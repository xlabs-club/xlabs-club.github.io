<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>HTTP Header on XLabs</title><link>https://www.xlabs.club/tags/http-header/</link><description>Recent content in HTTP Header on XLabs</description><generator>Hugo</generator><language>zh</language><copyright>Copyright (c) 2020-2025 XLabs Club</copyright><lastBuildDate>Tue, 30 Dec 2025 08:55:17 +0800</lastBuildDate><atom:link href="https://www.xlabs.club/tags/http-header/index.xml" rel="self" type="application/rss+xml"/><item><title>重复 Transfer-Encoding Response Header 引起的 Traefik 代理服务 500 问题</title><link>https://www.xlabs.club/blog/duplicate-transfer-encoding-chunked/</link><pubDate>Sun, 26 Nov 2023 10:21:44 +0800</pubDate><guid>https://www.xlabs.club/blog/duplicate-transfer-encoding-chunked/</guid><description>&lt;p&gt;我有一个 Spring Boot 应用服务，提供了一些简单的查询接口，本身运行很正常，通过 curl 或其他 http 客户端 localhost 请求都没有问题。&lt;/p&gt;
&lt;p&gt;某天通过 Traefik 代理了此服务，经过代理后再访问，某个接口一直都是 &lt;code&gt;500 internal server error&lt;/code&gt;，其他接口都没有问题。通过 tcpdump 抓包发现，应用服务并没有返回任何 500 错误，而且响应时间和 Body 体大小都很正常。&lt;/p&gt;
&lt;p&gt;根据网上经验排查了 Traefik SSL 证书问题、路径问题、消息体太大问题、请求 Header 不合规问题，都一一否定。最后无意间看了一眼 Response Header，发现 Spring Boot 应用返回了两个 &lt;code&gt;Transfer-Encoding: chunked&lt;/code&gt; Header。&lt;/p&gt;
&lt;p&gt;再根据此 Header 搜索，发现果然有人遇到过类似问题，请参考这几个链接。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/traefik/traefik/issues/7741" target="_blank" rel="noopener"&gt;https://github.com/traefik/traefik/issues/7741&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/spring-projects/spring-framework/issues/21523" target="_blank" rel="noopener"&gt;https://github.com/spring-projects/spring-framework/issues/21523&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/spring-projects/spring-boot/issues/37646" target="_blank" rel="noopener"&gt;https://github.com/spring-projects/spring-boot/issues/37646&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/77042701/nginx-upstream-sent-duplicate-header-line-transfer-encoding-chunked-previo" target="_blank" rel="noopener"&gt;https://stackoverflow.com/questions/77042701/nginx-upstream-sent-duplicate-header-line-transfer-encoding-chunked-previo&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从上面链接描述中可知，不仅 Traefik 会出现此问题，nginx 包含以 nginx 为基础的 ingress 也会出现同样问题，不过 nginx 返回错误信息类似 &lt;code&gt;Nginx: upstream sent duplicate header line: &amp;quot;Transfer-Encoding: chunked&amp;quot;, previous value: &amp;quot;Transfer-Encoding: chunked”&lt;/code&gt; ，返回错误码一般是 502 Bad Gateway。&lt;/p&gt;</description></item></channel></rss>