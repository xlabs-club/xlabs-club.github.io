<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Backstage on XLabs</title><link>https://www.xlabs.club/tags/backstage/</link><description>Recent content in Backstage on XLabs</description><generator>Hugo</generator><language>zh</language><copyright>Copyright (c) 2020-2025 XLabs Club</copyright><lastBuildDate>Sat, 20 Dec 2025 16:07:24 +0800</lastBuildDate><atom:link href="https://www.xlabs.club/tags/backstage/index.xml" rel="self" type="application/rss+xml"/><item><title>Backstage 集成 oauth2-proxy 和 Keycloak，实现用户管理、登录认证以及 RBAC、ABAC 授权</title><link>https://www.xlabs.club/blog/backstage-keycloak-oauth2-proxy/</link><pubDate>Sat, 16 Nov 2024 16:55:26 +0800</pubDate><guid>https://www.xlabs.club/blog/backstage-keycloak-oauth2-proxy/</guid><description>&lt;p&gt;基于 K8S 部署 Backstage，集成 oauth2-proxy 和 Keycloak，实现用户管理、认证和授权，配置详解和原理介绍。&lt;/p&gt;
&lt;p&gt;如果你遇到以下问题或诉求，可以参考此文档。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://backstage.io/" target="_blank" rel="noopener"&gt;Backstage&lt;/a&gt;
 接入 oauth2-proxy，登录或认证失败。&lt;/li&gt;
&lt;li&gt;Backstage 实现 RBAC、ABAC 授权管理，以及如何实现自定义权限。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://oauth2-proxy.github.io/oauth2-proxy/" target="_blank" rel="noopener"&gt;oauth2-proxy&lt;/a&gt;
 对接 keycloak，参数不理解或者配置一直错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在开始之前，我们先了解一个点，Backstage 官方开源有开箱即用的容器镜像，也有丰富的插件生态，然而区别于其他插件类应用，Backstage 有自己的特点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Backstage 插件分为 frontend 和 backend，一个完整的插件可能包含两种，也可能只包含其中一种。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;开源发布的开箱即用的容器镜像，只包含基础插件，一般只用来作为初次学习使用。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果想使用其他插件，需要做一些编码工作，一般步骤如下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;npx @backstage/create-app@latest&lt;/code&gt; 创建一个基础项目。&lt;/li&gt;
&lt;li&gt;按插件要求安装插件，配置插件菜单、UI 效果、权限、认证信息等，每个插件要求不同。&lt;/li&gt;
&lt;li&gt;按需开发自己的插件。&lt;/li&gt;
&lt;li&gt;编译成新容器镜像，某些插件可能还需要在容器中额外安装一些依赖包，部署时使用此容器镜像。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;基本上每个插件都有自己的配置要求，需根据插件文档配置 app-config.yaml。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;可以把 Backstage 类比于 Spring Boot，提供了 starter、framework、plugins，如果想真实使用，需要自己引入依赖，编译成自己的镜像发布部署，欢迎 star 我们基于 Backstage 定制的开源项目 &lt;a href="https://github.com/xlabs-club/xlabs-developer-platform" target="_blank" rel="noopener"&gt;xlabs-developer-platform&lt;/a&gt;
。&lt;/p&gt;
&lt;p&gt;核心组件介绍：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用户同步使用 Red Hat 贡献的社区开源插件 &lt;a href="https://github.com/backstage/community-plugins/tree/main/workspaces/keycloak/plugins/catalog-backend-module-keycloak" target="_blank" rel="noopener"&gt;@backstage-community/plugin-catalog-backend-module-keycloak&lt;/a&gt;
，将 keycloak 用户同步到 Backstage 数据库，后面我们会提到为什么需要这一步。&lt;/li&gt;
&lt;li&gt;认证使用官方内置的 &lt;a href="https://backstage.io/docs/auth/oauth2-proxy/provider" target="_blank" rel="noopener"&gt;OAuth 2 Proxy Provider&lt;/a&gt;
.&lt;/li&gt;
&lt;li&gt;授权，权限管理 Permissions，支持 RBAC、ABAC， 使用 Red Hat 贡献的社区开源插件 &lt;a href="https://github.com/backstage/community-plugins/tree/main/workspaces/rbac/plugins" target="_blank" rel="noopener"&gt;@backstage-community/plugin-rbac&lt;/a&gt;
，虽然插件名字叫 RBAC，但是实际上支持 ABAC。注意 Spotify 也有 &lt;a href="https://backstage.spotify.com/marketplace/spotify/plugin/rbac/" target="_blank" rel="noopener"&gt;RBAC 插件&lt;/a&gt;
 需要购买 License 才能用，两个插件别弄混了。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以上认证和授权是独立的，如果你只需要认证，不需要授权，那可以不需要 RBAC 插件。&lt;/p&gt;</description></item></channel></rss>