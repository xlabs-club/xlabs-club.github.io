<!doctype html><html lang=zh data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.fda21dad557b4560c85d0404e4f2df2e3c82fd0c71c1c7a1d1b519b9b77028edabab40695ef23211ec81684b3ccbd3db27466ee0a70e5c3a57b95b4b7adc02ec.css" integrity="sha512-/aIdrVV7RWDIXQQE5PLfLjyC/Qxxwceh0bUZubdwKO2rq0BpXvIyEeyBaEs8y9PbJ0Zu4KcOXDpXuVtLetwC7A==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/docs/platform/smart-code/><link rel=canonical href=https://www.xlabs.club/docs/platform/smart-code/><title>使用 OpenRewrite 进行大规模自动化代码重构，搭建私有化企业智能代码重构平台</title><meta name=description content="使用 OpenRewrite 进行大规模自动化代码重构，搭建私有化企业智能代码重构平台"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://www.xlabs.club/docs/platform/smart-code/"><meta property="og:site_name" content="XLabs"><meta property="og:title" content="智能代码重构"><meta property="og:description" content="使用 OpenRewrite 进行大规模自动化代码重构，搭建私有化企业智能代码重构平台"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-01-09T22:08:54+08:00"><meta property="article:modified_time" content="2025-09-10T14:56:58+08:00"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="智能代码重构"><meta name=twitter:description content="使用 OpenRewrite 进行大规模自动化代码重构，搭建私有化企业智能代码重构平台"><meta name=twitter:site content="@xlabs-club"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"卫星实验室","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"https://www.xlabs.club/docs/platform/","name":"平台工程","position":3},{"@type":"ListItem","name":"智能代码重构","position":4}]}</script><meta http-equiv=content-language content='zh-cn'></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/>XLabs</a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu">
<svg class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Guides</summary><ul class="list-unstyled list-nested"><li><a href=/docs/guides/introduction/>Introduction</a></li></ul></details></li><li><details open><summary>平台工程</summary><ul class="list-unstyled list-nested"><li><a href=/docs/platform/introduction/>总体架构</a></li><li><a href=/docs/platform/iam/>统一身份认证</a></li><li><a href=/docs/platform/backstage/>开发者门户</a></li><li class=active><a aria-current=page href=/docs/platform/smart-code/>智能代码重构</a></li></ul></details></li><li><details><summary>云原生</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cloud/introduction/>Introduction</a></li><li><a href=/docs/cloud/k8s-hpa-with-keda/>基于 KEDA 实现高效扩缩容</a></li></ul></details></li><li><details><summary>TL;DR</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tldr/kubernetes/>Kubernetes</a></li><li><a href=/docs/tldr/knife/>Knife</a></li><li><a href=/docs/tldr/shell-coding/>Shell Coding</a></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>XLabs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/docs/guides/introduction/ aria-current=true>Docs</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/xlabs-link-exchange>Links</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/about/>About</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/xlabs-club/xlabs-club.github.io><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details><summary>Guides</summary><ul class="list-unstyled list-nested"><li><a href=/docs/guides/introduction/>Introduction</a></li></ul></details></li><li><details open><summary>平台工程</summary><ul class="list-unstyled list-nested"><li><a href=/docs/platform/introduction/>总体架构</a></li><li><a href=/docs/platform/iam/>统一身份认证</a></li><li><a href=/docs/platform/backstage/>开发者门户</a></li><li class=active><a aria-current=page href=/docs/platform/smart-code/>智能代码重构</a></li></ul></details></li><li><details><summary>云原生</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cloud/introduction/>Introduction</a></li><li><a href=/docs/cloud/k8s-hpa-with-keda/>基于 KEDA 实现高效扩缩容</a></li></ul></details></li><li><details><summary>TL;DR</summary><ul class="list-unstyled list-nested"><li><a href=/docs/tldr/kubernetes/>Kubernetes</a></li><li><a href=/docs/tldr/knife/>Knife</a></li><li><a href=/docs/tldr/shell-coding/>Shell Coding</a></li></ul></details></li></ul></nav></div><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>目录</h3><nav id=toc><ul><li><a href=#openrewrite>OpenRewrite</a><ul><li><a href=#快速入门>快速入门</a></li><li><a href=#运行方式>运行方式</a></li><li><a href=#最佳实践和定制>最佳实践和定制</a></li><li><a href=#ci-集成>CI 集成</a></li></ul></li><li><a href=#spring-boot-migrator>Spring Boot Migrator</a></li><li><a href=#openrewrite-使用示例>OpenRewrite 使用示例</a><ul><li><a href=#升级到-java-21>升级到 Java 21</a></li><li><a href=#base64-方法替换>Base64 方法替换</a></li><li><a href=#升级到-jakartaee>升级到 JakartaEE</a></li><li><a href=#代码清理>代码清理</a></li><li><a href=#静态分析查找重构>静态分析、查找、重构</a></li><li><a href=#通用代码格式化>通用代码格式化</a></li><li><a href=#日志优化>日志优化</a></li><li><a href=#spring-到-spring-boot>Spring 到 Spring Boot</a></li><li><a href=#试用总结>试用总结</a></li></ul></li><li><a href=#遇见问题和解决办法>遇见问题和解决办法</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>智能代码重构</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>目录</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#openrewrite>OpenRewrite</a><ul><li><a href=#快速入门>快速入门</a></li><li><a href=#运行方式>运行方式</a></li><li><a href=#最佳实践和定制>最佳实践和定制</a></li><li><a href=#ci-集成>CI 集成</a></li></ul></li><li><a href=#spring-boot-migrator>Spring Boot Migrator</a></li><li><a href=#openrewrite-使用示例>OpenRewrite 使用示例</a><ul><li><a href=#升级到-java-21>升级到 Java 21</a></li><li><a href=#base64-方法替换>Base64 方法替换</a></li><li><a href=#升级到-jakartaee>升级到 JakartaEE</a></li><li><a href=#代码清理>代码清理</a></li><li><a href=#静态分析查找重构>静态分析、查找、重构</a></li><li><a href=#通用代码格式化>通用代码格式化</a></li><li><a href=#日志优化>日志优化</a></li><li><a href=#spring-到-spring-boot>Spring 到 Spring Boot</a></li><li><a href=#试用总结>试用总结</a></li></ul></li><li><a href=#遇见问题和解决办法>遇见问题和解决办法</a></li></ul></nav></div></details></nav><p>作为一个以 Java 和 Spring 为主要技术栈的团队，在日常的软件开发中，我们经常会遇到一系列的组件升级和代码重构需求，在此过程我们期望能做到几个效果：</p><ul><li>项目级升级：整个项目（注此项目指 Maven Project）升级，而不是基于某个 Java 类或片段。</li><li>不同版本跨度变更：比如从 Spring 项目迁移到 Spring Boot，从 Spring Boot 2.x 升级到 3.x，从 Java 8 升级到 Java 21。</li><li>代码安全可靠：变更的代码一定是正确的，至少是逻辑正确的，至少不能像某 AI 助手一样设置一些根本不存在的属性。</li><li>经验产品化：最佳实践就是产品，比如我并不（想）了解 Spring Boot 3.2 具体有哪些变更，但希望能一键从 3.0 自动升级到 3.2，直接告诉有哪些变更。</li><li>自定义重构：对于某些自研代码，希望能自定义重构逻辑，一键自动重构。</li></ul><p>基于以上背景，我们探索了 <a href=https://docs.openrewrite.org/ target=_blank rel=noopener>OpenRewrite</a>
、<a href=https://github.com/spring-projects-experimental/spring-boot-migrator target=_blank rel=noopener>Spring Boot Migrator</a>
、<a href=https://github.com/windup target=_blank rel=noopener>Redhat Windup</a>
、<a href=https://github.com/adoptium/emt4j target=_blank rel=noopener>emt4j</a>
和一众不便具名的 AI 代码助手，本文将分享我们使用 OpenRewrite、Spring Boot Migrator 进行代码重构和升级的一些使用经验和体验。</p><h2 id=openrewrite>OpenRewrite<a href=#openrewrite class=anchor aria-hidden=true>#</a></h2><p><a href=https://docs.openrewrite.org/ target=_blank rel=noopener>OpenRewrite</a>
是一个开源的代码重写工具，旨在帮助开发人员自动化大规模重构代码。</p><p>它提供了一套强大的 API 和插件系统，可以通过静态分析和代码转换技术来解析、修改和生成代码。OpenRewrite 支持多种编程语言，包括 Java、C#、 TypeScript、Python、Kubernetes 等。通过使用 OpenRewrite，开发人员可以轻松地进行代码重构、性能优化、代码风格调整和代码迁移等操作，从而提高代码质量和可维护性。OpenRewrite 的开源性质使得开发人员可以自由地定制和扩展其功能，以满足特定项目的需求。</p><p>比如 Java 领域一些热门的应用场景：</p><ul><li>Java 版本升级：从 Java 8 到 Java 21，从 Java EE 到 Jakarta EE 。</li><li>Spring 框架迁移：从 Spring 5 到 Spring 6，从 Spring Boot 2 到 Spring Boot 3。</li><li>测试框架迁移： 从 Junit 4 到 Junit 5。</li><li>依赖管理：自动更新 Java 项目的 Maven 或 Gradle 依赖，确保使用最新和最安全的库版本。</li><li>代码清理和格式化：自动清理和格式化 Java 代码，确保符合项目或组织的编码标准和风格指南。</li><li>修复安全漏洞：自动识别和修复 Java 代码中的已知安全漏洞，如使用了有安全问题的库或方法。</li><li>代码异味检测和修复：识别并自动重构 Java 代码中的“代码异味”，以提高代码可维护性。</li></ul><p>相比于时下火热的 AI 代码工具，比如 GitHub Copilot、Amazon CodeWhisperer，我认为 OpenRewrite 的优势主要有以下几点：</p><ul><li>可以直接处理大型项目，截止我写此文的今天还没一个成熟的 AI 助手能将整个项目一次性迁移或重构。</li><li>准确度较高，它通过预定义的规则来实现代码的精确修改，目前很多 AI 代码助手还在一本正经的瞎扯，尤其是凭空创造让人防不胜防。</li><li>可自定义扩展，对于自研代码不可能经过自动学习达到精确的效果，此时可自定义实现。</li><li>免费，可离线使用，便于 CI 集成。</li></ul><p>值得一提的是，AWS 最近推出了 Amazon Q Code Transformation 专门做代码迁移和重构，需要开通 Amazon CodeWhisperer 企业版才能使用，可惜我没有钱去试用。</p><h3 id=快速入门>快速入门<a href=#快速入门 class=anchor aria-hidden=true>#</a></h3><p>OpenRewrite 一个最核心的概念是 <code>Recipe</code>，由于我是国内首个翻译这个单词的人，以下将直译为食谱。一个 Recipe 可以理解为是一套声明好的规则，OpenRewrite 按照固定规则进行重构。</p><p>一个 Recipe 可以包含多个 Recipe，可以层级累加，比如 <code>UpgradeSpringBoot_3_2</code>可能包含对 pom.xml、application.properties、java main source、java test source 的升级改动。</p><p>初次使用 OpenRewrite，可通过官方提供的 <a href=https://docs.openrewrite.org/running-recipes/popular-recipe-guides target=_blank rel=noopener>热门指导</a>
找到自己感兴趣的按步骤操作。</p><p>另外就是食谱很多，一个一个用很麻烦，可优先考虑 <code>best practices</code> 系列，里面聚合了多个食谱。</p><p><a href=./popular-recipe-guides.png><img src=/docs/platform/smart-code/popular-recipe-guides_hu_ee452bc4396b6167.webp width=1582 height=1350 decoding=async fetchpriority=auto loading=lazy alt=popular-recipe-guides id=h-rh-i-0></a></p><p>更多功能可通过 <a href=https://docs.openrewrite.org/recipes target=_blank rel=noopener>食谱分类</a>
搜索，也可通过官网右上方的搜索按钮按照关键字搜索，也可通过 <code>mvn rewrite:discover</code> 列出可用的食谱。</p><p><a href=./recipes.png><img src=/docs/platform/smart-code/recipes_hu_6fb8e1cce8796f09.webp width=1532 height=1796 decoding=async fetchpriority=auto loading=lazy alt=recipes id=h-rh-i-1></a></p><h3 id=运行方式>运行方式<a href=#运行方式 class=anchor aria-hidden=true>#</a></h3><p>友情提示：运行前请把代码交给 Git 管理，并 checkout 一个全新的分支，便于比对自动修改了哪些代码。</p><p>OpenRewrite 支持使用 maven、gradle 以及使用 SaaS 服务 Moderne cli <code>mod</code> 这三种方法。</p><ol><li><p>使用 maven、gradle 文件定制比较方便，dependency 管理也比较灵活，另外某些食谱只有 maven、gradle 支持，缺点则是需要修改 pom、gradle 文件。</p></li><li><p>使用 maven 命令行直接执行插件任务并指定属性，不用改 pom.xml 更方便，缺点是不方便管理 dependencies。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.java.migrate.jakarta.JakartaEE10 -Drewrite.exportDatatables<span class=o>=</span>true</span></span></code></pre></div></figure></div></li><li><p>使用 SaaS 服务提供的 Moderne CLI 最方便，比如 <code>mod run . --recipe JakartaEE10</code>, 需要注册 license。</p></li></ol><h3 id=最佳实践和定制>最佳实践和定制<a href=#最佳实践和定制 class=anchor aria-hidden=true>#</a></h3><p>OpenRewrite 对不同类型分别内置了一些最佳实践，可通过 <code>best practices</code> 关键字搜索。</p><p><a href=./best-practices.png><img src=/docs/platform/smart-code/best-practices_hu_73354cb024798e29.webp width=1618 height=1326 decoding=async fetchpriority=auto loading=lazy alt=best-practices id=h-rh-i-2></a></p><p>最佳实践包含了哪些规则呢，以 <a href=https://docs.openrewrite.org/recipes/java/spring/boot3/springboot3bestpractices target=_blank rel=noopener>Spring Boot 3.x best practices</a>
为例，在文档中能看到对应的食谱列表如下：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>specs.openrewrite.org/v1beta/recipe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>org.openrewrite.java.spring.boot3.SpringBoot3BestPractices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Spring Boot 3.x best practices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Applies best practices to Spring Boot 3 applications.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>spring</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>boot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>recipeList</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.boot2.SpringBoot2BestPractices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.UpgradeToJava21</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.boot3.UpgradeSpringBoot_3_2</span></span></span></code></pre></div></figure></div><p>而其中每个食谱又可能包含多个，比如上面的 <a href=https://docs.openrewrite.org/recipes/java/spring/boot2/springboot2bestpractices target=_blank rel=noopener>org.openrewrite.java.spring.boot2.SpringBoot2BestPractices</a>
又包含以下列表：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>specs.openrewrite.org/v1beta/recipe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>org.openrewrite.java.spring.boot2.SpringBoot2BestPractices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Spring Boot 2.x best practices</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Applies best practices to Spring Boot 2 applications.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>spring</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>boot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>recipeList</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.NoRequestMappingAnnotation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.ImplicitWebAnnotationNames</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.boot2.UnnecessarySpringExtension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.NoAutowiredOnConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.boot2.RestTemplateBuilderRequestFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.spring.boot2.ReplaceDeprecatedEnvironmentTestUtils</span></span></span></code></pre></div></figure></div><p>如果官方的某个食谱不和你的胃口，比如想在最佳实践中去掉或新增某个自定义食谱怎么办，可以自己定义一个 <code>rewrite.yml</code> 文件，类似上面的 yaml 文件，在文件中自行组合食谱。注意 <code>rewrite.yml</code> 文件要放到 maven 项目的根目录下，更多关于文件的说明参考 <a href=https://docs.openrewrite.org/running-recipes/popular-recipe-guides/authoring-declarative-yaml-recipes target=_blank rel=noopener>Refactoring with declarative YAML recipes</a>
。</p><h3 id=ci-集成>CI 集成<a href=#ci-集成 class=anchor aria-hidden=true>#</a></h3><p>通过 <code>mvn rewrite:run</code> 命令执行后，会直接修改代码。但是大部分 CI 场景下，我们可能只想做分析，不想真正改动代码。那么就可以把命令换成 <code>mvn rewrite:dryRun</code>，dryRun 会在控制台输出 warning 结果，并生成一个 rewrite.patch 文件。</p><p>如果 dryRun 向控制台日志发出任何警告，或者生成了 rewrite.patch 文件，证明此次有需要变更的地方，则可视为 CI 失败。</p><h2 id=spring-boot-migrator>Spring Boot Migrator<a href=#spring-boot-migrator class=anchor aria-hidden=true>#</a></h2><p>OpenRewrite 功能很强悍，但是仍缺失一项功能：将传统 Spring 项目一键迁移到 Spring Boot。</p><p>Spring Boot Migrator 基于 OpenRewrite，是一个专门用于协助将传统的 Spring 应用迁移到基于 Spring Boot 的工具，同时也提供 Spring Boot 的升级。</p><p>Spring Boot Migrator 程序运行起来后，通过 <code>list</code> 命令可以看到提供的 OpenRewrite recipes，其中主要关注的有：</p><ul><li>initialize-spring-boot-migration: 将项目初始化为 Spring Boot 应用。</li><li>migrate-spring-xml-to-java-config：将 Spring xml 转换为 Java 注解。</li><li>spring-context-xml-import：使用 Import xml 文件的形式初始化 Bean。</li><li>boot-2.7-3.0-dependency-version-update：Spring Boot 2 升级到 Spring Boot 3。</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>migrator:&gt; list
</span></span></span><span class=line><span class=cl><span class=go>Found these recipes:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  1) remove-redundant-maven-compiler-plugin
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Remove standard maven-compiler plugin for applications with boot parent.
</span></span></span><span class=line><span class=cl><span class=go>  2) initialize-spring-boot-migration
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Initialize an application as Spring Boot application.
</span></span></span><span class=line><span class=cl><span class=go>  3) migrate-jndi-lookup
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate JNDI lookup using InitialContext to Spring Boot
</span></span></span><span class=line><span class=cl><span class=go>  4) migrate-jpa-to-spring-boot
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate JPA to Spring Boot
</span></span></span><span class=line><span class=cl><span class=go>  5) migrate-ejb-jar-deployment-descriptor
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Add or overrides @Stateless annotation as defined in ejb deployment descriptor
</span></span></span><span class=line><span class=cl><span class=go>  6) migrate-weblogic-ejb-deployment-descriptor
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate weblogic-ejb-jar.xml deployment descriptor
</span></span></span><span class=line><span class=cl><span class=go>  7) mark-and-clean-remote-ejbs
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Search @Stateless EJBs implementing a @Remote interface
</span></span></span><span class=line><span class=cl><span class=go>  8) migrate-stateless-ejb
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migration of stateless EJB to Spring components.
</span></span></span><span class=line><span class=cl><span class=go>  9) migrate-annotated-servlets
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Allow Spring Boot to deploy servlets annotated with @WebServlet
</span></span></span><span class=line><span class=cl><span class=go>  10) migrate-jax-ws
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate Jax Web-Service implementation to Spring Boot bases Web-Service
</span></span></span><span class=line><span class=cl><span class=go>  11) migrate-jax-rs
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Any class has import starting with javax.ws.rs
</span></span></span><span class=line><span class=cl><span class=go>  12) migrate-mule-to-boot
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate Mulesoft 3.9 to Spring Boot.
</span></span></span><span class=line><span class=cl><span class=go>  13) migrate-tx-to-spring-boot
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migration of @TransactionAttribute to @Transactionsl
</span></span></span><span class=line><span class=cl><span class=go>  14) spring-context-xml-import
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Import Spring Framework xml bean configuration into Java configuration without converting them.
</span></span></span><span class=line><span class=cl><span class=go>  15) migrate-spring-xml-to-java-config
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate Spring Framework xml bean configuration to Java configuration.
</span></span></span><span class=line><span class=cl><span class=go>  16) migrate-jms
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Convert JEE JMS app into Spring Boot JMS app
</span></span></span><span class=line><span class=cl><span class=go>  17) documentation-actions
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Create Documentation for Actions
</span></span></span><span class=line><span class=cl><span class=go>  18) migrate-jsf-2.x-to-spring-boot
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Use joinfaces to integrate JSF 2.x with Spring Boot.
</span></span></span><span class=line><span class=cl><span class=go>  19) cn-spring-cloud-config-server
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Externalize properties to Spring Cloud Config Server
</span></span></span><span class=line><span class=cl><span class=go>  20) boot-2.4-2.5-upgrade-report
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Create Upgrade Report for a Spring Boot 2.4 Application
</span></span></span><span class=line><span class=cl><span class=go>  21) boot-2.7-3.0-dependency-version-update
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Bump spring-boot-starter-parent from 2.7.x to 3.0.0
</span></span></span><span class=line><span class=cl><span class=go>  22) boot-autoconfiguration-update
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Create org.springframework.boot.autoconfigure.AutoConfiguration.imports file for new spring 2.7
</span></span></span><span class=line><span class=cl><span class=go>  23) boot-2.4-2.5-datasource-initializer
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Replace deprecated spring.datasource.* properties
</span></span></span><span class=line><span class=cl><span class=go>  24) boot-2.4-2.5-spring-data-jpa
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Rename JpaRepository methods getId() and calls to getOne()
</span></span></span><span class=line><span class=cl><span class=go>  25) boot-2.4-2.5-dependency-version-update
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Update Spring Boot dependencies from 2.4 to 2.5
</span></span></span><span class=line><span class=cl><span class=go>  26) boot-2.7-3.0-upgrade-report
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.0-M3
</span></span></span><span class=line><span class=cl><span class=go>  27) boot-2.4-2.5-sql-init-properties
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Replace deprecated spring.datasource.* properties
</span></span></span><span class=line><span class=cl><span class=go>  28) sbu30-report
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.x
</span></span></span><span class=line><span class=cl><span class=go>  29) sbu30-upgrade-dependencies
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Upgrade dependencies
</span></span></span><span class=line><span class=cl><span class=go>  30) sbu30-set-java-version
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Set java version property in build file
</span></span></span><span class=line><span class=cl><span class=go>  31) sbu30-add-milestone-repositories
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins
</span></span></span><span class=line><span class=cl><span class=go>  32) sbu30-migrate-spring-data-properties
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Migrate &#39;spring.data&#39; properties to new property names
</span></span></span><span class=line><span class=cl><span class=go>  33) sbu30-remove-construtor-binding
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Remove redundant @ConstructorBinding annotations
</span></span></span><span class=line><span class=cl><span class=go>  34) sbu30-migrate-to-jakarta-packages
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Migrate javax packages to new jakarta packages
</span></span></span><span class=line><span class=cl><span class=go>  35) sbu30-johnzon-dependency-update
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Specify version number for johnzon-core
</span></span></span><span class=line><span class=cl><span class=go>  36) sbu30-225-logging-date-format
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Logging Date Format
</span></span></span><span class=line><span class=cl><span class=go>  37) sbu30-auto-configuration
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Move EnableAutoConfiguration Property from spring.factories to AutoConfiguration.imports
</span></span></span><span class=line><span class=cl><span class=go>  38) sbu30-upgrade-spring-cloud-dependency
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Upgrade Spring Cloud Dependencies
</span></span></span><span class=line><span class=cl><span class=go>  39) sbu30-upgrade-boot-version
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Upgrade Spring Boot version
</span></span></span><span class=line><span class=cl><span class=go>  40) sbu30-remove-image-banner
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Remove the image banner at src/main/resources
</span></span></span><span class=line><span class=cl><span class=go>  41) sbu30-paging-and-sorting-repository
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Spring boot 3.0 Upgrade - Add CrudRepository interface extension additionally to PagingAndSortingRepository
</span></span></span><span class=line><span class=cl><span class=go>  42) migrate-raml-to-spring-mvc
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Create Spring Boot @RestController from .raml files.
</span></span></span><span class=line><span class=cl><span class=go>  43) migrate-boot-2.3-2.4
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate from Spring Boot 2.3 to 2.4
</span></span></span><span class=line><span class=cl><span class=go>  44) upgrade-boot-1x-to-2x
</span></span></span><span class=line><span class=cl><span class=go>     -&gt; Migrate applications built on previous versions of Spring Boot to the latest Spring Boot 2.7 release.
</span></span></span></code></pre></div></figure></div><h2 id=openrewrite-使用示例>OpenRewrite 使用示例<a href=#openrewrite-使用示例 class=anchor aria-hidden=true>#</a></h2><p>下面使用 maven 方式演示几个例子，注意如果是 maven 多模块项目，请在父模块下执行，否则运行可能出错，参考官方说明：<a href=https://docs.openrewrite.org/running-recipes/multi-module-maven target=_blank rel=noopener>Running Rewrite on a multi-module Maven project</a>
。</p><p>友情提醒：初次使用会下载很多依赖 jar 包，速度可能比较慢，切换到你最快的 maven 仓库。</p><h3 id=升级到-java-21>升级到 Java 21<a href=#升级到-java-21 class=anchor aria-hidden=true>#</a></h3><p>从任意版本升级到 Java 21。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.java.migrate.UpgradeToJava21
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 或者手动指定版本</span>
</span></span><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:5.31.0:run -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-migrate-java:2.14.0 -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.java.migrate.UpgradeToJava21</span></span></code></pre></div></figure></div><p>OpenRewrite 会自动替换一些 Java 21 支持的新特性，如：</p><ol><li>大文本块 JEP 378: Text Blocks，自动优化格式化。</li><li>模式匹配增强：支持在执行 instanceof 操作时同时定义指定类型的新变量，省却了类型转换的过程。</li><li>String 类增加的新格式化方法： formatted(Object…​ args)。</li><li>排序性集合：可以直接使用 getFirst() 和 getLast() 来获取第一个和最后一个集合元素了。参考： JEP 431: Sequenced Collections。</li></ol><h3 id=base64-方法替换>Base64 方法替换<a href=#base64-方法替换 class=anchor aria-hidden=true>#</a></h3><p>Base64 常用的实现有：</p><ol><li>Apache Common Codec，依然可用，可以选择是否转换成 java.util.Base64。</li><li>sun.misc 包下提供的实现类，从 Java 9 开始，已经不再对外提供，需要替换。</li><li>从 Java 1.8 开始提供的标准库 java.util.Base64。</li></ol><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># UseJavaUtilBase64</span>
</span></span><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.java.migrate.UseJavaUtilBase64 -Drewrite.exportDatatables<span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ApacheBase64ToJavaBase64</span>
</span></span><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-apache:RELEASE -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.apache.commons.codec.ApacheBase64ToJavaBase64 -Drewrite.exportDatatables<span class=o>=</span>true</span></span></code></pre></div></figure></div><p>另外更多关于 Apache 包升级、使用 Java 自带方法代替 Apache Utils 的方法，请参考 OpenRewrite 官网 <code>apache</code> 下的食谱。</p><h3 id=升级到-jakartaee>升级到 JakartaEE<a href=#升级到-jakartaee class=anchor aria-hidden=true>#</a></h3><p>从 javax 到 jakarta，在 maven 项目父（根）模块下执行以下命令即可，注意命令可能随着版本变化，请去官网查看最新版本示例。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.java.migrate.jakarta.JakartaEE10 -Drewrite.exportDatatables<span class=o>=</span>true</span></span></code></pre></div></figure></div><p>执行完成后可根据 git diff 查看修改效果。</p><h3 id=代码清理>代码清理<a href=#代码清理 class=anchor aria-hidden=true>#</a></h3><p>先试一下 CodeCleanup 效果。</p><p>pom.xml 文件中增加以下配置，然后执行 <code>mvn rewrite:run</code>。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.openrewrite.maven<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>rewrite-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>5.23.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;activeRecipes&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;recipe&gt;</span>org.openrewrite.staticanalysis.CodeCleanup<span class=nt>&lt;/recipe&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/activeRecipes&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.openrewrite.recipe<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rewrite-static-analysis<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>1.3.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/build&gt;</span></span></span></code></pre></div></figure></div><p>我的某个项目执行效果：</p><ul><li>删除了一些多余的空格、空行、多括号。</li><li>代码格式化，比如多个参数间缺少空格的加了空格。</li><li>颠倒了一个 equals 比较： <code>method.equals("CONNECT") -> "CONNECT".equals(method)</code>。</li><li>长代码换行归整，三元运算格式化。</li></ul><h3 id=静态分析查找重构>静态分析、查找、重构<a href=#静态分析查找重构 class=anchor aria-hidden=true>#</a></h3><p>支持以下功能，不一一列举，请参考官方文档。</p><ul><li>分析依赖关系。</li><li>查找某个方法是否被使用。</li><li>将某个方法替换为某个方法。</li><li>批量修改方法名字，修改参数类型等。</li><li>排序 imports ，删除未使用的 imports。</li></ul><h3 id=通用代码格式化>通用代码格式化<a href=#通用代码格式化 class=anchor aria-hidden=true>#</a></h3><p>无用空行、空白符、前后空白符、方法参数前后空白符、Tab 转 space 等一些常用格式化方式。</p><h3 id=日志优化>日志优化<a href=#日志优化 class=anchor aria-hidden=true>#</a></h3><ul><li>Parameterize logging statements：把字符串拼接自动转为参数类型。</li><li>用 logger 代替 System.err、System.out、printStackTrace。</li><li>把 JUL、log4j、logback 都转为 slf4j API。</li></ul><h3 id=spring-到-spring-boot>Spring 到 Spring Boot<a href=#spring-到-spring-boot class=anchor aria-hidden=true>#</a></h3><p>下面介绍下我们将 Spring 项目迁移到 Spring Boot 的过程，以及中间遇到的一些问题。</p><table><thead><tr><th>升级项</th><th>迁移前</th><th>迁移后</th></tr></thead><tbody><tr><td>Runtime</td><td>Spring + Tomcat</td><td>Spring Boot 3.2</td></tr><tr><td>Spring</td><td>Spring 4</td><td>Spring 6</td></tr><tr><td>Junit</td><td>Junit 4</td><td>Junit 5</td></tr><tr><td>okhttp</td><td>okhttp 3</td><td>okhttp 4</td></tr><tr><td>Java</td><td>Java 8</td><td>Java 21</td></tr><tr><td>Java EE</td><td>Java EE</td><td>Jakarta EE</td></tr></tbody></table><p>基本步骤：</p><ol><li><p>使用 Spring Boot Migrator 将 Spring 项目转换成 Spring Boot，使用 Java 17 启动 spring-boot-migrator 程序并根据提示一步一步操作，如果某个步骤出错，根据 <code>stacktrace</code> 命令查看错误信息，修复后继续 <code>apply &lt;recipe-number></code>。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意在执行 spring-boot-migrator 前，先在你要升级的项目中执行 mvn clean package install，拉取和安装依赖包，避免下面的 scan 步骤中下载依赖包失败
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 使用 Java <span class=m>17</span> 启动 spring-boot-migrator 程序
</span></span><span class=line><span class=cl><span class=gp>$</span> java -jar spring-boot-migrator.jar
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Get Started:
</span></span></span><span class=line><span class=cl><span class=go>------------
</span></span></span><span class=line><span class=cl><span class=go>Type
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&#34;help&#34; - to display a list all of the available commands.
</span></span></span><span class=line><span class=cl><span class=go>&#34;scan &lt;dir&gt;&#34; - to scan an application
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--------------------------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>migrator:&gt; scan my-spring-project-dir
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[ok] Found pom.xml.
</span></span></span><span class=line><span class=cl><span class=go>[ok] &#39;sbm.gitSupportEnabled&#39; is &#39;true&#39;, changes will be committed to branch [springboot] after each recipe.
</span></span></span><span class=line><span class=cl><span class=go>[ok] Found required source dir &#39;src/main/java&#39;.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Maven        100% │██████████████████████████████████│ 2/2 (0:00:00 / 0:00:00)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Applicable recipes:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>1) remove-redundant-maven-compiler-plugin
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Remove standard maven-compiler plugin for applications with boot parent.
</span></span></span><span class=line><span class=cl><span class=go>2) initialize-spring-boot-migration
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Initialize an application as Spring Boot application.
</span></span></span><span class=line><span class=cl><span class=go>3) spring-context-xml-import
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Import Spring Framework xml bean configuration into Java configuration without converting them.
</span></span></span><span class=line><span class=cl><span class=go>4) migrate-spring-xml-to-java-config
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Migrate Spring Framework xml bean configuration to Java configuration.
</span></span></span><span class=line><span class=cl><span class=go>5) cn-spring-cloud-config-server
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Externalize properties to Spring Cloud Config Server
</span></span></span><span class=line><span class=cl><span class=go>6) sbu30-set-java-version
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Set java version property in build file
</span></span></span><span class=line><span class=cl><span class=go>7) sbu30-add-milestone-repositories
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins
</span></span></span><span class=line><span class=cl><span class=go>8) sbu30-225-logging-date-format
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Logging Date Format
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Run command &#39;&gt; apply &lt;recipe-number&gt;&#39; to apply a recipe.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ibss-site-dc:&gt; apply remove-redundant-maven-compiler-plugin
</span></span></span><span class=line><span class=cl><span class=go>Applying recipe &#39;remove-redundant-maven-compiler-plugin&#39;
</span></span></span><span class=line><span class=cl><span class=go>[ok] Clean up redundant properties for maven compiler plugin.
</span></span></span><span class=line><span class=cl><span class=go>[ok] Clean up redundant maven compiler plugin.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>remove-redundant-maven-compiler-plugin successfully applied the following actions:
</span></span></span><span class=line><span class=cl><span class=go>(x) Clean up redundant properties for maven compiler plugin.
</span></span></span><span class=line><span class=cl><span class=go>(x) Clean up redundant maven compiler plugin.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Applicable recipes:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>1) initialize-spring-boot-migration
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Initialize an application as Spring Boot application.
</span></span></span><span class=line><span class=cl><span class=go>2) spring-context-xml-import
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Import Spring Framework xml bean configuration into Java configuration without converting them.
</span></span></span><span class=line><span class=cl><span class=go>3) migrate-spring-xml-to-java-config
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Migrate Spring Framework xml bean configuration to Java configuration.
</span></span></span><span class=line><span class=cl><span class=go>4) cn-spring-cloud-config-server
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Externalize properties to Spring Cloud Config Server
</span></span></span><span class=line><span class=cl><span class=go>5) sbu30-set-java-version
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Set java version property in build file
</span></span></span><span class=line><span class=cl><span class=go>6) sbu30-add-milestone-repositories
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins
</span></span></span><span class=line><span class=cl><span class=go>7) sbu30-225-logging-date-format
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Logging Date Format
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Run command &#39;&gt; apply &lt;recipe-number&gt;&#39; to apply a recipe.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ibss-site-dc:&gt; apply initialize-spring-boot-migration
</span></span></span><span class=line><span class=cl><span class=go>Applying recipe &#39;initialize-spring-boot-migration&#39;
</span></span></span><span class=line><span class=cl><span class=go>[ok] Add Spring Boot dependency management section to buildfile.
</span></span></span><span class=line><span class=cl><span class=go>[ok] Add Spring Boot starter class.
</span></span></span><span class=line><span class=cl><span class=go>[ok] Add initial unit test class to test Spring Boot Application Context startup.
</span></span></span><span class=line><span class=cl><span class=go>[ok] Set packaging to &#39;jar&#39; type if different
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>initialize-spring-boot-migration successfully applied the following actions:
</span></span></span><span class=line><span class=cl><span class=go>(x) Add Spring Boot dependency management section to buildfile.
</span></span></span><span class=line><span class=cl><span class=go>(x) Add spring dependencies &#39;spring-boot-starter&#39; and &#39;spring-boot-starter-test&#39;.
</span></span></span><span class=line><span class=cl><span class=go>(x) Delete dependencies to artifacts transitively managed by Spring Boot.
</span></span></span><span class=line><span class=cl><span class=go>(x) Add Spring Boot Maven plugin.
</span></span></span><span class=line><span class=cl><span class=go>(x) Add Spring Boot starter class.
</span></span></span><span class=line><span class=cl><span class=go>(x) Add initial unit test class to test Spring Boot Application Context startup.
</span></span></span><span class=line><span class=cl><span class=go>(x) Set packaging to &#39;jar&#39; type if different
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Applicable recipes:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>1) spring-context-xml-import
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Import Spring Framework xml bean configuration into Java configuration without converting them.
</span></span></span><span class=line><span class=cl><span class=go>2) migrate-spring-xml-to-java-config
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Migrate Spring Framework xml bean configuration to Java configuration.
</span></span></span><span class=line><span class=cl><span class=go>3) cn-spring-cloud-config-server
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Externalize properties to Spring Cloud Config Server
</span></span></span><span class=line><span class=cl><span class=go>4) boot-2.7-3.0-dependency-version-update
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Bump spring-boot-starter-parent from 2.7.x to 3.0.0
</span></span></span><span class=line><span class=cl><span class=go>5) boot-2.7-3.0-upgrade-report
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.0-M3
</span></span></span><span class=line><span class=cl><span class=go>6) sbu30-report
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.x
</span></span></span><span class=line><span class=cl><span class=go>7) sbu30-upgrade-dependencies
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Upgrade dependencies
</span></span></span><span class=line><span class=cl><span class=go>8) sbu30-set-java-version
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Set java version property in build file
</span></span></span><span class=line><span class=cl><span class=go>9) sbu30-add-milestone-repositories
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins
</span></span></span><span class=line><span class=cl><span class=go>10) sbu30-remove-construtor-binding
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Remove redundant @ConstructorBinding annotations
</span></span></span><span class=line><span class=cl><span class=go>11) sbu30-225-logging-date-format
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Logging Date Format
</span></span></span><span class=line><span class=cl><span class=go>12) sbu30-upgrade-spring-cloud-dependency
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Upgrade Spring Cloud Dependencies
</span></span></span><span class=line><span class=cl><span class=go>13) sbu30-upgrade-boot-version
</span></span></span><span class=line><span class=cl><span class=go>   -&gt; Spring boot 3.0 Upgrade - Upgrade Spring Boot version
</span></span></span></code></pre></div></figure></div></li><li><p>Spring Boot Migrator 目前还并不成熟，以上步骤中很多 <code>recipe</code> 可能出错，所以我只用 Spring Boot Migrator 做一些基础初始化，其他任务使用 rewrite-maven-plugin，交给 openrewrite 执行。在 maven pom.xml 中增加以下配置后，执行 <code>mvn rewrite:run</code>。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>   <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;groupId&gt;</span>org.openrewrite.maven<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;artifactId&gt;</span>rewrite-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;version&gt;</span>5.19.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;activeRecipes&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;recipe&gt;</span>org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7<span class=nt>&lt;/recipe&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;recipe&gt;</span>org.openrewrite.java.testing.junit5.JUnit4to5Migration<span class=nt>&lt;/recipe&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;recipe&gt;</span>org.openrewrite.okhttp.UpgradeOkHttp4<span class=nt>&lt;/recipe&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;recipe&gt;</span>org.openrewrite.okhttp.ReorderRequestBodyCreateArguments<span class=nt>&lt;/recipe&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;recipe&gt;</span>org.openrewrite.java.migrate.UpgradeToJava17<span class=nt>&lt;/recipe&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;/activeRecipes&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.openrewrite.recipe<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rewrite-spring<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>5.2.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.openrewrite.recipe<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rewrite-testing-frameworks<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>2.2.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.openrewrite.recipe<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rewrite-okhttp<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>0.1.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.openrewrite.recipe<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rewrite-migrate-java<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>2.5.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/plugin&gt;</span></span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[INFO] Using active recipe(s) [org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7, org.openrewrite.java.testing.junit5.JUnit4to5Migration]
</span></span></span><span class=line><span class=cl><span class=go>[INFO] Using active styles(s) []
</span></span></span><span class=line><span class=cl><span class=go>[INFO] Validating active recipes...
</span></span></span><span class=line><span class=cl><span class=go>[INFO] Project [ibss-site-dc] Resolving Poms...
</span></span></span><span class=line><span class=cl><span class=go>[INFO] Project [ibss-site-dc] Parsing source files
</span></span></span><span class=line><span class=cl><span class=go>[INFO] Running recipe(s)...
</span></span></span><span class=line><span class=cl><span class=go>[WARNING] Changes have been made to pom.xml by:
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]     org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]         org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_6
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]             org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_5
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                 org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_4
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                     org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                         org.openrewrite.java.testing.junit5.JUnit4to5Migration
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                             org.openrewrite.maven.ExcludeDependency: {groupId=junit, artifactId=junit}
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]         org.openrewrite.java.dependencies.UpgradeDependencyVersion: {groupId=org.springframework.boot, artifactId=*, newVersion=2.7.x, overrideManagedVersion=false}
</span></span></span><span class=line><span class=cl><span class=go>[WARNING] Changes have been made to src/main/java/com/fsde/ibss/dc/controller/ClientController.java by:
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]     org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]         org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_6
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]             org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_5
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                 org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_4
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                     org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_3
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                         org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_2
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                             org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_1
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                                 org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_0
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                                     org.openrewrite.java.spring.boot2.SpringBoot2BestPractices
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                                         org.openrewrite.java.spring.NoRequestMappingAnnotation
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                                         org.openrewrite.java.spring.ImplicitWebAnnotationNames
</span></span></span><span class=line><span class=cl><span class=go>[WARNING] Changes have been made to src/test/java/com/fsde/ibss/dc/service/FileSaveTest.java by:
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]     org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]         org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_6
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]             org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_5
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                 org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_4
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                     org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                         org.openrewrite.java.testing.junit5.JUnit4to5Migration
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                             org.openrewrite.java.testing.junit5.UpdateTestAnnotation
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                         org.openrewrite.java.spring.boot2.RemoveObsoleteSpringRunners
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                             org.openrewrite.java.testing.junit5.JUnit5BestPractices
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                                 org.openrewrite.java.testing.cleanup.RemoveTestPrefix
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]                                 org.openrewrite.java.testing.cleanup.TestsShouldNotBePublic
</span></span></span><span class=line><span class=cl><span class=go>[WARNING] Please review and commit the results.
</span></span></span><span class=line><span class=cl><span class=go>[INFO] ------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go>[INFO] BUILD SUCCESS
</span></span></span><span class=line><span class=cl><span class=go>[INFO] ------------------------------------------------------------------------
</span></span></span></code></pre></div></figure></div></li><li><p>在上面步骤我是先升级到了 Spring Boot 2，然后再执行升级 Spring Boot 3 和 Jakarta EE。实际上直接升级到 Spring Boot 3 也是可以的。</p></li><li><p>执行完成后可从 maven 中删除 rewrite-maven-plugin，也可留着下次做其他变更。</p></li></ol><h3 id=试用总结>试用总结<a href=#试用总结 class=anchor aria-hidden=true>#</a></h3><p>注意事项：</p><ol><li>我们项目配置都是通过远程配置中心管理的，所以升级过程中配置文件无法响应变更，解决办法是将配置从远端拷贝到本地 applicaiton.properties 中，执行完任务后根据变化再更新远程配置中心。</li><li>执行过程中可能会报错，比如 maven 插件升级后某些属性可能变更或失效，需要手动解决错误后，再执行 <code>mvn rewrite:run</code>，</li><li>可重复执行 <code>mvn rewrite:run</code> 命令，可随时加入新的 recipe 再执行，所以为了观察变更和保证执行成功，可分批次加入 recipe 多次执行。</li><li>OpenRewrite 不解析依赖的第三方 jar 包内容，所以第三方 jar 的问题需要自行识别，比如从 Java EE 到 Jakarta EE，只是替换规则中知道的 jar 包版本和当前项目的源代码，不会自动把 jar 包内的 <code>javax.</code> 替换为 <code>jakarta.</code>。</li></ol><h2 id=遇见问题和解决办法>遇见问题和解决办法<a href=#遇见问题和解决办法 class=anchor aria-hidden=true>#</a></h2><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=last-modified><a href=https://github.com/xlabs-club/xlabs-club.github.io/commit/f7a6f06735bea35d1abac43a67863a8f96196ac2><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Last updated on 2025年9月10日</a></div><div class=edit-page><a href=https://github.com/xlabs-club/xlabs-club.github.io/blob/main/content//docs/platform/smart-code/index.md><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
Edit this page on GitHub</a></div></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/platform/backstage/ class="stretched-link text-reset text-decoration-none">开发者门户</a></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/>Powered by Hugo, and based on Doks</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Give Me a <a class=text-muted href=https://github.com/xlabs-club/>Star</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.8b717d53dae071196d91d0d0c63650fe240e84ffe50a76fdb433a914d6b216ec.js integrity="sha256-i3F9U9rgcRltkdDQxjZQ/iQOhP/lCnb9tDOpFNayFuw="></script><script async src=/js/app.592ddd2791734c581ee9465f923ca99817c6bcb2a5c2725df8c34f9def04b128.js integrity="sha256-WS3dJ5FzTFge6UZfkjypmBfGvLKlwnJd+MNPne8EsSg="></script><script async src=/js/docsearch.4c43898496d40210bc7d52e319d675a83a35016293221b53c5c2e544c50ab234.js integrity="sha256-TEOJhJbUAhC8fVLjGdZ1qDo1AWKTIhtTxcLlRMUKsjQ="></script></body></html>