[{"content":"","date":"2023-09-07","id":0,"permalink":"/docs/guides/","summary":"","tags":[],"title":"Guides"},{"content":"äº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ã€‚\n","date":"2023-09-07","id":1,"permalink":"/docs/cloud/introduction/","summary":"\u003cp\u003eäº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ã€‚\u003c/p\u003e","tags":[],"title":"Introduction"},{"content":"å«æ˜Ÿå®éªŒå®¤ï¼Œä¸€ä¸ªä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°çš„å¼€æºç»„ç»‡ã€‚\næ­¤é¡¹ç›®ä¸ºå«æ˜Ÿå®éªŒå®¤ä¸»é¡µ xlabs.club çš„æºç ï¼Œåœ¨è¿™é‡Œå°†åˆ†äº«æˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å®è·µç»éªŒï¼Œä»‹ç»å¦‚ä½•ä»¥æŠ€æœ¯é©±åŠ¨ä¸šåŠ¡é•¿æœŸå‘å±•å’Œé«˜é€Ÿå¢é•¿ã€‚\næ¬¢è¿æäº¤ PR è¿›è¡Œå¼€æºå…±å»ºã€‚\nä¸»é¡µå†…å®¹ å¹³å°å·¥ç¨‹ï¼šæˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ï¼Œå…³äº DevOps, DataOps, FinOps ä»¥åŠ AIOps çš„å·¥ç¨‹å®è·µã€‚ äº‘åŸç”Ÿï¼šäº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ï¼Œå¦‚ä½•ä»¥äº‘åŸç”ŸæŠ€æœ¯æ”¯æ’‘èµ·ä¸æ–­å˜åŒ–çš„å¤æ‚ä¸šåŠ¡ã€‚ æŠ€æœ¯åšå®¢ï¼šç ”å‘è¸©å‘è®°å½•ï¼Œç¿»ä¸€ç¿»æ€»æœ‰æƒŠå–œã€‚ awesome-x-opsï¼šä¸€äº›å…³äº AIOpsã€DataOpsã€DevOpsã€GitOpsã€FinOps çš„ä¼˜ç§€è½¯ä»¶ã€åšå®¢ã€é…å¥—å·¥å…·ã€‚ xlabs-opsï¼šä¸€äº› IaC è¿ç»´è„šæœ¬å’Œé€šç”¨æ¨¡æ¿ï¼Œå¦‚ Argo Workflows æ¨¡æ¿ä»“åº“ï¼Œæ˜¯å¯¹å®˜æ–¹ Examples çš„ç»„åˆã€æ‰©å±•ã€‚ xlabs-developer-platformï¼šä¸€ä¸ªåŸºäº Backstage è‡ªå»ºçš„å¼€å‘è€…å¹³å°ã€‚ backstage-pluginsï¼šå«æ˜Ÿå®éªŒå®¤çš„å¼€æº backstage pluginsï¼Œæ¬¢è¿æäº¤ PRã€‚ License æœ¬æ–‡æ¡£é‡‡ç”¨ CC BY-NC 4.0 è®¸å¯åè®®ã€‚\n","date":"2023-09-07","id":2,"permalink":"/docs/guides/introduction/","summary":"\u003cp\u003eå«æ˜Ÿå®éªŒå®¤ï¼Œä¸€ä¸ªä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°çš„å¼€æºç»„ç»‡ã€‚\u003c/p\u003e\n\u003cp\u003eæ­¤é¡¹ç›®ä¸ºå«æ˜Ÿå®éªŒå®¤ä¸»é¡µ \u003ca href=\"https://www.xlabs.club\" target=\"_blank\" rel=\"noopener\"\u003exlabs.club\u003c/a\u003e\n çš„æºç ï¼Œåœ¨è¿™é‡Œå°†åˆ†äº«æˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å®è·µç»éªŒï¼Œä»‹ç»å¦‚ä½•ä»¥æŠ€æœ¯é©±åŠ¨ä¸šåŠ¡é•¿æœŸå‘å±•å’Œé«˜é€Ÿå¢é•¿ã€‚\u003c/p\u003e\n\u003cp\u003eæ¬¢è¿æäº¤ PR è¿›è¡Œå¼€æºå…±å»ºã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸»é¡µå†…å®¹\"\u003eä¸»é¡µå†…å®¹\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eå¹³å°å·¥ç¨‹ï¼šæˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ï¼Œå…³äº DevOps, DataOps, FinOps ä»¥åŠ AIOps çš„å·¥ç¨‹å®è·µã€‚\u003c/li\u003e\n\u003cli\u003eäº‘åŸç”Ÿï¼šäº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ï¼Œå¦‚ä½•ä»¥äº‘åŸç”ŸæŠ€æœ¯æ”¯æ’‘èµ·ä¸æ–­å˜åŒ–çš„å¤æ‚ä¸šåŠ¡ã€‚\u003c/li\u003e\n\u003cli\u003eæŠ€æœ¯åšå®¢ï¼šç ”å‘è¸©å‘è®°å½•ï¼Œç¿»ä¸€ç¿»æ€»æœ‰æƒŠå–œã€‚\u003c/li\u003e\n\u003cli\u003eawesome-x-opsï¼šä¸€äº›å…³äº AIOpsã€DataOpsã€DevOpsã€GitOpsã€FinOps çš„ä¼˜ç§€è½¯ä»¶ã€åšå®¢ã€é…å¥—å·¥å…·ã€‚\u003c/li\u003e\n\u003cli\u003exlabs-opsï¼šä¸€äº› IaC è¿ç»´è„šæœ¬å’Œé€šç”¨æ¨¡æ¿ï¼Œå¦‚ Argo Workflows æ¨¡æ¿ä»“åº“ï¼Œæ˜¯å¯¹å®˜æ–¹ Examples çš„ç»„åˆã€æ‰©å±•ã€‚\u003c/li\u003e\n\u003cli\u003exlabs-developer-platformï¼šä¸€ä¸ªåŸºäº Backstage è‡ªå»ºçš„å¼€å‘è€…å¹³å°ã€‚\u003c/li\u003e\n\u003cli\u003ebackstage-pluginsï¼šå«æ˜Ÿå®éªŒå®¤çš„å¼€æº backstage pluginsï¼Œæ¬¢è¿æäº¤ PRã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"license\"\u003eLicense\u003c/h2\u003e\n\u003cp\u003eæœ¬æ–‡æ¡£é‡‡ç”¨ \u003ca href=\"https://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\" rel=\"noopener\"\u003eCC BY-NC 4.0\u003c/a\u003e\n è®¸å¯åè®®ã€‚\u003c/p\u003e","tags":[],"title":"Introduction"},{"content":"å¸¸ç”¨ Kubernetes å‘½ä»¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´ï¼Œè¿™å°±æ˜¯ç”Ÿæ´»ã€‚\nå¤åˆ¶ secret åˆ°å¦ä¸€ä¸ª namespaceã€‚ kubectl get secret mys --namespace=na -oyaml | grep -v \u0026#39;^\\s*namespace:\\s\u0026#39; | kubectl apply --namespace=nb -f -\ræ‰¹é‡åˆ é™¤ podã€‚ kubectl get pods --all-namespaces | grep Evicted | awk \u0026#39;{print $2 \u0026#34; --namespace=\u0026#34; $1}\u0026#39; | xargs kubectl delete pod # Delete by label kubectl delete pod -n idaas-book -l app.kubernetes.io/name=idaas-book\råŸåœ°é‡å¯ Podã€‚ kubectl rollout restart deploy/xxx -n your-namespace\rå‘½ä»¤è¡Œå¿«é€Ÿæ‰©ç¼©å®¹ã€‚ # kubectl scale -h kubectl scale --replicas=1 deploy/xxx -n your-namespace\rå¯†é’¥è§£å¯†ã€‚ kubectl get secret my-creds -n mysql -o jsonpath=\u0026#34;{.data.ADMIN_PASSWORD}\u0026#34; | base64 --decode\råˆå¹¶å¤šä¸ª kube config æ–‡ä»¶ã€‚ export KUBECONFIG=~/.kube/config:~/.kube/anotherconfig kubectl config view --flatten \u0026gt; ~/.kube/config-all cp ~/.kube/config-all ~/.kube/config # é¡ºæ‰‹æŠŠæƒé™æ”¹äº†ï¼Œé¿å… helm æˆ– kubectl å®¢æˆ·ç«¯ warning chmod 600 ~/.kube/config\rè·å–æŸä¸ª namespace ä¸‹çš„å…¨éƒ¨èµ„æºï¼Œæ‰¾å‡ºä½ çœ‹ä¸è§çš„èµ„æºï¼Œå¸¸ç”¨äº webhook/CR/CRD ç­‰èµ„æºæ¸…ç†ï¼Œè§£å†³å¼ºåˆ¶åˆ é™¤å¤±è´¥ã€‚ ns=your-namespace for resource in `kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get -o name -n $ns`; do kubectl get $resource -n $ns; # kubectl patch $resource -p \u0026#39;{\u0026#34;metadata\u0026#34;: {\u0026#34;finalizers\u0026#34;: []}}\u0026#39; --type=\u0026#39;merge\u0026#39; -n $ns; done\ræ ¹æ®ç‰¹å®šå­—æ®µæ’åº Pod åˆ—è¡¨ã€‚ # æ ¹æ®é‡å¯æ¬¡æ•°æ’åº kubectl get pods --sort-by=\u0026#39;.status.containerStatuses[0].restartCount\u0026#39; -A\r","date":"2023-09-07","id":3,"permalink":"/docs/tldr/kubernetes/","summary":"\u003cp\u003eå¸¸ç”¨ Kubernetes å‘½ä»¤ï¼Œå¤åˆ¶ï¼Œç²˜è´´ï¼Œè¿™å°±æ˜¯ç”Ÿæ´»ã€‚\u003c/p\u003e\n\u003chr\u003e\n\u003cul\u003e\n\u003cli\u003eå¤åˆ¶ secret åˆ°å¦ä¸€ä¸ª namespaceã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get secret mys --namespace\u003cspan class=\"o\"\u003e=\u003c/span\u003ena -oyaml \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -v \u003cspan class=\"s1\"\u003e\u0026#39;^\\s*namespace:\\s\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e kubectl apply --namespace\u003cspan class=\"o\"\u003e=\u003c/span\u003enb -f -\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæ‰¹é‡åˆ é™¤ podã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get pods --all-namespaces \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep Evicted \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;{print $2 \u0026#34; --namespace=\u0026#34; $1}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e xargs kubectl delete pod\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Delete by label\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl delete pod -n idaas-book -l app.kubernetes.io/name\u003cspan class=\"o\"\u003e=\u003c/span\u003eidaas-book\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eåŸåœ°é‡å¯ Podã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl rollout restart deploy/xxx -n your-namespace\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eå‘½ä»¤è¡Œå¿«é€Ÿæ‰©ç¼©å®¹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# kubectl scale -h\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl scale --replicas\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e deploy/xxx -n your-namespace\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eå¯†é’¥è§£å¯†ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e kubectl get secret my-creds -n mysql -o \u003cspan class=\"nv\"\u003ejsonpath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;{.data.ADMIN_PASSWORD}\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 --decode\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eåˆå¹¶å¤šä¸ª kube config æ–‡ä»¶ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eKUBECONFIG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e~/.kube/config:~/.kube/anotherconfig\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl config view --flatten \u0026gt; ~/.kube/config-all\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp ~/.kube/config-all ~/.kube/config\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# é¡ºæ‰‹æŠŠæƒé™æ”¹äº†ï¼Œé¿å… helm æˆ– kubectl å®¢æˆ·ç«¯ warning\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e600\u003c/span\u003e ~/.kube/config\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eè·å–æŸä¸ª namespace ä¸‹çš„å…¨éƒ¨èµ„æºï¼Œæ‰¾å‡ºä½ çœ‹ä¸è§çš„èµ„æºï¼Œå¸¸ç”¨äº webhook/CR/CRD ç­‰èµ„æºæ¸…ç†ï¼Œè§£å†³å¼ºåˆ¶åˆ é™¤å¤±è´¥ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ens\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyour-namespace\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e resource in \u003cspan class=\"sb\"\u003e`\u003c/span\u003ekubectl api-resources --verbs\u003cspan class=\"o\"\u003e=\u003c/span\u003elist --namespaced -o name \u003cspan class=\"p\"\u003e|\u003c/span\u003e xargs -n \u003cspan class=\"m\"\u003e1\u003c/span\u003e kubectl get -o name -n \u003cspan class=\"nv\"\u003e$ns\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    kubectl get \u003cspan class=\"nv\"\u003e$resource\u003c/span\u003e  -n \u003cspan class=\"nv\"\u003e$ns\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# kubectl patch $resource -p \u0026#39;{\u0026#34;metadata\u0026#34;: {\u0026#34;finalizers\u0026#34;: []}}\u0026#39; --type=\u0026#39;merge\u0026#39; -n $ns;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæ ¹æ®ç‰¹å®šå­—æ®µæ’åº Pod åˆ—è¡¨ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ ¹æ®é‡å¯æ¬¡æ•°æ’åº\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get pods --sort-by\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.status.containerStatuses[0].restartCount\u0026#39;\u003c/span\u003e -A\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e","tags":[],"title":"Kubernetes"},{"content":"æˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ï¼Œä»‹ç»å‰æœŸæ–¹æ¡ˆè®¾è®¡ã€ä¸­é—´è¸©å‘å†ç¨‹ã€‚\nåŸåˆ™ åˆ†äº«æˆ‘ä»¬å¹³å°å·¥ç¨‹å»ºè®¾çš„ä¸€äº›åŸºæœ¬åŸåˆ™ã€‚\nä»¥å¼€å‘è€…ä¸ºä¸­å¿ƒï¼šèµ‹èƒ½å¼€å‘è€…ï¼Œäº†è§£å›°éš¾ï¼Œè§£å†³é—®é¢˜ï¼Œè®©å¼€å‘è€…ç”Ÿæ´»æ›´è½»æ¾ã€‚ è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–æ‰‹åŠ¨å’Œé‡å¤æ€§ä»»åŠ¡ï¼Œå‡å°‘äººä¸ºé”™è¯¯ï¼Œæé«˜æ•ˆç‡ã€‚ æ ‡å‡†åŒ–ï¼šæ ‡å‡†åŒ–ä¿æŒä¸€è‡´æ€§ï¼Œå‡å°‘å¤æ‚æ€§ï¼Œå‡å°‘å›¢é˜Ÿè®¤çŸ¥è´Ÿè½½ï¼Œæä¾›æœ€ä½³å®è·µå’Œç»Ÿä¸€çš„ç¼–ç ç»“æ„ã€‚ æ¨¡å—åŒ–ï¼šæ¾è€¦åˆä¸”ç‹¬ç«‹çš„æ¨¡å—ï¼Œå¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚ å¼¹æ€§ï¼šå¯æ‰©å±•æ°´å¹³æ‰©ç¼©å®¹çš„èƒ½åŠ›ï¼Œä»¥åŠå®¹é”™æŠ—è„†å¼±çš„èƒ½åŠ›ã€‚ å®‰å…¨ï¼šç›¸æ¯”äºå¾®æœåŠ¡ã€äº‘åŸç”Ÿé¢†åŸŸçš„å®‰å…¨ï¼Œåœ¨å¹³å°å·¥ç¨‹é‡Œï¼Œæ›´å¼ºè°ƒä»£ç ã€åŸºç¡€è®¾æ–½ã€æ•°æ®å’Œå…¶ä»–èµ„æºçš„å®‰å…¨ã€‚ åä½œï¼šå¹³å°å·¥ç¨‹å¸ˆã€å¼€å‘äººå‘˜ã€è¿ç»´è¿è¥äººå‘˜ä»¥åŠå…¶ä»–å‚ä¸è€…ä¹‹é—´çš„åä½œï¼Œæé«˜ç”Ÿäº§åŠ›ã€ä¿ƒè¿›åˆ›æ–°å¹¶åˆ›é€ ç§¯æåŒ…å®¹çš„å·¥ä½œç¯å¢ƒã€‚ æŒç»­æ”¹è¿›ï¼šæŒç»­æ€§åé¦ˆã€è¯„ä¼°ã€æ”¹è¿›ã€‚ æ¶æ„æ¦‚è¿° ä¸ºä¾¿äºç†è§£ï¼Œæˆ‘ä»¬ä»ç„¶æŒ‰ç…§æƒ¯ç”¨æ¶æ„æ¨¡å‹ï¼Œå°†æ¶æ„åˆ†ä¸º IaaSã€CaaSã€PaaSã€Applications è¿™å‡ ä¸ªå±‚çº§ã€‚\nä¸“ä¸šçš„è¿ç»´äººå‘˜ä½œä¸º platform engineer ç€é‡äº IaaSã€CaaSã€PaaS å»ºè®¾ï¼Œå¼€å‘äººå‘˜ä½œä¸º application engineer æ›´ä¸“æ³¨äº PaaSã€Applications å»ºè®¾ï¼Œä¸ºå¼€å‘å’Œè¿ç»´æä¾›å·¥å…·ã€åä½œå¹³å°ã€åŸºç¡€åº”ç”¨ã€‚\nC4Context title å¹³å°å·¥ç¨‹æ€»ä½“æ¶æ„ Boundary(users, \"Users\", \"ç”¨æˆ·æ¥å…¥\") { Person(superAdmin, \"è¶…çº§ç®¡ç†å‘˜\") Person(admin, \"å¹³å°ç®¡ç†å‘˜\") Person(developer, \"å¼€å‘äººå‘˜\") Person(maintenance, \"è¿ç»´äººå‘˜\") } Boundary(console, \"Console\", \"å¼€å‘è€…å¹³å°\") { Container(backstage, \"Backstage\",\"react\",\"å¼€å‘è€…é—¨æˆ·\") Container(apps, \"åº”ç”¨ç®¡ç†å¹³å°\",\"Application\",\"å®¹å™¨ç®¡ç†ã€åº”ç”¨ç®¡ç†ã€é…ç½®ç®¡ç†ã€è‡ªåŠ¨åŒ–æµ‹è¯•\") Container(ops, \"ç»Ÿä¸€è¿ç»´å¹³å°\",\"x-ops\",\"æ•°æ®åº“ã€ä¸­é—´ä»¶ã€æ—¥å¿—ã€ç›‘æ§å‘Šè­¦å¹³å°\") Container(iam, \"IAM\", \"Keycloak\", \"ç»Ÿä¸€ç”¨æˆ·ã€ç»„ç»‡ã€è§’è‰²æƒé™ç®¡ç†\") } Boundary(paas, \"PaaS\", \"PaaS\") { ContainerDb(rds, \"RDS\", \"PostgreSQL/MySQL\", \"PostgreSQLã€MySQL ç­‰å…³ç³»å‹æ•°æ®åº“\") ContainerDb(clickhouse, \"ClickHouse\", \"ClickHouse\", \"BIã€Loggingã€Metrics ç­‰åˆ—å¼æ•°æ®åº“\") ContainerDb(nosql, \"NoSQL\", \"NoSQL\", \"ESã€Redisã€Mongo ç­‰ç¼“å­˜æ•°æ®åº“ã€æ–‡æ¡£æ•°æ®åº“\") ContainerDb(mq, \"æ¶ˆæ¯é˜Ÿåˆ—\", \"Kafka\", \"Kafkaã€RocketMQ ç­‰æ¶ˆæ¯é˜Ÿåˆ—\") } Boundary(caas, \"CaaS\", \"CaaS\") { Container(k8s, \"Kubernetes\",\"k8s\",\"K8S å®¹å™¨å¹³å°\") Container(workflow, \"ç¼–æ’å¼•æ“\",\"Argo\",\"æµæ°´çº¿ï¼Œæµç¨‹ã€åº”ç”¨ç¼–æ’å¼•æ“\") Container(kms, \"KMS\",\"HashiCorp Vault\",\"ç§˜é’¥ç®¡ç†ç³»ç»Ÿ\") Container(harbor, \"Harbor\",\"harbor\",\"å®¹å™¨é•œåƒä»“åº“\") Container(git, \"IaC\",\"GitLab\",\"IaCã€GitOps æºç ä»“åº“\") } Boundary(iaas, \"IaaS\", \"IaaS\") { Container(vm, \"äº‘ä¸»æœº\",\"vm\",\"äº‘ä¸»æœºè‡ªå¸¦æœ¬åœ°å­˜å‚¨\") Container(cbh, \"å ¡å’æœº\",\"cbh\",\"å®‰å…¨è¿ç»´å®¡è®¡å ¡å’æœº\") Container(s3, \"S3\",\"S3/Minio\",\"åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨\") Container(nfs, \"NFS\",\"nfs\",\"å…±äº«æ–‡ä»¶å­˜å‚¨\") } UpdateLayoutConfig($c4ShapeInRow=\"4\", $c4BoundaryInRow=\"1\")\råŸºç¡€è®¾æ–½æ ‡å‡†åŒ– åŸºç¡€è®¾æ–½æ ‡å‡†åŒ–æ˜¯å¹³å°å·¥ç¨‹å»ºè®¾çš„ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡å¯¹åŸºç¡€è®¾æ–½æœåŠ¡è¿›è¡Œæ ‡å‡†åŒ–ï¼Œå‡å°‘å¼€å‘äººå‘˜å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„æ‘©æ“¦ï¼Œå‡å°‘è¿ç»´éš¾åº¦ï¼Œå¤§å¤§é™ä½å‡ºé”™çš„æ¦‚ç‡ã€‚\näº‘å¹³å°å·²ç»æˆç†Ÿï¼Œåœ¨äº‘å¹³å°çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ›´è¿‘ä¸€æ­¥ï¼Œæå‡º All In K8S ç­–ç•¥ï¼Œè¿™é‡Œçš„ All In ä¸»è¦åŒ…æ‹¬ä¸¤ç‚¹ï¼š\nRun On K8Sï¼šæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¸šåŠ¡åº”ç”¨ï¼Œä¸€åˆ‡éƒ½è¿è¡Œåœ¨ K8S ä¸Šï¼ŒK8S æ˜¯äº‹å®ä¸Šçš„åŸºç¡€è®¾æ–½ã€‚ é¢å‘ K8S è®¾è®¡ï¼šéµå¾ª K8S è®¾è®¡åŸåˆ™ï¼Œæ‹¥æŠ± K8S ç”Ÿæ€ï¼Œå……åˆ†åˆ©ç”¨å¼€æºåŠŸèƒ½ç‰¹æ€§ã€‚ ä½œä¸ºä¸€ä¸ªç”±ä¼ ç»Ÿè¿ç»´è½¬å˜è€Œæ¥çš„å›¢é˜Ÿï¼Œåˆ†äº«å‡ ä¸ªå¯èƒ½æœ‰ç”¨çš„å…³æ³¨ç‚¹ï¼š\næ“ä½œä¹ æƒ¯å˜åŒ–ï¼Œç”±å‘½ä»¤å¼åˆ°å£°æ˜å¼ï¼šè¿‡å»åœ¨è™šæ‹Ÿæœºå†…ç›´æ¥ä¿®æ”¹æ–‡ä»¶ã€æ‰§è¡ŒæŸä¸ªå‘½ä»¤ã€å®‰è£…æŸä¸ªæ’ä»¶ï¼Œå˜ä¸ºä¿®æ”¹ yaml é…ç½®ã€ä¿®æ”¹åŸºç¡€é•œåƒã€ä¿®æ”¹é•œåƒ init è¿›ç¨‹ã€‚ èµ„æºéš”ç¦»ï¼šä»é›†ç¾¤ã€nodeã€namespace ä¸åŒç»´åº¦è¿›è¡Œç‰©ç†æˆ–é€»è¾‘éš”ç¦»ï¼Œå¯¹æ•°æ®åº“ã€ä¸šåŠ¡åº”ç”¨æŒ‰ Label ã€æ±¡ç‚¹è¿›è¡Œé€»è¾‘åˆ†åŒºã€‚ æƒé™å’Œç­–ç•¥ç®¡ç†ï¼šæœ‰å®¹å™¨äº‘å¹³å°ç”¨å¹³å°å³å¯ã€‚å¦‚æœæ²¡æœ‰ï¼ŒK8S 4 ç§é‰´æƒæ¨¡å¼ Nodeã€ABACã€RBAC å’Œ Webhook èƒ½å¦æ»¡è¶³è¦æ±‚ï¼Œè€ƒè™‘æ˜¯å¦å¼•å…¥ OPA Gatekeeper æˆ– Kyverno å®Œå–„å’Œç®€åŒ–å·¥ä½œã€‚ ç½‘ç»œå®‰å…¨ï¼šæˆªæ­¢ç›®å‰ K8S å®‰è£…æ—¶ä»ç„¶æ¨èç¦ç”¨è™šæ‹Ÿæœºå†…éƒ¨é˜²ç«å¢™ï¼Œäº‘å¹³å°æä¾›è™šæ‹Ÿæœºå®‰å…¨ç»„ä¸€èˆ¬ç”¨äºé˜²æ­¢å¤–éƒ¨ç½‘ç»œå…¥ä¾µï¼Œ K8S å†…éƒ¨è€ƒè™‘ä½¿ç”¨ NetworkPolicy é˜²æ­¢å†…éƒ¨äººå‘˜æåã€‚æ¯”å¦‚ä¸åŒç»„ç»‡çš„å¤šä¸ªæ•°æ®åº“ï¼Œç»“åˆä¸Šé¢çš„èµ„æºéš”ç¦»å’Œæƒé™æ§åˆ¶ï¼Œä»ä¸€å¼€å§‹å°±è¦è§„åˆ’å¥½æ˜¯æŒ‰é›†ç¾¤è¿˜æ˜¯ namespace åˆ’åˆ†ã€‚ ä¸¥æ ¼ç‰ˆæœ¬åŒ–ç®¡ç†ï¼šæ“ä½œç³»ç»Ÿã€å®¹å™¨é•œåƒã€Helm Chartsã€å‘½ä»¤è¡Œå·¥å…·ï¼Œç²¾ç¡®åˆ°å°ç‰ˆæœ¬ã€‚ æ˜¾å¼å£°æ˜å‚æ•°ï¼šä»¥ Helm åº”ç”¨ä¸ºä¾‹ï¼Œç†è§£ values.yaml æ–‡ä»¶ä¸­çš„æ¯ä¸ªå˜é‡å¹¶é¿å…ä½¿ç”¨é»˜è®¤å€¼ï¼Œæ¯æ¬¡æ›´æ–°ç‰ˆæœ¬æ¯”å¯¹å˜é‡å·®å¼‚å¹¶å†æ¬¡æ‰§è¡Œæ˜¾å¼å£°æ˜å‚æ•°åŸåˆ™ã€‚ åº”ç”¨äº¤ä»˜è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–ã€è§„èŒƒåŒ–åº”ç”¨äº¤ä»˜å…¨æµç¨‹ï¼Œå¹¶ä¸¥æ ¼è·µè¡Œé¢å‘å¤±è´¥è®¾è®¡çš„åŸåˆ™ã€‚å‡å°‘äººçš„åŠ¨ä½œæµç¨‹æ‰èƒ½å‡å°‘ç”Ÿäº§äº‹æ•…ã€‚ æ—¥å¿—é‡‡é›†ï¼šåº”ç”¨æ—¥å¿—å¯èƒ½æ‰“å°åˆ°æ–‡ä»¶æˆ– Pod consoleï¼Œç»Ÿä¸€é‡‡é›†å±•ç¤ºã€‚ æ•…éšœæ¼”ç»ƒï¼šå¯¹ä¸åŒåº”ç”¨è¿›è¡Œæ•…éšœæ¼”ç»ƒï¼Œå°¤å…¶æ˜¯æ¨¡æ‹Ÿå¤‡ä»½å’Œæ¢å¤ï¼Œä¼ ç»Ÿçš„åœè¿›ç¨‹ã€æ¢å¤æ–‡ä»¶ã€é‡å¯æœåŠ¡çš„æ“ä½œæ¨¡å¼åœ¨å®¹å™¨å†…å¯èƒ½è¡Œä¸é€šã€‚ å¼€å‘è€…ä½“éªŒ å¦‚ä½•æå‡å¼€å‘è€…ä½“éªŒã€‚å¦‚ä½•å®ç°å¼€å‘è€…è‡ªåŠ©ã€‚å†…éƒ¨å¼€å‘è€…å¹³å°è§£å†³ä¸äº†çš„é—®é¢˜æœ‰å“ªäº›ï¼Œå¦‚ä½•è§£å†³çš„ã€‚\nå¯è§‚æµ‹æ€§ å¯è§‚æµ‹åŠ©åŠ›æå‡å¼€å‘è€…ä½“éªŒå’Œè´¨é‡æå‡ã€‚AIOps æ˜¯ä¸æ˜¯æœªæ¥ã€‚\nç»„ç»‡æ¶æ„å˜é© å¹³å°å·¥ç¨‹å¦‚ä½•æ¨åŠ¨å’Œå½±å“ç»„ç»‡æ¶æ„å˜é©ã€‚\n","date":"2023-09-07","id":4,"permalink":"/docs/platform/introduction/","summary":"\u003cp\u003eæˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ï¼Œä»‹ç»å‰æœŸæ–¹æ¡ˆè®¾è®¡ã€ä¸­é—´è¸©å‘å†ç¨‹ã€‚\u003c/p\u003e\n\u003ch2 id=\"åŸåˆ™\"\u003eåŸåˆ™\u003c/h2\u003e\n\u003cp\u003eåˆ†äº«æˆ‘ä»¬å¹³å°å·¥ç¨‹å»ºè®¾çš„ä¸€äº›åŸºæœ¬åŸåˆ™ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eä»¥å¼€å‘è€…ä¸ºä¸­å¿ƒï¼šèµ‹èƒ½å¼€å‘è€…ï¼Œäº†è§£å›°éš¾ï¼Œè§£å†³é—®é¢˜ï¼Œè®©å¼€å‘è€…ç”Ÿæ´»æ›´è½»æ¾ã€‚\u003c/li\u003e\n\u003cli\u003eè‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–æ‰‹åŠ¨å’Œé‡å¤æ€§ä»»åŠ¡ï¼Œå‡å°‘äººä¸ºé”™è¯¯ï¼Œæé«˜æ•ˆç‡ã€‚\u003c/li\u003e\n\u003cli\u003eæ ‡å‡†åŒ–ï¼šæ ‡å‡†åŒ–ä¿æŒä¸€è‡´æ€§ï¼Œå‡å°‘å¤æ‚æ€§ï¼Œå‡å°‘å›¢é˜Ÿè®¤çŸ¥è´Ÿè½½ï¼Œæä¾›æœ€ä½³å®è·µå’Œç»Ÿä¸€çš„ç¼–ç ç»“æ„ã€‚\u003c/li\u003e\n\u003cli\u003eæ¨¡å—åŒ–ï¼šæ¾è€¦åˆä¸”ç‹¬ç«‹çš„æ¨¡å—ï¼Œå¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚\u003c/li\u003e\n\u003cli\u003eå¼¹æ€§ï¼šå¯æ‰©å±•æ°´å¹³æ‰©ç¼©å®¹çš„èƒ½åŠ›ï¼Œä»¥åŠå®¹é”™æŠ—è„†å¼±çš„èƒ½åŠ›ã€‚\u003c/li\u003e\n\u003cli\u003eå®‰å…¨ï¼šç›¸æ¯”äºå¾®æœåŠ¡ã€äº‘åŸç”Ÿé¢†åŸŸçš„å®‰å…¨ï¼Œåœ¨å¹³å°å·¥ç¨‹é‡Œï¼Œæ›´å¼ºè°ƒä»£ç ã€åŸºç¡€è®¾æ–½ã€æ•°æ®å’Œå…¶ä»–èµ„æºçš„å®‰å…¨ã€‚\u003c/li\u003e\n\u003cli\u003eåä½œï¼šå¹³å°å·¥ç¨‹å¸ˆã€å¼€å‘äººå‘˜ã€è¿ç»´è¿è¥äººå‘˜ä»¥åŠå…¶ä»–å‚ä¸è€…ä¹‹é—´çš„åä½œï¼Œæé«˜ç”Ÿäº§åŠ›ã€ä¿ƒè¿›åˆ›æ–°å¹¶åˆ›é€ ç§¯æåŒ…å®¹çš„å·¥ä½œç¯å¢ƒã€‚\u003c/li\u003e\n\u003cli\u003eæŒç»­æ”¹è¿›ï¼šæŒç»­æ€§åé¦ˆã€è¯„ä¼°ã€æ”¹è¿›ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"æ¶æ„æ¦‚è¿°\"\u003eæ¶æ„æ¦‚è¿°\u003c/h2\u003e\n\u003cp\u003eä¸ºä¾¿äºç†è§£ï¼Œæˆ‘ä»¬ä»ç„¶æŒ‰ç…§æƒ¯ç”¨æ¶æ„æ¨¡å‹ï¼Œå°†æ¶æ„åˆ†ä¸º IaaSã€CaaSã€PaaSã€Applications è¿™å‡ ä¸ªå±‚çº§ã€‚\u003c/p\u003e\n\u003cp\u003eä¸“ä¸šçš„è¿ç»´äººå‘˜ä½œä¸º platform engineer ç€é‡äº IaaSã€CaaSã€PaaS å»ºè®¾ï¼Œå¼€å‘äººå‘˜ä½œä¸º application engineer æ›´ä¸“æ³¨äº PaaSã€Applications å»ºè®¾ï¼Œä¸ºå¼€å‘å’Œè¿ç»´æä¾›å·¥å…·ã€åä½œå¹³å°ã€åŸºç¡€åº”ç”¨ã€‚\u003c/p\u003e\n\u003cdiv class=\"mermaid text-center\"\u003e\nC4Context\n    title å¹³å°å·¥ç¨‹æ€»ä½“æ¶æ„\n\n    Boundary(users, \"Users\", \"ç”¨æˆ·æ¥å…¥\") {\n        Person(superAdmin, \"è¶…çº§ç®¡ç†å‘˜\")\n        Person(admin, \"å¹³å°ç®¡ç†å‘˜\")\n        Person(developer, \"å¼€å‘äººå‘˜\")\n        Person(maintenance, \"è¿ç»´äººå‘˜\")\n    }\n\n    Boundary(console, \"Console\", \"å¼€å‘è€…å¹³å°\") {\n        Container(backstage, \"Backstage\",\"react\",\"å¼€å‘è€…é—¨æˆ·\")\n        Container(apps, \"åº”ç”¨ç®¡ç†å¹³å°\",\"Application\",\"å®¹å™¨ç®¡ç†ã€åº”ç”¨ç®¡ç†ã€é…ç½®ç®¡ç†ã€è‡ªåŠ¨åŒ–æµ‹è¯•\")\n        Container(ops, \"ç»Ÿä¸€è¿ç»´å¹³å°\",\"x-ops\",\"æ•°æ®åº“ã€ä¸­é—´ä»¶ã€æ—¥å¿—ã€ç›‘æ§å‘Šè­¦å¹³å°\")\n        Container(iam, \"IAM\", \"Keycloak\", \"ç»Ÿä¸€ç”¨æˆ·ã€ç»„ç»‡ã€è§’è‰²æƒé™ç®¡ç†\")\n    }\n\n    Boundary(paas, \"PaaS\", \"PaaS\") {\n        ContainerDb(rds, \"RDS\", \"PostgreSQL/MySQL\", \"PostgreSQLã€MySQL ç­‰å…³ç³»å‹æ•°æ®åº“\")\n        ContainerDb(clickhouse, \"ClickHouse\", \"ClickHouse\", \"BIã€Loggingã€Metrics ç­‰åˆ—å¼æ•°æ®åº“\")\n        ContainerDb(nosql, \"NoSQL\", \"NoSQL\", \"ESã€Redisã€Mongo ç­‰ç¼“å­˜æ•°æ®åº“ã€æ–‡æ¡£æ•°æ®åº“\")\n        ContainerDb(mq, \"æ¶ˆæ¯é˜Ÿåˆ—\", \"Kafka\", \"Kafkaã€RocketMQ ç­‰æ¶ˆæ¯é˜Ÿåˆ—\")\n    }\n\n    Boundary(caas, \"CaaS\", \"CaaS\") {\n        Container(k8s, \"Kubernetes\",\"k8s\",\"K8S å®¹å™¨å¹³å°\")\n        Container(workflow, \"ç¼–æ’å¼•æ“\",\"Argo\",\"æµæ°´çº¿ï¼Œæµç¨‹ã€åº”ç”¨ç¼–æ’å¼•æ“\")\n        Container(kms, \"KMS\",\"HashiCorp Vault\",\"ç§˜é’¥ç®¡ç†ç³»ç»Ÿ\")\n        Container(harbor, \"Harbor\",\"harbor\",\"å®¹å™¨é•œåƒä»“åº“\")\n        Container(git, \"IaC\",\"GitLab\",\"IaCã€GitOps æºç ä»“åº“\")\n    }\n\n    Boundary(iaas, \"IaaS\", \"IaaS\") {\n        Container(vm, \"äº‘ä¸»æœº\",\"vm\",\"äº‘ä¸»æœºè‡ªå¸¦æœ¬åœ°å­˜å‚¨\")\n        Container(cbh, \"å ¡å’æœº\",\"cbh\",\"å®‰å…¨è¿ç»´å®¡è®¡å ¡å’æœº\")\n        Container(s3, \"S3\",\"S3/Minio\",\"åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨\")\n        Container(nfs, \"NFS\",\"nfs\",\"å…±äº«æ–‡ä»¶å­˜å‚¨\")\n    }\n\n    UpdateLayoutConfig($c4ShapeInRow=\"4\", $c4BoundaryInRow=\"1\")\r\n\u003c/div\u003e\r\n\r\n\u003ch2 id=\"åŸºç¡€è®¾æ–½æ ‡å‡†åŒ–\"\u003eåŸºç¡€è®¾æ–½æ ‡å‡†åŒ–\u003c/h2\u003e\n\u003cp\u003eåŸºç¡€è®¾æ–½æ ‡å‡†åŒ–æ˜¯å¹³å°å·¥ç¨‹å»ºè®¾çš„ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡å¯¹åŸºç¡€è®¾æ–½æœåŠ¡è¿›è¡Œæ ‡å‡†åŒ–ï¼Œå‡å°‘å¼€å‘äººå‘˜å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„æ‘©æ“¦ï¼Œå‡å°‘è¿ç»´éš¾åº¦ï¼Œå¤§å¤§é™ä½å‡ºé”™çš„æ¦‚ç‡ã€‚\u003c/p\u003e","tags":[],"title":"æ€»ä½“æ¶æ„"},{"content":"ç»Ÿä¸€èº«ä»½è®¤è¯ï¼ˆIdentity and Access Managementï¼Œèº«ä»½è®¤è¯å’Œè®¿é—®æ§åˆ¶ï¼Œç®€ç§° IAMï¼‰çš„æŠ€æœ¯é€‰å‹å’Œå®è·µã€‚\næ ¸å¿ƒéœ€æ±‚ é›†ä¸­ç®¡ç†ï¼šä»ä¸€ä¸ªåœ°æ–¹ç®¡ç†è´¦æˆ·å’Œèº«ä»½ã€‚ å•ç‚¹ç™»å½•ï¼šå…è®¸ç”¨æˆ·ä½¿ç”¨ä¸€ç»„å‡­æ®è®¿é—®æ‰€æœ‰é›†æˆçš„ç³»ç»Ÿå’Œåº”ç”¨ï¼Œé¿å…è®°å¿†å¤šä¸ªç”¨æˆ·åå’Œå¯†ç ã€‚ åŠ¨æ€è®¿é—®æ§åˆ¶ï¼šåŸºäºè§’è‰²å’Œç­–ç•¥åŠ¨æ€æˆäºˆæˆ–æ’¤é”€è®¿é—®æƒé™ã€‚ å®¡è®¡ä¸åˆè§„ï¼šè®°å½•å’Œç›‘æ§è®¿é—®æ´»åŠ¨ï¼Œä»¥æ”¯æŒåˆè§„æ€§å®¡è®¡ã€‚ æ— ç¼å¿«é€Ÿé›†æˆï¼šä½œä¸ºå¹³å°å·¥ç¨‹çš„ä¸€éƒ¨åˆ†æ›´å¼ºè°ƒâ€œè‡ªåŠ©â€ï¼Œå„ä¸ªåº”ç”¨èƒ½å¤Ÿæ— ç¼å¿«é€Ÿæ¥å…¥ï¼Œç”šè‡³æœ‰äº›åº”ç”¨åªéœ€è¦ç®€å•çš„æƒé™èƒ½å¤Ÿä¸éœ€è¦å¼€å‘è‡ªåŠ¨æ¥å…¥ã€‚ å¼ºåŒ–è®¤è¯æœºåˆ¶ï¼šé‡‡ç”¨å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼šOTP å£ä»¤ã€æŒ‡çº¹ã€çŸ­ä¿¡éªŒè¯ç ç­‰ï¼‰æ–¹æ³•ï¼Œä¸ºé‡è¦æ“ä½œå¢åŠ é¢å¤–é˜²æŠ¤ã€‚ æŠ€æœ¯é€‰é¡¹ ä¸ºæ»¡è¶³ä»¥ä¸Šéœ€æ±‚ï¼Œåœ¨åˆæœŸæŠ€æœ¯é€‰é¡¹æ—¶ä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªå¼€æºç»„ä»¶ã€‚\nkeycloak : å…¨é¢çš„ IAM è§£å†³æ–¹æ¡ˆ ï¼Œå®ç°ç”¨æˆ·ã€æƒé™ç®¡ç†ï¼Œå•ç‚¹ç™»å½•ã€MFA ç­‰ã€‚ Dex : èº«ä»½ä»£ç†ï¼Œè¿æ¥å¤šä¸ªèº«ä»½æºï¼Œä»…ä½œä¸º OpenID Connectã€‚ Ory : åŒ…å«å¤šä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œç»„æˆä¸€ä¸ªå…¨å®¶æ¡¶çš„è§£å†³æ–¹æ¡ˆã€‚ oauth2-proxy : åå‘ä»£ç†å·¥å…·ï¼Œä¸“ä¸ºæä¾› OAuth 2.0 èº«ä»½éªŒè¯å’ŒæˆæƒæœåŠ¡è€Œè®¾è®¡ï¼Œé™„å¸¦åŸºäºç”¨æˆ·ã€åˆ†ç»„ã€è§’è‰²çš„æƒé™ç®¡ç†ã€‚ Pomerium : Pomerium ä¸ä»…ä»…æ˜¯ä¸€ä¸ª OAuth 2.0 ä»£ç†ï¼Œå®ƒè¿˜æä¾›äº†ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·ã€ç»„ã€å’Œå…¶ä»–ä¸Šä¸‹æ–‡å±æ€§æ¥å†³å®šè®¿é—®æƒé™ã€‚ ä»¥ä¸‹ä¸º keycloak å’Œ Dex çš„ç®€å•å¯¹æ¯”ã€‚ä¸ºä»€ä¹ˆä¸æŠŠ Ory åŠ è¿›æ¥ï¼Œå› ä¸ºæ²¡æœ‰å®é™…ç”¨è¿‡ï¼Œä¸ä¾¿äºå‘è¡¨æ„è§ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ª Ory ç”¨æˆ·æ¬¢è¿è¡¥å……ã€‚\nç‰¹æ€§/å·¥å…· Keycloak Dex ç±»å‹ å…¨é¢çš„ IAM è§£å†³æ–¹æ¡ˆ èº«ä»½ä»£ç† ç”¨æˆ·ç®¡ç† æ”¯æŒå†…ç½®ç”¨æˆ·ç®¡ç† ä¸ç›´æ¥ç®¡ç†ç”¨æˆ·ï¼Œä¾èµ–å¤–éƒ¨èº«ä»½æä¾›è€… åè®®æ”¯æŒ OpenID Connectã€OAuth 2.0ã€SAML 2.0 OpenID Connect SSO æ”¯æŒ ä¾èµ–å¤–éƒ¨èº«ä»½æä¾›è€…å®ç° ç¤¾äº¤ç™»å½• æ”¯æŒå¤šç§ç¤¾äº¤ç™»å½•é€‰é¡¹ ä¸ç›´æ¥æ”¯æŒï¼Œå¯é€šè¿‡è¿æ¥å¤–éƒ¨èº«ä»½æä¾›è€…å®ç° è§’è‰²ç®¡ç† æ”¯æŒå¤æ‚çš„è§’è‰²å’Œæƒé™ç®¡ç† ä¸ç›´æ¥æ”¯æŒ æ‰©å±•æ€§ é«˜ï¼Œé€‚åˆå„ç§è§„æ¨¡å’Œå¤æ‚æ€§çš„éœ€æ±‚ é€‚åˆå°†å¤šä¸ªèº«ä»½æºç»Ÿä¸€åˆ°ä¸€ä¸ªè®¤è¯æµç¨‹çš„ç¯å¢ƒ ä½¿ç”¨åœºæ™¯ éœ€è¦å…¨é¢ã€é›†ä¸­å¼èº«ä»½ç®¡ç†çš„ç»„ç»‡ éœ€è¦ç»Ÿä¸€å¤šä¸ªèº«ä»½æºè®¤è¯ï¼Œå¦‚åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­ ç”¨æˆ·ç•Œé¢ æä¾›ä¸°å¯Œçš„ç”¨æˆ·å’Œç®¡ç†å‘˜ç•Œé¢ ä¸»è¦æ˜¯ APIï¼Œæ²¡æœ‰è¯¦ç»†çš„ç”¨æˆ·ç•Œé¢ é€‚ç”¨æ€§ é€‚ç”¨äºéœ€è¦å®Œæ•´ IAM è§£å†³æ–¹æ¡ˆçš„ç»„ç»‡ é€‚ç”¨äºä½œä¸ºå¤šä¸ªèº«ä»½æºä»£ç†ï¼Œå°¤å…¶åœ¨ Kubernetes ç¯å¢ƒä¸­ ä»¥ä¸‹ä¸º OAuth2 Proxy å’Œ Pomerium çš„ç®€å•å¯¹æ¯”ã€‚\nç‰¹æ€§/å·¥å…· OAuth2 Proxy Pomerium ä¸»è¦ç”¨é€” èº«ä»½éªŒè¯ä»£ç† è¾¹ç¼˜èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ èº«ä»½è®¤è¯æ–¹æ³• æ”¯æŒå¤šç§ OAuth 2.0 æä¾›å•† æ”¯æŒ OAuth 2.0ã€OpenID Connect å’Œ SAML å®‰å…¨æ€§ åŸºæœ¬çš„èº«ä»½éªŒè¯å’Œæˆæƒ é«˜çº§è®¿é—®æ§åˆ¶ï¼ŒåŒ…æ‹¬è·¯ç”±è§„åˆ™å’Œç­–ç•¥ å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ æ”¯æŒ æ”¯æŒ éƒ¨ç½²å¤æ‚æ€§ ç›¸å¯¹ç®€å•ï¼Œæ˜“äºéƒ¨ç½² è¾ƒä¸ºå¤æ‚ï¼Œä½†æä¾›æ›´å¤šçš„é…ç½®é€‰é¡¹å’Œçµæ´»æ€§ ç”¨æˆ·ç•Œé¢ ä¸»è¦é€šè¿‡é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œç•Œé¢æ“ä½œ æä¾› Web ç•Œé¢ç”¨äºé…ç½®å’Œç®¡ç† é€‚ç”¨åœºæ™¯ é€‚åˆäºå°å‹åº”ç”¨å’Œç®€å•çš„èº«ä»½éªŒè¯éœ€æ±‚ é€‚åˆäºå¤§å‹ä¼ä¸šå’Œå¤æ‚çš„è®¿é—®æ§åˆ¶éœ€æ±‚ é›†æˆèƒ½åŠ› é€‚åˆå•ä¸€åº”ç”¨æˆ–å°å‹ç³»ç»Ÿ é€‚åˆå¤æ‚çš„ç³»ç»Ÿæ¶æ„å’Œå¤šåº”ç”¨ç¯å¢ƒ æ‰©å±•æ€§å’Œçµæ´»æ€§ åŸºæœ¬æ‰©å±•æ€§ï¼Œé€‚ç”¨äºæ ‡å‡†ç”¨ä¾‹ é«˜åº¦å¯æ‰©å±•å’Œçµæ´»ï¼Œé€‚ç”¨äºå¤æ‚å¤šå˜çš„ç¯å¢ƒ ç¤¾åŒºå’Œæ”¯æŒ æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒº ç¤¾åŒºæ”¯æŒå¼ºå¤§ï¼Œæä¾›ä¼ä¸šçº§æ”¯æŒå’ŒæœåŠ¡ æ–¹æ¡ˆè½åœ° ä¸ºæ»¡è¶³æ ¸å¿ƒè¯‰æ±‚ï¼Œæ ¹æ®ä¸åŒåœºæ™¯æˆ‘ä»¬åšäº†ä»¥ä¸‹é€‰æ‹©ã€‚\nä»¥ keycloak + ldap ç®¡ç†ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼Œç”¨æˆ·åŸå§‹æ•°æ®å­˜äº ldap ä¸­ã€‚ ä»¥ oatuh2-proxy + keycloak oidc ä½œä¸ºè®¤è¯ä»£ç†ä¸­é—´ä»¶ï¼Œä¸ºé‚£äº›ä¸å…·å¤‡è®¤è¯æˆæƒæœºåˆ¶çš„åº”ç”¨æä¾›ç»Ÿä¸€çš„è®¤è¯æˆæƒè®¿é—®æ§åˆ¶ã€‚ ä¸€ä¸ªç®€å•çš„åº”ç”¨ç»Ÿä¸€èº«ä»½è®¤è¯æ€»æ¶æ„ç¤ºä¾‹å¦‚ä¸‹ã€‚\nC4Context Person(admin, \"è¶…çº§ç®¡ç†å‘˜\") Person_Ext(extUser, \"è‡ªåŠ©æ³¨å†Œ\") Person_Ext(socialUser, \"ç¤¾äº¤ç™»å½•\") Person(developer, \"å†…éƒ¨äººå‘˜\") Boundary(iam, \"IAM\", \"iam\") { Container(keycloak, \"keycloak\", \"Quarkus\", \"Admin æ§åˆ¶å°\nç”¨æˆ·ã€ç»„ç»‡ã€è§’è‰²ã€æƒé™ç®¡ç†\") Container(ldap, \"LDAP/AD\",\"ldap\", \"LDAP æˆ– Windows AD ä½œä¸ºç”¨æˆ·æº\") ContainerDb(spiUser, \"è‡ªå®šä¹‰ç”¨æˆ·æº\", \"Java SPI\", \"é€šè¿‡å®ç° SPI è‡ªå®šä¹‰ç”¨æˆ·æº\") System_Ext(providers, \"èº«ä»½è”åˆ\", \"Githubã€Gitlabã€Wechartã€SAML v2.0ã€OIDC ç­‰\nç”¨æˆ·èº«ä»½è”åˆ\") } Boundary(sso, \"Plugins Applications\", \"sso\") { Container(backstage, \"Backstage\",\"react\",\"å¼€å‘è€…é—¨æˆ·\") Container(grafana, \"Grafana\",\"grafana\",\"ç›‘æ§å‘Šè­¦å¹³å°\") Container(k8s, \"Kubernetes\",\"kubernetes\",\"Kubernetes Service Account\") } Boundary(apps, \"OAuth Proxy Applications\", \"sso\") { Container(proxy, \"oauth2-proxy\",\"golang\",\"è®¤è¯ä»£ç†\nè®¤è¯å’Œ RBAC æƒé™ç®¡ç†\né€šè¿‡åé€ä¼ ç”¨æˆ·ã€è§’è‰²ç­‰ä¿¡æ¯\") Container(login, \"è‡ªç ”åº”ç”¨\",\"any\", \"éœ€è¦ç™»å½•æ‰å¯è®¿\nè‡ªèº«æ— ç”¨æˆ·æƒé™ç®¡ç†åŠŸèƒ½\") } Rel(admin, keycloak, \"ç”¨æˆ·ç®¡ç†\", \"http\") Rel(developer, keycloak, \"ç”¨æˆ·è‡ªåŠ©\", \"http\") Rel(extUser, keycloak, \"ç”¨æˆ·è‡ªåŠ©æ³¨å†Œ\", \"http\") Rel(socialUser, keycloak, \"ç¤¾äº¤è´¦æˆ·ç™»å½•\", \"http\") Rel(developer, backstage, \"å¼€å‘è€…é—¨æˆ·\", \"http\") Rel(developer, proxy, \"SSO\", \"http\") Rel(developer, grafana, \"SSO\", \"http\") Rel(developer, k8s, \"ç»Ÿä¸€èº«ä»½\", \"http\") Rel(proxy, login, \"RBAC\",\"x-user-id/group/role\") Rel(keycloak, ldap, \"user storage\") Rel(keycloak, spiUser, \"user storage\") Rel(keycloak, providers, \"identity provider\") Rel(backstage, keycloak, \"plugin auth backend\") Rel(proxy, keycloak, \"oidc provider\") Rel(grafana, keycloak, \"oidc provider\") Rel(k8s, keycloak, \"oidc provider\") UpdateRelStyle(proxy, keycloak,$lineColor=\"blue\" $offsetX=\"260\") UpdateLayoutConfig($c4ShapeInRow=\"4\", $c4BoundaryInRow=\"4\")\r","date":"2023-12-19","id":5,"permalink":"/docs/platform/iam/","summary":"\u003cp\u003eç»Ÿä¸€èº«ä»½è®¤è¯ï¼ˆIdentity and Access Managementï¼Œèº«ä»½è®¤è¯å’Œè®¿é—®æ§åˆ¶ï¼Œç®€ç§° IAMï¼‰çš„æŠ€æœ¯é€‰å‹å’Œå®è·µã€‚\u003c/p\u003e\n\u003ch2 id=\"æ ¸å¿ƒéœ€æ±‚\"\u003eæ ¸å¿ƒéœ€æ±‚\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eé›†ä¸­ç®¡ç†ï¼šä»ä¸€ä¸ªåœ°æ–¹ç®¡ç†è´¦æˆ·å’Œèº«ä»½ã€‚\u003c/li\u003e\n\u003cli\u003eå•ç‚¹ç™»å½•ï¼šå…è®¸ç”¨æˆ·ä½¿ç”¨ä¸€ç»„å‡­æ®è®¿é—®æ‰€æœ‰é›†æˆçš„ç³»ç»Ÿå’Œåº”ç”¨ï¼Œé¿å…è®°å¿†å¤šä¸ªç”¨æˆ·åå’Œå¯†ç ã€‚\u003c/li\u003e\n\u003cli\u003eåŠ¨æ€è®¿é—®æ§åˆ¶ï¼šåŸºäºè§’è‰²å’Œç­–ç•¥åŠ¨æ€æˆäºˆæˆ–æ’¤é”€è®¿é—®æƒé™ã€‚\u003c/li\u003e\n\u003cli\u003eå®¡è®¡ä¸åˆè§„ï¼šè®°å½•å’Œç›‘æ§è®¿é—®æ´»åŠ¨ï¼Œä»¥æ”¯æŒåˆè§„æ€§å®¡è®¡ã€‚\u003c/li\u003e\n\u003cli\u003eæ— ç¼å¿«é€Ÿé›†æˆï¼šä½œä¸ºå¹³å°å·¥ç¨‹çš„ä¸€éƒ¨åˆ†æ›´å¼ºè°ƒâ€œè‡ªåŠ©â€ï¼Œå„ä¸ªåº”ç”¨èƒ½å¤Ÿæ— ç¼å¿«é€Ÿæ¥å…¥ï¼Œç”šè‡³æœ‰äº›åº”ç”¨åªéœ€è¦ç®€å•çš„æƒé™èƒ½å¤Ÿä¸éœ€è¦å¼€å‘è‡ªåŠ¨æ¥å…¥ã€‚\u003c/li\u003e\n\u003cli\u003eå¼ºåŒ–è®¤è¯æœºåˆ¶ï¼šé‡‡ç”¨å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼šOTP å£ä»¤ã€æŒ‡çº¹ã€çŸ­ä¿¡éªŒè¯ç ç­‰ï¼‰æ–¹æ³•ï¼Œä¸ºé‡è¦æ“ä½œå¢åŠ é¢å¤–é˜²æŠ¤ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"æŠ€æœ¯é€‰é¡¹\"\u003eæŠ€æœ¯é€‰é¡¹\u003c/h2\u003e\n\u003cp\u003eä¸ºæ»¡è¶³ä»¥ä¸Šéœ€æ±‚ï¼Œåœ¨åˆæœŸæŠ€æœ¯é€‰é¡¹æ—¶ä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªå¼€æºç»„ä»¶ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/keycloak/\" target=\"_blank\" rel=\"noopener\"\u003ekeycloak\u003c/a\u003e\n: å…¨é¢çš„ IAM è§£å†³æ–¹æ¡ˆ ï¼Œå®ç°ç”¨æˆ·ã€æƒé™ç®¡ç†ï¼Œå•ç‚¹ç™»å½•ã€MFA ç­‰ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/dexidp\" target=\"_blank\" rel=\"noopener\"\u003eDex\u003c/a\u003e\n: èº«ä»½ä»£ç†ï¼Œè¿æ¥å¤šä¸ªèº«ä»½æºï¼Œä»…ä½œä¸º OpenID Connectã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ory/\" target=\"_blank\" rel=\"noopener\"\u003eOry\u003c/a\u003e\n: åŒ…å«å¤šä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œç»„æˆä¸€ä¸ªå…¨å®¶æ¡¶çš„è§£å†³æ–¹æ¡ˆã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/oauth2-proxy\" target=\"_blank\" rel=\"noopener\"\u003eoauth2-proxy\u003c/a\u003e\n: åå‘ä»£ç†å·¥å…·ï¼Œä¸“ä¸ºæä¾› OAuth 2.0 èº«ä»½éªŒè¯å’ŒæˆæƒæœåŠ¡è€Œè®¾è®¡ï¼Œé™„å¸¦åŸºäºç”¨æˆ·ã€åˆ†ç»„ã€è§’è‰²çš„æƒé™ç®¡ç†ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/pomerium/\" target=\"_blank\" rel=\"noopener\"\u003ePomerium\u003c/a\u003e\n: Pomerium ä¸ä»…ä»…æ˜¯ä¸€ä¸ª OAuth 2.0 ä»£ç†ï¼Œå®ƒè¿˜æä¾›äº†ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·ã€ç»„ã€å’Œå…¶ä»–ä¸Šä¸‹æ–‡å±æ€§æ¥å†³å®šè®¿é—®æƒé™ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥ä¸‹ä¸º keycloak å’Œ Dex çš„ç®€å•å¯¹æ¯”ã€‚ä¸ºä»€ä¹ˆä¸æŠŠ Ory åŠ è¿›æ¥ï¼Œå› ä¸ºæ²¡æœ‰å®é™…ç”¨è¿‡ï¼Œä¸ä¾¿äºå‘è¡¨æ„è§ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ª Ory ç”¨æˆ·æ¬¢è¿è¡¥å……ã€‚\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eç‰¹æ€§/å·¥å…·\u003c/th\u003e\n          \u003cth\u003eKeycloak\u003c/th\u003e\n          \u003cth\u003eDex\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eç±»å‹\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eå…¨é¢çš„ IAM è§£å†³æ–¹æ¡ˆ\u003c/td\u003e\n          \u003ctd\u003eèº«ä»½ä»£ç†\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eç”¨æˆ·ç®¡ç†\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ”¯æŒå†…ç½®ç”¨æˆ·ç®¡ç†\u003c/td\u003e\n          \u003ctd\u003eä¸ç›´æ¥ç®¡ç†ç”¨æˆ·ï¼Œä¾èµ–å¤–éƒ¨èº«ä»½æä¾›è€…\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eåè®®æ”¯æŒ\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eOpenID Connectã€OAuth 2.0ã€SAML 2.0\u003c/td\u003e\n          \u003ctd\u003eOpenID Connect\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eSSO\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ”¯æŒ\u003c/td\u003e\n          \u003ctd\u003eä¾èµ–å¤–éƒ¨èº«ä»½æä¾›è€…å®ç°\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eç¤¾äº¤ç™»å½•\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ”¯æŒå¤šç§ç¤¾äº¤ç™»å½•é€‰é¡¹\u003c/td\u003e\n          \u003ctd\u003eä¸ç›´æ¥æ”¯æŒï¼Œå¯é€šè¿‡è¿æ¥å¤–éƒ¨èº«ä»½æä¾›è€…å®ç°\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eè§’è‰²ç®¡ç†\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæ”¯æŒå¤æ‚çš„è§’è‰²å’Œæƒé™ç®¡ç†\u003c/td\u003e\n          \u003ctd\u003eä¸ç›´æ¥æ”¯æŒ\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eæ‰©å±•æ€§\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eé«˜ï¼Œé€‚åˆå„ç§è§„æ¨¡å’Œå¤æ‚æ€§çš„éœ€æ±‚\u003c/td\u003e\n          \u003ctd\u003eé€‚åˆå°†å¤šä¸ªèº«ä»½æºç»Ÿä¸€åˆ°ä¸€ä¸ªè®¤è¯æµç¨‹çš„ç¯å¢ƒ\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eä½¿ç”¨åœºæ™¯\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eéœ€è¦å…¨é¢ã€é›†ä¸­å¼èº«ä»½ç®¡ç†çš„ç»„ç»‡\u003c/td\u003e\n          \u003ctd\u003eéœ€è¦ç»Ÿä¸€å¤šä¸ªèº«ä»½æºè®¤è¯ï¼Œå¦‚åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eç”¨æˆ·ç•Œé¢\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eæä¾›ä¸°å¯Œçš„ç”¨æˆ·å’Œç®¡ç†å‘˜ç•Œé¢\u003c/td\u003e\n          \u003ctd\u003eä¸»è¦æ˜¯ APIï¼Œæ²¡æœ‰è¯¦ç»†çš„ç”¨æˆ·ç•Œé¢\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eé€‚ç”¨æ€§\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eé€‚ç”¨äºéœ€è¦å®Œæ•´ IAM è§£å†³æ–¹æ¡ˆçš„ç»„ç»‡\u003c/td\u003e\n          \u003ctd\u003eé€‚ç”¨äºä½œä¸ºå¤šä¸ªèº«ä»½æºä»£ç†ï¼Œå°¤å…¶åœ¨ Kubernetes ç¯å¢ƒä¸­\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eä»¥ä¸‹ä¸º OAuth2 Proxy å’Œ Pomerium çš„ç®€å•å¯¹æ¯”ã€‚\u003c/p\u003e","tags":[],"title":"ç»Ÿä¸€èº«ä»½è®¤è¯"},{"content":"æˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ã€‚\n","date":"2023-09-07","id":6,"permalink":"/docs/platform/","summary":"\u003cp\u003eæˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ã€‚\u003c/p\u003e","tags":[],"title":"å¹³å°å·¥ç¨‹"},{"content":"äº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ã€‚\n","date":"2023-09-07","id":7,"permalink":"/docs/cloud/","summary":"\u003cp\u003eäº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ã€‚\u003c/p\u003e","tags":[],"title":"äº‘åŸç”Ÿ"},{"content":"2025 å¹´ 11 æœˆï¼ŒSpring Boot 4.0 æ­£å¼å‘å¸ƒï¼Œè¿™æ¬¡å‡çº§è¢«ä¸šç•Œç§°ä¸ºçˆ†ç‚¸æ€§å‡çº§ã€‚åŒæ—¶å¯¹äºäº‘åŸç”Ÿåº”ç”¨è€Œè¨€ï¼Œè¿™æ˜¯ä¸€æ¬¡ä¸å¯é”™è¿‡çš„æ€§èƒ½ä¸æ•ˆç‡è·ƒè¿ï¼š\nğŸ³ å®¹å™¨åŒ–å‹å¥½ï¼šæ¨¡å—åŒ–æ¶æ„å‡å°‘ 30-50% è¿è¡Œæ—¶å ç”¨ï¼Œé•œåƒæ›´å°ã€å¯åŠ¨æ›´å¿« âš¡ å¯åŠ¨é€Ÿåº¦æå‡ 30-50%ï¼šå¤šçº¿ç¨‹å¼‚æ­¥å¯åŠ¨æœºåˆ¶ï¼Œå®¹å™¨å†·å¯åŠ¨æ—¶é—´æ˜¾è‘—ç¼©çŸ­ï¼Œæ›´é€‚åˆ Kubernetes å¿«é€Ÿæ‰©ç¼©å®¹ ğŸš€ 2-3 å€ååé‡æå‡ï¼šè™šæ‹Ÿçº¿ç¨‹åŸç”Ÿæ”¯æŒï¼ŒI/O å¯†é›†å‹å¾®æœåŠ¡èµ„æºåˆ©ç”¨ç‡å¤§å¹…æå‡ï¼Œå•å®ä¾‹å¯æ‰¿è½½æ›´é«˜å¹¶å‘ ğŸ¯ äº‘åŸç”Ÿç‰¹æ€§å¢å¼ºï¼šå†…ç½®å¼¹æ€§åŠŸèƒ½ï¼ˆé‡è¯•ã€é™æµï¼‰ã€HTTP æ¥å£å®¢æˆ·ç«¯è‡ªåŠ¨é…ç½®ï¼Œç®€åŒ–å¾®æœåŠ¡é—´é€šä¿¡ ä½†è¿™æ¬¡å‡çº§ä¹Ÿå¸¦æ¥äº† 36 ä¸ªåºŸå¼ƒ API ç§»é™¤ã€æ¨¡å—åŒ–æ¶æ„é‡æ„ã€Tomcat 11 å˜æ›´ç­‰æŒ‘æˆ˜ã€‚æœ¬æ–‡åŸºäº Spring Boot å®˜æ–¹æ–‡æ¡£å’Œç”Ÿäº§ç¯å¢ƒè¿ç§»ç»éªŒï¼Œä»åŸç†åˆ°è¸©å‘ï¼Œæä¾›å®Œæ•´ã€å®ç”¨çš„è¿ç§»æŒ‡å—ï¼ŒåŠ©ä½ å¹³ç¨³å®Œæˆäº‘åŸç”Ÿåº”ç”¨çš„å‡çº§ã€‚\nSpring Boot 4.0 æ ¸å¿ƒæ–°ç‰¹æ€§ ä½œä¸º Spring Boot 3.x ä¹‹åçš„é¦–ä¸ªå¤§ç‰ˆæœ¬æ›´æ–°ï¼ŒSpring Boot 4.0 åŸºäº Spring Framework 7.0ã€Jakarta EE 11 å’Œ Java 17+ï¼ˆæ¨è Java 21 æˆ– 25ï¼‰ï¼Œå¸¦æ¥äº†æ¨¡å—åŒ–æ¶æ„é‡æ„ã€è™šæ‹Ÿçº¿ç¨‹åŸç”Ÿæ”¯æŒã€HTTP æœåŠ¡å®¢æˆ·ç«¯è‡ªåŠ¨é…ç½®ç­‰é‡å¤§å˜åŒ–ã€‚\nSpring Boot 4.0 é…å¥—ä½¿ç”¨ Spring Cloud 2025.1.xã€‚è™½ç„¶ç‰ˆæœ¬å·çœ‹èµ·æ¥åªæ˜¯ä¸­å·ç‰ˆæœ¬å˜æ›´ï¼Œä½†å®é™…ä¸Šè¿™æ˜¯ä¸€æ¬¡å¤§ç‰ˆæœ¬å˜æ›´ï¼ŒåŒ…å«äº†å¤§é‡ç ´åæ€§å˜æ›´å’Œé‡è¦æ›´æ–°ã€‚\næ¨¡å—åŒ–æ¶æ„ Spring Boot 4 å°† spring-boot-autoconfigure æ‹†åˆ†ä¸ºå¤šä¸ªä¸“æ³¨çš„æ¨¡å—ï¼Œæ¯ä¸ªæŠ€æœ¯éƒ½æœ‰ç‹¬ç«‹çš„ starter å’Œå¯¹åº”çš„æµ‹è¯• starterã€‚\nä¸»è¦å˜åŒ–ï¼š\næ¨¡å—å‘½åï¼šspring-boot-\u0026lt;technology\u0026gt;ï¼ŒåŒ…è·¯å¾„ï¼šorg.springframework.boot.\u0026lt;technology\u0026gt; Starter å‘½åï¼šspring-boot-starter-\u0026lt;technology\u0026gt; å’Œ spring-boot-starter-\u0026lt;technology\u0026gt;-test ä¹‹å‰æ²¡æœ‰ starter çš„æŠ€æœ¯ï¼ˆå¦‚ Flywayã€Liquibaseï¼‰ç°åœ¨éœ€è¦æ˜¾å¼æ·»åŠ å¯¹åº”çš„ starter æ¨¡å—åŒ–çš„ä¼˜åŠ¿ï¼š\nå‡å°‘ IDE å¹²æ‰°ï¼šIDE è‡ªåŠ¨å®Œæˆåªæ˜¾ç¤ºä½ å®é™…ä½¿ç”¨çš„æŠ€æœ¯ç›¸å…³çš„ç±»å’Œé…ç½®å±æ€§ï¼Œä¸å†å‡ºç°æ— å…³çš„ä»£ç æç¤ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸ä½¿ç”¨ GraphQLï¼ŒIDE ä¸ä¼šæç¤º GraphQL ç›¸å…³çš„é…ç½®å±æ€§ æ›´å°çš„è¿è¡Œæ—¶å ç”¨ï¼šåªå¼•å…¥å®é™…ä½¿ç”¨çš„æ¨¡å—ï¼Œå‡å°‘ç±»è·¯å¾„å¼€é”€å’Œå¯åŠ¨æ‰«ææˆæœ¬ã€‚Spring Boot 3.5 çš„ spring-boot-autoconfigure æ˜¯ 2 MiBï¼Œæ¨¡å—åŒ–ååªå¼•å…¥éœ€è¦çš„æ¨¡å—ï¼Œæ˜¾è‘—å‡å°‘å ç”¨ é¿å…æ„å¤–è‡ªåŠ¨é…ç½®ï¼šæ¨¡å—åŒ–åï¼ŒSpring Boot èƒ½æ›´å‡†ç¡®åœ°åˆ¤æ–­ä½ çš„æ„å›¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªä½¿ç”¨ WebClientï¼ˆé€šè¿‡ spring-boot-starter-webclientï¼‰ï¼Œä¸ä¼šæ„å¤–å¯ç”¨ Web æœåŠ¡å™¨è‡ªåŠ¨é…ç½®ï¼Œä¸å†éœ€è¦è°ƒç”¨ SpringApplication.setWebApplicationType(WebApplicationType.NONE) å¯ç”¨æ–°ç”¨ä¾‹ï¼šä¾‹å¦‚ï¼Œç°åœ¨å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ Micrometer æŒ‡æ ‡ï¼ˆspring-boot-starter-micrometer-metricsï¼‰ï¼Œè€Œä¸éœ€è¦å®Œæ•´çš„ Actuator ä¾èµ–é“¾ æ›´å¥½çš„ç»´æŠ¤æ€§ï¼šæ¨¡å—è¾¹ç•Œæˆä¸ºæ˜ç¡®çš„å¥‘çº¦ï¼Œè€Œä¸æ˜¯è½¯çº¦å®šï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œä»£ç ç»´æŠ¤ æµ‹è¯•æ”¯æŒçš„æ¨¡å—åŒ–ï¼š\nspring-boot-test-autoconfigure ä¹Ÿè¢«æ¨¡å—åŒ–äº†ã€‚æµ‹è¯•ç›¸å…³çš„æ³¨è§£ç°åœ¨ä½äºå¯¹åº”çš„æµ‹è¯•æ¨¡å—ä¸­ã€‚ä¾‹å¦‚ï¼Œ@AutoConfigureDataJdbc æ³¨è§£ç°åœ¨ä½äº spring-boot-starter-data-jdbc-test æ¨¡å—ä¸­ï¼Œä¸ spring-boot-starter-data-jdbc å¯¹é½ã€‚\næµ‹è¯• Starter çš„ä¼ é€’æ€§ï¼š\næ‰€æœ‰ test starter éƒ½ä¼šä¼ é€’æ€§åœ°å¼•å…¥ spring-boot-starter-testï¼Œå› æ­¤ä¸éœ€è¦å†å•ç‹¬å£°æ˜ spring-boot-starter-testã€‚åªéœ€è¦åˆ—å‡ºè¢«æµ‹è¯•æŠ€æœ¯å¯¹åº”çš„ test starter å³å¯ã€‚\nä¸»è¦åºŸå¼ƒ Starter å’Œæ›¿ä»£æ–¹æ¡ˆï¼š\nåºŸå¼ƒ Starter æ›¿ä»£ spring-boot-starter-web spring-boot-starter-webmvc spring-boot-starter-aop spring-boot-starter-aspectj spring-boot-starter-oauth2-authorization-server spring-boot-starter-security-oauth2-authorization-server spring-boot-starter-oauth2-client spring-boot-starter-security-oauth2-client spring-boot-starter-oauth2-resource-server spring-boot-starter-security-oauth2-resource-server spring-boot-starter-web-services spring-boot-starter-webservices å…¶ä»–è¿ç§»è¦ç‚¹ï¼š\næµ‹è¯•ä¾èµ–éœ€è¦æ·»åŠ å¯¹åº”çš„ -test starterï¼Œå¦‚ spring-boot-starter-security-test ä¹‹å‰æ²¡æœ‰ starter çš„æŠ€æœ¯ï¼ˆå¦‚ Flywayã€Liquibaseï¼‰ç°åœ¨éœ€è¦æ˜¾å¼æ·»åŠ å¯¹åº”çš„ starter å®Œæ•´çš„ Starter åˆ—è¡¨ï¼š\nSpring Boot 4.0 ç»Ÿä¸€äº† starter çš„ä½¿ç”¨æ–¹å¼ï¼šå¤§å¤šæ•°æŠ€æœ¯éƒ½æœ‰ä¸“é—¨çš„ starterï¼Œæ¯ä¸ª starter éƒ½æœ‰å¯¹åº”çš„ test starterã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„åˆ—è¡¨ï¼ˆå‚è€ƒ å®˜æ–¹è¿ç§»æŒ‡å— ï¼‰ï¼š\nTechnology Main Dependency Test Dependency Core Starters AspectJ spring-boot-starter-aspectj spring-boot-starter-aspectj-test Cloud Foundry Support spring-boot-starter-cloudfoundry spring-boot-starter-cloudfoundry-test Jakarta Validation spring-boot-starter-validation spring-boot-starter-validation-test Kotlin Serialization spring-boot-starter-kotlin-serialization spring-boot-starter-kotlin-serialization-test Reactor spring-boot-starter-reactor spring-boot-starter-reactor-test Web Server Starters Jetty spring-boot-starter-jetty none Reactor Netty spring-boot-starter-reactor-netty none Tomcat spring-boot-starter-tomcat none Web Client Starters Spring\u0026rsquo;s Imperative RestClient and RestTemplate spring-boot-starter-restclient spring-boot-starter-restclient-test Spring\u0026rsquo;s Reactive WebClient spring-boot-starter-webclient spring-boot-starter-webclient-test Web Starters Jersey spring-boot-starter-jersey spring-boot-starter-jersey-test Spring GraphQL spring-boot-starter-graphql spring-boot-starter-graphql-test Spring HATEOAS spring-boot-starter-hateoas spring-boot-starter-hateoas-test Spring Session Data Redis spring-boot-starter-session-data-redis spring-boot-starter-session-data-redis-test Spring Session JDBC spring-boot-starter-session-jdbc spring-boot-starter-session-jdbc-test Spring Web MVC spring-boot-starter-webmvc spring-boot-starter-webmvc-test Spring WebFlux spring-boot-starter-webflux spring-boot-starter-webflux-test Spring Webservices spring-boot-starter-webservices spring-boot-starter-webservices-test Database Starters Cassandra spring-boot-starter-cassandra spring-boot-starter-cassandra-test Couchbase spring-boot-starter-couchbase spring-boot-starter-couchbase-test Elasticsearch spring-boot-starter-elasticsearch spring-boot-starter-elasticsearch-test Flyway spring-boot-starter-flyway spring-boot-starter-flyway-test JDBC spring-boot-starter-jdbc spring-boot-starter-jdbc-test jOOQ spring-boot-starter-jooq spring-boot-starter-jooq-test Liquibase spring-boot-starter-liquibase spring-boot-starter-liquibase-test LDAP spring-boot-starter-ldap spring-boot-starter-ldap-test MongoDB spring-boot-starter-mongodb spring-boot-starter-mongodb-test Neo4J spring-boot-starter-neo4j spring-boot-starter-neo4j-test R2DBC spring-boot-starter-r2dbc spring-boot-starter-r2dbc-test Spring Data Starters Spring Data Cassandra spring-boot-starter-data-cassandra æˆ– spring-boot-starter-data-cassandra-reactive spring-boot-starter-data-cassandra-test æˆ– spring-boot-starter-data-cassandra-reactive-test Spring Data Couchbase spring-boot-starter-data-couchbase æˆ– spring-boot-starter-data-couchbase-reactive spring-boot-starter-data-couchbase-test æˆ– spring-boot-starter-data-couchbase-reactive-test Spring Data Elasticsearch spring-boot-starter-data-elasticsearch spring-boot-starter-data-elasticsearch-test Spring Data JDBC spring-boot-starter-data-jdbc spring-boot-starter-data-jdbc-test Spring Data JPA (using Hibernate) spring-boot-starter-data-jpa spring-boot-starter-data-jpa-test Spring Data LDAP spring-boot-starter-data-ldap spring-boot-starter-data-ldap-test Spring Data MongoDB spring-boot-starter-data-mongodb æˆ– spring-boot-starter-data-mongodb-reactive spring-boot-starter-data-mongodb-test æˆ– spring-boot-starter-data-mongodb-reactive-test Spring Data Neo4J spring-boot-starter-data-neo4j spring-boot-starter-data-neo4j-test Spring Data R2DBC spring-boot-starter-data-r2dbc spring-boot-starter-data-r2dbc-test Spring Data Redis spring-boot-starter-data-redis æˆ– spring-boot-starter-data-redis-reactive spring-boot-starter-data-redis-test æˆ– spring-boot-starter-data-redis-reactive-test Spring Data REST spring-boot-starter-data-rest spring-boot-starter-data-rest-test IO Starters Hazelcast spring-boot-starter-hazelcast spring-boot-starter-hazelcast-test Mail spring-boot-starter-mail spring-boot-starter-mail-test Quartz spring-boot-starter-quartz spring-boot-starter-quartz-test SendGrid spring-boot-starter-sendgrid spring-boot-starter-sendgrid-test Spring Caching Support spring-boot-starter-cache spring-boot-starter-cache-test Spring Batch (with JDBC) spring-boot-starter-batch-jdbc spring-boot-starter-batch-jdbc-test Spring Batch (without JDBC) spring-boot-starter-batch spring-boot-starter-batch-test JSON Starters GSON spring-boot-starter-gson spring-boot-starter-gson-test Jackson spring-boot-starter-jackson spring-boot-starter-jackson-test JSONB spring-boot-starter-jsonb spring-boot-starter-jsonb-test Messaging Starters ActiveMQ spring-boot-starter-activemq spring-boot-starter-activemq-test Artemis spring-boot-starter-artemis spring-boot-starter-artemis-test JMS spring-boot-starter-jms spring-boot-starter-jms-test RSocket spring-boot-starter-rsocket spring-boot-starter-rsocket-test Spring AMQP spring-boot-starter-amqp spring-boot-starter-amqp-test Spring Integration spring-boot-starter-integration spring-boot-starter-integration-test Spring for Apache Kafka spring-boot-starter-kafka spring-boot-starter-kafka-test Spring for Apache Pulsar spring-boot-starter-pulsar spring-boot-starter-pulsar-test Websockets spring-boot-starter-websocket spring-boot-starter-websocket-test Security Starters Spring Security spring-boot-starter-security spring-boot-starter-security-test Spring Security OAuth Authorization Server spring-boot-starter-security-oauth2-authorization-server spring-boot-starter-security-oauth2-authorization-server-test Spring Security OAuth Client spring-boot-starter-security-oauth2-client spring-boot-starter-security-oauth2-client-test Spring Security OAuth Resource Server spring-boot-starter-security-oauth2-resource-server spring-boot-starter-security-oauth2-resource-server-test Spring Security SAML spring-boot-starter-security-saml2 spring-boot-starter-security-saml2-test Templating Starters Freemarker spring-boot-starter-freemarker spring-boot-starter-freemarker-test Groovy Templates spring-boot-starter-groovy-templates spring-boot-starter-groovy-templates-test Mustache spring-boot-starter-mustache spring-boot-starter-mustache-test Thymeleaf spring-boot-starter-thymeleaf spring-boot-starter-thymeleaf-test Production-Ready Starters Actuator spring-boot-starter-actuator spring-boot-starter-actuator-test Micrometer Metrics spring-boot-starter-micrometer-metrics spring-boot-starter-micrometer-metrics-test OpenTelemetry spring-boot-starter-opentelemetry spring-boot-starter-opentelemetry-test Zipkin spring-boot-starter-zipkin spring-boot-starter-zipkin-test æç¤ºï¼š æ‰€æœ‰ test starter éƒ½ä¼šä¼ é€’æ€§åœ°å¼•å…¥ spring-boot-starter-testï¼Œå› æ­¤ä¸éœ€è¦å†å•ç‹¬å£°æ˜ spring-boot-starter-testã€‚åªéœ€è¦åˆ—å‡ºè¢«æµ‹è¯•æŠ€æœ¯å¯¹åº”çš„ test starter å³å¯ã€‚\nClassic Startersï¼ˆå¿«é€Ÿè¿ç§»æ–¹æ¡ˆï¼‰ï¼š\nå¦‚æœéœ€è¦å¿«é€Ÿè¿ç§»ï¼Œå¯ä»¥ä½¿ç”¨ Classic Startersï¼Œå®ƒä»¬æä¾›äº†ç±»ä¼¼ Spring Boot 3.x çš„ classpathï¼Œè®©ä½ å¯ä»¥å¿«é€Ÿæ¢å¤æ‰€æœ‰åŸºç¡€è®¾æ–½çš„å¯ç”¨æ€§ï¼š\n\u0026lt;!-- æ›¿ä»£ spring-boot-starter --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-classic\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æ›¿ä»£ spring-boot-starter-test --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test-classic\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt;\rä½¿ç”¨ Classic Starters çš„å¥½å¤„ï¼š\nå¿«é€Ÿæ¢å¤åº”ç”¨åŠŸèƒ½ï¼Œæ— éœ€ç«‹å³å¤„ç†æ‰€æœ‰ starter æ›¿æ¢ ä¿®å¤å¯¼å…¥é”™è¯¯ï¼ŒéªŒè¯åº”ç”¨èƒ½æ­£å¸¸å·¥ä½œ ä½œä¸ºè¿‡æ¸¡æ–¹æ¡ˆï¼Œé™ä½è¿ç§»é£é™© è¿ç§»å»ºè®®ï¼ˆå®˜æ–¹æ¨èçš„ä¸¤æ­¥æ³•ï¼‰ï¼š\nç¬¬ä¸€æ­¥ï¼šä½¿ç”¨ Classic Starters å¿«é€Ÿè¿ç§»ï¼Œä¿®å¤ç¼–è¯‘é”™è¯¯ï¼Œç¡®ä¿åº”ç”¨è¿è¡Œæ­£å¸¸ ç¬¬äºŒæ­¥ï¼šé€æ­¥ç§»é™¤ Classic Startersï¼Œæ ¹æ®æ›´æ–°åçš„å¯¼å…¥è¯­å¥è¯†åˆ«ç¼ºå¤±çš„ starterï¼Œæ·»åŠ å¯¹åº”çš„æ¨¡å—åŒ– starter æ³¨æ„ï¼š å®˜æ–¹å»ºè®®æœ€ç»ˆè¿˜æ˜¯è¦è¿ç§»åˆ°æ¨¡å—åŒ–çš„ starterï¼ŒClassic Starters åªæ˜¯è¿‡æ¸¡æ–¹æ¡ˆã€‚å®Œæ•´çš„ starter åˆ—è¡¨å’Œå¯¹åº”å…³ç³»è¯·å‚è€ƒ å®˜æ–¹è¿ç§»æŒ‡å— ã€‚\nå¢å¼ºçš„é…ç½®å±æ€§å…ƒæ•°æ® Spring Boot 4 å¼•å…¥äº†æ–°çš„æ³¨è§£ @ConfigurationPropertiesSourceï¼Œå…è®¸ Spring Boot è¯»å–å¤–éƒ¨æ¨¡å—ä¸­å®šä¹‰çš„ @ConfigurationProperties ç±»å‹ï¼Œè¿™åœ¨ä¹‹å‰æ˜¯ä¸å¯èƒ½çš„ã€‚\nä½¿ç”¨åœºæ™¯ï¼š\n@ConfigurationPropertiesSource(\u0026#34;com.example.config\u0026#34;) @ConfigurationProperties(prefix = \u0026#34;app\u0026#34;) public class AppProperties { private String name; // getters and setters }\rä¼˜åŠ¿ï¼š\næ›´æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ æ”¹è¿›å·¥å…·æ”¯æŒï¼ˆIDE è‡ªåŠ¨å®Œæˆã€é…ç½®æç¤ºç­‰ï¼‰ æ”¯æŒè·¨æ¨¡å—çš„é…ç½®å±æ€§å®šä¹‰ ä»»åŠ¡è°ƒåº¦å¢å¼º Spring Boot 4 ç°åœ¨æ”¯æŒé…ç½®å¤šä¸ª TaskDecorator Beanï¼Œå…è®¸ä½ ç»„åˆå¤šä¸ªè£…é¥°å™¨æ¥å¢å¼ºä»»åŠ¡æ‰§è¡Œè¡Œä¸ºã€‚\nä½¿ç”¨ç¤ºä¾‹ï¼š\n@Configuration public class TaskConfig { @Bean public TaskDecorator loggingTaskDecorator() { return runnable -\u0026gt; { return () -\u0026gt; { System.out.println(\u0026#34;Task started: \u0026#34; + Thread.currentThread().getName()); try { runnable.run(); } finally { System.out.println(\u0026#34;Task completed\u0026#34;); } }; }; } @Bean public TaskDecorator mdcTaskDecorator() { return runnable -\u0026gt; { String traceId = MDC.get(\u0026#34;traceId\u0026#34;); return () -\u0026gt; { MDC.put(\u0026#34;traceId\u0026#34;, traceId); try { runnable.run(); } finally { MDC.clear(); } }; }; } }\rå¤šä¸ª TaskDecorator ä¼šæŒ‰é¡ºåºåº”ç”¨ï¼Œæä¾›æ›´çµæ´»çš„ä»»åŠ¡æ‰§è¡Œå¢å¼ºèƒ½åŠ›ã€‚\nåŒ…ç»“æ„å˜åŒ– æ¨¡å—åŒ–æ¶æ„å¯¹åŒ…ç»“æ„ä¹Ÿæœ‰å½±å“ã€‚æ¯ä¸ªæ¨¡å—ç°åœ¨éƒ½æœ‰ç‹¬ç«‹çš„ org.springframework.boot.\u0026lt;module\u0026gt; åŒ…è·¯å¾„ã€‚æ ¹æ®æ¨¡å—çš„èŒè´£èŒƒå›´ï¼Œå¯èƒ½åŒ…å« APIã€è‡ªåŠ¨é…ç½®ã€Actuator ç›¸å…³æ”¯æŒç­‰ã€‚\nç¤ºä¾‹ï¼š\n// Spring Boot 3.x import org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration; // Spring Boot 4.0 import org.springframework.boot.webmvc.autoconfigure.WebMvcAutoConfiguration;\rä¸»è¦å˜åŒ–ï¼š\næ¯ä¸ªæŠ€æœ¯æ¨¡å—éƒ½æœ‰ç‹¬ç«‹çš„åŒ…è·¯å¾„ï¼šorg.springframework.boot.\u0026lt;technology\u0026gt; æµ‹è¯•æ¨¡å—åŒ…è·¯å¾„ï¼šorg.springframework.boot.\u0026lt;technology\u0026gt;.test è‡ªåŠ¨é…ç½®ç±»ã€Actuator æ”¯æŒç­‰éƒ½ä½äºå¯¹åº”çš„æ¨¡å—åŒ…ä¸‹ å¦‚æœä½ æœ‰è‡ªå®šä¹‰ starterï¼Œå¤§æ¦‚ç‡éƒ½éœ€è¦é€‚é…æ–°çš„åŒ…è·¯å¾„ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ class å­—ç¬¦åå­—ï¼Œè€Œä¸æ˜¯ class ç±»çš„ã€‚ Spring Framework 7.0 å¸¦æ¥çš„å¢å¼º Spring Boot 4 åŸºäº Spring Framework 7.0 æ„å»ºï¼Œç»§æ‰¿äº†ä»¥ä¸‹ç‰¹æ€§ã€‚\nAPI ç‰ˆæœ¬æ§åˆ¶ Spring Framework 7 åŸç”Ÿæ”¯æŒ API ç‰ˆæœ¬ç®¡ç†ï¼Œè¿™æ˜¯é¦–æ¬¡åœ¨ Spring æ¡†æ¶ä¸­æä¾›å®˜æ–¹æ”¯æŒã€‚ä¹‹å‰è™½ç„¶å¯ä»¥é€šè¿‡ @RequestMapping å®ç°ï¼Œä½†éœ€è¦å¤§é‡æ‰‹åŠ¨å·¥ä½œã€‚\né…ç½®æ–¹å¼ï¼š\nJava é…ç½®ï¼š\n@Configuration public class WebConfiguration implements WebMvcConfigurer { @Override public void configureApiVersioning(ApiVersionConfigurer configurer) { configurer.useRequestHeader(\u0026#34;API-Version\u0026#34;); // æˆ–ä½¿ç”¨å…¶ä»–ç­–ç•¥ï¼š // configurer.useQueryParameter(\u0026#34;version\u0026#34;); // configurer.usePathPattern(\u0026#34;/api/{version}\u0026#34;); // configurer.useMediaType(\u0026#34;application/vnd.api.v1+json\u0026#34;); } }\rSpring Boot é…ç½®å±æ€§ï¼š\nspring: mvc: apiversion: use: header: API-Version # æˆ–ä½¿ç”¨ï¼š # query-parameter: version # path-pattern: /api/{version}\rä½¿ç”¨ç¤ºä¾‹ï¼š\n@RestController @RequestMapping(\u0026#34;/api\u0026#34;) public class UserController { @GetMapping(value = \u0026#34;/users\u0026#34;, version = \u0026#34;1\u0026#34;) public List\u0026lt;UserV1\u0026gt; getUsersV1() { return userService.getUsersV1(); } @GetMapping(value = \u0026#34;/users\u0026#34;, version = \u0026#34;2\u0026#34;) public List\u0026lt;UserV2\u0026gt; getUsersV2() { return userService.getUsersV2(); } }\råŠŸèƒ½å¼ç«¯ç‚¹æ”¯æŒï¼š\nRouterFunction\u0026lt;ServerResponse\u0026gt; route = RouterFunctions.route() .GET(\u0026#34;/hello-world\u0026#34;, version(\u0026#34;1.2\u0026#34;), request -\u0026gt; ServerResponse.ok().body(\u0026#34;Hello World\u0026#34;)) .build();\ræ”¯æŒçš„ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ï¼š\nè·¯å¾„ç‰ˆæœ¬æ§åˆ¶ï¼š/v1/usersã€/v2/usersï¼ˆéœ€è¦åœ¨è·¯å¾„ä¸­å£°æ˜ URI å˜é‡ï¼‰ è¯·æ±‚å¤´ç‰ˆæœ¬æ§åˆ¶ï¼šX-API-Version: 1 æˆ–è‡ªå®šä¹‰ header åç§° æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬æ§åˆ¶ï¼š/users?version=1 åª’ä½“ç±»å‹ç‰ˆæœ¬æ§åˆ¶ï¼šAccept: application/vnd.api.v1+json ç‰ˆæœ¬æ ¼å¼ï¼š\né»˜è®¤ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰ï¼Œæ”¯æŒ major.minor.patch æ ¼å¼ã€‚å¦‚æœæœªæŒ‡å®š minor å’Œ patchï¼Œé»˜è®¤ä¸º 0ã€‚ç‰ˆæœ¬è§£æå™¨å¯ä»¥è‡ªå®šä¹‰ï¼Œæ”¯æŒæ—¥æœŸæ ¼å¼æˆ–å…¶ä»–æ ¼å¼ã€‚\nåºŸå¼ƒå¤„ç†ï¼š\nAPI ç‰ˆæœ¬æ§åˆ¶æ”¯æŒ RFC 9745 æ ‡å‡†çš„åºŸå¼ƒå¤„ç†ï¼Œå¯ä»¥åœ¨å“åº”ä¸­å‘é€åºŸå¼ƒæç¤ºã€‚\nJSpecify ç©ºå®‰å…¨æ³¨è§£ Spring Framework 7 è¿ç§»åˆ° JSpecify æ³¨è§£ï¼Œè¿™æ˜¯ Spring ç”Ÿæ€ç³»ç»Ÿä¸­ç©ºå®‰å…¨æ”¯æŒçš„é‡å¤§é‡Œç¨‹ç¢‘ã€‚JSpecify æ˜¯ä¸€ä¸ªç”± OpenJDKã€Broadcomã€Googleã€JetBrainsã€Sonar ç­‰ç»„ç»‡å…±åŒå‚ä¸çš„æ ‡å‡†é¡¹ç›®ã€‚\nå·²æ”¯æŒ JSpecify çš„ Spring é¡¹ç›®ï¼š\nSpring Boot 4.0 Spring Framework 7.0 Spring Data 4.0 Spring Security 7.0 Spring Batch 6.0 Spring Kafka 4.0 Spring Integration 7.0 Spring GraphQL 2.0 Spring Web Services 5.0 Spring AMQP 4.0 Spring Shell 4.0 Spring Plugin 4.0 Spring HATEOAS 3.0 Spring Modulith 2.0 Spring Vault 4.0 Spring Cloud Commons 5.0 Spring Cloud Gateway 5.0 Micrometer 1.16 Micrometer Tracing 1.6 Context Propagation 1.2 Reactor 2025.0 ä½¿ç”¨ç¤ºä¾‹ï¼š\nimport org.jspecify.annotations.Nullable; import org.jspecify.annotations.NonNull; public class UserService { public @NonNull User getUser(@NonNull String userId) { return userRepository.findById(userId) .orElseThrow(() -\u0026gt; new UserNotFoundException(userId)); } public @Nullable User findUser(@NonNull String email) { return userRepository.findByEmail(email).orElse(null); } }\rIDE æ”¯æŒï¼š\nIntelliJ IDEA 2025.3+ï¼šæä¾›å®Œæ•´çš„ JSpecify æ”¯æŒï¼ŒåŒ…æ‹¬å¤æ‚çš„æ•°æ®æµåˆ†æ Kotlin 2.2ï¼šè‡ªåŠ¨å°† JSpecify æ³¨è§£è½¬æ¢ä¸º Kotlin ç©ºå®‰å…¨ç±»å‹ï¼Œå‘Šåˆ«å¹³å°ç±»å‹ï¼ˆplatform typesï¼‰ NullAwayï¼šæ„å»ºæ—¶æ£€æŸ¥å·¥å…·ï¼Œéœ€è¦ JDK 21+ï¼ˆJDK 17 æ”¯æŒå¯èƒ½åœ¨åç»­ç‰ˆæœ¬æä¾›ï¼‰ Kotlin é¡¹ç›®æ³¨æ„äº‹é¡¹ï¼š\nJSpecify æ³¨è§£ä¼šæ˜ç¡®æ ‡è®°å¯ç©ºæ€§ï¼ŒKotlin ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶è½¬æ¢ã€‚å¦‚æœ Java æ¥å£ä½¿ç”¨ @Nullable æ³¨è§£ï¼ŒKotlin å®ç°å¿…é¡»è¿”å›å¯ç©ºç±»å‹ï¼›å¦‚æœä½¿ç”¨ @NonNullï¼Œåˆ™å¿…é¡»è¿”å›éç©ºç±»å‹ã€‚IntelliJ IDEA ä¼šæä¾›ç›¸åº”çš„ç¼–è¯‘é”™è¯¯æç¤ºå’Œä¿®å¤å»ºè®®ã€‚\nå¤šçº¿ç¨‹å¼‚æ­¥å¯åŠ¨ Spring Framework 7.0 å¼•å…¥äº†å¤šçº¿ç¨‹å¼‚æ­¥å¯åŠ¨æœºåˆ¶ï¼Œå¯ä»¥å¹¶è¡Œåˆå§‹åŒ– ApplicationContextï¼Œæ˜¾è‘—åŠ å¿«åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚\nå·¥ä½œåŸç†ï¼š\nApplicationContext å¯åŠ¨æ—¶ï¼Œå¯ä»¥å¹¶è¡Œåˆå§‹åŒ–å¤šä¸ª Bean åˆ©ç”¨å¤šæ ¸ CPU èµ„æºï¼Œå°†ä¸²è¡Œçš„ Bean åˆå§‹åŒ–æ”¹ä¸ºå¹¶è¡Œæ‰§è¡Œ è‡ªåŠ¨å¤„ç† Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿åˆå§‹åŒ–é¡ºåºæ­£ç¡® é…ç½®æ–¹å¼ï¼š\n@SpringBootApplication public class Application { public static void main(String[] args) { SpringApplication app = new SpringApplication(Application.class); // å¯ç”¨å¼‚æ­¥å¯åŠ¨ app.setApplicationStartup(new BufferingApplicationStartup(1000)); app.run(args); } }\ræˆ–è€…é€šè¿‡é…ç½®å±æ€§ï¼š\nspring: application: startup: enabled: true\ræ€§èƒ½æå‡ï¼š\nå¤§å‹åº”ç”¨å¯åŠ¨æ—¶é—´å¯å‡å°‘ 30-50% ç‰¹åˆ«é€‚åˆ Bean æ•°é‡å¤šã€åˆå§‹åŒ–è€—æ—¶çš„åº”ç”¨ å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUï¼Œæå‡èµ„æºåˆ©ç”¨ç‡ æ³¨æ„äº‹é¡¹ï¼š\néœ€è¦ç¡®ä¿ Bean åˆå§‹åŒ–æ˜¯çº¿ç¨‹å®‰å…¨çš„ æŸäº›å•ä¾‹ Bean å¯èƒ½ä»éœ€è¦ä¸²è¡Œåˆå§‹åŒ– å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯ï¼Œç¡®ä¿æ— å¹¶å‘é—®é¢˜ HTTP æ¥å£å®¢æˆ·ç«¯ Spring Framework 7 å’Œ Spring Boot 4 å¤§å¹…ç®€åŒ–äº† HTTP æ¥å£å®¢æˆ·ç«¯çš„é…ç½®ã€‚ä¹‹å‰éœ€è¦æ‰‹åŠ¨åˆ›å»º HttpServiceProxyFactory å’Œé…ç½®æ¯ä¸ªå®¢æˆ·ç«¯ï¼Œç°åœ¨å¯ä»¥é€šè¿‡å£°æ˜å¼æ–¹å¼è‡ªåŠ¨æ³¨å†Œã€‚\nå»ºè®®ï¼š è™½ç„¶ RestTemplate ä»å¯ä½¿ç”¨ï¼Œä½†æ¨èä½¿ç”¨ RestClient æˆ– HTTP æ¥å£å®¢æˆ·ç«¯ï¼ˆ@HttpExchangeï¼‰ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆã€‚\næ—§æ–¹å¼ï¼ˆSpring Framework 6 / Spring Boot 3ï¼‰ï¼š\n@HttpExchange(url = \u0026#34;/api/users\u0026#34;) public interface UserClient { @GetExchange(\u0026#34;/{id}\u0026#34;) User getUser(@PathVariable String id); @PostExchange User createUser(@RequestBody UserRequest request); } // éœ€è¦æ‰‹åŠ¨é…ç½®æ¯ä¸ªå®¢æˆ·ç«¯ @Configuration public class HttpClientConfig { @Bean public UserClient userClient(RestClient.Builder builder) { RestClient restClient = builder.baseUrl(\u0026#34;https://api.example.com\u0026#34;).build(); HttpServiceProxyFactory factory = HttpServiceProxyFactory .builderFor(RestClientAdapter.create(restClient)).build(); return factory.createClient(UserClient.class); } // å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯ï¼Œéœ€è¦é‡å¤é…ç½®ã€‚.. }\ræ–°æ–¹å¼ï¼ˆSpring Framework 7 / Spring Boot 4ï¼‰ï¼š\nä½¿ç”¨ @ImportHttpServices æ³¨è§£ï¼š\n@HttpExchange(url = \u0026#34;/api/users\u0026#34;) public interface UserClient { @GetExchange(\u0026#34;/{id}\u0026#34;) User getUser(@PathVariable String id); @PostExchange User createUser(@RequestBody UserRequest request); } @Configuration @ImportHttpServices(group = \u0026#34;api\u0026#34;, types = {UserClient.class}) public class HttpClientConfig { }\ré…ç½® application.ymlï¼š\nspring: http: client: service: read-timeout: 2s group: api: base-url: https://api.example.com\ræˆ–ä½¿ç”¨åŒ…æ‰«æè‡ªåŠ¨å‘ç°ï¼š\n@Configuration @ImportHttpServices(group = \u0026#34;api\u0026#34;, basePackages = \u0026#34;com.example.client\u0026#34;) public class HttpClientConfig { }\rå¤šç»„é…ç½®ç¤ºä¾‹ï¼š\nå¦‚æœåº”ç”¨éœ€è¦é›†æˆå¤šä¸ª REST APIï¼Œå¯ä»¥ä¸ºæ¯ä¸ª API é…ç½®ä¸åŒçš„ç»„ï¼š\n@Configuration @ImportHttpServices(group = \u0026#34;github\u0026#34;, basePackages = \u0026#34;com.example.client.github\u0026#34;) @ImportHttpServices(group = \u0026#34;stackoverflow\u0026#34;, basePackages = \u0026#34;com.example.client.stackoverflow\u0026#34;) public class HttpClientConfig { }\rå¯¹åº”çš„é…ç½®ï¼š\nspring: http: client: service: group: github: base-url: https://api.github.com read-timeout: 5s stackoverflow: base-url: https://api.stackexchange.com read-timeout: 10s\rä½¿ç”¨ WebClientï¼ˆå“åº”å¼ï¼‰ï¼š\né»˜è®¤ä½¿ç”¨ RestClientï¼Œå¦‚éœ€ä½¿ç”¨ WebClientï¼Œå¯é€šè¿‡é…ç½®åˆ‡æ¢ï¼š\n@Configuration @ImportHttpServices( group = \u0026#34;api\u0026#34;, basePackages = \u0026#34;com.example.client\u0026#34;, clientType = ClientType.WEB_CLIENT ) public class HttpClientConfig { }\rä¼˜åŠ¿ï¼š\né…ç½®ç®€åŒ–ï¼šä¸å†éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æ‰‹åŠ¨åˆ›å»º HttpServiceProxyFactory å’Œ Bean è‡ªåŠ¨æ³¨å†Œï¼šæ‰€æœ‰ HTTP æ¥å£è‡ªåŠ¨æ³¨å†Œä¸º Spring Beanï¼Œå¯ç›´æ¥æ³¨å…¥ä½¿ç”¨ ç»Ÿä¸€ç®¡ç†ï¼šé€šè¿‡ç»„ï¼ˆgroupï¼‰æ¦‚å¿µç»Ÿä¸€ç®¡ç†åŒä¸€ API çš„æ‰€æœ‰å®¢æˆ·ç«¯ çµæ´»é…ç½®ï¼šæ”¯æŒä¸ºä¸åŒç»„é…ç½®ä¸åŒçš„è¶…æ—¶ã€é‡è¯•ç­‰ç­–ç•¥ è¿™æ · com.example.client åŒ…ä¸‹æ‰€æœ‰å¸¦ @HttpExchange çš„æ¥å£éƒ½ä¼šè‡ªåŠ¨æ³¨å†Œä¸º Spring Beanï¼Œå¯ä»¥ç›´æ¥æ³¨å…¥ä½¿ç”¨ï¼š\n@Service public class UserService { private final UserClient userClient; // ç›´æ¥æ³¨å…¥ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® public UserService(UserClient userClient) { this.userClient = userClient; } public User getUser(String id) { return userClient.getUser(id); // ç›´æ¥ä½¿ç”¨ } }\rå†…ç½®å¼¹æ€§åŠŸèƒ½ï¼ˆResilienceï¼‰ Spring Framework 7 å¼•å…¥äº†å¼ºå¤§çš„å¼¹æ€§å·¥å…·ï¼Œç›´æ¥é›†æˆåˆ°æ ¸å¿ƒæ¡†æ¶ä¸­ï¼š\n@Retryableï¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„æ–¹æ³•è°ƒç”¨ï¼Œæ”¯æŒé…ç½®æœ€å¤§å°è¯•æ¬¡æ•°ã€å»¶è¿Ÿã€æŠ–åŠ¨å’Œé€€é¿ç­–ç•¥ï¼Œä¹Ÿæ”¯æŒå“åº”å¼è¿”å›ç±»å‹ @ConcurrencyLimitï¼šé™åˆ¶å¹¶å‘æ–¹æ³•è°ƒç”¨æ•°é‡ï¼Œä¿æŠ¤æœåŠ¡å’Œèµ„æºï¼ˆä¾‹å¦‚é™åˆ¶ä¸ºå•çº¿ç¨‹è®¿é—®ï¼‰ é…ç½®æ–¹å¼ï¼š\n@Configuration @EnableResilientMethods public class ApplicationConfig { } @Service public class PaymentService { @Retryable( maxAttempts = 3, backoff = @Retryable.Backoff(delay = 2000, multiplier = 2.0) ) @ConcurrencyLimit(value = 2) // åªå…è®¸ 2 ä¸ªå¹¶å‘è°ƒç”¨ public void processPayment(String paymentId) { // å¤„ç†æ”¯ä»˜é€»è¾‘ } }\rä¼˜åŠ¿ï¼š\næ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Resilience4jï¼‰ ä¸ Spring ç”Ÿæ€æ·±åº¦é›†æˆ æ”¯æŒå“åº”å¼ç¼–ç¨‹æ¨¡å‹ é…ç½®ç®€å•ï¼Œå¼€ç®±å³ç”¨ æµå¼ JMS å®¢æˆ·ç«¯ APIï¼ˆJmsClientï¼‰ Spring Framework 7 å¼•å…¥äº† JmsClientï¼Œç±»ä¼¼äº JdbcClient å’Œ RestClientï¼Œæä¾›æµç•…çš„æ„å»ºå™¨é£æ ¼ APIã€‚è¿™æ˜¯å¯¹ä¼ ç»Ÿ JMS æ¨¡æ¿çš„æ›´ä¼˜é›…å’Œå¯è¯»çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nä½¿ç”¨ç¤ºä¾‹ï¼š\n@Service public class MessageService { private final JmsClient jmsClient; public MessageService(JmsClient jmsClient) { this.jmsClient = jmsClient; } public void sendMessage(String destination, String message) { jmsClient.create() .queue(destination) .body(message) .send(); } public String receiveMessage(String destination) { return jmsClient.create() .queue(destination) .receive(String.class); } }\rä¼˜åŠ¿ï¼š\næµç•…çš„ API è®¾è®¡ï¼Œä»£ç æ›´æ˜“è¯» ä¸ JdbcClientã€RestClient ä¿æŒä¸€è‡´çš„é£æ ¼ Spring Boot 4 æä¾›è‡ªåŠ¨é…ç½®æ”¯æŒ ç»Ÿä¸€æ¶ˆæ¯è½¬æ¢ï¼ˆUnified Message Conversionï¼‰ Spring Framework 7 ç®€åŒ–äº†æ¶ˆæ¯è½¬æ¢ï¼Œå¼•å…¥äº†æ–°çš„ HttpMessageConverters é…ç½®ç±»ã€‚è¿™ç§ç»Ÿä¸€æ–¹æ³•å€Ÿé‰´äº†å“åº”å¼ç¼–è§£ç å™¨çš„è®¾è®¡ï¼Œç®€åŒ–äº† HTTP æ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚\nJakarta EE 11 å‡çº§ Spring Framework 7 é‡‡ç”¨ Jakarta EE 11 è§„èŒƒï¼š\nServlet 6.1 JPA 3.2 Bean Validation 3.1 WebSocket 2.2 JPA 3.2 é‡è¦å˜åŒ–ï¼š\nä¹‹å‰ï¼ŒEntityManager åªèƒ½é€šè¿‡ @PersistenceContext æ³¨è§£æ³¨å…¥ã€‚ç°åœ¨ï¼ŒEntityManagerFactory å’Œå…±äº«çš„ EntityManager éƒ½å¯ä»¥ä½¿ç”¨ @Inject æˆ– @Autowired æ³¨å…¥ï¼Œå¹¶æ”¯æŒä½¿ç”¨é™å®šç¬¦æ¥é€‰æ‹©ç‰¹å®šçš„æŒä¹…åŒ–å•å…ƒï¼ˆå½“é…ç½®äº†å¤šä¸ªæŒä¹…åŒ–å•å…ƒæ—¶ï¼‰ã€‚\n// æ—§æ–¹å¼ï¼ˆä»ç„¶æ”¯æŒï¼‰ @PersistenceContext private EntityManager entityManager; // æ–°æ–¹å¼ï¼ˆSpring Framework 7 / JPA 3.2ï¼‰ @Autowired private EntityManager entityManager; // å¤šä¸ªæŒä¹…åŒ–å•å…ƒæ—¶ä½¿ç”¨é™å®šç¬¦ @Autowired @Qualifier(\u0026#34;primaryEntityManager\u0026#34;) private EntityManager primaryEntityManager;\rè¿™é‡Œè¦æé†’ä¸€ä¸‹ï¼šjavax.* åˆ° jakarta.* çš„è¿ç§»åº”è¯¥åœ¨ Spring Boot 3.0 çš„æ—¶å€™å°±å·²ç»å®Œæˆäº†ã€‚å¦‚æœä½ è¿˜åœ¨ç”¨ Spring Boot 2.xï¼Œé‚£å¾—å…ˆå‡çº§åˆ° 3.xï¼Œç„¶åå†è€ƒè™‘ 4.0ã€‚\nJUnit 4 å’Œ Jackson 2.x å¼ƒç”¨ JUnit 4ï¼šå®˜æ–¹æ¨èè¿ç§»åˆ° JUnit 5 Jackson 2.xï¼šSpring Boot 4 ä½¿ç”¨ Jackson 3.x Jackson 3.x çš„ç ´åæ€§å˜æ›´ï¼š\néƒ¨åˆ†æ³¨è§£è¢«ç§»é™¤ æ›´ä¸¥æ ¼çš„ç±»å‹å¤„ç† æ¨¡å—æ•´åˆ ObjectMapper è¡Œä¸ºå˜æ›´ è¿ç§»ç¤ºä¾‹ï¼š\n// Jackson 2.x @JsonInclude(JsonInclude.Include.NON_NULL) public class User { private String name; // ... } // Jackson 3.x ï¼ˆåŒæ ·çš„è¯­æ³•ï¼Œä½†å†…éƒ¨è¡Œä¸ºå¯èƒ½ä¸åŒï¼‰ @JsonInclude(JsonInclude.Include.NON_NULL) public class User { private String name; // ... }\ræµ‹è¯•ä¸Šä¸‹æ–‡æš‚åœæœºåˆ¶ Spring Framework 7 å¼•å…¥äº†ä¸€ä¸ªæŒºæœ‰æ„æ€çš„æµ‹è¯•ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶ï¼š\næµ‹è¯•ä¸Šä¸‹æ–‡åœ¨ä¸ä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æš‚åœï¼ˆstoppedï¼‰ ä¸‹æ¬¡ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨é‡å¯ è¿™æ ·èƒ½æ˜¾è‘—é™ä½æµ‹è¯•å¥—ä»¶çš„å†…å­˜å ç”¨ è¯¥æœºåˆ¶å¯æ˜¾è‘—é™ä½æµ‹è¯•å¥—ä»¶çš„å†…å­˜å ç”¨ã€‚\nSpEL å¢å¼º æ”¯æŒ Optional ç±»å‹å’Œ Elvis æ“ä½œç¬¦ï¼š\n@Value(\u0026#34;#{userService.findUser(\u0026#39;123\u0026#39;)?.name ?: \u0026#39;Unknown\u0026#39;}\u0026#34;) private String userName;\rç¨‹åºåŒ– Bean æ³¨å†Œï¼ˆBeanRegistrarï¼‰ Spring Framework 7 å¼•å…¥äº† BeanRegistrar æ¥å£ï¼Œå…è®¸åœ¨ @ConditionalOn... æ³¨è§£æ—ä¸å¤Ÿç”¨æ—¶è¿›è¡ŒåŠ¨æ€ Bean æ³¨å†Œã€‚\nJava å®ç°ï¼š\nimport org.springframework.context.bean.BeanRegistrar; import org.springframework.context.bean.BeanRegistry; public class QuoteProviderRegistrar implements BeanRegistrar { @Override public void register(BeanRegistry registry, Environment env) { registry.registerBean(\u0026#34;quoteProviderDb\u0026#34;, QuoteProviderDb.class); registry.registerBean(\u0026#34;quoteProviderFallback\u0026#34;, QuoteProviderFallback.class, spec -\u0026gt; { spec.fallback(); spec.order(1); }); } }\rKotlin DSL å®ç°ï¼ˆæ›´ä¼˜é›…ï¼‰ï¼š\nKotlin 2.2 æä¾›äº† BeanRegistrarDslï¼Œè®© Bean æ³¨å†Œæ›´åŠ ç®€æ´ï¼š\nimport org.springframework.context.bean.BeanRegistrarDsl class QuoteProviderRegistrar : BeanRegistrarDsl({ registerBean\u0026lt;QuoteProviderDb\u0026gt;(\u0026#34;quoteProviderDb\u0026#34;) registerBean\u0026lt;QuoteProviderFallback\u0026gt;( name = \u0026#34;quoteProviderFallback\u0026#34;, fallback = true, order = 1 ) })\rä½¿ç”¨åœºæ™¯ï¼š\næ ¹æ®ç¯å¢ƒå˜é‡æˆ–é…ç½®åŠ¨æ€æ³¨å†Œ Bean å®ç°å¤æ‚çš„æ¡ä»¶é€»è¾‘ï¼Œè¶…å‡º @ConditionalOn... æ³¨è§£çš„èƒ½åŠ›èŒƒå›´ éœ€è¦æ ¹æ®è¿è¡Œæ—¶ä¿¡æ¯å†³å®šæ³¨å†Œå“ªäº› Bean Tomcat 11 æ ¸å¿ƒå˜æ›´ Tomcat 11 æ˜¯ Apache Tomcat é¡¹ç›®ç¬¬ä¹ä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œæ ‡å¿—ç€ä»ä¼ ç»Ÿ Java EE å‘ç°ä»£ Jakarta EE æ¡†æ¶çš„é‡è¦è½¬å˜ã€‚æœ¬æ¬¡å‡çº§æ”¯æŒ Jakarta EE 11ï¼Œå®ç°äº†ï¼š\nServlet 6.1 - æ”¹è¿›å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Œæå‡é•¿è¿è¡Œä»»åŠ¡çš„æ€§èƒ½ JSP 4.0 EL 6.0 WebSocket 2.2 - æ€§èƒ½å’Œå¯æ‰©å±•æ€§æ˜¾è‘—æå‡ï¼Œç‰¹åˆ«é€‚åˆå®æ—¶åŒå‘é€šä¿¡åœºæ™¯ï¼ˆå¦‚èŠå¤©åº”ç”¨ã€åä½œå·¥å…·ï¼‰ Authentication 3.1 è™šæ‹Ÿçº¿ç¨‹æ”¯æŒï¼ˆJava 21+ï¼‰ é‡è¦ç‰¹æ€§ï¼š Tomcat 11 åŸç”Ÿæ”¯æŒ Java 21 çš„ Project Loom è™šæ‹Ÿçº¿ç¨‹ï¼Œè¿™æ˜¯æœ¬æ¬¡å‡çº§çš„æ ¸å¿ƒäº®ç‚¹ä¹‹ä¸€ã€‚\næ€§èƒ½æ•°æ®ï¼ˆåŸºäºå®é™…æµ‹è¯•ï¼‰ï¼š\næ ¹æ® Fast Thread å’Œ Java Code Geeks çš„æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼š\nåœºæ™¯ å¹³å°çº¿ç¨‹ è™šæ‹Ÿçº¿ç¨‹ æ€§èƒ½æå‡ I/O å¯†é›†å‹åº”ç”¨ï¼ˆæ•°æ®åº“æŸ¥è¯¢ã€HTTP è°ƒç”¨ï¼‰ åŸºå‡† 2-3x ååé‡ +100-200% é«˜å¹¶å‘ Web è¯·æ±‚ï¼ˆ1000+ å¹¶å‘ï¼‰ åŸºå‡† 2-3x ååé‡ +100-200% CPU å¯†é›†å‹åº”ç”¨ åŸºå‡† æ— æ˜æ˜¾æå‡ 0% å†…å­˜å ç”¨ åŸºå‡† -30-50%ï¼ˆçº¿ç¨‹æ ˆï¼‰ -30-50% å“åº”æ—¶é—´ï¼ˆP99ï¼‰ åŸºå‡† -20-40% -20-40% é€‚ç”¨åœºæ™¯ï¼š\nâœ… æ¨èä½¿ç”¨ï¼šREST APIã€æ•°æ®åº“æŸ¥è¯¢ã€HTTP å®¢æˆ·ç«¯è°ƒç”¨ã€æ–‡ä»¶ I/Oã€æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹ âŒ ä¸æ¨èä½¿ç”¨ï¼šCPU å¯†é›†å‹è®¡ç®—ã€å›¾åƒå¤„ç†ã€åŠ å¯†è§£å¯†ã€å¤æ‚ç®—æ³• å®é™…æ¡ˆä¾‹ï¼š\nä¸€ä¸ªå…¸å‹çš„ Spring Boot Web åº”ç”¨ï¼ˆå¤„ç† REST è¯·æ±‚ï¼Œè°ƒç”¨æ•°æ®åº“å’Œå¤–éƒ¨ APIï¼‰ï¼š\nä½¿ç”¨å¹³å°çº¿ç¨‹ï¼š1000 å¹¶å‘è¯·æ±‚ï¼Œååé‡çº¦ 500 req/sï¼ŒP99 å»¶è¿Ÿ 200ms ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼š1000 å¹¶å‘è¯·æ±‚ï¼Œååé‡çº¦ 1200-1500 req/sï¼ŒP99 å»¶è¿Ÿ 120ms æ€§èƒ½æå‡ï¼šååé‡æå‡ 2-3 å€ï¼Œå»¶è¿Ÿé™ä½ 40% ä¼˜åŠ¿ï¼š\nè½»é‡çº§å¹¶å‘æ¨¡å‹ï¼Œç®€åŒ–çº¿ç¨‹ç®¡ç† ç›¸æ¯”ä¼ ç»Ÿçº¿ç¨‹æ¨¡å‹ï¼Œæä¾›æ›´å¥½çš„å¯æ‰©å±•æ€§ ç‰¹åˆ«é€‚åˆ I/O å¯†é›†å‹åº”ç”¨ï¼Œå¯ä»¥å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ é…ç½®æ–¹å¼ï¼š\nåœ¨ Spring Boot 4 ä¸­ï¼Œè™šæ‹Ÿçº¿ç¨‹æ”¯æŒé€šè¿‡é…ç½®å±æ€§å¯ç”¨ï¼š\nspring: threads: virtual: enabled: true\ré€‚ç”¨åœºæ™¯ï¼š\nWeb è¯·æ±‚å¤„ç† WebSocket è¿æ¥ç®¡ç† é«˜å¹¶å‘ I/O æ“ä½œ WebSocket 2.2 æ€§èƒ½æå‡ é‡è¦å˜åŒ–ï¼š Tomcat 11 å‡çº§åˆ° Jakarta WebSocket 2.2ï¼Œå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§æå‡ã€‚\nä¸»è¦æ”¹è¿›ï¼š\næ›´é«˜æ•ˆçš„å®æ—¶åŒå‘é€šä¿¡å¤„ç† æ”¹è¿›çš„æµå¼æ•°æ®ä¼ è¾“èƒ½åŠ› æ›´å¥½çš„å¹¶å‘è¿æ¥ç®¡ç† ç‰¹åˆ«é€‚åˆéœ€è¦å®æ—¶æ›´æ–°çš„åº”ç”¨ï¼ˆå¦‚èŠå¤©ã€åä½œå·¥å…·ã€å®æ—¶æ•°æ®æµï¼‰ ä¸ HTTP/2 å’Œå¼‚æ­¥å¤„ç†çš„ååŒï¼š\nTomcat 11 çš„ WebSocket æ”¹è¿›ä¸ HTTP/2 æ”¯æŒå’Œå¼‚æ­¥å¤„ç†èƒ½åŠ›ååŒå·¥ä½œï¼Œç¡®ä¿æ›´å“åº”å¼å’Œå¯æ‰©å±•çš„ Web åº”ç”¨ã€‚\nServlet 6.1 å¼‚æ­¥å¤„ç†æ”¹è¿› é‡è¦å˜åŒ–ï¼š Jakarta Servlet 6.1 æ”¹è¿›äº† Web åº”ç”¨å¤„ç† HTTP è¯·æ±‚çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å¼‚æ­¥è¯·æ±‚å¤„ç†ã€‚\nä¸»è¦æ”¹è¿›ï¼š\næ›´é«˜æ•ˆçš„å¼‚æ­¥è¯·æ±‚å¤„ç†æœºåˆ¶ æå‡é•¿è¿è¡Œä»»åŠ¡çš„æ€§èƒ½ æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ å®‰å…¨å¢å¼º é‡è¦å˜åŒ–ï¼š Tomcat 11 å¼•å…¥äº†å¤šé¡¹å®‰å…¨å¢å¼ºã€‚\nä¸»è¦æ”¹è¿›ï¼š\næ›´å¥½çš„ TLS/SSL é»˜è®¤é…ç½® - ä½¿ç®¡ç†å‘˜æ›´å®¹æ˜“å»ºç«‹å®‰å…¨çš„ HTTPS è¿æ¥ï¼Œå¼€ç®±å³ç”¨ æ”¹è¿›çš„å®‰å…¨å®è·µå’Œé»˜è®¤è®¾ç½® æœ€ä½ Java ç‰ˆæœ¬è¦æ±‚ Tomcat 11 è¦æ±‚è‡³å°‘ Java SE 17ï¼Œè¿™ä¸ªå’Œ Spring Boot 4 çš„è¦æ±‚ä¸€è‡´ã€‚\nå½±å“ï¼š\nç¡®ä¿ Tomcat èƒ½å¤Ÿåˆ©ç”¨æœ€æ–°çš„ Java è¯­è¨€ç‰¹æ€§å’Œæ€§èƒ½æ”¹è¿› åŒ…æ‹¬å¢å¼ºçš„å†…å­˜ç®¡ç†ã€Recordsã€æ›´é«˜æ•ˆçš„ switch è¡¨è¾¾å¼ç­‰ éœ€è¦ä»æ—§ç‰ˆæœ¬ Java å‡çº§çš„åº”ç”¨éœ€è¦ç‰¹åˆ«æ³¨æ„ OpenSSL æ”¯æŒï¼ˆJava 22+ï¼‰ å¦‚æœä½ ç”¨çš„æ˜¯ Java 22+ï¼ŒTomcat 11 æ”¯æŒé€šè¿‡ FFMï¼ˆForeign Function \u0026amp; Memory APIï¼‰ä½¿ç”¨ OpenSSLï¼Œæ€§èƒ½ä¼šæ›´å¥½ã€‚\njavax. åˆ° jakarta. å‘½åç©ºé—´è¿ç§» é‡è¦æé†’ï¼š è¿ç§»åˆ° Tomcat 11 çš„ä¸€ä¸ªæŒ‘æˆ˜æ€§æ–¹é¢æ˜¯éœ€è¦é‡æ„åº”ç”¨ä»¥é€‚åº”ä» javax.* åˆ° jakarta.* å‘½åç©ºé—´çš„åˆ‡æ¢ã€‚\nå½±å“ï¼š\nè¿™æ˜¯ä»æ—©æœŸ Tomcat ç‰ˆæœ¬è¿ç§»çš„åŸºç¡€æ€§å˜æ›´ ç‰¹åˆ«æ˜¯ä½¿ç”¨ Java EE çš„åº”ç”¨éœ€è¦ç‰¹åˆ«æ³¨æ„ Tomcat 11 æä¾›äº† è¿ç§»å·¥å…· æ¥æ”¯æŒè¿™ä¸€è½¬æ¢ éœ€è¦ä»”ç»†æµ‹è¯•ä»¥ç¡®ä¿åº”ç”¨åœ¨æ–°å‘½åç©ºé—´ä¸‹ç»§ç»­æ­£å¸¸å·¥ä½œ æ³¨æ„ï¼š å¦‚æœä½ è¿˜åœ¨ä½¿ç”¨ Spring Boot 2.xï¼Œéœ€è¦å…ˆå‡çº§åˆ° Spring Boot 3.xï¼ˆå·²å®Œæˆ javax.* åˆ° jakarta.* è¿ç§»ï¼‰ï¼Œç„¶åå†è€ƒè™‘å‡çº§åˆ° Spring Boot 4.0ã€‚\nHTTP Header å¤§å°å†™å¤„ç†å˜åŒ– Tomcat 11 ä½¿ç”¨ header name çš„åŸå§‹å¤§å°å†™æ¥å­˜å‚¨ HTTP/1.1 request headersï¼Œè€Œä¸æ˜¯å¼ºåˆ¶å°†å…¶è½¬æ¢ä¸ºå°å†™ã€‚ä»¥å‰ Tomcat ä¼šè‡ªåŠ¨è½¬å°å†™ï¼Œç°åœ¨ä¸ä¼šäº†ã€‚\nä¸»è¦å½±å“ï¼š\nå– Header æ—¶ä¸€å®šè¦å…³æ³¨å¤§å°å†™ å»ºè®®æŒ‰ç…§ RFC 7230 å»ºè®®ï¼Œå…¨é“¾è·¯éƒ½ç»Ÿä¸€ä½¿ç”¨å°å†™ å¦‚æœä»£ç ä¸­ç›´æ¥æ¯”è¾ƒ header åç§°å­—ç¬¦ä¸²ï¼Œå¯èƒ½å› ä¸ºå¤§å°å†™ä¸åŒ¹é…è€Œå¤±è´¥ Spring Framework 7.0 çš„ HttpHeaders API ä¹Ÿæœ‰ç›¸åº”å˜åŒ– åºŸå¼ƒåŠŸèƒ½ä¸ç ´åæ€§å˜æ›´ ç§»é™¤çš„åºŸå¼ƒ API Spring Boot 4.0 è¿™æ¬¡ç§»é™¤äº† 36 ä¸ªåºŸå¼ƒç±»ï¼Œå¤§æ¦‚å äº†æ‰€æœ‰åºŸå¼ƒ API çš„ 88%ã€‚è¿ç§»çš„æ—¶å€™è¿™äº›åœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š\nMockBean å’Œ SpyBean ç§»é™¤ å½±å“ï¼š æµ‹è¯•ä»£ç ä¸­å¹¿æ³›ä½¿ç”¨ã€‚æ—§å†™æ³•ï¼š\n// Spring Boot 3.x ï¼ˆå·²åºŸå¼ƒï¼Œ4.0 ç§»é™¤ï¼‰ @SpringBootTest class UserServiceTest { @MockBean private UserRepository userRepository; }\ræ–°å†™æ³•ï¼š\n// Spring Boot 4.0 ï¼ˆä½¿ç”¨ Spring å®˜æ–¹æ”¯æŒï¼‰ @SpringBootTest class UserServiceTest { @MockitoBean private UserRepository userRepository; }\rMockitoTestExecutionListener ç§»é™¤ Spring Boot 4.0 ç§»é™¤äº†è¯¥ç›‘å¬å™¨ï¼Œä½¿ç”¨ Spring çš„åŸç”Ÿ Mockito æ”¯æŒã€‚\nWebSecurityConfigurerAdapter ç§»é™¤ è¯¥æ”¹åŠ¨åœ¨ Spring Boot 3.x æ—¶å·²åºŸå¼ƒï¼Œ4.0 æ­£å¼ç§»é™¤ã€‚\næ—§å†™æ³•ï¼š\n// Spring Boot 2.x/3.x ï¼ˆå·²åºŸå¼ƒï¼‰ @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/public/**\u0026#34;).permitAll() .anyRequest().authenticated(); } }\réœ€è¦æ”¹æˆæ–°çš„æ–¹å¼ï¼š\n// Spring Boot 4.0 @Configuration @EnableWebSecurity public class SecurityConfig { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { return http .authorizeHttpRequests(auth -\u0026gt; auth .requestMatchers(\u0026#34;/public/**\u0026#34;).permitAll() .anyRequest().authenticated() ) .build(); } }\rè¯¥æ”¹åŠ¨åœ¨ Spring Boot 3.x æ—¶å·²åºŸå¼ƒï¼Œ4.0 æ­£å¼ç§»é™¤ã€‚\nUndertow æ”¯æŒç§»é™¤ Undertow ç›®å‰ä¸å…¼å®¹ Servlet 6.1ï¼ŒSpring Boot 4.0 ç§»é™¤äº†å¯¹å®ƒçš„æ”¯æŒï¼š\n\u0026lt;!-- Spring Boot 4.0 ä¸å†æ”¯æŒ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-undertow\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt;\ræ›¿ä»£æ–¹æ¡ˆï¼š\nåˆ‡æ¢åˆ° Tomcat 11ï¼ˆæ¨èï¼‰ ä½¿ç”¨ Jetty 12.1+ ç­‰å¾… Undertow æ”¯æŒ Servlet 6.1 Spring Batch é»˜è®¤è¡Œä¸ºå˜æ›´ Spring Batch ç°åœ¨é»˜è®¤åœ¨å†…å­˜ä¸­å­˜å‚¨å…ƒæ•°æ®ï¼Œä¸å†ä½¿ç”¨æ•°æ®åº“ã€‚è¿™å¯èƒ½å¯¼è‡´ Job æ‰§è¡Œå†å²ä¸¢å¤±ï¼š\n\u0026lt;!-- å¦‚æœéœ€è¦æŒä¹…åŒ–å…ƒæ•°æ®ï¼Œæ˜¾å¼æ·»åŠ  JDBC æ”¯æŒ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-batch-jdbc\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt;\rReactive Pulsar æ”¯æŒç§»é™¤ Spring Pulsar ç§»é™¤äº† Reactor æ”¯æŒï¼Œæ‰€ä»¥ Spring Boot 4.0 ä¹Ÿç›¸åº”ç§»é™¤äº†å“åº”å¼ Pulsar å®¢æˆ·ç«¯çš„è‡ªåŠ¨é…ç½®ã€‚\nEmbedded Executable Uber Jar Launch Scripts ç§»é™¤ Spring Boot 4.0 ç§»é™¤äº†ç”¨äºåˆ›å»º\u0026quot;å®Œå…¨å¯æ‰§è¡Œ\u0026quot; jar æ–‡ä»¶çš„åµŒå…¥å¼å¯åŠ¨è„šæœ¬æ”¯æŒã€‚è¯¥åŠŸèƒ½ä»…é€‚ç”¨äºç±» Unix ç³»ç»Ÿï¼Œä¸”ä¸ é«˜æ•ˆéƒ¨ç½²å»ºè®® å†²çªã€‚\nå¦‚æœéœ€è¦ç±»ä¼¼åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ Gradle çš„ application plugin ç­‰æ›¿ä»£æ–¹æ¡ˆã€‚ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ Spring Boot çš„æ„å»ºæ’ä»¶åˆ›å»º uber jarï¼Œå¹¶é€šè¿‡ java -jar è¿è¡Œã€‚\nSpring Session Hazelcast/MongoDB ç§»é™¤ Spring Session Hazelcast å’Œ Spring Session MongoDB ç°åœ¨åˆ†åˆ«ç”± Hazelcast å›¢é˜Ÿå’Œ MongoDB å›¢é˜Ÿç»´æŠ¤ï¼ŒSpring Boot 4.0 ç§»é™¤äº†å¯¹å®ƒä»¬çš„ç›´æ¥æ”¯æŒã€‚å¦‚éœ€ä½¿ç”¨ï¼Œè¯·ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ starterã€‚\nå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ HTTP Header å¤§å°å†™é—®é¢˜ é—®é¢˜ï¼šHeader è®¿é—®å¤±è´¥æˆ–è¡Œä¸ºä¸ä¸€è‡´\nå‡çº§åˆ° Tomcat 11.0.12+ å’Œ Spring Framework 7.0 åï¼ŒæŸäº› header è®¿é—®å¯èƒ½å‡ºç°é—®é¢˜ã€‚è¿™æ˜¯ Spring Boot 4 è¿ç§»ä¸­å¿…é¡»å…³æ³¨çš„å‘ã€‚\nåŸå› ï¼š\nTomcat 11.0.12+ï¼šHTTP è¯·æ±‚å¤´åç§°ä¼šä¿ç•™åŸå§‹å¤§å°å†™ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶è½¬æ¢ä¸ºå°å†™ï¼ˆä»¥å‰ Tomcat ä¼šè‡ªåŠ¨è½¬å°å†™ï¼Œç°åœ¨ä¸ä¼šäº†ï¼‰ Spring Framework 7.0ï¼šHttpHeaders API ä¸å†ç»§æ‰¿ MultiValueMap Header åç§°å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æŸäº›ä»£ç å¯èƒ½ä¾èµ–ç‰¹å®šçš„å¤§å°å†™æ ¼å¼æˆ–ç›´æ¥æ¯”è¾ƒ header åç§° å»ºè®®ï¼š æŒ‰ç…§ RFC 7230 å»ºè®®ï¼Œå…¨é“¾è·¯éƒ½ç»Ÿä¸€ä½¿ç”¨å°å†™ header åç§°ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\næ›´æ–° HttpHeaders çš„ä½¿ç”¨æ–¹å¼ï¼š // æ—§ä»£ç ï¼ˆSpring Framework 6.xï¼‰ HttpHeaders headers = new HttpHeaders(); headers.add(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;); String contentType = headers.getFirst(\u0026#34;Content-Type\u0026#34;); // æ–°ä»£ç ï¼ˆSpring Framework 7.0ï¼‰ HttpHeaders headers = new HttpHeaders(); headers.add(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;); String contentType = headers.getFirst(\u0026#34;Content-Type\u0026#34;); // ä»ç„¶å¯ç”¨ // æˆ–ä½¿ç”¨ boolean hasContentType = headers.contains(\u0026#34;Content-Type\u0026#34;); // å¤§å°å†™ä¸æ•æ„Ÿ\rç»Ÿä¸€ä½¿ç”¨æ ‡å‡†æ ¼å¼çš„ header åç§°ï¼š // æ¨èï¼šä½¿ç”¨æ ‡å‡†æ ¼å¼ headers.add(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;); headers.add(\u0026#34;Authorization\u0026#34;, \u0026#34;Bearer token\u0026#34;); headers.add(\u0026#34;X-Custom-Header\u0026#34;, \u0026#34;value\u0026#34;);\ræ›´æ–° header åç§°æ¯”è¾ƒçš„ä»£ç ï¼š // é—®é¢˜ä»£ç ï¼šç›´æ¥å­—ç¬¦ä¸²æ¯”è¾ƒå¯èƒ½å¤±è´¥ Enumeration\u0026lt;String\u0026gt; headerNames = request.getHeaderNames(); while (headerNames.hasMoreElements()) { String name = headerNames.nextElement(); if (name.equals(\u0026#34;content-type\u0026#34;)) { // å¯èƒ½å¤±è´¥ï¼Œname å¯èƒ½æ˜¯ \u0026#34;Content-Type\u0026#34; // ... } } // æ¨èï¼šä½¿ç”¨å¤§å°å†™ä¸æ•æ„Ÿæ¯”è¾ƒ if (name.equalsIgnoreCase(\u0026#34;content-type\u0026#34;)) { // ... }\ræ›´æ–°æµ‹è¯•ä»£ç ï¼š // MockHttpServletRequest çš„è¡Œä¸ºå·²æ›´æ–° MockHttpServletRequest request = new MockHttpServletRequest(); request.addHeader(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;); // ä»¥ä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰ assertThat(request.getHeader(\u0026#34;Content-Type\u0026#34;)).isNotNull(); assertThat(request.getHeader(\u0026#34;content-type\u0026#34;)).isNotNull(); assertThat(request.getHeader(\u0026#34;CONTENT-TYPE\u0026#34;)).isNotNull(); // ä½†éå†æ—¶éœ€è¦æ³¨æ„åŸå§‹å¤§å°å†™ Enumeration\u0026lt;String\u0026gt; names = request.getHeaderNames(); while (names.hasMoreElements()) { String name = names.nextElement(); // name å¯èƒ½æ˜¯ \u0026#34;Content-Type\u0026#34; è€Œä¸æ˜¯ \u0026#34;content-type\u0026#34; assertThat(name).isEqualTo(\u0026#34;Content-Type\u0026#34;); // ä½¿ç”¨åŸå§‹å¤§å°å†™ }\rç¼–è¯‘æ—¶ Nullability é”™è¯¯ é—®é¢˜ï¼šJSpecify æ³¨è§£å¯¼è‡´ Kotlin æˆ–ç©ºå€¼æ£€æŸ¥å·¥å…·æŠ¥é”™\nKotlin é¡¹ç›®å¯èƒ½é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š\nerror: [nullness] incompatible types in return. required: @NonNull String found: @Nullable String\rè§£å†³æ–¹æ¡ˆï¼š\n// Kotlin ä¸­å¤„ç†å¯ç©ºç±»å‹ val user: User? = userService.findUser(\u0026#34;123\u0026#34;) val name: String = user?.name ?: \u0026#34;Unknown\u0026#34;\ræˆ–è€…ä¸´æ—¶ç¦ç”¨ä¸¥æ ¼ç©ºå€¼æ£€æŸ¥ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;compilerArgs\u0026gt; \u0026lt;arg\u0026gt;-Xlint:-nullness\u0026lt;/arg\u0026gt; \u0026lt;/compilerArgs\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt;\rJackson 3.x åºåˆ—åŒ–é—®é¢˜ é—®é¢˜ï¼šJSON åºåˆ—åŒ–/ååºåˆ—åŒ–è¡Œä¸ºå˜æ›´\nJackson 3.x çš„è¡Œä¸ºå’Œ 2.x æœ‰äº›ä¸ä¸€æ ·ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›åºåˆ—åŒ–é—®é¢˜ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\n@Configuration public class JacksonConfig { @Bean public ObjectMapper objectMapper() { ObjectMapper mapper = new ObjectMapper(); // æ¢å¤ Jackson 2.x çš„å…¼å®¹æ€§è¡Œä¸º mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false); mapper.registerModule(new JavaTimeModule()); return mapper; } }\rç¬¬ä¸‰æ–¹åº“ä¸å…¼å®¹ é—®é¢˜ï¼šæŸäº›åº“ä¾èµ–æ—§ç‰ˆæœ¬çš„ Spring æˆ– Jakarta API\néƒ¨åˆ†ç¬¬ä¸‰æ–¹åº“å¯èƒ½å°šæœªé€‚é… Spring Boot 4.0ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\næ£€æŸ¥åº“çš„æœ€æ–°ç‰ˆæœ¬ ä½¿ç”¨ä¾èµ–æ’é™¤å’Œå¼ºåˆ¶ç‰ˆæœ¬ï¼š \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;legacy-library\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;*\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt;\rè€ƒè™‘æ›¿æ¢ä¸ºå…¼å®¹çš„åº“ Spring Batch å…ƒæ•°æ®ä¸¢å¤± é—®é¢˜ï¼šå‡çº§åæ‰¾ä¸åˆ° Job æ‰§è¡Œå†å²\nå‡çº§å Job æ‰§è¡Œå†å²ä¸¢å¤±ï¼ŒåŸå› æ˜¯ Spring Batch é»˜è®¤è¡Œä¸ºå˜æ›´ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-batch-jdbc\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt;\rspring: batch: jdbc: initialize-schema: always\rUndertow æ— æ³•ä½¿ç”¨ é—®é¢˜ï¼šspring-boot-starter-undertow ä¸å†å¯ç”¨\nè§£å†³æ–¹æ¡ˆï¼šåˆ‡æ¢åˆ° Tomcatï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;!-- é»˜è®¤ä½¿ç”¨ Tomcatï¼Œæ— éœ€é¢å¤–é…ç½® --\u0026gt; \u0026lt;/dependency\u0026gt;\rå¦‚æœéœ€è¦ Jettyï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-tomcat\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-jetty\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt;\rè™šæ‹Ÿçº¿ç¨‹æ€§èƒ½æœªè¾¾é¢„æœŸ é—®é¢˜ï¼šå¯ç”¨è™šæ‹Ÿçº¿ç¨‹åæ€§èƒ½æ— æ˜æ˜¾æå‡\nå¯èƒ½åŸå› ï¼š\nåº”ç”¨æ˜¯ CPU å¯†é›†å‹çš„ï¼ˆè™šæ‹Ÿçº¿ç¨‹å¯¹è¿™ç§æƒ…å†µæ²¡ç”¨ï¼‰ æ•°æ®åº“è¿æ¥æ± é…ç½®ä¸å½“ ç”¨äº†åŒæ­¥çš„é˜»å¡ä»£ç ï¼ˆæ¯”å¦‚ synchronizedï¼‰ è§£å†³æ–¹æ¡ˆï¼š\n# ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ±  spring: datasource: hikari: maximum-pool-size: 50 # è™šæ‹Ÿçº¿ç¨‹ç¯å¢ƒå¯é€‚å½“å¢åŠ  minimum-idle: 10 # ç¡®ä¿å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ spring: threads: virtual: enabled: true\rä½¿ç”¨ JFR (Java Flight Recorder) åˆ†æï¼š\njava -XX:StartFlightRecording=filename=recording.jfr -jar app.jar\ræµ‹è¯•ä¸Šä¸‹æ–‡ç¼“å­˜é—®é¢˜ é—®é¢˜ï¼šæµ‹è¯•ä¸Šä¸‹æ–‡è‡ªåŠ¨æš‚åœå¯¼è‡´æµ‹è¯•å˜æ…¢\nSpring Framework 7 çš„æµ‹è¯•ä¸Šä¸‹æ–‡æš‚åœæœºåˆ¶å¯èƒ½å¯¼è‡´æµ‹è¯•å˜æ…¢ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\nè°ƒæ•´æµ‹è¯•ä¸Šä¸‹æ–‡ç¼“å­˜é…ç½®ï¼š\n@SpringBootTest @TestPropertySource(properties = { \u0026#34;spring.test.context.cache.maxSize=10\u0026#34; }) class MyTest { // ... }\rè‡ªåŠ¨åŒ–è¿ç§»å·¥å…· OpenRewrite OpenRewrite æ˜¯å¼€æºçš„è‡ªåŠ¨åŒ–ä»£ç é‡æ„å·¥å…·ï¼Œæ”¯æŒ Spring Boot è¿ç§»ã€‚\nMaven é›†æˆï¼š\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.40.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;activeRecipes\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.java.spring.boot4.UpgradeSpringBoot_4_0\u0026lt;/recipe\u0026gt; \u0026lt;/activeRecipes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.recipe\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-spring\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.22.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt;\rGradle é›†æˆï¼š\nplugins { id \u0026#39;org.openrewrite.rewrite\u0026#39; version \u0026#39;6.25.0\u0026#39; } rewrite { activeRecipe(\u0026#39;org.openrewrite.java.spring.boot4.UpgradeSpringBoot_4_0\u0026#39;) } dependencies { rewrite \u0026#39;org.openrewrite.recipe:rewrite-spring:5.22.0\u0026#39; }\rè¿è¡Œè¿ç§»ï¼š\n# Maven: é¢„è§ˆå˜æ›´ mvn rewrite:dryRun # Maven: åº”ç”¨å˜æ›´ mvn rewrite:run # Gradle: é¢„è§ˆå˜æ›´ ./gradlew rewriteDryRun # Gradle: åº”ç”¨å˜æ›´ ./gradlew rewriteRun\rä¸»è¦åŠŸèƒ½ï¼š\nè‡ªåŠ¨å‡çº§ Spring Boot ç‰ˆæœ¬å· æ›¿æ¢åºŸå¼ƒçš„ APIï¼ˆå¦‚ @MockBean â†’ @MockitoBeanï¼‰ æ›´æ–° import è¯­å¥ ä¿®å¤ä¾èµ–å†²çª è°ƒæ•´é…ç½®æ–‡ä»¶æ ¼å¼ é‡æ„å®‰å…¨é…ç½®ï¼ˆç§»é™¤ WebSecurityConfigurerAdapterï¼‰ ç¤ºä¾‹ï¼šè¿ç§»å®‰å…¨é…ç½® OpenRewrite ä¼šè‡ªåŠ¨å°†ï¼š\n@Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests().anyRequest().authenticated(); } }\ré‡æ„ä¸ºï¼š\n@Configuration public class SecurityConfig { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { return http.authorizeHttpRequests(auth -\u0026gt; auth.anyRequest().authenticated() ).build(); } }\rSpring Boot Migrator Spring Boot Migrator æ˜¯ Spring å®˜æ–¹çš„å®éªŒæ€§å·¥å…·ï¼ŒåŸºäº OpenRewriteï¼Œä¸“é—¨ç”¨äºå°†ä¼ ç»Ÿ Spring åº”ç”¨è¿ç§»åˆ° Spring Bootï¼ŒåŒæ—¶æä¾› Spring Boot ç‰ˆæœ¬å‡çº§ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nå°†ä¼ ç»Ÿ Spring é¡¹ç›®åˆå§‹åŒ–ä¸º Spring Boot åº”ç”¨ å°† Spring XML é…ç½®è½¬æ¢ä¸º Java é…ç½® Spring Boot ç‰ˆæœ¬å‡çº§ # å®‰è£… git clone https://github.com/spring-projects-experimental/spring-boot-migrator.git cd spring-boot-migrator ./mvnw clean install # æ‰«æé¡¹ç›® java -jar applications/cli/target/spring-boot-migrator.jar scan /path/to/project # åº”ç”¨è¿ç§» java -jar applications/cli/target/spring-boot-migrator.jar migrate /path/to/project\rWindup (Red Hat) Windup æ˜¯ Red Hat æä¾›çš„ Java åº”ç”¨ç°ä»£åŒ–å’Œè¿ç§»å·¥å…·ï¼Œæ”¯æŒå¤§è§„æ¨¡ Java åº”ç”¨è¿ç§»ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nä»£ç åˆ†æå’Œè¿ç§»è¯„ä¼° æ”¯æŒå¤šç§è¿ç§»åœºæ™¯ï¼ˆJava ç‰ˆæœ¬å‡çº§ã€æ¡†æ¶è¿ç§»ã€äº‘è¿ç§»ç­‰ï¼‰ ç”Ÿæˆè¿ç§»æŠ¥å‘Šå’Œè¯„ä¼°å·¥ä½œé‡ é€‚ç”¨åœºæ™¯ï¼š\nå¤§å‹ä¼ä¸šçº§åº”ç”¨è¿ç§» å¤šé¡¹ç›®æ‰¹é‡è¿ç§» äº‘åŸç”Ÿåº”ç”¨è¿ç§» IntelliJ IDEA è¿ç§»åŠ©æ‰‹ IntelliJ IDEA 2025.3+ å†…ç½®äº† Spring Boot 4 è¿ç§»æ”¯æŒï¼š\næ‰“å¼€é¡¹ç›® å³é”®ç‚¹å‡» pom.xml æˆ– build.gradle é€‰æ‹© Refactor â†’ Migrate to Spring Boot 4.0 æŒ‰ç…§å‘å¯¼å®Œæˆè¿ç§» Eclipse Transformer ä» Spring Boot 2.x è¿ç§»æ—¶ï¼Œå¯ä½¿ç”¨ Eclipse Transformer æ‰¹é‡è½¬æ¢ javax.* åˆ° jakarta.*ï¼š\njava -jar transformer.jar /path/to/project /path/to/output\rå‚è€ƒèµ„æ–™ å®˜æ–¹æ–‡æ¡£ Spring Boot 4.0.0 Official Release Spring Boot 4.0 Release Notes - GitHub Wiki Spring Boot 4.0 Migration Guide - GitHub Wikiï¼Œå¿…è¯» Spring Framework 7.0 Release Notes Spring Framework 7.0 General Availability æŠ€æœ¯æ–‡ç«  Modularizing Spring Boot - Spring å®˜æ–¹å¯¹æ¨¡å—åŒ–æ”¹é€ çš„è¯¦ç»†è¯´æ˜ Spring Boot 4 and Spring Framework 7: Key Features and Changes - Loiane Groner çš„è¯¦ç»†è§£è¯» Spring Boot 4 \u0026amp; Spring Framework 7 â€“ What\u0026rsquo;s New | Baeldung - Baeldung æƒå¨æ•™ç¨‹ Spring Boot 4: Leaner, Safer Apps and a New Kotlin Baseline - JetBrains å®˜æ–¹å¯¹ Spring Boot 4 çš„åˆ†æ Spring Framework 7 and Spring Boot 4 Deliver API Versioning, Resilience, and Null-Safe Annotations - InfoQ æ·±åº¦æŠ¥é“ Preparing for Spring Framework 7 and Spring Boot 4 - Foojay.io å¯¹ Spring Framework 7 å’Œ Spring Boot 4 æ–°ç‰¹æ€§çš„å…¨é¢ä»‹ç» è¿ç§»ç»éªŒ Spring Boot 4 Migration Guide: Faster, Safer, at Scale - Moderne.ai çš„ä¼ä¸šçº§è¿ç§»æŒ‡å— The Spring Boot 4 Migration Hack Every Developer Needs to Know in 2025 - å®æˆ˜æŠ€å·§åˆ†äº« Migration to Spring Boot 4.0: A Performance Enhancements Guide - æ€§èƒ½ä¼˜åŒ–ç»éªŒ Migrating to Spring Boot 3+: 7 Subtle Pitfalls and How to Fix Them - å¸¸è§é—®é¢˜è§£å†³ Java 25 å®Œæ•´å‡çº§æŒ‡å—ï¼šä» Java 8 åˆ° Java 25 - Java ç‰ˆæœ¬å‡çº§å®Œæ•´æŒ‡å—ï¼ŒåŒ…å«æ–°ç‰¹æ€§ã€æ€§èƒ½ä¼˜åŒ–ã€è¿ç§»å®æˆ˜å’Œå·¥å…·æ¨è è™šæ‹Ÿçº¿ç¨‹ Virtual Threads Performance in Spring Boot - Fast Thread çš„æ€§èƒ½åŸºå‡†æµ‹è¯• Spring Boot Performance with Java Virtual Threads - Java Code Geeks çš„æ€§èƒ½åˆ†æ Working with Virtual Threads in Spring | Baeldung - Baeldung è™šæ‹Ÿçº¿ç¨‹æ•™ç¨‹ Spring Boot 4 and Virtual Threads: A Practical, High-Impact Upgrade - è™šæ‹Ÿçº¿ç¨‹å®æˆ˜ è¿ç§»å·¥å…· OpenRewrite: Migrate to Spring Boot 4.0 - OpenRewrite å®˜æ–¹æ–‡æ¡£ Spring Boot Migrator - Spring å®˜æ–¹è¿ç§»å·¥å…· Windup - Red Hat åº”ç”¨ç°ä»£åŒ–å·¥å…· EMT4J - Eclipse Java ç‰ˆæœ¬è¿ç§»å·¥å…· Moderne.ai - ä¼ä¸šçº§ OpenRewrite æ‰˜ç®¡æœåŠ¡ ","date":"2025-11-25","id":8,"permalink":"/blog/migration-spring-boot-3-to-4/","summary":"\u003cp\u003e2025 å¹´ 11 æœˆï¼ŒSpring Boot 4.0 æ­£å¼å‘å¸ƒï¼Œè¿™æ¬¡å‡çº§è¢«ä¸šç•Œç§°ä¸º\u003cstrong\u003eçˆ†ç‚¸æ€§å‡çº§\u003c/strong\u003eã€‚åŒæ—¶å¯¹äºäº‘åŸç”Ÿåº”ç”¨è€Œè¨€ï¼Œè¿™æ˜¯ä¸€æ¬¡\u003cstrong\u003eä¸å¯é”™è¿‡çš„æ€§èƒ½ä¸æ•ˆç‡è·ƒè¿\u003c/strong\u003eï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eğŸ³ \u003cstrong\u003eå®¹å™¨åŒ–å‹å¥½\u003c/strong\u003eï¼šæ¨¡å—åŒ–æ¶æ„å‡å°‘ 30-50% è¿è¡Œæ—¶å ç”¨ï¼Œé•œåƒæ›´å°ã€å¯åŠ¨æ›´å¿«\u003c/li\u003e\n\u003cli\u003eâš¡ \u003cstrong\u003eå¯åŠ¨é€Ÿåº¦æå‡ 30-50%\u003c/strong\u003eï¼šå¤šçº¿ç¨‹å¼‚æ­¥å¯åŠ¨æœºåˆ¶ï¼Œå®¹å™¨å†·å¯åŠ¨æ—¶é—´æ˜¾è‘—ç¼©çŸ­ï¼Œæ›´é€‚åˆ Kubernetes å¿«é€Ÿæ‰©ç¼©å®¹\u003c/li\u003e\n\u003cli\u003eğŸš€ \u003cstrong\u003e2-3 å€ååé‡æå‡\u003c/strong\u003eï¼šè™šæ‹Ÿçº¿ç¨‹åŸç”Ÿæ”¯æŒï¼ŒI/O å¯†é›†å‹å¾®æœåŠ¡èµ„æºåˆ©ç”¨ç‡å¤§å¹…æå‡ï¼Œå•å®ä¾‹å¯æ‰¿è½½æ›´é«˜å¹¶å‘\u003c/li\u003e\n\u003cli\u003eğŸ¯ \u003cstrong\u003eäº‘åŸç”Ÿç‰¹æ€§å¢å¼º\u003c/strong\u003eï¼šå†…ç½®å¼¹æ€§åŠŸèƒ½ï¼ˆé‡è¯•ã€é™æµï¼‰ã€HTTP æ¥å£å®¢æˆ·ç«¯è‡ªåŠ¨é…ç½®ï¼Œç®€åŒ–å¾®æœåŠ¡é—´é€šä¿¡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä½†è¿™æ¬¡å‡çº§ä¹Ÿå¸¦æ¥äº† 36 ä¸ªåºŸå¼ƒ API ç§»é™¤ã€æ¨¡å—åŒ–æ¶æ„é‡æ„ã€Tomcat 11 å˜æ›´ç­‰æŒ‘æˆ˜ã€‚æœ¬æ–‡åŸºäº Spring Boot å®˜æ–¹æ–‡æ¡£å’Œç”Ÿäº§ç¯å¢ƒè¿ç§»ç»éªŒï¼Œä»åŸç†åˆ°è¸©å‘ï¼Œæä¾›\u003cstrong\u003eå®Œæ•´ã€å®ç”¨çš„è¿ç§»æŒ‡å—\u003c/strong\u003eï¼ŒåŠ©ä½ å¹³ç¨³å®Œæˆäº‘åŸç”Ÿåº”ç”¨çš„å‡çº§ã€‚\u003c/p\u003e\n\u003ch2 id=\"spring-boot-40-æ ¸å¿ƒæ–°ç‰¹æ€§\"\u003eSpring Boot 4.0 æ ¸å¿ƒæ–°ç‰¹æ€§\u003c/h2\u003e\n\u003cp\u003eä½œä¸º Spring Boot 3.x ä¹‹åçš„é¦–ä¸ªå¤§ç‰ˆæœ¬æ›´æ–°ï¼ŒSpring Boot 4.0 åŸºäº Spring Framework 7.0ã€Jakarta EE 11 å’Œ Java 17+ï¼ˆæ¨è Java 21 æˆ– 25ï¼‰ï¼Œå¸¦æ¥äº†æ¨¡å—åŒ–æ¶æ„é‡æ„ã€è™šæ‹Ÿçº¿ç¨‹åŸç”Ÿæ”¯æŒã€HTTP æœåŠ¡å®¢æˆ·ç«¯è‡ªåŠ¨é…ç½®ç­‰é‡å¤§å˜åŒ–ã€‚\u003c/p\u003e\n\u003cp\u003eSpring Boot 4.0 é…å¥—ä½¿ç”¨ \u003cstrong\u003eSpring Cloud 2025.1.x\u003c/strong\u003eã€‚è™½ç„¶ç‰ˆæœ¬å·çœ‹èµ·æ¥åªæ˜¯ä¸­å·ç‰ˆæœ¬å˜æ›´ï¼Œä½†å®é™…ä¸Šè¿™æ˜¯ä¸€æ¬¡\u003cstrong\u003eå¤§ç‰ˆæœ¬å˜æ›´\u003c/strong\u003eï¼ŒåŒ…å«äº†å¤§é‡ç ´åæ€§å˜æ›´å’Œé‡è¦æ›´æ–°ã€‚\u003c/p\u003e\n\u003ch3 id=\"æ¨¡å—åŒ–æ¶æ„\"\u003eæ¨¡å—åŒ–æ¶æ„\u003c/h3\u003e\n\u003cp\u003eSpring Boot 4 å°† \u003ccode\u003espring-boot-autoconfigure\u003c/code\u003e æ‹†åˆ†ä¸ºå¤šä¸ªä¸“æ³¨çš„æ¨¡å—ï¼Œæ¯ä¸ªæŠ€æœ¯éƒ½æœ‰ç‹¬ç«‹çš„ starter å’Œå¯¹åº”çš„æµ‹è¯• starterã€‚\u003c/p\u003e","tags":["Spring Boot","Spring Boot 4","Spring Framework 7","Jakarta EE","Tomcat 11","Virtual Threads","è¿ç§»æŒ‡å—ï¼ŒOpenRewrite"],"title":"Spring Boot 3 åˆ° 4 è¿ç§»å®Œå…¨æŒ‡å—ï¼šæ–°ç‰¹æ€§ã€åºŸå¼ƒåŠŸèƒ½ä¸å®æˆ˜è¸©å‘ç»éªŒ"},{"content":"ä»€ä¹ˆæ˜¯ Jakarta EEï¼Œä¸ºä»€ä¹ˆè¦åˆ‡æ¢ Jakarta EE å°±æ˜¯ Java EE çš„æ–°åè¯ã€‚è¿™é‡Œçš„ EE å…¨ç§°æ˜¯ Enterprise Editionï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºä¼ä¸šçº§ Java åº”ç”¨å®šä¹‰çš„ä¸€å¥—è§„èŒƒï¼Œä¸ Java SE (Java Platform, Standard Edition) ç›¸å¯¹åº”ã€‚\nJava EE æ˜¯ä» Java 1.2 ç‰ˆæœ¬å¼€å§‹æ¨å‡ºçš„ Java ä¼ä¸šçº§å¼€å‘å¹³å°ï¼Œæœ€åˆçš„åç§°æ˜¯ J2EE (Java 2 Platform, Enterprise Edition)ã€‚éšç€ Java çš„å‘å±•ï¼Œå®ƒçš„åç§°äº Java 1.5 ç‰ˆæœ¬æ—¶æ›´æ”¹ä¸º Java EE (Java Platform, Enterprise Edition)ã€‚2009 å¹´ Oracle æ”¶è´­äº† Sunï¼ŒJava EE å¼€å§‹ç”± Oracle é€šè¿‡ JCP (Java Community Process) å¼€å‘å’Œç»´æŠ¤ã€‚\nç›´åˆ° 2017 å¹´ï¼ŒOracle å°† Java EE æäº¤ç»™äº† Eclipse åŸºé‡‘ä¼šï¼Œå¹¶å‘½åä¸º Eclipse Enterprise for Javaã€‚ç„¶è€Œï¼Œç”±äº\u0026quot;Java\u0026quot;è¿™ä¸ªåå­—çš„å•†æ ‡å½’ Oracle æ‰€æœ‰ï¼ŒEclipse åŸºé‡‘ä¼šæ— æ³•ç»§ç»­ä½¿ç”¨ javax.* å’Œ java.*ï¼Œå› æ­¤ï¼Œé¡¹ç›®åç§°æ”¹ä¸º Jakarta EEã€‚\nJakarta EE åŒ…å«äº†è®¸å¤šæŠ€æœ¯è§„èŒƒå’Œ APIï¼Œæ¶µç›–äº† Web åº”ç”¨ã€æ•°æ®åº“è®¿é—®ã€æ¶ˆæ¯ä¼ é€’ã€äº‹åŠ¡å¤„ç†ã€å®‰å…¨æ€§ç­‰æ–¹é¢çš„åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬ä½†ä¸é™äºä¸‹åˆ—è§„èŒƒï¼š\nJakarta Servletï¼šå‰èº«æ˜¯ J2EE Servletï¼Œå®šä¹‰äº†å¦‚ä½•ç®¡ç† HTTP è¯·æ±‚çš„è§„èŒƒã€‚è¿™åº”è¯¥æ˜¯å¤§éƒ¨åˆ† Java Web å¼€å‘è€…æœ€ç†Ÿæ‚‰çš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è®¸å¤šå…¶å®ƒè§„èŒƒçš„åŸºç¡€ã€‚\nJakarta Server Page (JSP)ï¼šæœåŠ¡ç«¯åŠ¨æ€ç”Ÿæˆç½‘é¡µçš„æŠ€æœ¯ï¼Œå¯ä»¥çœ‹ä½œ Java ç‰ˆæœ¬çš„ PHP å’Œ ASPã€‚\nJakarta Websocketï¼šå®šä¹‰äº†ä¸€å¥— WebSocket è¿æ¥ç›¸å…³çš„ APIï¼Œç”¨äºå®ç°å…¨åŒå·¥é€šä¿¡ã€‚\nJakarta RESTful Web Servicesï¼šå¼€å‘ç¬¦åˆ REST åŸåˆ™çš„ Web æœåŠ¡çš„ä¸€å¥—è§„èŒƒã€‚\nJakarta JSON Bindingï¼šJava ç±»å’Œ JSON å­—ç¬¦ä¸²äº’ç›¸è½¬æ¢çš„è§„èŒƒã€‚\nJakarta XML Bindingï¼šJava ç±»å’Œ XML çš„æ˜ å°„è§„èŒƒã€‚\nJakarta Enterprise Beans (EJB)ï¼šè¿™ä¸ªè§„èŒƒæ¯”è¾ƒå¤æ‚ï¼ŒåŒ…æ‹¬ EJB å®¹å™¨ï¼ŒRMIï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œå¹¶å‘æ§åˆ¶ï¼Œä¾èµ–æ³¨å…¥ç­‰ã€‚\nJakarta Persistent (JPA)ï¼šORM è§„èŒƒï¼Œå®šä¹‰äº† Java ç±»å’Œæ•°æ®åº“è¡¨ç›´æ¥çš„æ˜ å°„è§„èŒƒã€‚\nJakarta Transactions (JTA)ï¼šåŒ…å«äº†äº‹åŠ¡ç›¸å…³çš„æ¥å£å’Œæ³¨è§£ç±»ï¼Œä¹Ÿç”¨äºç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚\nJakarta Messaging (JMS)ï¼šæ¶ˆæ¯ç³»ç»Ÿçš„è§„èŒƒï¼Œç”¨äºå®ç°å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼Œæ¯”å¦‚ Apache çš„ ActiveMQ å°±å®ç°äº†è¿™å¥—è§„èŒƒã€‚\nå¯¹ç ”å‘çš„å½±å“ ä¾èµ–åŒ…åæ ‡å’Œç‰ˆæœ¬å·å˜æ›´ æ¯”å¦‚å¸¸è§çš„ servlet-apiï¼š\n\u0026lt;!-- è€ç‰ˆæœ¬ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æ–°ç‰ˆæœ¬ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;jakarta.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jakarta.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;6.1.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt;\rpackage namespace å˜æ›´ æ¯”å¦‚ï¼š\n// è€ç‰ˆæœ¬ import javax.servlet.Filter; // æ–°ç‰ˆæœ¬ import jakarta.servlet.Filter;\rå…¼å®¹æ€§é—®é¢˜ å¦‚æœä¸å…¼å®¹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæ¯”å¦‚ï¼š\nServlet è¿è¡ŒæœŸé”™è¯¯ javax.servlet.ServletRequest can not cast to jakarta.servlet.ServletRequest\ræ•°æ®åº“æ‰«æå¤±è´¥æ˜ å°„é”™è¯¯ æ¯”å¦‚ä¸‹é¢å®šä¹‰æ˜¯ javax.persistence.Tableï¼Œå¼€æºæˆ–è€…è‡ªå®šä¹‰çš„æ•°æ®åº“ä¸­é—´ä»¶ä»¶ä¸€èˆ¬ä¹ æƒ¯æŒ‰æ³¨è§£ jakarta.persistence.Table è¿›è¡Œæ‰«æï¼š\nimport javax.persistence.Id; import javax.persistence.Table; @Table(name = \u0026#34;mt_field_extra\u0026#34;) public class FieldExtra { @Id String id; }\rprivate static void scanTableName(Class\u0026lt;?\u0026gt; clazz, PersistMeta meta, boolean mapCamelCaseToUnderscore) { jakarta.persistence.Table table = clazz.getAnnotation(jakarta.persistence.Table.class); String tableName; if (null != table) { tableName = table.name(); } else { tableName = nameConvert(clazz.getSimpleName(), mapCamelCaseToUnderscore); } }\rå¦‚æœé¡¹ç›®èƒ½ç›´æ¥å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬å½“ç„¶æ›´å¥½ï¼Œä½†æ˜¯ä½œä¸ºä¸­é—´ä»¶å›¢é˜Ÿæä¾›çš„ç»„ä»¶ï¼Œå¾€å¾€éœ€è¦åœ¨è¿‡æ¸¡æœŸé—´æä¾›ä¸€ç§å…¼å®¹ä¸¤ç§æ¨¡å¼çš„æ–¹æ¡ˆï¼Œæ—¢èƒ½è®©åŸæœ‰è€æœåŠ¡æ­£å¸¸ä½¿ç”¨ï¼Œåˆå…¼å®¹ Spring Boot 3+ Jakarta EE 9+æ–°æœåŠ¡ã€‚\nJakarta EE å…¼å®¹æ˜¯ä¸€ä¸ªå¤æ‚çš„è¯¾é¢˜ï¼Œå½“å‰åªè®°å½• package namespace å·®å¼‚è§£å†³æ–¹æ³•ã€‚\nMaven æœ¬èº«ç‰¹æ€§è¯´æ˜ çˆ¶å­ POM ä¾èµ–ç»§æ‰¿ å‡è®¾çˆ¶ POM ä½¿ç”¨ dependencyManagement å®šä¹‰å¦‚ä¸‹ï¼š\n\u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;classifier\u0026gt;jakarta\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;classifier\u0026gt;jakarta-java21\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;classifier\u0026gt;jakarta-java23\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt;\rMaven å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼š\nNOTE: In two of these dependency references, we had to specify the \u0026lt;type/\u0026gt; element. This is because the minimal set of information for matching a dependency reference against a dependencyManagement section is actually {groupId, artifactId, type, classifier}. In many cases, these dependencies will refer to jar artifacts with no classifier. This allows us to shorthand the identity set to {groupId, artifactId}, since the default for the type field is jar, and the default classifier is null.\nåŸºäºä»¥ä¸Šè¯´æ˜ï¼Œå‡è®¾å­æ¨¡å—ï¼Œä¾æ¬¡æŒ‰ä»¥ä¸‹æ–¹å¼å¡«å†™ dependencyï¼Œå®é™…ç”Ÿæ•ˆçš„æ˜¯å“ªä¸ªï¼š\n\u0026lt;dependencies\u0026gt; \u0026lt;!-- æ–¹å¼ 1 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æ–¹å¼ 2 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æ–¹å¼ 3 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;classifier\u0026gt;jakarta\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æ–¹å¼ 4ï¼ŒåŒæ—¶å¼•å…¥ 2 ä¸ª --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.tester\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-support\u0026lt;/artifactId\u0026gt; \u0026lt;classifier\u0026gt;jakarta-java23\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt;\rProfile ç»§æ‰¿å’Œä¼ é€’ å‡è®¾æœ‰ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œæ¯”å¦‚ rocketmq-supportï¼Œä»–å®šä¹‰äº†ä¸€ä¸ª profile å« jakartaï¼Œç‹¬ç«‹åŠ äº† dependenciesï¼Œdeploy åˆ°ä¸­å¤®ä»“åº“ã€‚\n\u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;jakarta\u0026lt;/id\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;jakarta.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jakarta.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/profile\u0026gt;\ræœ‰å¦å¤–ä¸€ä¸ªç»„ä»¶ B ä¾èµ–äº† rocketmq-supportï¼Œå¹¶ä¸”ä¹Ÿå®šä¹‰äº†ä¸€ä¸ª jakarta profile æ¿€æ´»ã€‚é‚£ä¹ˆè¿™ä¸ªç»„ä»¶ B ä¼šè‡ªåŠ¨ä¾èµ– jakarta.servlet-api å—ï¼Ÿ\nä¸ä¼šã€‚profile ä¸ºè‡ªèº«ç¼–è¯‘æœŸæœåŠ¡ï¼Œdeploy åå¤±æ•ˆã€‚\nå¦‚æœ deploy åè¿˜èƒ½ä¾èµ–ä¼ é€’çš„è¯ï¼Œé‚£æŸäº›äººå®šä¹‰å†™ä¸€äº›æ¶æ„ä»£ç å’Œæ’ä»¶ç„¶åå®šä¹‰ä¸€å †é€šç”¨çš„ profileï¼Œæ¯”å¦‚å¤§å®¶å–œæ¬¢å« devï¼Œç„¶å deploy å°±èƒ½å˜ç›¸æŠ•æ¯’äº†ã€‚\nå¦‚æœçˆ¶ pom å®šä¹‰äº† profileï¼Œå­æ¨¡å—ç›´æ¥å¼•ç”¨ï¼Œæ˜¯ä¼šç»§æ‰¿ç”Ÿæ•ˆçš„ã€‚\nä¸»æµçš„è¾…åŠ©å·¥å…· Tomcat Migration Tool Tomcat Migration Tool æ˜¯ Apache Tomcat æä¾›çš„è¿ç§»å·¥å…·ã€‚\njava -jar jakartaee-migration-*-shaded.jar \u0026lt;source\u0026gt; \u0026lt;destination\u0026gt;\rThe source should be a path to a compressed archive, a folder or an individual file. The destination will be created at the specified path as a resource of the same type as the source.\nç”¨é€”ï¼š\nå­—èŠ‚ç è½¬æ¢ å·²æœ‰é¡¹ç›®ï¼Œç”šè‡³æ— æºç é¡¹ç›®ï¼Œç›´æ¥è½¬æ¢ã€‚åªè´Ÿè´£è½¬æ¢åˆ¶å“ï¼Œè¦æƒ³ç»™åˆ«äººç”¨éœ€è‡ªå·±æ‰‹åŠ¨ deploy ä¸€ä¸ª javax war è½¬æ¢åæ”¾åˆ° Tomcat 10ï¼Œç†è®ºä¸Šå¯è¿è¡Œ ç¼ºé™·ï¼š\nè§£å†³ä¸äº†æœ¬åœ°å¼€å‘ Debug æœŸé—´ç¼–è¯‘ã€è¿è¡Œçš„é—®é¢˜ï¼Œå¦‚æœä¸å…¼å®¹æœ¬åœ°å¯åŠ¨ã€Test å¤±è´¥ å¦å¤– Tomcat 10 æä¾›äº†ä¸€ç§è‡ªåŠ¨è½¬æ¢çš„æ–¹æ³•ï¼Œå‚è€ƒæ–‡æ¡£ï¼šhttps://tomcat.apache.org/migration-10.html å°† war æ”¾åˆ° webapps-javaee ç›®å½•ä¸‹ï¼Œå°±ä¼šè‡ªåŠ¨è½¬æ¢åæ”¾åˆ° webapp ä¸‹è¿è¡Œã€‚ç„¶è€Œè¿™ç§æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜åœ¨äºï¼š\nå¿…é¡»æ˜¯åŸºäºå¤–ç½® Tomcatï¼Œä¸æ”¯æŒ Spring Boot Jar å½¢å¼è¿è¡Œã€‚ è½¬æ¢éœ€è¦æ—¶é—´ï¼Œè¿™æ˜¯æ—¶é—´åŸºæœ¬ä¸Šéƒ½æ˜¯ 1~10 åˆ†é’Ÿä¹‹é—´ï¼Œå¯¹åº”ç”¨é‡å¯ã€å¿«é€Ÿæ‰©ç¼©å®¹éƒ½æœ‰å¾ˆå¤§çš„å‰¯ä½œç”¨ã€‚ maven-shade-plugin ç”¨é€”ï¼š\nå­—èŠ‚ç è½¬æ¢ éœ€è¦é…ç½®è¯¦ç»†çš„è½¬æ¢è§„åˆ™ ç¼ºé™·ï¼š\nè§£å†³ä¸äº†æœ¬åœ°å¼€å‘ Debug æœŸé—´ç¼–è¯‘ã€è¿è¡Œçš„é—®é¢˜ï¼Œæœ¬åœ°å¯åŠ¨ã€Test å¤±è´¥ maven-assembly-plugin ä¸Šé¢æˆ‘ä»¬éƒ½æ˜¯å‡è®¾åªæœ‰ javax å’Œ jakarta namespace å·®å¼‚ï¼Œåªéœ€è¦è½¬æ¢å­—èŠ‚ç ã€‚ä½†æ˜¯ï¼Œ\nå¦‚æœæœ‰æŸä¸ª Java æ–¹æ³•ä¸å…¼å®¹éœ€è¦é‡å†™ä¸€ä¸ªç‰ˆæœ¬æ€ä¹ˆåŠ é…ç½®æ–‡ä»¶æ¯”å¦‚ xml æœ‰å·®å¼‚æ€ä¹ˆåŠ assembly-plugin å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ includeã€exclude ä¸åŒçš„æºç ã€resourceã€ä¾èµ–é¡¹ï¼Œé‡ç»„ç¼–è¯‘å‘å¸ƒä¸åŒçš„åŒ…ã€‚\nè¿™æ˜¯é€‚åˆå¤æ‚ä¸å…¼å®¹çš„ä»£ç ï¼Œä½†æ˜¯å¯¹äºå¤šæ¨¡å—é¡¹ç›®ï¼Œéœ€è¦æŸä¸ªæ¨¡å—å¼€å‘æŒ‡å®š assembly xmlï¼Œä¼šéå¸¸ç—›è‹¦ã€‚\nç›®å‰å…¶ä»–å‡ ç§å·¥å…·åªå¤„ç† javax å’Œ jakarta package å·®å¼‚ï¼Œåç»­è‚¯å®šä¼šé‡åˆ°é™¤äº† package ä¸åŒï¼Œæ¥å£æˆ–ä½¿ç”¨æ–¹å¼ä¹Ÿä¸å…¼å®¹çš„æƒ…å†µï¼Œç­‰é‡åˆ°äº†å†å•ç‹¬å¤„ç†ã€‚\nOpenRewrite OpenRewrite è¿ç§»èœè°± Migrate to Jakarta EE 9 ã€‚\n# å‘½ä»¤è¡Œè¿è¡Œ mvn -U org.openrewrite.maven:rewrite-maven-plugin:run \\ -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:RELEASE \\ -Drewrite.activeRecipes=org.openrewrite.java.migrate.jakarta.JavaxMigrationToJakarta \\ -Drewrite.exportDatatables=false\rç”¨é€”ï¼š\næºç çº§åˆ«è½¬æ¢ï¼Œç›´æ¥è‡ªåŠ¨æ”¹ä»£ç  é™¤äº†ä»£ç ï¼Œè¿˜èƒ½è‡ªåŠ¨æ”¹å†™ pom ä¾èµ– ç¼ºé™·ï¼š\nå¤šæ¨¡å—ç›®å‰é€‚é…è¿˜ä¸å®Œå–„ï¼Œå¯¹äºå¤šæ¨¡å—ï¼Œéœ€è¦æ¯ä¸ªæ¨¡å—å¤„ç†ä¸€æ¬¡ å¤æ‚ä»£ç å¯èƒ½è½¬æ¢å¤±è´¥ï¼Œå¤±è´¥åå¯èƒ½å¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œæ— æ³•ä¸€é”®ç¼–è¯‘ï¼Œéœ€è¦äººå·¥ä»‹å…¥ æ”¹ pom æ—¶ï¼Œä»–ä¼šè‡ªå·±å¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬å·ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¸Œæœ›ç”¨çˆ¶ pom ç®¡ç†ç‰ˆæœ¬å· é€Ÿåº¦ç¨æ…¢ï¼Œéå†å¹¶ä¿®æ”¹æ–‡ä»¶æºç ï¼Œç„¶åç¼–è¯‘ transformer-maven-plugin transformer-maven-plugin æ˜¯ eclipse å‡ºçš„å­—èŠ‚ç å’Œé…ç½®æ–‡ä»¶è½¬æ¢å·¥å…·ï¼Œé»˜è®¤å†…ç½®äº†ä¸€äº› jakarta çš„æ›¿æ¢è§„åˆ™ã€‚\nå®ƒèƒ½å¸®æˆ‘ä»¬å®ç°ï¼š\nåŒæ—¶æ‰“åŒ…ï¼ˆæˆ–å‘å¸ƒï¼‰å‡º javax å’Œ jakarta ä¸¤ä¸ªåŒ…ï¼Œé€šè¿‡ classifier åŒºåˆ†ï¼Œæ¯”å¦‚è®¾ç½® javax é»˜è®¤ classifier ä¸º nullï¼Œè½¬æ¢åçš„ç‰ˆæœ¬è®¾ç½® classifier ä¸º jakartaã€‚ åªæ‰“åŒ…ï¼ˆæˆ–å‘å¸ƒï¼‰javax å’Œ jakarta ä»»æ„ä¸€ä¸ªç‰ˆæœ¬ã€‚ web.xml æˆ– web-fragment.xml ç­‰ç›¸å…³ xml å®šä¹‰è½¬æ¢ã€‚ \u0026lt;plugin\u0026gt; \u0026lt;!-- è¿™ä¸ªæ’ä»¶è‡ªåŠ¨æŠŠ javax è½¬ä¸º jakartaï¼Œæ‰“åŒ…å‡º javax å’Œ jakarta ä¸¤ä¸ªåŒ…ï¼Œé€šè¿‡ classifier åŒºåˆ† --\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.transformer\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;transformer-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;extensions\u0026gt;true\u0026lt;/extensions\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;!-- javax æ›¿æ¢æˆ jakarta --\u0026gt; \u0026lt;id\u0026gt;jakarta-jar\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;package\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;jar\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;rules\u0026gt; \u0026lt;jakartaDefaults\u0026gt;true\u0026lt;/jakartaDefaults\u0026gt; \u0026lt;/rules\u0026gt; \u0026lt;artifact\u0026gt; \u0026lt;groupId\u0026gt;${project.groupId}\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;${project.artifactId}\u0026lt;/artifactId\u0026gt; \u0026lt;/artifact\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt;\rç”¨é€”ï¼š\nå­—èŠ‚ç è½¬æ¢ æ”¯æŒ web ç›¸å…³ xml å®šä¹‰è‡ªåŠ¨æ›¿æ¢ï¼Œæ¯”å¦‚ web-fragment.xml xmlns=\u0026quot;http://xmlns.jcp.org/xml/ns/javaee\u0026quot; è½¬æ¢å’Œ deploy å¯ä»¥ä¸€æ­¥åˆ°ä½ï¼Œé€Ÿåº¦å¿«å¾ˆæ–¹ä¾¿ å¦‚æœæ˜¯å¤šæ¨¡å—ï¼Œå¯ä»¥åœ¨æ ¹çˆ¶æ¨¡å—å£°æ˜ä¸€æ¬¡ï¼Œä¸€é”®å…¨éƒ¨ç¼–è¯‘ ç¼ºé™·ï¼š\nä¸å¤„ç† pom ä¾èµ–å…³ç³»ï¼Œå‘å¸ƒå‡ºçš„ Jakarta ç‰ˆæœ¬ä¾èµ–é¡¹éƒ½éµå¾ªåŸ pom å£°æ˜ æ­¤æ’ä»¶è¿è¡Œéœ€è¦ Java 21 ç‰ˆæœ¬ï¼Œå‘å¸ƒä¸šåŠ¡åŒ…çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨ Java 21 ç¼–è¯‘ï¼Œç¼–è¯‘ç›®æ ‡ release ç‰ˆæœ¬å¯ä»¥æ˜¯ Java 8ï¼Œåœ¨ pom ä¸­å¢åŠ ä»¥ä¸‹è®¾ç½®ï¼š\n\u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;21\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.release\u0026gt;8\u0026lt;/maven.compiler.release\u0026gt; \u0026lt;/properties\u0026gt;\rweb-fragment.xml é€‚é… ä¸€èˆ¬å’±ä»¬å…¸å‹çš„ web-fragment å®šä¹‰æœ‰å¦‚ä¸‹ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ3.0 å’Œ 3.1ï¼š\n3.0 ç‰ˆæœ¬ï¼š\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-fragment xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns=\u0026#34;http://java.sun.com/xml/ns/javaee\u0026#34; xsi:schemaLocation=\u0026#34;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-fragment_3_0.xsd\u0026#34; version=\u0026#34;3.0\u0026#34; metadata-complete=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;/web-fragment\u0026gt;\r3.1 ç‰ˆæœ¬ï¼š\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-fragment xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee\u0026#34; xsi:schemaLocation=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-fragment_3_1.xsd\u0026#34; version=\u0026#34;3.1\u0026#34; metadata-complete=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;/web-fragment\u0026gt;\rå…¶ä¸­æ¶‰åŠ jakarta ä¿®æ”¹çš„æ›¿æ¢çš„æ˜¯å…¶ä¸­çš„ xmlnsã€xsiã€version å­—æ®µã€‚\nTomcat 8 ä»¥åæ”¯æŒ 3.1 ç‰ˆæœ¬å¹¶å…¼å®¹ 3.0 ç‰ˆæœ¬ï¼ŒTomcat 7 å¯¹åº” 3.0 ç‰ˆæœ¬ã€‚\ntransformer-maven-plugin å·²ç»ä¸æ”¯æŒ 3.0 ç‰ˆæœ¬çš„æ›¿æ¢ï¼Œæ‰€ä»¥å¦‚æœè¿˜åœ¨ç”¨ 3.0 çš„éœ€è¦å’±ä»¬æ‰‹åŠ¨æ”¹æˆä»¥ä¸Š 3.1 ç‰ˆæœ¬çš„å®šä¹‰ï¼Œtransformer-maven-plugin åœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­æ‰èƒ½è‡ªåŠ¨å‡çº§åˆ° jakartaï¼Œè‡ªåŠ¨å‡çº§åï¼Œå‡çº§åˆ° 5.0 åçš„ç»“æœå¦‚ä¸‹ï¼š\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-fragment xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns=\u0026#34;https://jakarta.ee/xml/ns/jakartaee\u0026#34; xsi:schemaLocation=\u0026#34;https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-fragment_5_0.xsd\u0026#34; version=\u0026#34;5.0\u0026#34; metadata-complete=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;/web-fragment\u0026gt;\rè·³è¿‡è½¬æ¢ æˆ‘ä»¬çš„ maven é¡¹ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šæ¨¡å—ï¼Œå¯¹äºæ‰“åŒ…æˆ war è‡ªè¿è¡Œä¸éœ€è¦å‘å¸ƒç»™åˆ«äººç”¨çš„é¡¹ç›®ï¼Œä¸€èˆ¬éƒ½ä¸éœ€è¦è½¬æ¢ï¼Œå¯ä»¥è®¾ç½® properties transform.skip=true è·³è¿‡ã€‚\n\u0026lt;properties\u0026gt; \u0026lt;!-- ä¸å‘å¸ƒ --\u0026gt; \u0026lt;maven.deploy.skip\u0026gt;true\u0026lt;/maven.deploy.skip\u0026gt; \u0026lt;!-- ä¸è½¬æ¢ --\u0026gt; \u0026lt;transform.skip\u0026gt;true\u0026lt;/transform.skip\u0026gt; \u0026lt;/properties\u0026gt;\rå®æ–½æ–¹æ¡ˆ Classifier vs Version ä¸šç•Œä¸»æµæ–¹æ¡ˆå°±æ˜¯ç”¨ç‰ˆæœ¬å·åŒºåˆ†æˆ–è€…ç”¨ classifier åŒºåˆ†è¿™ä¸¤ç§æ–¹æ¡ˆã€‚\nclassifier æœ€ä¸»è¦çš„é—®é¢˜æ˜¯æ— æ³•é€šè¿‡çˆ¶ pom ç»§æ‰¿ï¼Œè¿™æ ·å°†å¯¼è‡´å„ä¸ªä¸šåŠ¡æ–¹éœ€è¦å¤§é‡æ”¹ pom.xml æ–‡ä»¶ã€‚\nå‡è®¾ä¸€ä¸ªé¡¹ç›®ä¾èµ–äº† app-aï¼Œè€Œ app-a åˆä¾èµ– bã€cã€d.\né¦–å…ˆå› ä¸ºçˆ¶ pom å®šä¹‰ classifier å¹¶ä¸ä¼šç»§æ‰¿ã€‚é‚£ä¹ˆï¼Œæˆ‘æ˜¯ä¸æ˜¯æŒ‡å®š app-a çš„ classifier å°±è¡Œäº†ã€‚\nä¸æ˜¯ï¼Œé™¤é app-a çš„ç‰¹å®š classifier è‡ªèº« pom é‡Œå·²ç»ä¸ºç»™ä¸ªæ¨¡å—æŒ‡å®šäº† classifierï¼Œå¦åˆ™ app-a ä¾èµ–çš„å„ä¸ªéƒ½è¦é‡æ–°æŒ‡å®šä¸€éï¼Œè¿™å°±ä½¿ç”¨ pom æ–‡ä»¶é•¿å¾—åˆé•¿åˆè‡­ã€‚å¦‚æœå“ªå¤© app-a åˆæ–°å¢ä¾èµ– e, ä½†æ˜¯ä½¿ç”¨è€…æ¼æ‰äº† e classifier å£°æ˜çš„ï¼Œå°±å¯èƒ½å¸¦æ¥é—®é¢˜ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„åŠ¨ä½œã€‚\næ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©ç”¨ç‰ˆæœ¬å·æ¥åŒºåˆ†ã€‚\nä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ ç‰ˆæœ¬å·è§„åˆ™ï¼Œåœ¨åŸç‰ˆæœ¬åŸºç¡€ä¸Šå¢åŠ å›ºå®šå‰ç¼€ï¼š9999.${project.version}ï¼Œå¦‚åŸ 9.6.0 å¯¹åº”çš„ jakarta ç‰ˆæœ¬å·æ˜¯ 9999.9.6.0ã€‚\nçˆ¶ pom åŒºåˆ†ç‰ˆæœ¬å·ï¼ŒSpring Boot 3.x ç‰ˆæœ¬ä¾èµ–ï¼Œé‡ç”³ç‰ˆæœ¬å·ã€‚\nè¿™æ ·å„ä¸ªä½¿ç”¨è€…ï¼Œåªéœ€è¦é€‰æ‹©ä¸åŒçš„çˆ¶ pomï¼Œéµå¾ªçˆ¶ pom ç‰ˆæœ¬å®šä¹‰ï¼Œdependency å¯ä»¥åŸæ ·ä¸å˜ã€‚\nå¦‚ä½•æ‰“åŒ…å‘å¸ƒ ç›®å‰æš‚å®šé€‰æ‹© transformer-maven-pluginï¼Œä»–ä¸å®Œç¾ï¼Œä½†æ˜¯è¶³å¤Ÿå¿«ï¼Œç›¸å¯¹ç¨³å®šã€‚\nå‘å¸ƒç›®æ ‡ï¼šä¸¤æ¬¡å‘å¸ƒï¼Œç¬¬ä¸€æ¬¡å‘å¸ƒå¸¸è§„ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‘å¸ƒè‡ªåŠ¨è½¬æ¢åçš„ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å·å¢åŠ å‰ç¼€ã€‚\nå‘å¸ƒæ­¥éª¤ï¼š\nåœ¨å…¬å¸çº§çˆ¶ pom å¢åŠ å¦‚ä¸‹ profileï¼š\n\u0026lt;profiles\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;jakarta-transformer\u0026lt;/id\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.transformer\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;transformer-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;extensions\u0026gt;true\u0026lt;/extensions\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;!-- æ­¤å¤„é…ç½® javax æ›¿æ¢æˆ jakartaï¼ŒartifactId ä¸å˜ï¼Œæ—  classifier --\u0026gt; \u0026lt;id\u0026gt;jakarta-jar\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;package\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;jar\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;rules\u0026gt; \u0026lt;jakartaDefaults\u0026gt;true\u0026lt;/jakartaDefaults\u0026gt; \u0026lt;/rules\u0026gt; \u0026lt;artifact\u0026gt; \u0026lt;groupId\u0026gt;${project.groupId}\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;${project.artifactId}\u0026lt;/artifactId\u0026gt; \u0026lt;/artifact\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/profile\u0026gt; \u0026lt;/profiles\u0026gt;\rå‘å¸ƒ jakarta ç‰ˆæœ¬æ—¶ï¼Œå…ˆæ”¹ç‰ˆæœ¬å·å¢åŠ å‰ç¼€ï¼Œå†æŒ‡å®š profile å‘å¸ƒï¼š\n# è·å–å½“å‰ç‰ˆæœ¬å· mvn help:evaluate -Dexpression=project.version -q -DforceStdout # å¦‚æœé¡¹ç›®éƒ½æ˜¯è‡ªå·±å†™ç‰ˆæœ¬å·çš„ï¼Œä½¿ç”¨ version æ’ä»¶è®¾ç½®æ–°ç‰ˆæœ¬å·ï¼Œå¢åŠ å‰ç¼€ mvn versions:set -DnewVersion=9999.9.6.0 -DgenerateBackupPoms=false # é‡æ–°å‘å¸ƒï¼ŒæŒ‡å®š -Pjakarta profileï¼Œçˆ¶ pom é‡Œçš„æ’ä»¶è‡ªåŠ¨è½¬æ¢ javax mvn deploy -Pjakarta-transformer # å¦‚æœä½¿ç”¨ flatten-maven-plugin æ’ä»¶ç®¡ç†ç‰ˆæœ¬å·çš„ï¼Œè®¾ç½® revision mvn deploy -Drevision=9999.9.6.0 -Pjakarta-transformer\r","date":"2025-09-14","id":9,"permalink":"/blog/javax-jakarta-compatibility/","summary":"\u003ch2 id=\"ä»€ä¹ˆæ˜¯-jakarta-eeä¸ºä»€ä¹ˆè¦åˆ‡æ¢\"\u003eä»€ä¹ˆæ˜¯ Jakarta EEï¼Œä¸ºä»€ä¹ˆè¦åˆ‡æ¢\u003c/h2\u003e\n\u003cp\u003eJakarta EE å°±æ˜¯ Java EE çš„æ–°åè¯ã€‚è¿™é‡Œçš„ EE å…¨ç§°æ˜¯ Enterprise Editionï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºä¼ä¸šçº§ Java åº”ç”¨å®šä¹‰çš„ä¸€å¥—è§„èŒƒï¼Œä¸ Java SE (Java Platform, Standard Edition) ç›¸å¯¹åº”ã€‚\u003c/p\u003e\n\u003cp\u003eJava EE æ˜¯ä» Java 1.2 ç‰ˆæœ¬å¼€å§‹æ¨å‡ºçš„ Java ä¼ä¸šçº§å¼€å‘å¹³å°ï¼Œæœ€åˆçš„åç§°æ˜¯ J2EE (Java 2 Platform, Enterprise Edition)ã€‚éšç€ Java çš„å‘å±•ï¼Œå®ƒçš„åç§°äº Java 1.5 ç‰ˆæœ¬æ—¶æ›´æ”¹ä¸º Java EE (Java Platform, Enterprise Edition)ã€‚2009 å¹´ Oracle æ”¶è´­äº† Sunï¼ŒJava EE å¼€å§‹ç”± Oracle é€šè¿‡ JCP (Java Community Process) å¼€å‘å’Œç»´æŠ¤ã€‚\u003c/p\u003e\n\u003cp\u003eç›´åˆ° 2017 å¹´ï¼ŒOracle å°† Java EE æäº¤ç»™äº† Eclipse åŸºé‡‘ä¼šï¼Œå¹¶å‘½åä¸º Eclipse Enterprise for Javaã€‚ç„¶è€Œï¼Œ\u003cstrong\u003eç”±äº\u0026quot;Java\u0026quot;è¿™ä¸ªåå­—çš„å•†æ ‡å½’ Oracle æ‰€æœ‰ï¼ŒEclipse åŸºé‡‘ä¼šæ— æ³•ç»§ç»­ä½¿ç”¨ \u003ccode\u003ejavax.*\u003c/code\u003e å’Œ \u003ccode\u003ejava.*\u003c/code\u003eï¼Œå› æ­¤ï¼Œé¡¹ç›®åç§°æ”¹ä¸º Jakarta EE\u003c/strong\u003eã€‚\u003c/p\u003e","tags":["Java","Spring Boot"],"title":"Javax å’Œ Jakarta è¿‡æ¸¡æœŸå…¼å®¹æ–¹æ¡ˆ"},{"content":"åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ç±»ä¼¼å¦‚ä¸‹éœ€æ±‚ï¼š\né¡¹ç›®ç»„æä¾›äº† SDKï¼ŒæŸä¸ª API å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä½†æ˜¯å¤§å®¶è¿Ÿè¿Ÿä¸å‡çº§ï¼Œé¡¹ç›®ç»„è¿˜éœ€è¦èŠ±è´¹æ—¶é—´ç»´æŠ¤å·²ç»åºŸå¼ƒçš„ APIã€‚ æœ‰äº›é¡¹ç›®åœ¨ä½¿ç”¨ JDK å·²ç»åºŸå¼ƒçš„ APIï¼Œè¿™äº›åºŸå¼ƒ API åœ¨æ›´é«˜ç‰ˆæœ¬ JDK ä¸­å·²ç»åˆ é™¤ï¼Œå¯¼è‡´æ¨åŠ¨å‡çº§ JDK æ¯”è¾ƒå›°éš¾ã€‚ æœ‰äº›é¡¹ç›®ä¼šè·¨ç‰ˆæœ¬æ··åˆç¼–è¯‘ï¼Œæ¯”å¦‚ç”¨ Java 8 ç¼–è¯‘è¿è¡Œåœ¨ Java 21 ä¸Šï¼Œå¸¸è§çš„é”™è¯¯æ¯”å¦‚ javafx.util åœ¨ Java 21 é»˜è®¤å·²ç»å»æ‰äº†ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘æˆåŠŸå´è¿è¡Œæ—¶å¤±è´¥ã€‚ æ‰€ä»¥æˆ‘ä»¬æƒ³æä¾›ä¸€ç§æ–¹æ¡ˆï¼Œèƒ½ä¸èƒ½åœ¨ç¼–è¯‘æœŸå°±å¼ºåˆ¶ç¦ç”¨æŸäº› APIï¼Œä¸»åŠ¨é˜»æ­¢è®©ç¼–è¯‘ä¸é€šè¿‡ï¼Œæå‰æŠ¥é”™åŠæ—©å‘ç°åŠæ—©å¤„ç†ã€‚\nå®ç°æ–¹æ¡ˆ å½“å‰æˆ‘ä»¬ä½¿ç”¨ maven forbiddenapis æ’ä»¶ï¼Œç»“åˆ CI æµç¨‹æ¥å®ç°ã€‚\næ‰§è¡Œæ•ˆæœï¼Œå¦‚æœæœ‰ä½¿ç”¨ç¦ç”¨çš„ APIï¼Œèƒ½çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹é”™è¯¯æç¤ºï¼Œç¼–è¯‘å¤±è´¥å¹¶ç»™å‡ºåŸå› ã€‚\n12:40:30.647 [INFO] 12:40:30.648 [INFO] --- forbiddenapis:3.9:check (check-forbidden-apis) @ app-biz --- 12:40:30.657 [INFO] Scanning for classes to check... 12:40:30.661 [INFO] Reading bundled API signatures: jdk-deprecated-1.8 12:40:30.694 [INFO] Reading API signatures: /usr/share/maven/conf/forbidden-apis.txt 12:40:30.694 [INFO] Loading classes to check... 12:40:30.695 [INFO] Scanning classes for violations... 12:40:30.849 [ERROR] Forbidden class/interface use: javafx.util.Pair [ç¦æ­¢ä½¿ç”¨ JavaFX ç›¸å…³ç±»] 12:40:30.850 [ERROR] in com.tester.HomeController (HomeController.java:11) 12:40:30.865 [ERROR] Scanned 13 class file(s) for forbidden API invocations (in 0.21s), 1 error(s). 12:40:30.872 [INFO] ------------------------------------------------------------------------ 24784 [INFO] --- forbiddenapis:3.9:check (check-forbidden-apis) @ app-api --- 24812 [INFO] Scanning for classes to check... 24884 [INFO] Reading bundled API signatures: jdk-deprecated-1.8 25016 [INFO] Reading API signatures: /usr/share/maven/conf/forbidden-apis.txt 25017 [INFO] Loading classes to check... 25106 [INFO] Scanning classes for violations... 25984 [ERROR] Forbidden method invocation: java.net.URLEncoder#encode(java.lang.String) [Deprecated in Java 1.8] 25984 [ERROR] in com.tester.FormBody$FormBodyBuilder (FormBody.java:60) 26110 [ERROR] Scanned 660 class file(s) for forbidden API invocations (in 1.31s), 2 error(s). 26113 [INFO] Maven æ ¸å¿ƒé…ç½® é¦–å…ˆï¼Œåœ¨çˆ¶ pom é‡Œå¢åŠ äº†ä»¥ä¸‹ç‰‡æ®µï¼Œæ­¤å†…å®¹ä¸»è¦å«ä¹‰ï¼š\nåœ¨å­˜åœ¨ ${env.MAVEN_HOME}/conf/forbidden-apis.txt æ–‡ä»¶æ—¶æ¿€æ´»æ­¤ profileï¼Œä»¥ä¾¿ç¡®ä¿ç¼ºå°‘ txt æ–‡ä»¶æ—¶ä¸ä¼šæŠ¥é”™ã€‚ é»˜è®¤æ¿€æ´»äº† forbiddenapis æ’ä»¶çš„ jdk-deprecated è§„åˆ™ã€‚ å¢åŠ äº†æˆ‘ä»¬å®šåˆ¶çš„ forbidden-apis.txt è§„åˆ™ï¼Œæ­¤æ–‡ä»¶æ”¾åœ¨ maven çš„åŸºç¡€é•œåƒé‡Œã€‚ \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;forbidden\u0026lt;/id\u0026gt; \u0026lt;activation\u0026gt; \u0026lt;file\u0026gt; \u0026lt;exists\u0026gt;${env.MAVEN_HOME}/conf/forbidden-apis.txt\u0026lt;/exists\u0026gt; \u0026lt;/file\u0026gt; \u0026lt;/activation\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;de.thetaphi\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;forbiddenapis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.9\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;detail\u0026gt;true\u0026lt;/detail\u0026gt; \u0026lt;failOnUnsupportedJava\u0026gt;false\u0026lt;/failOnUnsupportedJava\u0026gt; \u0026lt;ignoreSignaturesOfMissingClasses\u0026gt;true\u0026lt;/ignoreSignaturesOfMissingClasses\u0026gt; \u0026lt;bundledSignatures\u0026gt; \u0026lt;bundledSignature\u0026gt;jdk-deprecated\u0026lt;/bundledSignature\u0026gt; \u0026lt;/bundledSignatures\u0026gt; \u0026lt;signaturesFiles\u0026gt; \u0026lt;signaturesFile\u0026gt;${env.MAVEN_HOME}/conf/forbidden-apis.txt\u0026lt;/signaturesFile\u0026gt; \u0026lt;/signaturesFiles\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;check-forbidden-apis\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;process-classes\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;check\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;test-check-forbidden-apis\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;process-test-classes\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;testCheck\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/profile\u0026gt;\ræˆ‘çš„é¡¹ç›®éœ€è¦ç´§æ€¥å‘ç‰ˆï¼Œæ¥ä¸åŠæ”¹ä»£ç ï¼Œå¦‚ä½•ç¦ç”¨ä»¥ä¸Šæ’ä»¶ï¼Œåœ¨ pom.xml ä¸­å¢åŠ ä»¥ä¸‹å±æ€§ï¼Œæˆ–é€šè¿‡ mvn å‘½ä»¤è¡Œ -Dforbiddenapis.skip=true ä¼ é€’æ­¤å‚æ•°ï¼š\n\u0026lt;properties\u0026gt; \u0026lt;forbiddenapis.skip\u0026gt;true\u0026lt;/forbiddenapis.skip\u0026gt; \u0026lt;/properties\u0026gt;\rforbiddenapis è§„åˆ™è¯¦è§£ forbiddenapis æ’ä»¶æœ‰å†…ç½®è§„åˆ™å’Œè‡ªå®šä¹‰è§„åˆ™ï¼Œè§„åˆ™åå­—å« signaturesã€‚\nforbiddenapis æ’ä»¶é»˜è®¤å·²ç»å†…ç½®äº†ä¸€äº›è§„åˆ™ signaturesï¼Œå‚è€ƒï¼šbundled-signatures ã€‚\nä¸»è¦é»˜è®¤è§„åˆ™ï¼š\njdk-unsafe-*: Signatures of \u0026ldquo;unsafe\u0026rdquo; methods that use default charset, default locale, or default timezone. For server applications it is very stupid to call those methods, as the results will definitely not what the user wants (for Java* = 1.7, 1.8, 9,\u0026hellip;, 24; Ant / Maven / Gradle automatically add the compile Java version). jdk-deprecated-*: This disallows all deprecated methods from the JDK (for Java*= 1.7, 1.8, 9,\u0026hellip;, 24; Ant / Maven / Gradle automatically add the compile Java version). jdk-internal-*: Lists all internal packages of the JDK as of Security.getProperty(\u0026ldquo;package.access\u0026rdquo;). Calling those methods will always trigger security manager and is completely forbidden from Java 9 on (for Java*= 1.7, 1.8, 9,\u0026hellip;, 24; Ant / Maven / Gradle automatically add the compile Java version, since forbiddenapis v2.1). jdk-non-portable: Signatures of all non-portable (like com.sun.management.HotSpotDiagnosticMXBean) or internal runtime APIs (like sun.misc.Unsafe). This is a superset of jdk-internal. Internally this is implemented using heuristics: Any reference to an API that is part of the Java runtime (rt.jar, extensions, Java 9+ java./ jdk. core modules) and is not part of the Java SE specification packages (mainly java, javax, but also org.ietf.jgss, org.omg, org.w3c.dom, and org.xml.sax) is forbidden (any java version, no specific JDK version, since forbiddenapis v2.1). jdk-system-out: On server-side applications or libraries used by other programs, printing to System.out or System.err is discouraged and should be avoided (any java version, no specific JDK version). jdk-reflection: Reflection usage to work around access flags fails with SecurityManagers and likely will not work anymore on runtime classes in Java 9 or later (any java version, no specific JDK version, since forbiddenapis v2.1). commons-io-unsafe-*: If your application uses the famous Apache Common-IO library, this adds signatures of all methods that depend on default charset (for versions* = 1.0, 1.1, 1.2, 1.3, 1.4, 2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8.0, 2.9.0, 2.10.0, 2.11.0, 2.12.0, 2.13.0, 2.14.0, 2.15.0, 2.15.1, 2.16.0, 2.16.1, 2.17.0, 2.18.0). é€šè¿‡ txt æ–‡ä»¶è‡ªå®šä¹‰è§„åˆ™ï¼Œè§„åˆ™è¯­æ³•ï¼šsignatures-syntax ã€‚\nClass reference: A binary/fully-qualified class name (including package). You may use the output of Class.getName(). Be sure to use correct name for inner classes! Example: java.lang.String A package/class glob pattern: To forbid all classes from a package, you may use glob patterns, like sun.misc.**(** matches against package boundaries). A field of a class: package.Class#fieldName A method signature: It consists of a binary class name, followed by # and a method name including method parameters: java.lang.String#concat(java.lang.String) â€“ All method parameters need to use fully qualified class names! Instead of method parameters, the special wildcard string ** may be used to add all variants of a method, regardless of their parameter types. To refer to instance constructors, use the method name \u0026lt;init\u0026gt;, e.g. java.lang.Integer#\u0026lt;init\u0026gt;(int). The error message displayed when the signature matches can be given at the end of each signature line using \u0026ldquo;@\u0026rdquo; as separator:\njava.lang.String @ You are crazy that you disallow strings To not repeat the same message after each signature, you can prepend signatures with a default message. Use a line starting with \u0026ldquo;@defaultMessage\u0026rdquo;.\n@defaultMessage You are crazy that you disallow substrings java.lang.String#substring(int) java.lang.String#substring(int,int) è¿™é‡Œç€é‡éœ€è¦æ³¨æ„ï¼š\næŒ‰æ–¹æ³•åå®šä¹‰æ—¶ï¼Œä¸€å®šè¦å®šä¹‰å¥½å‚æ•°ç±»å‹ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚ æŒ‰åŒ…åå®šä¹‰æ—¶ï¼Œä¸€å®šè¦åŒºåˆ†å¥½ä¸€ä¸ª * å’Œä¸¤ä¸ª **ï¼Œä¸€ä¸ª*åªèƒ½åŒ¹é…ä¸€çº§ï¼Œä¸¤ä¸ª**èƒ½åŒ¹é… N çº§ã€‚ ","date":"2025-09-09","id":10,"permalink":"/blog/ci-maven-forbidden-api/","summary":"\u003cp\u003eåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ç±»ä¼¼å¦‚ä¸‹éœ€æ±‚ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé¡¹ç›®ç»„æä¾›äº† SDKï¼ŒæŸä¸ª API å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä½†æ˜¯å¤§å®¶è¿Ÿè¿Ÿä¸å‡çº§ï¼Œé¡¹ç›®ç»„è¿˜éœ€è¦èŠ±è´¹æ—¶é—´ç»´æŠ¤å·²ç»åºŸå¼ƒçš„ APIã€‚\u003c/li\u003e\n\u003cli\u003eæœ‰äº›é¡¹ç›®åœ¨ä½¿ç”¨ JDK å·²ç»åºŸå¼ƒçš„ APIï¼Œè¿™äº›åºŸå¼ƒ API åœ¨æ›´é«˜ç‰ˆæœ¬ JDK ä¸­å·²ç»åˆ é™¤ï¼Œå¯¼è‡´æ¨åŠ¨å‡çº§ JDK æ¯”è¾ƒå›°éš¾ã€‚\u003c/li\u003e\n\u003cli\u003eæœ‰äº›é¡¹ç›®ä¼šè·¨ç‰ˆæœ¬æ··åˆç¼–è¯‘ï¼Œæ¯”å¦‚ç”¨ Java 8 ç¼–è¯‘è¿è¡Œåœ¨ Java 21 ä¸Šï¼Œå¸¸è§çš„é”™è¯¯æ¯”å¦‚ \u003ccode\u003ejavafx.util\u003c/code\u003e åœ¨ Java 21 é»˜è®¤å·²ç»å»æ‰äº†ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘æˆåŠŸå´è¿è¡Œæ—¶å¤±è´¥ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ‰€ä»¥æˆ‘ä»¬æƒ³æä¾›ä¸€ç§æ–¹æ¡ˆï¼Œèƒ½ä¸èƒ½åœ¨ç¼–è¯‘æœŸå°±å¼ºåˆ¶ç¦ç”¨æŸäº› APIï¼Œä¸»åŠ¨é˜»æ­¢è®©ç¼–è¯‘ä¸é€šè¿‡ï¼Œæå‰æŠ¥é”™åŠæ—©å‘ç°åŠæ—©å¤„ç†ã€‚\u003c/p\u003e\n\u003ch2 id=\"å®ç°æ–¹æ¡ˆ\"\u003eå®ç°æ–¹æ¡ˆ\u003c/h2\u003e\n\u003cp\u003eå½“å‰æˆ‘ä»¬ä½¿ç”¨ maven \u003ca href=\"https://github.com/policeman-tools/forbidden-apis\" target=\"_blank\" rel=\"noopener\"\u003eforbiddenapis\u003c/a\u003e\n æ’ä»¶ï¼Œç»“åˆ CI æµç¨‹æ¥å®ç°ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰§è¡Œæ•ˆæœï¼Œå¦‚æœæœ‰ä½¿ç”¨ç¦ç”¨çš„ APIï¼Œèƒ½çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹é”™è¯¯æç¤ºï¼Œç¼–è¯‘å¤±è´¥å¹¶ç»™å‡ºåŸå› ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.647 [INFO]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.648 [INFO] --- forbiddenapis:3.9:check (check-forbidden-apis) @ app-biz ---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.657 [INFO] Scanning for classes to check...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.661 [INFO] Reading bundled API signatures: jdk-deprecated-1.8\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.694 [INFO] Reading API signatures: /usr/share/maven/conf/forbidden-apis.txt\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.694 [INFO] Loading classes to check...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.695 [INFO] Scanning classes for violations...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.849 [ERROR] Forbidden class/interface use: javafx.util.Pair [ç¦æ­¢ä½¿ç”¨ JavaFX ç›¸å…³ç±»]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.850 [ERROR]   in com.tester.HomeController (HomeController.java:11)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.865 [ERROR] Scanned 13 class file(s) for forbidden API invocations (in 0.21s), 1 error(s).\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e12:40:30.872 [INFO] ------------------------------------------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e24784 [INFO] --- forbiddenapis:3.9:check (check-forbidden-apis) @ app-api ---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e24812 [INFO] Scanning for classes to check...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e24884 [INFO] Reading bundled API signatures: jdk-deprecated-1.8\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e25016 [INFO] Reading API signatures: /usr/share/maven/conf/forbidden-apis.txt\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e25017 [INFO] Loading classes to check...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e25106 [INFO] Scanning classes for violations...\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e25984 [ERROR] Forbidden method invocation: java.net.URLEncoder#encode(java.lang.String) [Deprecated in Java 1.8]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e25984 [ERROR]   in com.tester.FormBody$FormBodyBuilder (FormBody.java:60)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e26110 [ERROR] Scanned 660 class file(s) for forbidden API invocations (in 1.31s), 2 error(s).\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e26113 [INFO]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003ch3 id=\"maven-æ ¸å¿ƒé…ç½®\"\u003eMaven æ ¸å¿ƒé…ç½®\u003c/h3\u003e\n\u003cp\u003eé¦–å…ˆï¼Œåœ¨çˆ¶ pom é‡Œå¢åŠ äº†ä»¥ä¸‹ç‰‡æ®µï¼Œæ­¤å†…å®¹ä¸»è¦å«ä¹‰ï¼š\u003c/p\u003e","tags":["CICD","Java"],"title":"CI: Maven å¦‚ä½•åœ¨ç¼–è¯‘æ—¶ç¦æ­¢è°ƒç”¨æŸäº›ç‰¹å®š API"},{"content":"ä½¿ç”¨ Spring Security Resource Server å’Œ Keycloakï¼Œå®ç°ç”¨æˆ· RBACã€ABAC æˆæƒï¼Œä¸»è¦ä»‹ç»ï¼š\nSpring Security Resource Server å¦‚ä½•ä¸æ ‡å‡† OAuth2 åè®®é›†æˆã€‚ Spring Security Resource Server å¦‚ä½•ä¸ Keycloak Authorization Server é›†æˆã€‚ å¦‚ä½•æ ¡éªŒå’Œè§£æ JWT Tokenï¼Œè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚ å¦‚ä½•ä½¿ç”¨ keycloak admin client è·å–æ›´å¤šä¿¡æ¯ï¼Œæ‰§è¡Œæ›´é«˜çº§åŠ¨ä½œã€‚ Spring Security JWT Token æ¨¡å¼ä¸‹å¦‚ä½•æ–¹ä¾¿æœ¬åœ° Debugï¼Œå¦‚ä½•é€šè¿‡ keycloak admin client æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•ã€‚ åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬å…ˆè§£é‡Šå‡ ç‚¹ï¼š\nKeycloak å®˜æ–¹çš„ Spring Boot Starter åç»­å°†é€æ¸åœæ­¢ç»´æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨ keycloak çš„ clientï¼Œè‡ªå·±å®ç°ä¸€éƒ¨åˆ†ä»£ç ï¼Œæœ‰ client sdk å®ç°èµ·æ¥å¾ˆå®¹æ˜“ã€‚ Spring Security OAuth 2.0 Resource Server ä¹Ÿæœ‰å¤šç§é›†æˆæ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬åªå®ç° JWT è¿™ä¸€ç§ï¼Œå¹¶ä¸”æ˜¯ sessionless çš„ï¼Œä¹Ÿå°±æ˜¯åªè´Ÿè´£æˆæƒä¸è´Ÿè´£ ç™»å½•è®¤è¯ï¼Œ ç™»å½•ç”±ç½‘å…³é€šè¿‡ oauth2-proxy å®ç°ï¼Œè¯¦æƒ…å¯å‚è€ƒå¦ä¸€ç¯‡åšå®¢ä»‹ç» traefik-oauth2-proxy-keycloak ã€‚ ","date":"2024-11-24","id":11,"permalink":"/blog/spring-security-with-keycloak-oauth2/","summary":"\u003cp\u003eä½¿ç”¨ Spring Security Resource Server å’Œ Keycloakï¼Œå®ç°ç”¨æˆ· RBACã€ABAC æˆæƒï¼Œä¸»è¦ä»‹ç»ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eSpring Security Resource Server å¦‚ä½•ä¸æ ‡å‡† OAuth2 åè®®é›†æˆã€‚\u003c/li\u003e\n\u003cli\u003eSpring Security Resource Server å¦‚ä½•ä¸ Keycloak Authorization Server é›†æˆã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚ä½•æ ¡éªŒå’Œè§£æ JWT Tokenï¼Œè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚ä½•ä½¿ç”¨ keycloak admin client è·å–æ›´å¤šä¿¡æ¯ï¼Œæ‰§è¡Œæ›´é«˜çº§åŠ¨ä½œã€‚\u003c/li\u003e\n\u003cli\u003eSpring Security JWT Token æ¨¡å¼ä¸‹å¦‚ä½•æ–¹ä¾¿æœ¬åœ° Debugï¼Œå¦‚ä½•é€šè¿‡ keycloak admin client æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eåœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬å…ˆè§£é‡Šå‡ ç‚¹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eKeycloak å®˜æ–¹çš„ Spring Boot Starter åç»­å°†é€æ¸åœæ­¢ç»´æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨ keycloak çš„ clientï¼Œè‡ªå·±å®ç°ä¸€éƒ¨åˆ†ä»£ç ï¼Œæœ‰ client sdk å®ç°èµ·æ¥å¾ˆå®¹æ˜“ã€‚\u003c/li\u003e\n\u003cli\u003eSpring Security \u003ca href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/index.html\" target=\"_blank\" rel=\"noopener\"\u003eOAuth 2.0 Resource Server\u003c/a\u003e\n ä¹Ÿæœ‰å¤šç§é›†æˆæ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬åªå®ç° \u003ccode\u003eJWT\u003c/code\u003e è¿™ä¸€ç§ï¼Œå¹¶ä¸”æ˜¯ sessionless çš„ï¼Œä¹Ÿå°±æ˜¯åªè´Ÿè´£æˆæƒä¸è´Ÿè´£ \u003ccode\u003eç™»å½•è®¤è¯\u003c/code\u003eï¼Œ ç™»å½•ç”±ç½‘å…³é€šè¿‡ oauth2-proxy å®ç°ï¼Œè¯¦æƒ…å¯å‚è€ƒå¦ä¸€ç¯‡åšå®¢ä»‹ç» \u003ca href=\"https://www.xlabs.club/blog/traefik-oauth2-proxy-keycloak/\" target=\"_blank\" rel=\"noopener\"\u003etraefik-oauth2-proxy-keycloak\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003c/ol\u003e","tags":["spring","idaas","oauth2","keycloak"],"title":"Spring Security é›†æˆ Keycloak å®ç°ç”¨æˆ· RBACã€ABAC æˆæƒ"},{"content":"åŸºäº K8S éƒ¨ç½² Backstageï¼Œé›†æˆ oauth2-proxy å’Œ Keycloakï¼Œå®ç°ç”¨æˆ·ç®¡ç†ã€è®¤è¯å’Œæˆæƒï¼Œé…ç½®è¯¦è§£å’ŒåŸç†ä»‹ç»ã€‚\nå¦‚æœä½ é‡åˆ°ä»¥ä¸‹é—®é¢˜æˆ–è¯‰æ±‚ï¼Œå¯ä»¥å‚è€ƒæ­¤æ–‡æ¡£ã€‚\nBackstage æ¥å…¥ oauth2-proxyï¼Œç™»å½•æˆ–è®¤è¯å¤±è´¥ã€‚ Backstage å®ç° RBACã€ABAC æˆæƒç®¡ç†ï¼Œä»¥åŠå¦‚ä½•å®ç°è‡ªå®šä¹‰æƒé™ã€‚ oauth2-proxy å¯¹æ¥ keycloakï¼Œå‚æ•°ä¸ç†è§£æˆ–è€…é…ç½®ä¸€ç›´é”™è¯¯ã€‚ åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªç‚¹ï¼ŒBackstage å®˜æ–¹å¼€æºæœ‰å¼€ç®±å³ç”¨çš„å®¹å™¨é•œåƒï¼Œä¹Ÿæœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼Œç„¶è€ŒåŒºåˆ«äºå…¶ä»–æ’ä»¶ç±»åº”ç”¨ï¼ŒBackstage æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼š\nBackstage æ’ä»¶åˆ†ä¸º frontend å’Œ backendï¼Œä¸€ä¸ªå®Œæ•´çš„æ’ä»¶å¯èƒ½åŒ…å«ä¸¤ç§ï¼Œä¹Ÿå¯èƒ½åªåŒ…å«å…¶ä¸­ä¸€ç§ã€‚\nå¼€æºå‘å¸ƒçš„å¼€ç®±å³ç”¨çš„å®¹å™¨é•œåƒï¼ŒåªåŒ…å«åŸºç¡€æ’ä»¶ï¼Œä¸€èˆ¬åªç”¨æ¥ä½œä¸ºåˆæ¬¡å­¦ä¹ ä½¿ç”¨ã€‚\nå¦‚æœæƒ³ä½¿ç”¨å…¶ä»–æ’ä»¶ï¼Œéœ€è¦åšä¸€äº›ç¼–ç å·¥ä½œï¼Œä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ã€‚\nä½¿ç”¨ npx @backstage/create-app@latest åˆ›å»ºä¸€ä¸ªåŸºç¡€é¡¹ç›®ã€‚ æŒ‰æ’ä»¶è¦æ±‚å®‰è£…æ’ä»¶ï¼Œé…ç½®æ’ä»¶èœå•ã€UI æ•ˆæœã€æƒé™ã€è®¤è¯ä¿¡æ¯ç­‰ï¼Œæ¯ä¸ªæ’ä»¶è¦æ±‚ä¸åŒã€‚ æŒ‰éœ€å¼€å‘è‡ªå·±çš„æ’ä»¶ã€‚ ç¼–è¯‘æˆæ–°å®¹å™¨é•œåƒï¼ŒæŸäº›æ’ä»¶å¯èƒ½è¿˜éœ€è¦åœ¨å®¹å™¨ä¸­é¢å¤–å®‰è£…ä¸€äº›ä¾èµ–åŒ…ï¼Œéƒ¨ç½²æ—¶ä½¿ç”¨æ­¤å®¹å™¨é•œåƒã€‚ åŸºæœ¬ä¸Šæ¯ä¸ªæ’ä»¶éƒ½æœ‰è‡ªå·±çš„é…ç½®è¦æ±‚ï¼Œéœ€æ ¹æ®æ’ä»¶æ–‡æ¡£é…ç½® app-config.yamlã€‚\nå¯ä»¥æŠŠ Backstage ç±»æ¯”äº Spring Bootï¼Œæä¾›äº† starterã€frameworkã€pluginsï¼Œå¦‚æœæƒ³çœŸå®ä½¿ç”¨ï¼Œéœ€è¦è‡ªå·±å¼•å…¥ä¾èµ–ï¼Œç¼–è¯‘æˆè‡ªå·±çš„é•œåƒå‘å¸ƒéƒ¨ç½²ï¼Œæ¬¢è¿ star æˆ‘ä»¬åŸºäº Backstage å®šåˆ¶çš„å¼€æºé¡¹ç›® xlabs-developer-platform ã€‚\næ ¸å¿ƒç»„ä»¶ä»‹ç»ï¼š\nç”¨æˆ·åŒæ­¥ä½¿ç”¨ Red Hat è´¡çŒ®çš„ç¤¾åŒºå¼€æºæ’ä»¶ @backstage-community/plugin-catalog-backend-module-keycloak ï¼Œå°† keycloak ç”¨æˆ·åŒæ­¥åˆ° Backstage æ•°æ®åº“ï¼Œåé¢æˆ‘ä»¬ä¼šæåˆ°ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸€æ­¥ã€‚ è®¤è¯ä½¿ç”¨å®˜æ–¹å†…ç½®çš„ OAuth 2 Proxy Provider . æˆæƒï¼Œæƒé™ç®¡ç† Permissionsï¼Œæ”¯æŒ RBACã€ABACï¼Œ ä½¿ç”¨ Red Hat è´¡çŒ®çš„ç¤¾åŒºå¼€æºæ’ä»¶ @backstage-community/plugin-rbac ï¼Œè™½ç„¶æ’ä»¶åå­—å« RBACï¼Œä½†æ˜¯å®é™…ä¸Šæ”¯æŒ ABACã€‚æ³¨æ„ Spotify ä¹Ÿæœ‰ RBAC æ’ä»¶ éœ€è¦è´­ä¹° License æ‰èƒ½ç”¨ï¼Œä¸¤ä¸ªæ’ä»¶åˆ«å¼„æ··äº†ã€‚ ä»¥ä¸Šè®¤è¯å’Œæˆæƒæ˜¯ç‹¬ç«‹çš„ï¼Œå¦‚æœä½ åªéœ€è¦è®¤è¯ï¼Œä¸éœ€è¦æˆæƒï¼Œé‚£å¯ä»¥ä¸éœ€è¦ RBAC æ’ä»¶ã€‚\næ•´ä½“æ¶æ„æµç¨‹å›¾ï¼š\nsequenceDiagram participant User as User participant proxy as oauth2-proxy participant Backstage as Backstage participant Keycloak as Keycloak Note over Backstage,Keycloak: Backstage Sync Users Backstage-\u003e\u003eKeycloak: Fetch users and groups from Keycloak Keycloak--\u003e\u003eBackstage: Save user and group to backstage User-\u003e\u003eproxy: Access oauth2-proxy (Browser) proxy-\u003e\u003eproxy: Check if user is authenticated by cookie session proxy-\u003e\u003eKeycloak: Redirect to Keycloak for login Keycloak--\u003e\u003eUser: Display Keycloak login page User-\u003e\u003eKeycloak: Submit credentials Keycloak--\u003e\u003eproxy: Return access token proxy-\u003e\u003eBackstage: Forward request with token and user info in Header Backstage-\u003e\u003eBackstage: Validate user existence, check user permissions Backstage--\u003e\u003eproxy: Respond with data proxy--\u003e\u003eUser: Return data from Backstage\rå®‰è£…éƒ¨ç½²é…ç½®è¯¦è§£å’ŒåŸç†åˆ†æ åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç‰¹åˆ«æ³¨æ„å‡ ä¸ªæ¯”è¾ƒå®¹æ˜“è¸©å‘çš„ç‚¹ï¼š\nBackstage OAuth 2 Proxy Provider é™¤äº†è¿›è¡Œç”¨æˆ·ç™»å½•è®¤è¯å¤–ï¼Œè¿˜ä¼šæ ¡éªŒç”¨æˆ·æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè¿”å›é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ @backstage-community/plugin-catalog-backend-module-keycloak æ’ä»¶ï¼Œå…ˆå°†ç”¨æˆ·åŒæ­¥åˆ° backstage é‡Œã€‚ Backstage çš„ Sign In resolver ä¾èµ– oauth2-proxy ä¼ é€’çš„ http headerï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ backstage ä½œä¸º oauth2-proxy çš„ upstreamï¼Œç½‘ç»œæµé‡æ˜¯ User -\u0026gt; oauth2-proxy -\u0026gt; Backstageã€‚ä¸‹é¢æˆ‘ä»¬ä¼šå•ç‹¬è¯´æ˜ä¾èµ–å“ªäº› Headerã€‚ oauth2-proxy ä»¥ email ä½œä¸ºç”¨æˆ·æ ¡éªŒå’Œè¯†åˆ«ï¼Œæ‰€ä»¥å°½é‡ä¸ºç”¨æˆ·è®¾ç½® emailï¼Œå¦åˆ™åç»­ä¼šæœ‰å¾ˆå¤šé¢å¤–é…ç½®å’Œå¼€å‘å·¥ä½œã€‚ç­‰æŠ¥é”™äº†å°±çŸ¥é“æ€ä¹ˆè§£å†³äº†ï¼Œèƒ½è§£å†³ï¼Œåªæ˜¯å¸¦æ¥é¢å¤–çš„å·¥ä½œã€‚ ä¸‹é¢çš„å®‰è£…éƒ¨ç½²é…ç½®ï¼Œéƒ½åœ¨æˆ‘ä»¬çš„éƒ¨ç½²è„šæœ¬ xlabs-ops æºç é‡Œï¼Œå¯ä¾›å‚è€ƒï¼Œæ–¹ä¾¿å¤åˆ¶ç²˜è´´ã€‚\nKeycloak é…ç½®å‡†å¤‡ Keycloak éœ€è¦å‡†å¤‡ä¸¤å¯¹ client id å’Œ client secretï¼Œéƒ½æ˜¯ OpenID Connect , åˆ†åˆ«ç»™ Backstage @backstage-community/plugin-catalog-backend-module-keycloak æ’ä»¶åŒæ­¥ç”¨æˆ·ç”¨ï¼Œ å’Œ oauth2-proxy ç™»å½•è®¤è¯ä½¿ç”¨ã€‚å¦‚æœä½ æƒ³çœäº‹ï¼Œä¹Ÿå¯ä»¥æŠŠä¸¤ä¸ª client åˆå¹¶æˆä¸€ä¸ªã€‚\nç»™ Backstage åŒæ­¥ç”¨æˆ·ä½¿ç”¨ï¼Œå‡è®¾ id å« backstageï¼Œéœ€è¦åœ¨ keycloak å¼€å¯ Authorizationï¼Œå¹¶åœ¨ Service Account Roles æˆæƒæŸ¥è¯¢ users å’Œ groups çš„æƒé™ã€‚ä»–çš„ä½œç”¨å°±æ˜¯é€šè¿‡ keycloak çš„ api å°† users å’Œ groups åŒæ­¥åˆ° backstageï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œåœ¨ backstage çš„æ—¥å¿—é‡Œåº”è¯¥èƒ½çœ‹åˆ°ä¸€äº›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚\nç»™ oauth2-proxy ç™»å½•è®¤è¯ç”¨ï¼Œå‡è®¾ id å« oauth2-proxy, éœ€è¦åœ¨ keycloak è®¾ç½® Valid redirect URIs ä¸ºä½  backstage çš„å›è°ƒåœ°å€ï¼Œæ”¯æŒé€šé…ç¬¦ï¼Œæ¯”å¦‚ https://backstage.nxest.com/*ï¼Œå¹¶è®¾ç½® Audience å’Œ Groups scopeï¼Œ å¦åˆ™ç™»å½•å¤±è´¥ã€‚å…·ä½“è®¾ç½® scope æ–¹å¼è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ oauth2-proxy-keycloak-oidc å’Œæˆ‘çš„å¦å¤–ä¸€éåšå®¢ traefik-oauth2-proxy-keycloak ã€‚\noauth2-proxy é…ç½® oauth2-proxy ä¹Ÿæœ‰å¾ˆå¤šéƒ¨ç½²æ–¹å¼ï¼Œä»¥ K8S å†…éƒ¨ç½² bitnami/oauth2-proxy helm chart ä¸ºä¾‹ï¼Œæ ¸å¿ƒé…ç½®å‚è€ƒå¦‚ä¸‹ã€‚\nconfiguration: clientID: oauth2-proxy clientSecret: copy-from-keycloak-oauth2-proxy-client-secret # openssl rand -base64 32 | tr -- \u0026#39;+/\u0026#39; \u0026#39;-_\u0026#39; cookieSecret: \u0026#34;Vr0_r5nWZPLAxNgI9ZIU2JnE24brhPbkZ0sUN_phwJo==\u0026#34; # https://oauth2-proxy.github.io/oauth2-proxy/configuration/overview # oauth2_proxy.cfg æ˜¯ tomlï¼Œæ³¨æ„ç­‰å·åé¢ String ç±»å‹éœ€è¦å¼•å· content: | provider = \u0026#34;keycloak-oidc\u0026#34; provider_display_name = \u0026#34;Keycloak\u0026#34; email_domains = \u0026#34;*\u0026#34; pass_access_token = true ssl_insecure_skip_verify = true ssl_upstream_insecure_skip_verify = true insecure_oidc_allow_unverified_email = true code_challenge_method = \u0026#34;S256\u0026#34; cookie_expire = \u0026#34;30m\u0026#34; cookie_refresh = \u0026#34;4m\u0026#34; skip_auth_routes = \u0026#39;.*\\.(js|css)$\u0026#39; upstreams = \u0026#34;http://backstage.backstage.svc:7007\u0026#34; silence_ping_logging = true backend_logout_url = \u0026#34;\u0026lt;%= keycloakBaseUrl %\u0026gt;/realms/devops/protocol/openid-connect/logout\u0026#34; oidcIssuerUrl: \u0026lt;%= keycloakBaseUrl %\u0026gt;/realms/devops redirectUrl: \u0026#34;\u0026#34; # ç™½åå•æ”¯æŒé€šé…ç¬¦ï¼š *.xxx.com whiteList: \u0026#34;*.xxx.com\u0026#34;\ræ³¨æ„è¿™é‡Œå‡ ä¸ªç‰¹åˆ«å…³é”®çš„é…ç½®ï¼š\nå°† \u0026lt;%= keycloakBaseUrl %\u0026gt; æ›¿æ¢ä¸ºä½ çš„ keycloak çœŸå® URL åœ°å€ï¼Œè®¾ç½®ä¸ºå¯¹å¤–åœ°å€ï¼Œæ¯”å¦‚ ingress çš„åŸŸåã€‚ devops æ˜¯æˆ‘è‡ªå®šä¹‰çš„ realm åå­—ï¼Œè¯·æ ¹æ®ä½ è‡ªå·±å®é™…çš„æƒ…å†µè®¾ç½®ï¼Œkeycloak é»˜è®¤çš„ realm æ˜¯ masterã€‚ upstreamsï¼šè®¾ç½®ä¸º backstage çš„æœåŠ¡åœ°å€ã€‚æˆ‘è¿™é‡Œè®¾ç½®çš„æ˜¯ backstage çš„ k8s service åœ°å€ï¼Œå› ä¸º oauth2-proxy å’Œ Backstage éƒ½åœ¨ K8S é›†ç¾¤å†…ï¼Œèƒ½é€šå³å¯ã€‚ cookie_refresh : è®¾ç½®ä¸º Keycloak Access-Token lifespan - 1m cookie_expire : è®¾ç½®ä¸º Keycloak Refresh-Token lifespan (Keycloak client_session_idle) skip_auth_routes å¯¹æŸäº› url ä¸åšè®¤è¯ï¼Œå¯å†™å¯ä¸å†™ï¼Œçœ‹ä½ çˆ±å¥½ã€‚ å…³äº keycloak token è¿‡æœŸæ—¶é—´çš„é…ç½®ï¼Œå¯ä»¥å‚è€ƒ keycloak å®˜æ–¹æ–‡æ¡£æˆ– IDaaS Book ã€‚\nBackstage é…ç½® Backstage éœ€è¦ç¼–ç ï¼Œå¼•å…¥ Keycloak å’Œ RBAC æ’ä»¶ï¼Œä¿®æ”¹å¯¼èˆªæ èœå•ï¼Œç„¶åæ‰æ˜¯é…ç½®æ–‡ä»¶ã€‚è¿™éƒ¨åˆ†å¹¶æ²¡æœ‰ä»€ä¹ˆéš¾åº¦ï¼Œå‚è€ƒæ’ä»¶è¯´æ˜å³å¯å®Œæˆï¼Œæ³¨æ„è¯·æ ¹æ®æ’ä»¶çš„æœ€æ–°ç‰ˆæœ¬è¯´æ˜é…ç½®ï¼Œè¿™é‡Œæåˆ°çš„ä¸€åˆ‡éƒ½å¯èƒ½è¿‡æ—¶ï¼ŒBackstage å˜åŒ–å®åœ¨æ˜¯å¤ªå¤§äº†ã€‚\nBackstage æˆ‘ä»¬åŒºåˆ†è®¤è¯å’Œæˆæƒä¸¤éƒ¨åˆ†ï¼Œä¸¤éƒ¨åˆ†å¯ç‹¬ç«‹é…ç½®ï¼Œä½†æ˜¯éƒ½ä¾èµ–ç”¨æˆ·åŒæ­¥ï¼Œæ‰€ä»¥å…ˆæŠŠç”¨æˆ·åŒæ­¥åˆ° Backstage æ•°æ®åº“ã€‚\nç”¨æˆ·åŒæ­¥ å®˜æ–¹è‹±æ–‡æœ€æ–°æ–‡æ¡£è¯·å‚è€ƒ catalog-backend-module-keycloak ï¼Œè¯·æ ¹æ®æœ€æ–°æ–‡æ¡£æ“ä½œã€‚\nåŸºæœ¬æ­¥éª¤ï¼š\nå®‰è£…æ’ä»¶ä¾èµ–ã€‚\nyarn workspace backend add @backstage-community/plugin-catalog-backend-module-keycloak\råœ¨ backstage æ³¨å†Œæ’ä»¶ï¼Œbackstage å·¥ç¨‹ packages/backend/src/index.ts å¢åŠ ä»¥ä¸‹ä»£ç ã€‚\nconst backend = createBackend(); # å¢åŠ è¿™ä¸€è¡Œ backend.add( import(\u0026#39;@backstage-community/plugin-catalog-backend-module-keycloak\u0026#39;), ); backend.start();\ré…ç½®æ’ä»¶åŒæ­¥éœ€è¦çš„ client id å’Œ client secretï¼ŒåŒæ­¥å‘¨æœŸï¼Œåœ¨ backstage çš„ app-config.yaml å¢åŠ ä»¥ä¸‹ç‰‡æ®µã€‚\ncatalog: providers: keycloakOrg: default: baseUrl: https://\u0026lt;keycloak_host\u0026gt; loginRealm: ${KEYCLOAK_REALM} realm: ${KEYCLOAK_REALM} # è¿™é‡Œçš„ client å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„ backstage clientï¼Œ éœ€è¦æˆæƒæŸ¥è¯¢ç”¨æˆ·å’Œç»„çš„æƒé™ clientId: ${KEYCLOAK_CLIENTID} clientSecret: ${KEYCLOAK_CLIENTSECRET} schedule: # Optional (defaults to the configurations below if not provided); same options as in TaskScheduleDefinition # supports cron, ISO duration, \u0026#34;human duration\u0026#34; as used in code frequency: { minutes: 30 } # Customize this to fit your needs # supports ISO duration, \u0026#34;human duration\u0026#34; as used in code timeout: { minutes: 3 } # Customize this to fit your needs\rä»¥ä¸Šé…ç½®å®Œæˆåï¼Œè§‚å¯Ÿä¸‹ backstage çš„è¿è¡Œæ—¥å¿—ï¼ŒæˆåŠŸçš„è¯ä¼šæœ‰åŒæ­¥äº†å¤šå°‘ä¸ª user å’Œ group çš„æ—¥å¿—ï¼Œå¤±è´¥çš„è¯ä¼šæœ‰å¤±è´¥åŸå› ï¼Œç¡®ä¿åŒæ­¥æˆåŠŸã€‚\nç”¨æˆ·è®¤è¯ å®˜æ–¹è‹±æ–‡æœ€æ–°æ–‡æ¡£è¯·å‚è€ƒ OAuth 2 Proxy Provider ï¼Œè¯·æ ¹æ®æœ€æ–°æ–‡æ¡£æ“ä½œã€‚\nåŸºæœ¬æ­¥éª¤ï¼š\nå®‰è£… backstage åç«¯æ’ä»¶ä¾èµ–ã€‚\nyarn --cwd packages/backend add @backstage/plugin-auth-backend-module-oauth2-proxy-provider\ré…ç½® backstage åç«¯ä»£ç ï¼Œå¯ç”¨æ’ä»¶ï¼Œåœ¨ packages/backend/src/index.ts å¢åŠ ä»¥ä¸‹ä»£ç ã€‚\n# å¢åŠ è¿™ä¸€è¡Œ backend.add( import(\u0026#39;@backstage/plugin-auth-backend-module-oauth2-proxy-provider\u0026#39;), );\ré…ç½® oauth2Proxy è®¤è¯ç»„ä»¶éœ€è¦çš„å‚æ•°ï¼Œåœ¨ backstage çš„ app-config.yaml å¢åŠ ä»¥ä¸‹ç‰‡æ®µã€‚\nauth: # environment å¿…é¡»å®šä¹‰ï¼Œä¸€èˆ¬å®šä¹‰ä¸º development å’Œ productionï¼Œå¯æ ¹æ®è‡ªå·±çš„éœ€è¦å®šä¹‰ï¼Œåé¢ä»£ç ä¸­ä¼šæœ‰å¼•ç”¨åå­—çš„åœ°æ–¹ environment: development providers: oauth2Proxy: signIn: resolvers: # See https://backstage.io/docs/auth/oauth2-proxy/provider#resolvers for more resolvers - resolver: forwardedUserMatchingUserEntityName\ræ”¹å‰ç«¯ä»£ç ï¼Œä¿®æ”¹ç™»å½•é¡µé¢ï¼Œä½¿ç”¨ oauth2Proxy çš„ç™»å½•ç»„ä»¶ï¼Œå‚è€ƒ å®˜æ–¹æ–‡æ¡£ . åœ¨ packages/app/src/App.tsx æ‰¾åˆ° SignInPage ä¿®æ”¹ä¸ºå¦‚ä¸‹ç‰‡æ®µï¼Œå½“ç„¶ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„ç¯å¢ƒå®šåˆ¶æ›´å¤šè‡ªå·±çš„ç™»å½•é¡µé¢ã€‚\n// SignInPage: props =\u0026gt; \u0026lt;SignInPage {...props} auto providers={[\u0026#39;guest\u0026#39;]} /\u0026gt;, SignInPage: props =\u0026gt; { const configApi = useApi(configApiRef); // å¼€å‘ç¯å¢ƒä½¿ç”¨ guest è´¦å·ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ oauth2Proxy ä½œä¸ºç™»å½•è®¤è¯ if (configApi.getString(\u0026#39;auth.environment\u0026#39;) === \u0026#39;development\u0026#39;) { return ( \u0026lt;SignInPage {...props} providers={[\u0026#39;guest\u0026#39;]} /\u0026gt; ); } return \u0026lt;ProxiedSignInPage {...props} provider=\u0026#34;oauth2Proxy\u0026#34; /\u0026gt;; }\rä¸Šé¢æˆ‘ä»¬ä½¿ç”¨äº† backstage çš„ resolvers forwardedUserMatchingUserEntityName, ä»–å°±æ˜¯ä» Http Header ä¸­è·å– oauth2-proxy ä¼ é€’è¿‡æ¥çš„ x-forwarded-user å€¼ä¸æ•°æ®åº“æ¯”å¯¹ï¼Œæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚\noauth2-proxy ä¼ é€’åˆ° upstream çš„å¸¸ç”¨ header æœ‰ï¼š\nx-forwarded-user: af188bba-0388-2623-8cdb-39422e8be30a # user database id x-forwarded-preferred-username: lisan123 # user login name x-forwarded-groups: admin,test-group # user groups x-forwarded-access-token: xxx # Access Token authorization: Bearer token xxx # æ³¨æ„è¿™ä¸ªæ˜¯ ID Tokenï¼Œä¸æ˜¯ Access Token cookie: xxx\rè‡³æ­¤ï¼Œç™»å½•è®¤è¯å·²ç»å¯ä»¥äº†ã€‚\nç”¨æˆ·æˆæƒ RBAC æˆæƒæ’ä»¶æœ‰å‰ç«¯å’Œåç«¯ä¸¤ä¸ªæ’ä»¶ã€‚\nå…ˆå®‰è£… backend åç«¯æ’ä»¶ï¼ŒåŸºæœ¬æ­¥éª¤ï¼š\nå®‰è£… backstage åç«¯æ’ä»¶ä¾èµ–ã€‚\nyarn workspace backend add @backstage-community/plugin-rbac-backend\ré…ç½® backstage åç«¯ä»£ç ï¼Œå¯ç”¨æ’ä»¶ï¼Œåœ¨ packages/backend/src/index.ts è¡¥å……ä»¥ä¸‹ä»£ç ã€‚\n// åˆ é™¤åŸæ¥çš„ permission plugin - backend.add(import(\u0026#39;@backstage/plugin-permission-backend/alpha\u0026#39;)); - backend.add( - import(\u0026#39;@backstage/plugin-permission-backend-module-allow-all-policy\u0026#39;), - ); // å¢åŠ è¿™ä¸€è¡Œ + backend.add(import(\u0026#39;@backstage-community/plugin-rbac-backend\u0026#39;)); é…ç½® RBAC æ’ä»¶ç”¨æˆ·æƒé™ï¼Œåœ¨ backstage çš„ app-config.yaml å¢åŠ ä»¥ä¸‹ç‰‡æ®µã€‚\npermission: enabled: true # see https://github.com/backstage/community-plugins/tree/main/workspaces/rbac/plugins/rbac-backend rbac: maxDepth: 1 admin: superUsers: # è¿™é‡Œçš„ â€œdefaultâ€ æ˜¯ backstage çš„ namespace çš„æ¦‚å¿µï¼Œæ²¡æ”¹é»˜è®¤æ˜¯ default - name: user:default/zhangsan - name: user:default/mike users: - name: user:default/lisir - name: group:default/admins\rå†å®‰è£… frontend å‰ç«¯æ’ä»¶ï¼ŒæŠŠ RBAC ç®¡ç†ç•Œé¢æ”¾å‡ºæ¥ï¼ŒåŸºæœ¬æ­¥éª¤ï¼š\nå®‰è£… backstage å‰ç«¯æ’ä»¶ä¾èµ–ã€‚\nyarn workspace app add @backstage-community/plugin-rbac\ré…ç½® backstage å‰ç«¯ä»£ç ï¼Œåœ¨ packages/app/src/App.tsx è¡¥å……ä»¥ä¸‹ä»£ç ï¼Œå¢åŠ  Routeã€‚\nimport { RbacPage } from \u0026#39;@backstage-community/plugin-rbac\u0026#39;; \u0026lt;Route path=\u0026#34;/rbac\u0026#34; element={\u0026lt;RbacPage /\u0026gt;} /\u0026gt;;\ré…ç½®å¯¼èˆªèœå•ï¼Œä¿®æ”¹ packages/app/src/components/Root/Root.tsxã€‚\nimport { Administration } from \u0026#39;@backstage-community/plugin-rbac\u0026#39;; export const Root = ({ children }: PropsWithChildren\u0026lt;{}\u0026gt;) =\u0026gt; ( \u0026lt;SidebarPage\u0026gt; \u0026lt;Sidebar\u0026gt; ... \u0026lt;Administration /\u0026gt; ... \u0026lt;/Sidebar\u0026gt; \u0026lt;/SidebarPage\u0026gt; );\rè‡³æ­¤ï¼Œç”¨ä»¥ä¸Šé…ç½®æœ‰æƒé™çš„ç”¨æˆ·ç™»å½•ï¼Œå°±å¯ä»¥è®¿é—® RBAC ç®¡ç†ç•Œé¢äº†ã€‚æ ¹æ® æƒé™ç®¡ç†æ–‡æ¡£ å¼€å¯è‡ªå®šä¹‰æƒé™ä¹‹æ—…å§ã€‚\n","date":"2024-11-16","id":12,"permalink":"/blog/backstage-keycloak-oauth2-proxy/","summary":"\u003cp\u003eåŸºäº K8S éƒ¨ç½² Backstageï¼Œé›†æˆ oauth2-proxy å’Œ Keycloakï¼Œå®ç°ç”¨æˆ·ç®¡ç†ã€è®¤è¯å’Œæˆæƒï¼Œé…ç½®è¯¦è§£å’ŒåŸç†ä»‹ç»ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœä½ é‡åˆ°ä»¥ä¸‹é—®é¢˜æˆ–è¯‰æ±‚ï¼Œå¯ä»¥å‚è€ƒæ­¤æ–‡æ¡£ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://backstage.io/\" target=\"_blank\" rel=\"noopener\"\u003eBackstage\u003c/a\u003e\n æ¥å…¥ oauth2-proxyï¼Œç™»å½•æˆ–è®¤è¯å¤±è´¥ã€‚\u003c/li\u003e\n\u003cli\u003eBackstage å®ç° RBACã€ABAC æˆæƒç®¡ç†ï¼Œä»¥åŠå¦‚ä½•å®ç°è‡ªå®šä¹‰æƒé™ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://oauth2-proxy.github.io/oauth2-proxy/\" target=\"_blank\" rel=\"noopener\"\u003eoauth2-proxy\u003c/a\u003e\n å¯¹æ¥ keycloakï¼Œå‚æ•°ä¸ç†è§£æˆ–è€…é…ç½®ä¸€ç›´é”™è¯¯ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªç‚¹ï¼ŒBackstage å®˜æ–¹å¼€æºæœ‰å¼€ç®±å³ç”¨çš„å®¹å™¨é•œåƒï¼Œä¹Ÿæœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼Œç„¶è€ŒåŒºåˆ«äºå…¶ä»–æ’ä»¶ç±»åº”ç”¨ï¼ŒBackstage æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eBackstage æ’ä»¶åˆ†ä¸º frontend å’Œ backendï¼Œä¸€ä¸ªå®Œæ•´çš„æ’ä»¶å¯èƒ½åŒ…å«ä¸¤ç§ï¼Œä¹Ÿå¯èƒ½åªåŒ…å«å…¶ä¸­ä¸€ç§ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¼€æºå‘å¸ƒçš„å¼€ç®±å³ç”¨çš„å®¹å™¨é•œåƒï¼ŒåªåŒ…å«åŸºç¡€æ’ä»¶ï¼Œä¸€èˆ¬åªç”¨æ¥ä½œä¸ºåˆæ¬¡å­¦ä¹ ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¦‚æœæƒ³ä½¿ç”¨å…¶ä»–æ’ä»¶ï¼Œéœ€è¦åšä¸€äº›ç¼–ç å·¥ä½œï¼Œä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä½¿ç”¨ \u003ccode\u003enpx @backstage/create-app@latest\u003c/code\u003e åˆ›å»ºä¸€ä¸ªåŸºç¡€é¡¹ç›®ã€‚\u003c/li\u003e\n\u003cli\u003eæŒ‰æ’ä»¶è¦æ±‚å®‰è£…æ’ä»¶ï¼Œé…ç½®æ’ä»¶èœå•ã€UI æ•ˆæœã€æƒé™ã€è®¤è¯ä¿¡æ¯ç­‰ï¼Œæ¯ä¸ªæ’ä»¶è¦æ±‚ä¸åŒã€‚\u003c/li\u003e\n\u003cli\u003eæŒ‰éœ€å¼€å‘è‡ªå·±çš„æ’ä»¶ã€‚\u003c/li\u003e\n\u003cli\u003eç¼–è¯‘æˆæ–°å®¹å™¨é•œåƒï¼ŒæŸäº›æ’ä»¶å¯èƒ½è¿˜éœ€è¦åœ¨å®¹å™¨ä¸­é¢å¤–å®‰è£…ä¸€äº›ä¾èµ–åŒ…ï¼Œéƒ¨ç½²æ—¶ä½¿ç”¨æ­¤å®¹å™¨é•œåƒã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåŸºæœ¬ä¸Šæ¯ä¸ªæ’ä»¶éƒ½æœ‰è‡ªå·±çš„é…ç½®è¦æ±‚ï¼Œéœ€æ ¹æ®æ’ä»¶æ–‡æ¡£é…ç½® app-config.yamlã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå¯ä»¥æŠŠ Backstage ç±»æ¯”äº Spring Bootï¼Œæä¾›äº† starterã€frameworkã€pluginsï¼Œå¦‚æœæƒ³çœŸå®ä½¿ç”¨ï¼Œéœ€è¦è‡ªå·±å¼•å…¥ä¾èµ–ï¼Œç¼–è¯‘æˆè‡ªå·±çš„é•œåƒå‘å¸ƒéƒ¨ç½²ï¼Œæ¬¢è¿ star æˆ‘ä»¬åŸºäº Backstage å®šåˆ¶çš„å¼€æºé¡¹ç›® \u003ca href=\"https://github.com/xlabs-club/xlabs-developer-platform\" target=\"_blank\" rel=\"noopener\"\u003exlabs-developer-platform\u003c/a\u003e\nã€‚\u003c/p\u003e\n\u003cp\u003eæ ¸å¿ƒç»„ä»¶ä»‹ç»ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨æˆ·åŒæ­¥ä½¿ç”¨ Red Hat è´¡çŒ®çš„ç¤¾åŒºå¼€æºæ’ä»¶ \u003ca href=\"https://github.com/backstage/community-plugins/tree/main/workspaces/keycloak/plugins/catalog-backend-module-keycloak\" target=\"_blank\" rel=\"noopener\"\u003e@backstage-community/plugin-catalog-backend-module-keycloak\u003c/a\u003e\nï¼Œå°† keycloak ç”¨æˆ·åŒæ­¥åˆ° Backstage æ•°æ®åº“ï¼Œåé¢æˆ‘ä»¬ä¼šæåˆ°ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸€æ­¥ã€‚\u003c/li\u003e\n\u003cli\u003eè®¤è¯ä½¿ç”¨å®˜æ–¹å†…ç½®çš„ \u003ca href=\"https://backstage.io/docs/auth/oauth2-proxy/provider\" target=\"_blank\" rel=\"noopener\"\u003eOAuth 2 Proxy Provider\u003c/a\u003e\n.\u003c/li\u003e\n\u003cli\u003eæˆæƒï¼Œæƒé™ç®¡ç† Permissionsï¼Œæ”¯æŒ RBACã€ABACï¼Œ ä½¿ç”¨ Red Hat è´¡çŒ®çš„ç¤¾åŒºå¼€æºæ’ä»¶ \u003ca href=\"https://github.com/backstage/community-plugins/tree/main/workspaces/rbac/plugins\" target=\"_blank\" rel=\"noopener\"\u003e@backstage-community/plugin-rbac\u003c/a\u003e\nï¼Œè™½ç„¶æ’ä»¶åå­—å« RBACï¼Œä½†æ˜¯å®é™…ä¸Šæ”¯æŒ ABACã€‚æ³¨æ„ Spotify ä¹Ÿæœ‰ \u003ca href=\"https://backstage.spotify.com/marketplace/spotify/plugin/rbac/\" target=\"_blank\" rel=\"noopener\"\u003eRBAC æ’ä»¶\u003c/a\u003e\n éœ€è¦è´­ä¹° License æ‰èƒ½ç”¨ï¼Œä¸¤ä¸ªæ’ä»¶åˆ«å¼„æ··äº†ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥ä¸Šè®¤è¯å’Œæˆæƒæ˜¯ç‹¬ç«‹çš„ï¼Œå¦‚æœä½ åªéœ€è¦è®¤è¯ï¼Œä¸éœ€è¦æˆæƒï¼Œé‚£å¯ä»¥ä¸éœ€è¦ RBAC æ’ä»¶ã€‚\u003c/p\u003e","tags":["k8s","idaas"],"title":"Backstage é›†æˆ oauth2-proxy å’Œ Keycloakï¼Œå®ç°ç”¨æˆ·ç®¡ç†ã€ç™»å½•è®¤è¯ä»¥åŠ RBACã€ABAC æˆæƒ"},{"content":"ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­æ°¸è¿œé¿å…ä¸äº†è®¤è¯é‰´æƒï¼Œè€Œæˆ‘ä»¬å¼€å‘çš„æŸäº›åº”ç”¨ï¼Œå¹¶ä¸éœ€è¦å¤ªå¤æ‚çš„é‰´æƒï¼Œæ¯”å¦‚å¯èƒ½åªè¦æ±‚å¿…é¡»æ˜¯ç™»å½•ç”¨æˆ·ï¼Œæˆ–è€…åªéœ€è¦æ ¹æ®è§’è‰²è¿›è¡Œ RBAC é‰´æƒã€‚æœ‰æ²¡æœ‰æ–¹æ³•ç®€åŒ–æ­¤æµç¨‹ï¼Œè®©åº”ç”¨å¼€å‘è€…åªå…³æ³¨ä¸šåŠ¡å¼€å‘ï¼Œè¿™å°±æ˜¯æœ¬æ–‡æ¡£è¦è§£å†³çš„é—®é¢˜ã€‚\nå¦‚æœä½ æœ‰ç±»ä¼¼ä»¥ä¸‹çš„éœ€æ±‚ï¼Œéƒ½å¯ä»¥å‚è€ƒæ­¤æ–‡æ¡£ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œç»„ä»¶ä¹Ÿå¯å¤ç”¨ã€‚\nä¸ºåŸæœ¬æ²¡æœ‰ç™»å½•éªŒè¯çš„æœåŠ¡æä¾›è®¤è¯æœåŠ¡ï¼Œæ¯”å¦‚æŸäº›å¼€æºç»„ä»¶ä¸æ”¯æŒè®¤è¯ä½†æ˜¯åˆå› æºå¸¦ä¸€äº›å±é™©æ•°æ®è€Œä¸æƒ³å…¬å¼€è®¿é—®ã€‚ å®ç°ç»Ÿä¸€çš„å•ç‚¹ç™»å½• SSOã€å¹¶æ”¯æŒç®€å•çš„ RBACã€UBAC é‰´æƒã€‚ ä¸º Kubernetus Traefik Nginx Ingress æä¾›ç»Ÿä¸€çš„è®¤è¯å…¥å£ï¼Œä¸€é”®å®ç°æ‰€æœ‰å…¥å£å¿…é¡»ç™»å½•æ‰å¯è®¿é—®ã€‚ é…ç½® Traefik ä½¿ç”¨ Forward Authï¼ŒNginx ä½¿ç”¨ auth_request å®ç°è®¤è¯ï¼Œä¹Ÿå¯ä»¥ä¸€å¹¶å‚è€ƒã€‚ åœ¨ K8S æˆ–åº”ç”¨ç½‘å…³ï¼ŒåŸºäºç”¨æˆ·ã€è§’è‰²ç­‰ä¸åŒå±æ€§ï¼Œè·¯ç”±åˆ°ä¸åŒæœåŠ¡ã€‚ å¦‚æœä½ å‡‘å·§ä¹Ÿåœ¨ç”¨ Backstage ï¼Œè¯·å‚è€ƒ å¦ä¸€ç¯‡åšå®¢ ã€‚ å†™åœ¨å‰é¢ï¼š\næœ¬æ–‡æ¡£é‡Œçš„ç¤ºä¾‹ä»£ç æ˜¯ä»¥ k3s ä¸ºåŸºç¡€ï¼Œä½¿ç”¨ traefik ä½œä¸º ingress controllerï¼Œæ•´ä½“å®Œå–„ä½†ç•¥æ˜¾å¤æ‚ï¼Œå¦‚æœæ²¡æœ‰ K3S/K8Sï¼Œä»¥å…¶ä»–æ–¹å¼éƒ¨ç½²ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼ŒåŸºæœ¬åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚ å¯¹äºæŸäº›åœºæ™¯ä¸‹å¯é€‰çš„é…ç½®ï¼Œä¼šå•ç‹¬è¯´æ˜ï¼Œè¯·æ³¨æ„åˆ†åˆ«ã€‚ è¿™é‡Œæåˆ°çš„æ¯ä¸ªç»„ä»¶éƒ½æ˜¯å¯æ›¿æ¢çš„ï¼Œæ¯”å¦‚ nginx ä»£æ›¿ traefikï¼ŒPomerium ä»£æ›¿ oauth2-proxyï¼Œå¯æ ¹æ®çˆ±å¥½é€‰æ‹©ï¼Œåé¢ä¹Ÿä¼šé€‚å½“è¡¥å……å‡ ç§ä¸åŒæ–¹å¼çš„å¯¹æ¯”å’Œéƒ¨ç½²å·®å¼‚ï¼Œæ›´è¯¦ç»†å†…å®¹è¯·å‚è€ƒæœ¬ç«™å¦å¤–ä¸€ç¯‡æ–‡æ¡£ ç»Ÿä¸€èº«ä»½è®¤è¯ ã€‚ ç¤ºä¾‹ä¸­çš„ä»£ç éƒ½æ˜¯ä»çœŸå®ç¯å¢ƒæ‹·è´ç»è¿‡æ£€éªŒçš„ï¼Œä½†ä¸ºäº†ä¾¿äºç†è§£å¯èƒ½è£å‰ªæ— å…³ç´§è¦çš„å†…å®¹ï¼Œå®Œæ•´çš„å®‰è£…éƒ¨ç½²æºç è¯·å‚è€ƒæˆ‘ä»¬çš„éƒ¨ç½²è„šæœ¬ xlabs-club/xlabs-ops ã€‚ éœ€è¦æ‡‚ä¸€äº› K8Sã€OIDC åŸºç¡€çŸ¥è¯†ï¼Œæ­¤å¤„åªæä¾›é“¾æ¥ä¸å±•å¼€è¯´æ˜ã€‚ ç»„ä»¶ä»‹ç» Keycloak\nKeycloak æ˜¯ä¸€ä¸ªå¼€æºçš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ OAuth 2.0ã€OpenID Connectã€SAML ç­‰åè®®ã€‚å®ƒæä¾›ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ã€èº«ä»½æä¾›æœåŠ¡ç­‰åŠŸèƒ½ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­æ‹…ä»» Auth Provider è§’è‰²ã€‚å…³äº Keycloak çš„ä¸­æ–‡ä»‹ç»ï¼Œå¯å‚è€ƒæœ¬ç«™å•ç‹¬çš„åšå®¢ IDaaS Book ã€‚\noauth2-proxy é¡¾åæ€ä¹‰å®ƒæ˜¯ä¸€ä¸ªå…³äº oauth åå‘ä»£ç†ï¼Œä¸»è¦ç”¨æ¥ä¸ºåç«¯æœåŠ¡å¢åŠ èº«ä»½éªŒè¯å±‚ã€‚å®ƒæ”¯æŒå¤šç§ OAuth 2.0 æä¾›è€…ï¼ˆå¦‚ Googleã€OIDCã€Keycloak ç­‰ï¼‰ï¼Œå¯ä»¥ä¿æŠ¤æœªæä¾›èº«ä»½éªŒè¯çš„åº”ç”¨ã€‚oauth2-proxy åœ¨è¯·æ±‚è¿›å…¥åç«¯æœåŠ¡ä¹‹å‰ï¼Œä¼šå…ˆè¿›è¡Œ OAuth 2.0 ç™»å½•è®¤è¯ï¼Œç¡®ä¿è¯·æ±‚è€…å…·æœ‰è®¿é—®æƒé™ã€‚å®ƒæ‰¿æ‹…äº†ç™»å½•çš„åˆæ³•æ€§æ ¡éªŒã€é‡å®šå‘ã€ç™»å½•æˆåŠŸåçš„ cookieã€response è®¾ç½®ç­‰åŠŸèƒ½ã€‚\nApplication\nåº”ç”¨ä»£å·ï¼Œå¯ä»¥æ˜¯ä»»ä½•åº”ç”¨ï¼ŒUI ä¹Ÿå¥½ï¼ŒAPI ä¹Ÿå¥½ï¼Œéƒ½å¯ä»¥ï¼Œåªè¦æƒ³æ‹¦æˆªéƒ½è¡Œã€‚\nåœ¨å¼€å§‹ä¹‹å‰ï¼Œå»ºè®®å…ˆäº†è§£ä¸‹ oauth2-proxy çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶éœ€è¦ç‰¹åˆ«å…³æ³¨ä¸€ä¸‹ä»–çš„è¿™å‡ ä¸ªå®¹æ˜“ä»¤äººç–‘æƒ‘çš„è®¾ç½®ã€‚\noauth2-proxy çš„ set header å’Œ pass header çš„åŒºåˆ«ï¼Œ set header è®¾ç½®çš„æ˜¯ response headerï¼Œè¿™åœ¨ä¸‹é¢æåˆ°çš„ nginx auth_request æ¨¡å—å’Œ traefik forwardAuth Middleware ä¼šç”¨åˆ°ã€‚ pass header æ˜¯è®¤è¯é€šè¿‡åï¼Œå°†ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚ Access Tokenã€User IDã€User Group é€šè¿‡ Http Request Header ä¼ é€’åˆ° upstreamï¼ˆä»£ç†çš„ç›®æ ‡åº”ç”¨ï¼‰ï¼Œupstream å¯ä»¥æ‹¿åˆ° Header ä¿¡æ¯ååšæ›´å¤šçš„äº‹æƒ…ã€‚ ç›®æ ‡åº”ç”¨ --upstream ä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå…·ä½“çš„åç«¯æœåŠ¡åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯é™æ€æ–‡ä»¶ã€‚è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ file:///dev/null, ç›¸å½“äºèˆå¼ƒ upstreamï¼Œä¸‹é¢æˆ‘ä»¬ä¼šç”¨ä»–ç»“åˆ traefik forwardAuth ä½¿ç”¨ã€‚ å…³æ³¨ä¸‹ oauth2-proxy çš„ Endpoints ï¼Œä¸»è¦ä½¿ç”¨ startã€authã€sign_inã€sign_out ç­‰å‡ ä¸ªï¼Œå¦å¤– auth endpoint åé¢å¯ä»¥è¿½åŠ  query parameters allowed_groups/allowed_emailsï¼Œè¿™æ ·ä¸å°±ç»„æˆäº†ä¸€ä¸ªç®€å•çš„åŸºäº Group çš„æƒé™è®¤è¯ã€‚ æ³¨æ„çœ‹æ–‡æ¡£ä¸­å…³äº proxy çš„è®¾ç½®ï¼Œæ¯”å¦‚ --reverse-proxyï¼Œå¾ˆå¤šé”™è¯¯éƒ½æ˜¯å› ä¸ºè®¤è¯å’Œé…ç½®æ²¡é—®é¢˜ï¼Œä½†æ˜¯åˆ°äº†åç«¯ OAuth æœ¬èº«æ ¡éªŒå¤±è´¥ï¼ŒToken çš„æ ¡éªŒå¯¹ schemeã€host éƒ½æœ‰è¦æ±‚ï¼Œå¦‚æœç»è¿‡äº† proxyï¼Œè¦é€ä¼  header ä¸­çš„ schemeã€hostã€‚ åŸºæœ¬åŸç†å’Œæµç¨‹ ç›®å‰ oauth2-proxy æœ‰å‡ ç§ä¸»æµçš„ä½¿ç”¨æ–¹å¼ã€‚\nç¬¬ä¸€ç§ï¼Œç›´æ¥ä½¿ç”¨ oauth2-proxy å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰¿æ‹…è®¤è¯æµç¨‹å¹¶æä¾›ç®€å•çš„æƒé™æ ¡éªŒï¼Œè®¤è¯é€šè¿‡åé€šè¿‡ Header ä¼ é€’ä¸€äº›ç”¨æˆ·ä¿¡æ¯åˆ° upstream applicationï¼Œæµé‡ç”± oauth2-proxy åˆ†å‘ã€‚\nè¿™ç§æ–¹å¼ç½‘ç»œæµé‡å¤§æ¦‚ç±»ä¼¼å¦‚ä¸‹æ–¹å¼ã€‚\nsequenceDiagram participant User participant oauth2-proxy participant Application User-\u003e\u003eoauth2-proxy: Access Service oauth2-proxy-\u003e\u003eoauth2-proxy: Authenticate User to Auth Provider (eg. keycloak) oauth2-proxy-\u003e\u003eApplication: Forward request to Backend proxy paas headers(user id/name/groups/roles) Application-\u003e\u003eApplication: Do more things by header info Application--\u003e\u003eoauth2-proxy: Response oauth2-proxy--\u003e\u003eUser: Return Response\rç¬¬äºŒç§ï¼Œå€ŸåŠ© traefik forwardAuth è®¤è¯æ’ä»¶ æˆ– nginx auth_request è®¤è¯æ¨¡å—ï¼Œç»“åˆ oauth2-proxy æä¾›çš„è®¤è¯ç›¸å…³ Endpointsï¼Œæ‰¿æ‹…è®¤è¯æµç¨‹ï¼Œè®¤è¯é€šè¿‡åæµé‡çš„åˆ†å‘ä»ç„¶ç”± traefik/nginx æ‰§è¡Œã€‚æ­¤æ–¹æ¡ˆçš„ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ traefik/nginx çš„æµé‡åˆ†å‘èƒ½åŠ›è¿œè¶…è¿‡ oauth2-proxyï¼Œä¸ç ´å traefik/nginx æœ¬èº«çš„åŠŸèƒ½ã€‚\nä»–çš„ç½‘ç»œæµé‡å’Œæµç¨‹å¤§æ¦‚ç±»ä¼¼å¦‚ä¸‹æ–¹å¼ã€‚\nsequenceDiagram participant User participant Traefik participant oauth2-proxy participant Keycloak participant Application User-\u003e\u003eTraefik: Access Application URL Traefik-\u003e\u003eoauth2-proxy: Forward request (auth check) oauth2-proxy-\u003e\u003eoauth2-proxy: Check if user is authenticated oauth2-proxy--\u003e\u003eUser: Redirect to Keycloak login User-\u003e\u003eKeycloak: Enter credentials Keycloak-\u003e\u003eKeycloak: Authenticate User Keycloak--\u003e\u003eUser: Return Authorization Code User-\u003e\u003eoauth2-proxy: Send Authorization Code oauth2-proxy-\u003e\u003eKeycloak: Exchange Code for Access Token Keycloak--\u003e\u003eoauth2-proxy: Return Access Token oauth2-proxy--\u003e\u003eUser: Set authentication cookie oauth2-proxy-\u003e\u003eTraefik: Forward original request, add Response Header Traefik-\u003e\u003eApplication: Response Header to Request Header, Forward request to Application Application--\u003e\u003eTraefik: Return response Traefik--\u003e\u003eUser: Return response\ræµç¨‹æè¿°ï¼š\nç”¨æˆ·è®¿é—® Application URLï¼Œè¯·æ±‚è¢« Traefik æ•è·ã€‚ Traefik å°†è¯·æ±‚è½¬å‘ç»™ oauth2-proxyï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¤è¯ã€‚ å¦‚æœç”¨æˆ·æœªè®¤è¯ï¼Œoauth2-proxy ä¼šå°†ç”¨æˆ·é‡å®šå‘åˆ° Keycloak ç™»å½•é¡µé¢ã€‚ ç”¨æˆ·åœ¨ Keycloak ä¸Šè¾“å…¥å‡­è¯å¹¶è¿›è¡Œè®¤è¯ã€‚ è®¤è¯æˆåŠŸåï¼ŒKeycloak è¿”å›é‰´æƒç ç»™ç”¨æˆ·ã€‚ ç”¨æˆ·å°†é‰´æƒç å‘é€ç»™ oauth2-proxyï¼Œoauth2-proxy ä½¿ç”¨é‰´æƒç å‘ Keycloak è¯·æ±‚è®¿é—®ä»¤ç‰Œã€‚ Keycloak è¿”å›è®¿é—®ä»¤ç‰Œç»™ oauth2-proxyï¼Œoauth2-proxy è®¾ç½®èº«ä»½éªŒè¯ cookieã€‚ oauth2-proxy è®¤è¯é€šè¿‡åï¼Œè®¾ç½® Response Header ç»™ Traefikï¼ŒTraefik å°† Response Header è½¬æˆ Request Header ä¼ é€’ç»™ Applicationã€‚ Application è¿”å›å“åº”ï¼Œæœ€ç»ˆç”± Traefik è¿”å›ç»™ç”¨æˆ·ã€‚ æœ¬æ–‡æ¡£éƒ¨ç½²ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹å¼ã€‚\néƒ¨ç½²é…ç½®è¯¦è§£ æ­¤å¤„çš„ Traefik ä½¿ç”¨çš„ K3S Traefik ingress controllerï¼Œç›¸å…³çš„åŠŸèƒ½é€šè¿‡ ingress annotations å®ç°ï¼Œå¦‚æœä½ ä½¿ç”¨å…¶ä»–æ–¹å¼éƒ¨ç½²ï¼Œè¯·å‚è€ƒ Traefik æ–‡æ¡£ è½¬æ¢ä¸ºå¯¹åº”çš„ yaml é…ç½®ã€‚\nKeycloak é…ç½® é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Keycloak ä¸­åˆ›å»ºä¸€ä¸ª clientï¼Œç”¨äºå…è®¸ oauth2-proxy ä½¿ç”¨ Keycloak éªŒè¯ç”¨æˆ·èº«ä»½éªŒè¯ã€‚\nOIDC å®¢æˆ·ç«¯å¿…é¡»é…ç½® audience mapperï¼Œä»¥å°†å®¢æˆ·ç«¯çš„åç§°åŒ…å«åœ¨ JWT ä»¤ç‰Œçš„ aud å£°æ˜ä¸­ã€‚ aud å£°æ˜æŒ‡å®šä»¤ç‰Œçš„é¢„æœŸæ¥æ”¶è€…ï¼Œoauth2-proxy æœŸæœ›ä¸ \u0026ndash;client-id æˆ– \u0026ndash;oidc-extra-audience çš„å€¼åŒ¹é…ã€‚ åœ¨ Keycloak ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ client scopes æˆ– dedicated å°†å£°æ˜æ·»åŠ åˆ° JWT Token ä¸­ã€‚\nç™»å½• Keycloak admin æ§åˆ¶å°ï¼Œåˆ‡æ¢åˆ°ä½ è‡ªå·±çš„ realmã€‚\né€šè¿‡ Clients -\u0026gt; Create client ï¼ˆæ³¨ï¼š -\u0026gt; è¿æ¥ä»£è¡¨ Keycloak çš„èœå•å’ŒæŒ‰é’®å¯¼èˆªï¼‰æ¥åˆ›å»ºæ–°å®¢æˆ·ç«¯ï¼Œæ ¸å¿ƒå‚æ•°å¦‚ä¸‹ï¼Œæ³¨ï¼šapp.example.com ä¸ºæˆ‘çš„åº”ç”¨åœ°å€ã€‚\nClient typeï¼š OpenID Connect Client IDï¼šoauth2-proxy Client authentication å‹¾é€‰ï¼Œæ‰“å¼€ Authentication flow å‹¾é€‰ Standard flow Valid redirect URIs: è®¾ç½®ä¸ºä½ çš„åº”ç”¨ callback åœ°å€ï¼Œhttps://app.example.com/oauth2/callbackï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ­£åˆ™åŒ¹é…ï¼Œå¦‚ https://app.example.com/* Valid post logout redirect URIsï¼šhttps://app.example.com/oauth2/sign_out ä»¥ä¸Šç‚¹ä¿å­˜åï¼Œä» Clients -\u0026gt; oauth2-proxy -\u0026gt; Credentials é¡µé¢ï¼Œå¤åˆ¶å®¢æˆ·ç«¯å¯†é’¥ï¼Œä¸‹é¢ä¼šç”¨åˆ°ã€‚\né…ç½®ä¸€ä¸ª audience mapper, åœ¨ Clients -\u0026gt; oauth2-proxy -\u0026gt; Client scopesé¡µç­¾ï¼Œæ­¤æ—¶åœ¨åˆ—è¡¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªåå­—å« oauth2-proxy-dedicatedçš„ï¼Œç‚¹å‡»è¿›å»ï¼Œé€šè¿‡ Configure a new mapper æŒ‰é’®åˆ›å»ºä¸€ä¸ªæ–°çš„ mapperã€‚\nç±»å‹é€‰æ‹© Audience åå­—å« aud-mapper-oauth2-proxy Included Client Audienceï¼šé€‰æ‹© oauth2-proxy å‹¾é€‰ Add to ID tokenã€Add to access tokenã€Add to token introspection å¦‚æœæƒ³ä½¿ç”¨ oauth2-proxy çš„ --allowed-group éªŒè¯ï¼Œéœ€è¦åœ¨ Client scopes -\u0026gt; Create client scope åˆ›å»ºä¸€ä¸ªåå­—å« groups çš„ scopeï¼Œä¸‹é¢å‚æ•°æ˜¯ä¿æŒ groups åæ‰èƒ½ä½¿ç”¨ï¼Œåœ¨ groups çš„ detail -\u0026gt; mapper é‡Œåˆ›å»º Group Membership ç±»å‹çš„ mapperã€‚\nnameï¼šgroups-mapper Token Claim Name: groups å‹¾é€‰ Add to xxxï¼Œå…¨å‹¾ä¸Šã€‚ å†å›åˆ° Clients -\u0026gt; oauth2-proxy -\u0026gt; Client scopesé¡µç­¾ï¼Œ Add client scopeé€‰æ‹©æˆ‘ä»¬ä¸Šä¸€æ­¥åˆ›å»ºçš„ groups, Add ç±»å‹é€‰æ‹© Optionalã€‚è¿™æ ·å°±èƒ½æŠŠç”¨æˆ·çš„ group åŠ åˆ° JWT token é‡Œäº†ã€‚\noauth2-proxy é…ç½® åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬å…ˆåšå‡ºä¸¤ä¸ªé€‰æ‹©ï¼š\noauth2-proxy å¯¹æ¥ keycloakï¼Œå¯ä»¥é€‰æ‹© Keycloak OIDC providerï¼Œä¹Ÿå¯ä»¥é€‰æ‹© OpenID Connect providerï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© Keycloak OIDCï¼Œä»–æ¯” OpenID Connect å¤šäº†æŒ‰ç…§ role å’Œ group æˆæƒã€‚ oauth2-proxy å¯¹æ¥ Traefikï¼Œå¯ä»¥ä½¿ç”¨ errors middlewares å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Redirect å®ç°ï¼Œè¿™ä¸¤ç§æ–¹å¼åœ¨ oauth2-proxy çš„æ–‡æ¡£é‡Œéƒ½æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œä¸¤ç§æ–¹å¼éƒ½èƒ½å®ç°æ ¹æ®æƒ…å†µé€‰æ‹©ä¸€ä¸ªï¼Œé…ç½®ä¸Šç¨æœ‰å·®åˆ«ï¼Œè¿”å›å€¼å¯¹ 401 å’Œ 403 çš„å¤„ç†ä¹Ÿä¸åŒã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ bitnami/oauth2-proxy helm chart éƒ¨ç½²ï¼Œvalues.yaml ä¸»è¦é…ç½®å¦‚ä¸‹ã€‚\n# service é»˜è®¤ port 4180 service: port: 4180 ## Configuration section ## configuration: clientID: oauth2-proxy clientSecret: \u0026lt;%= æ›¿æ¢æˆä¸Šé¢åˆ›å»ºçš„ clientSecret %\u0026gt; # cookieSecret åˆ›å»ºå‘½ä»¤ï¼š openssl rand -base64 32 | tr -- \u0026#39;+/\u0026#39; \u0026#39;-_\u0026#39; cookieSecret: \u0026#34;iSGfyi0EbDrkg6eNJpAXGLmwN1jZDZossmElq5GgXeI=\u0026#34; ## content ä¼šæ˜ å°„åˆ° oauth2-proxy.cfg é…ç½®æ–‡ä»¶é‡Œ ## å„ä¸ªå‚æ•°å«ä¹‰è¯·å‚è€ƒ https://oauth2-proxy.github.io/oauth2-proxy/configuration/overview content: | reverse_proxy = true provider = \u0026#34;keycloak-oidc\u0026#34; provider_display_name = \u0026#34;Keycloak\u0026#34; email_domains = \u0026#34;*\u0026#34; set_xauthrequest = true set_authorization_header = true ssl_insecure_skip_verify = true insecure_oidc_allow_unverified_email = true code_challenge_method = \u0026#34;S256\u0026#34; upstreams = \u0026#34;file:///dev/null\u0026#34; # å¡«ä½ è‡ªå·±çš„ keycloak æœåŠ¡åœ°å€ oidcIssuerUrl: https://keycloak.example.com/realms/master # ä¸éœ€è¦å¡« redirectUrlï¼Œç”± Traefik å¸®æˆ‘ä»¬å¤„ç† redirectUrl: \u0026#34;\u0026#34;\rå†æ¬¡å¼ºè°ƒï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨ Traefik åšæµé‡åˆ†å‘ï¼Œoauth2-proxy ä»…æä¾›è®¤è¯åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªå‚æ•°å¾ˆé‡è¦ã€‚\nredirectUrl: \u0026#34;\u0026#34; content: | reverse_proxy = true upstreams = \u0026#34;file:///dev/null\u0026#34;\rä¸ºäº†é…åˆä¸‹é¢çš„ Traefik forwardAuth å®ç° authResponseHeadersï¼Œè¿˜éœ€è¦å¼€å¯è¿™ä¸¤ä¸ªå‚æ•°ã€‚\ncontent: | set_xauthrequest = true set_authorization_header = true\rå¼€å¯åï¼Œåœ¨ backend æœåŠ¡é‡Œå°±èƒ½é€šè¿‡ Header è·å–åˆ°å½“å‰ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œä»¥ keycloak-oidc provider ä¸ºä¾‹ï¼Œè·å–åˆ°çš„ Header å¦‚ä¸‹ã€‚\nx-auth-request-user: af188bba-0388-2623-8cdb-39422e8be30a # user database id x-auth-request-preferred-username: lisan123 # user login name x-auth-request-groups: admin,test-group # user groups x-auth-request-access-token: xxx # Access Token authorization: Bearer token xxx # æ³¨æ„è¿™ä¸ªæ˜¯ ID Tokenï¼Œä¸æ˜¯ Access Token cookie: xxx\rTraefik é…ç½® Traefik æˆ‘ä»¬éœ€è¦ä¸¤ä¸ª Middlewareï¼š\nerrors: å°† http è¿”å›çŠ¶æ€ç æ˜¯ 401-403 çš„è¯·æ±‚ï¼Œé‡å®šå‘åˆ° oauth2-proxy /oauth2/sign_in ç«¯ç‚¹ã€‚ forwardAuthï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶è®¾ç½® cookie å’Œ Headerã€‚ å…ˆåˆ›å»ºè¿™ä¸¤ä¸ª Middlewareã€‚\napiVersion: traefik.io/v1alpha1 kind: Middleware metadata: name: errors-sign-in namespace: oauth2-proxy spec: errors: status: - \u0026#34;401-403\u0026#34; service: name: oauth2-proxy namespace: oauth2-proxy port: 4180 query: \u0026#34;/oauth2/sign_in\u0026#34; --- apiVersion: traefik.io/v1alpha1 kind: Middleware metadata: name: forward-auth namespace: oauth2-proxy spec: forwardAuth: # oauth2-proxy k8s service åœ°å€ address: http://oauth2-proxy.oauth2-proxy.svc:4180/oauth2/auth trustForwardHeader: true # å¢åŠ  headerï¼Œå¯ç”¨ header å‚è€ƒ oauth2-proxy æ–‡æ¡£ authResponseHeaders: - X-Auth-Request-User - X-Auth-Request-Preferred-Username - X-Auth-Request-Access-Token - X-Auth-Request-Groups - Authorization - Set-Cookie\råˆ›å»ºå®Œäº†ï¼Œåœ¨ k8s é‡Œå¯ä½¿ç”¨ traefik IngressRoute å¯¹å¤–æš´éœ²æœåŠ¡ï¼Œä¹Ÿå¯ä½¿ç”¨æ ‡å‡† traefik ingressï¼Œçœ‹ä¸ªäººçˆ±å¥½ã€‚\nå› ä¸º IngressRoute çœ‹èµ·æ¥æ¯”è¾ƒç›´è§‚ï¼Œå¥½ç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ IngressRoute é…ç½®ã€‚\napiVersion: traefik.io/v1alpha1 kind: IngressRoute metadata: name: app-ingress-route namespace: oauth2-proxy # annotations: # cert-manager.io/issuer: selfsigned-issuer spec: entryPoints: - web - websecure routes: - match: \u0026#34;Host(`app.example.com`) \u0026amp;\u0026amp; PathPrefix(`/oauth2`)\u0026#34; kind: Rule services: - name: oauth2-proxy namespace: oauth2-proxy port: http middlewares: - name: errors-sign-in # éœ€è¦ä»£ç†çš„åº”ç”¨å¯¹å¤–æš´éœ²æœåŠ¡ - match: Host(`app.example.com`) kind: Rule middlewares: - name: errors-sign-in - name: forward-auth services: # åç«¯åº”ç”¨ - name: backend namespace: oauth2-proxy port: http-backend\rä½¿ç”¨ k8s ingress å®ç°ï¼Œannotations è¯·å‚è€ƒ traefik.ingress.kubernetes.io ã€‚\næ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š\nå› ä¸º ingress æ²¡åŠæ³•åƒ IngressRoute é‚£æ ·ï¼Œä¸ºä¸åŒ path è®¾ç½®ä¸åŒçš„ middlewaresï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹†åˆ†æˆä¸¤ä¸ª ingress å®šä¹‰ã€‚ traefik annotations çš„ middlewares åå­—å®šä¹‰æ ¼å¼ä¸ºï¼šnamespace-middleware@@kubernetescrdï¼Œä¸€å®šè¦åŠ  namespace å‰ç¼€ï¼Œå¦‚æœæ˜¯ default namespace çš„è¯ï¼Œä¹Ÿè¦åŠ  default-å‰ç¼€ï¼Œå¦åˆ™æŸ¥çœ‹ traefik æ—¥å¿—ä¼šçœ‹åˆ°ä¸€äº› middlewares æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼Œä»è€Œå¯¼è‡´æœåŠ¡ä¸ç”Ÿæ•ˆã€‚ # ç¬¬ä¸€ä¸ª ingressï¼Œå¯¹åº” match: \u0026#34;Host(`app.example.com`) \u0026amp;\u0026amp; PathPrefix(`/oauth2`)\u0026#34;ï¼Œä½¿ç”¨ errors-sign-in middleware apiVersion: networking.k8s.io/v1 kind: Ingress metadata: annotations: traefik.ingress.kubernetes.io/router.middlewares: oauth2-proxy-errors-sign-in@kubernetescrd name: errors-sign-in # namespace: oauth2-proxy spec: ingressClassName: traefik rules: # traefik æ”¯æŒæ³›åŸŸåæ‹¦æˆªï¼Œå¦‚æœä½ æƒ³ç»™æ‰€æœ‰çš„ ingress éƒ½è®¾ç½® oauth2ï¼Œæ­¤å¤„å¯ä»¥è®¾ç½®ä¸º \u0026#34;*.example.com\u0026#34; - host: \u0026#34;app.example.com\u0026#34; http: paths: - backend: service: name: oauth2-proxy port: name: http path: /oauth2 pathType: Prefix # æ ¹æ®ä½ è‡ªå·±çš„æƒ…å†µè®¾ç½® TLS # tls: # - hosts: # - \u0026#34;app.example.com\u0026#34; # secretName: \u0026#34;app.example.com-tls\u0026#34; --- # ç¬¬äºŒä¸ª ingressï¼Œå¯¹åº” match: \u0026#34;Host(`app.example.com`)ï¼Œä½¿ç”¨ errors-sign-in,oauth2-proxy ä¸¤ä¸ª middleware apiVersion: networking.k8s.io/v1 kind: Ingress metadata: annotations: # è¿™é‡Œè®¾ç½® errors-sign-in,oauth2-proxy ä¸¤ä¸ª middleware traefik.ingress.kubernetes.io/router.middlewares: oauth2-proxy-errors-sign-in@kubernetescrd,oauth2-proxy-forward-auth@kubernetescrd name: errors-sign-in-ingress namespace: oauth2-proxy spec: ingressClassName: traefik rules: # traefik æ”¯æŒæ³›åŸŸåæ‹¦æˆªï¼Œå¦‚æœä½ æƒ³ç»™æ‰€æœ‰çš„ ingress éƒ½è®¾ç½® oauth2ï¼Œæ­¤å¤„å¯ä»¥è®¾ç½®ä¸º \u0026#34;*.example.com\u0026#34; - host: \u0026#34;app.example.com\u0026#34; http: paths: - backend: service: name: backend port: name: http-backend path: / pathType: Prefix\rK3S Traefik å¯¹æ¥ oauth2-proxy ç‰¹åˆ«è¯´æ˜ å¦‚æœä»¥ä¸Šä½ çš„æ‰€æœ‰åº”ç”¨éƒ½éƒ¨ç½²åœ¨ K8S åŒä¸€ä¸ª namespace é‡Œï¼Œå°±ä¸ç”¨å…³æ³¨è¿™ä¸ªäº†ã€‚\nK3S Traefik é»˜è®¤æœªå¼€å¯ allowCrossNamespace, ä¸å…è®¸è·¨ namespace è®¿é—®ï¼Œæ‰€ä»¥å¦‚æœä½ ç»™å…¶ä»– namespace çš„åº”ç”¨ä¹ŸåŠ ä¸Š auth Middlewareï¼Œåœ¨åº”ç”¨ä¸Šè®¿é—®çœ‹ä¸åˆ°é”™è¯¯å°±æ˜¯ä¸€ç›´æ²¡æœ‰ Auth åŠŸèƒ½ï¼Œä»¥ä¸ºæ˜¯é…ç½®ä¸ç”Ÿæ•ˆï¼Œå…¶å®æŸ¥çœ‹ K3S Traefik log å¯ä»¥çœ‹åˆ°æœ‰å…³äº Middleware æ‰¾ä¸åˆ°æˆ– Service æ— æ³•è®¿é—®çš„é”™è¯¯æ—¥å¿—ã€‚\nä»¥ä¸‹è§£å†³åŠæ³•ä»»é€‰å…¶ä¸€ï¼š\nåœ¨åº”ç”¨æ‰€åœ¨çš„ namespace éƒ½åˆ›å»º Middlewareï¼Œåˆ›å»º K8S ExternalName Service æŒ‡å®š oauth2-proxy Serviceï¼Œè¿™æ · Middleware å’Œ Service éƒ½åœ¨åŒ namespace äº†ã€‚\nä¸º Traefik å¼€å¯ allowCrossNamespace é…ç½®ï¼Œå…³äº K3S å¦‚ä½•ä½¿ç”¨ HelmChartConfig å®šåˆ¶ Traefik é…ç½®ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ Customizing Packaged Components with HelmChartConfig ã€‚\n# æ‰‹åŠ¨ä¸´æ—¶æ”¹é…ç½®ï¼Œä¸æ¨èï¼Œå¯èƒ½åç»­æ›´æ–°ä¸¢å¤± $ kubectl -n kube-system edit deployment traefik # åœ¨ args ä¸­å¢åŠ  --providers.kubernetescrd.allowCrossNamespace=true # æ°¸ä¹…ç”Ÿæ•ˆé…ç½® # vi /var/lib/rancher/k3s/server/manifests/traefik-config.yaml apiVersion: helm.cattle.io/v1 kind: HelmChartConfig metadata: name: traefik namespace: kube-system spec: valuesContent: |- providers: kubernetesCRD: enabled: true allowCrossNamespace: true\rKeycloak å¯¹æ¥ oauth2-proxy ç‰¹åˆ«è¯´æ˜ Keycloak éœ€è¦åˆ›å»º audience mapper å’Œ groups scope mapperï¼Œè¿™åœ¨ oauth2-proxy å®˜æ–¹æ–‡æ¡£ ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜å’Œåˆ›å»ºæ­¥éª¤ã€‚\noauth2-proxy è‡ªåŠ¨é‡å®šå‘åˆ° keycloak ç™»å½• ä»¥ä¸Šä½¿ç”¨ traefik errors middlewares å®ç°çš„æ–¹æ¡ˆï¼Œæœ‰ä¸¤ä¸ªå¼Šç«¯ï¼š\nç™»å½•æˆåŠŸåçš„å›è°ƒï¼Œæ— æ³•å›åˆ°åŸå§‹è¯·æ±‚é¡µé¢ï¼Œä¼šä¸¢å¤± oauth2-proxy çš„ rdï¼Œåªèƒ½å›åˆ°æ ¹ç›®å½•ã€‚ æ¯æ¬¡éœ€è¦ç™»å½•çš„æ—¶å€™ï¼Œå…ˆåœåœ¨ oauth2-proxy çš„ sign-in ç™»å½•é¡µï¼Œç­‰ç€ä½ ç‚¹ Sign in withï¼Œéœ€è¦ç‚¹å‡»ä¸€ä¸‹æ‰ä¼šè·³è½¬åˆ° keycloak çš„ç™»å½•é¡µã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ oauth2-proxy çš„ç™»å½•é¡µ sign_in.htmlï¼Œåœ¨ç™»å½•é¡µé¢ç›´æ¥é‡å®šå‘ï¼Œsign_in.html å†…å®¹å¦‚ä¸‹ã€‚\n{{define \u0026#34;sign_in.html\u0026#34;}} \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34; charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Redirecting\u0026lt;/title\u0026gt; \u0026lt;script\u0026gt; window.location = \u0026#34;{{.ProxyPrefix}}/start?rd=\u0026#34; + encodeURI(window.location); \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;\u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {{end}}\rç„¶åç»™ oauth2-proxy å¢åŠ ç¯å¢ƒå˜é‡ OAUTH2_PROXY_CUSTOM_TEMPLATES_DIR æ”¾ç½®ä»¥ä¸Šç™»å½•é¡µé¢ã€‚\nå¦‚æœåœ¨ k8s é‡Œï¼Œå¯ä»¥é€šè¿‡é‡ç¼– oauth2-proxy é•œåƒï¼Œæˆ–è€…é€šè¿‡ initContainers æŒ‚è½½ç›®å½•å¤åˆ¶ä»¥ä¸Šæ–‡ä»¶ï¼Œæˆ‘å·²åšå¥½äº†ä¸€ä¸ªè¿™æ ·çš„é•œåƒï¼Œåœ¨æ­¤ GitHub ã€‚\nä½¿ç”¨æ–¹å¼ç±»ä¼¼å¦‚ä¸‹ã€‚\ninitContainers: # copy è‡ªå®šä¹‰æ¨¡æ¿ï¼Œä¸éœ€è¦ç‚¹å‡» `Sign in` æŒ‰é’®ï¼Œè‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ - name: auto-sign-in # æºç ï¼š https://github.com/l10178/x-container image: docker.io/nxest/oauth2-proxy-auto-sign-in:v7.7.1 imagePullPolicy: IfNotPresent env: - name: OAUTH2_PROXY_CUSTOM_TEMPLATES_DIR value: /bitnami/oauth2-proxy/templates volumeMounts: - mountPath: /bitnami/oauth2-proxy/templates name: templates\rnginx ä½¿ç”¨ auth_request å¯¹æ¥ oauth2-proxy åŸç†åŒ Traefikï¼Œå°† /oauth2 ç›¸å…³è¯·æ±‚äº¤ç»™ oauth2-proxy æœåŠ¡ï¼Œè®¤è¯é€šè¿‡å proxy_pass åˆ°åç«¯æœåŠ¡ï¼Œæ³¨æ„è®¾ç½® Header å’Œ Cookieã€‚\nå¦å¤–æ³¨æ„ä¸‹è¿™ä¸€è¡Œ auth_request /oauth2/auth;ï¼Œå‰é¢æˆ‘ä»¬æåˆ° auth endpoint åé¢å¯ä»¥è¿½åŠ  query parameters allowed_groups/allowed_emailsï¼Œåœ¨ nginx é‡Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒ server æˆ– location è®¾ç½®ä¸åŒçš„ groupï¼Œç±»ä¼¼ auth_request /oauth2/auth?allowed_groups=cms-admin;, è¿™æ ·ä¸å°±ç»„æˆäº†ä¸€ä¸ªç®€å•çš„åŸºäº Group çš„æƒé™è®¤è¯ã€‚\nå¦‚æœæƒ³æ ¹æ®ç”¨æˆ·å±æ€§ä»£ç†åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹æˆ–è·¯å¾„ï¼ŒæŠŠ proxy_pass http://backend/; ç”¨ lua if else åŒ…è£…ä¸€ä¸‹ï¼Œä¸å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„è·¯ç”±åŠŸèƒ½ã€‚\nserver { location /oauth2/ { proxy_pass http://oauth2-proxy.svc:4180; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_set_header X-Auth-Request-Redirect $request_uri; # or, if you are handling multiple domains: # proxy_set_header X-Auth-Request-Redirect $scheme://$host$request_uri; } location = /oauth2/auth { proxy_pass http://oauth2-proxy.svc:4180; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; # nginx auth_request includes headers but not body proxy_set_header Content-Length \u0026#34;\u0026#34;; proxy_pass_request_body off; } location / { auth_request /oauth2/auth; error_page 401 = /oauth2/sign_in; # pass information via X-User and X-Email headers to backend, # requires running with --set-xauthrequest flag auth_request_set $user $upstream_http_x_auth_request_user; auth_request_set $email $upstream_http_x_auth_request_email; proxy_set_header X-User $user; proxy_set_header X-Email $email; # if you enabled --pass-access-token, this will pass the token to the backend auth_request_set $token $upstream_http_x_auth_request_access_token; proxy_set_header X-Access-Token $token; # if you enabled --cookie-refresh, this is needed for it to work with auth_request auth_request_set $auth_cookie $upstream_http_set_cookie; add_header Set-Cookie $auth_cookie; # When using the --set-authorization-header flag, some provider\u0026#39;s cookies can exceed the 4kb # limit and so the OAuth2 Proxy splits these into multiple parts. # Nginx normally only copies the first `Set-Cookie` header from the auth_request to the response, # so if your cookies are larger than 4kb, you will need to extract additional cookies manually. auth_request_set $auth_cookie_name_upstream_1 $upstream_cookie_auth_cookie_name_1; # Extract the Cookie attributes from the first Set-Cookie header and append them # to the second part ($upstream_cookie_* variables only contain the raw cookie content) if ($auth_cookie ~* \u0026#34;(; .*)\u0026#34;) { set $auth_cookie_name_0 $auth_cookie; set $auth_cookie_name_1 \u0026#34;auth_cookie_name_1=$auth_cookie_name_upstream_1$1\u0026#34;; } # Send both Set-Cookie headers now if there was a second part if ($auth_cookie_name_upstream_1) { add_header Set-Cookie $auth_cookie_name_0; add_header Set-Cookie $auth_cookie_name_1; } proxy_pass http://backend/; # or \u0026#34;root /path/to/site;\u0026#34; or \u0026#34;fastcgi_pass ...\u0026#34; etc } }\rå¦‚æœæ˜¯åœ¨ K8S å†…ä½¿ç”¨ nginx ingress controller å®ç°ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£å°†ä»¥ä¸Šé…ç½®è½¬æ¢ä¸ºæ³¨è§£å’Œ lua ç‰‡æ®µï¼Œç±»ä¼¼å¦‚ä¸‹è®¾ç½®ã€‚\nnginx.ingress.kubernetes.io/auth-signin: https://$host/oauth2/start?rd=$escaped_request_uri nginx.ingress.kubernetes.io/auth-url: https://$host/oauth2/auth\ré‡è§é—®é¢˜å’Œè§£å†³åŠæ³• æˆ‘ä»¬ä½¿ç”¨è¿‡ç¨‹ä¸­é‡è§çš„é—®é¢˜å’Œè§£å†³åŠæ³•ï¼Œè®°å½•ä¸‹æ¥ä»…ä¾›å‚è€ƒã€‚\ntraefik middleware é…ç½®æœªç”Ÿæ•ˆã€‚\næ£€æŸ¥ traefik æ—¥å¿—ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é”™è¯¯ï¼Œå¦‚æœæœ‰è¯­æ³•é”™è¯¯æˆ–è€…æƒé™é—®é¢˜ï¼Œtraefik ä¹Ÿèƒ½æ­£å¸¸å¯åŠ¨ï¼Œåªæ˜¯é…ç½®ä¸ç”Ÿæ•ˆã€‚\ntraefik log ä¸­ middleware æ‰¾ä¸åˆ°ï¼Œè¯·å‚è€ƒæœ¬æ–‡ä¸Šé¢è¯´æ˜ï¼Œå°† middlewares åå­—æ”¹ä¸ºï¼šnamespace-middleware@@kubernetescrdï¼Œä¸€å®šè¦åŠ  namespace å‰ç¼€ï¼Œå¦‚æœæ˜¯ default namespace çš„è¯ï¼Œä¹Ÿè¦åŠ  default- å‰ç¼€ã€‚\nlevel=error msg=\u0026#34;middleware \\\u0026#34;errors-sign-in@kubernetes\\\u0026#34; does not exist\u0026#34; entryPointName=web routerName=oauth2-proxy-errors-sign-in-sign-in-example-com-oauth2@kubernetes oauth2-proxy èƒ½é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œè¾“å…¥å¯†ç ç™»å½•æˆåŠŸï¼Œå›è°ƒåˆ° callback æ—¶å‡ºç°ä¸‹é¢è¿™ä¸ªé”™è¯¯ï¼ŒåŸå› æ˜¯ç¼ºå°‘ audience mapperï¼Œå‚è€ƒæœ¬æ–‡ä¸Šé¢ä»‹ç»å¢åŠ  mapperã€‚\n500 Internal Server Error Oops! Something went wrong. For more information contact your server administrator. [oauthproxy.go:902] Error creating session during OAuth2 callback: audience from claim aud with value [account] does not match with any of allowed audiences map[oauth2-proxy:{}] ","date":"2024-10-10","id":13,"permalink":"/blog/traefik-oauth2-proxy-keycloak/","summary":"\u003cp\u003eä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­æ°¸è¿œé¿å…ä¸äº†è®¤è¯é‰´æƒï¼Œè€Œæˆ‘ä»¬å¼€å‘çš„æŸäº›åº”ç”¨ï¼Œå¹¶ä¸éœ€è¦å¤ªå¤æ‚çš„é‰´æƒï¼Œæ¯”å¦‚å¯èƒ½åªè¦æ±‚å¿…é¡»æ˜¯ç™»å½•ç”¨æˆ·ï¼Œæˆ–è€…åªéœ€è¦æ ¹æ®è§’è‰²è¿›è¡Œ RBAC é‰´æƒã€‚æœ‰æ²¡æœ‰æ–¹æ³•ç®€åŒ–æ­¤æµç¨‹ï¼Œè®©åº”ç”¨å¼€å‘è€…åªå…³æ³¨ä¸šåŠ¡å¼€å‘ï¼Œè¿™å°±æ˜¯æœ¬æ–‡æ¡£è¦è§£å†³çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœä½ æœ‰ç±»ä¼¼ä»¥ä¸‹çš„éœ€æ±‚ï¼Œéƒ½å¯ä»¥å‚è€ƒæ­¤æ–‡æ¡£ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œç»„ä»¶ä¹Ÿå¯å¤ç”¨ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eä¸ºåŸæœ¬æ²¡æœ‰ç™»å½•éªŒè¯çš„æœåŠ¡æä¾›è®¤è¯æœåŠ¡ï¼Œæ¯”å¦‚æŸäº›å¼€æºç»„ä»¶ä¸æ”¯æŒè®¤è¯ä½†æ˜¯åˆå› æºå¸¦ä¸€äº›å±é™©æ•°æ®è€Œä¸æƒ³å…¬å¼€è®¿é—®ã€‚\u003c/li\u003e\n\u003cli\u003eå®ç°ç»Ÿä¸€çš„å•ç‚¹ç™»å½• SSOã€å¹¶æ”¯æŒç®€å•çš„ RBACã€UBAC é‰´æƒã€‚\u003c/li\u003e\n\u003cli\u003eä¸º Kubernetus Traefik Nginx Ingress æä¾›ç»Ÿä¸€çš„è®¤è¯å…¥å£ï¼Œä¸€é”®å®ç°æ‰€æœ‰å…¥å£å¿…é¡»ç™»å½•æ‰å¯è®¿é—®ã€‚\u003c/li\u003e\n\u003cli\u003eé…ç½® Traefik ä½¿ç”¨ Forward Authï¼ŒNginx ä½¿ç”¨ auth_request å®ç°è®¤è¯ï¼Œä¹Ÿå¯ä»¥ä¸€å¹¶å‚è€ƒã€‚\u003c/li\u003e\n\u003cli\u003eåœ¨ K8S æˆ–åº”ç”¨ç½‘å…³ï¼ŒåŸºäºç”¨æˆ·ã€è§’è‰²ç­‰ä¸åŒå±æ€§ï¼Œè·¯ç”±åˆ°ä¸åŒæœåŠ¡ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœä½ å‡‘å·§ä¹Ÿåœ¨ç”¨ \u003ca href=\"https://backstage.io/\" target=\"_blank\" rel=\"noopener\"\u003eBackstage\u003c/a\u003e\nï¼Œè¯·å‚è€ƒ \u003ca href=\"https://www.xlabs.club/blog/backstage-oauth2-proxy-keycloak/\" target=\"_blank\" rel=\"noopener\"\u003eå¦ä¸€ç¯‡åšå®¢\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå†™åœ¨å‰é¢ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæœ¬æ–‡æ¡£é‡Œçš„ç¤ºä¾‹ä»£ç æ˜¯ä»¥ k3s ä¸ºåŸºç¡€ï¼Œä½¿ç”¨ traefik ä½œä¸º ingress controllerï¼Œæ•´ä½“å®Œå–„ä½†ç•¥æ˜¾å¤æ‚ï¼Œå¦‚æœæ²¡æœ‰ K3S/K8Sï¼Œä»¥å…¶ä»–æ–¹å¼éƒ¨ç½²ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼ŒåŸºæœ¬åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚\u003c/li\u003e\n\u003cli\u003eå¯¹äºæŸäº›åœºæ™¯ä¸‹å¯é€‰çš„é…ç½®ï¼Œä¼šå•ç‹¬è¯´æ˜ï¼Œè¯·æ³¨æ„åˆ†åˆ«ã€‚\u003c/li\u003e\n\u003cli\u003eè¿™é‡Œæåˆ°çš„æ¯ä¸ªç»„ä»¶éƒ½æ˜¯å¯æ›¿æ¢çš„ï¼Œæ¯”å¦‚ nginx ä»£æ›¿ traefikï¼ŒPomerium ä»£æ›¿ oauth2-proxyï¼Œå¯æ ¹æ®çˆ±å¥½é€‰æ‹©ï¼Œåé¢ä¹Ÿä¼šé€‚å½“è¡¥å……å‡ ç§ä¸åŒæ–¹å¼çš„å¯¹æ¯”å’Œéƒ¨ç½²å·®å¼‚ï¼Œæ›´è¯¦ç»†å†…å®¹è¯·å‚è€ƒæœ¬ç«™å¦å¤–ä¸€ç¯‡æ–‡æ¡£ \u003ca href=\"https://www.xlabs.club/docs/platform/iam/\" target=\"_blank\" rel=\"noopener\"\u003eç»Ÿä¸€èº«ä»½è®¤è¯\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003cli\u003eç¤ºä¾‹ä¸­çš„ä»£ç éƒ½æ˜¯ä»çœŸå®ç¯å¢ƒæ‹·è´ç»è¿‡æ£€éªŒçš„ï¼Œä½†ä¸ºäº†ä¾¿äºç†è§£å¯èƒ½è£å‰ªæ— å…³ç´§è¦çš„å†…å®¹ï¼Œå®Œæ•´çš„å®‰è£…éƒ¨ç½²æºç è¯·å‚è€ƒæˆ‘ä»¬çš„éƒ¨ç½²è„šæœ¬ \u003ca href=\"https://github.com/xlabs-club/xlabs-ops\" target=\"_blank\" rel=\"noopener\"\u003exlabs-club/xlabs-ops\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003cli\u003eéœ€è¦æ‡‚ä¸€äº› K8Sã€OIDC åŸºç¡€çŸ¥è¯†ï¼Œæ­¤å¤„åªæä¾›é“¾æ¥ä¸å±•å¼€è¯´æ˜ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"ç»„ä»¶ä»‹ç»\"\u003eç»„ä»¶ä»‹ç»\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eKeycloak\u003c/p\u003e\n\u003cp\u003eKeycloak æ˜¯ä¸€ä¸ªå¼€æºçš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ OAuth 2.0ã€OpenID Connectã€SAML ç­‰åè®®ã€‚å®ƒæä¾›ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ã€èº«ä»½æä¾›æœåŠ¡ç­‰åŠŸèƒ½ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­æ‹…ä»» Auth Provider è§’è‰²ã€‚å…³äº Keycloak çš„ä¸­æ–‡ä»‹ç»ï¼Œå¯å‚è€ƒæœ¬ç«™å•ç‹¬çš„åšå®¢ \u003ca href=\"https://idaas.xlabs.club/\" target=\"_blank\" rel=\"noopener\"\u003eIDaaS Book\u003c/a\u003e\nã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://oauth2-proxy.github.io/oauth2-proxy/\" target=\"_blank\" rel=\"noopener\"\u003eoauth2-proxy\u003c/a\u003e\n\u003c/p\u003e\n\u003cp\u003eé¡¾åæ€ä¹‰å®ƒæ˜¯ä¸€ä¸ªå…³äº oauth åå‘ä»£ç†ï¼Œä¸»è¦ç”¨æ¥ä¸ºåç«¯æœåŠ¡å¢åŠ èº«ä»½éªŒè¯å±‚ã€‚å®ƒæ”¯æŒå¤šç§ OAuth 2.0 æä¾›è€…ï¼ˆå¦‚ Googleã€OIDCã€Keycloak ç­‰ï¼‰ï¼Œå¯ä»¥ä¿æŠ¤æœªæä¾›èº«ä»½éªŒè¯çš„åº”ç”¨ã€‚oauth2-proxy åœ¨è¯·æ±‚è¿›å…¥åç«¯æœåŠ¡ä¹‹å‰ï¼Œä¼šå…ˆè¿›è¡Œ OAuth 2.0 ç™»å½•è®¤è¯ï¼Œç¡®ä¿è¯·æ±‚è€…å…·æœ‰è®¿é—®æƒé™ã€‚å®ƒæ‰¿æ‹…äº†ç™»å½•çš„åˆæ³•æ€§æ ¡éªŒã€é‡å®šå‘ã€ç™»å½•æˆåŠŸåçš„ cookieã€response è®¾ç½®ç­‰åŠŸèƒ½ã€‚\u003c/p\u003e","tags":["k8s","idaas"],"title":"ä½¿ç”¨ oauth2-proxy ä¸ºä»»æ„ç¨‹åºå¢åŠ è®¤è¯é‰´æƒï¼Œç»“åˆ K8Sã€traefikã€keycloak éƒ¨ç½²é…ç½®è¯¦è§£"},{"content":"åœ¨å»ºè®¾æœ¬åšå®¢çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†ä¸€äº›ä¼˜ç§€çš„å¼€å‘å·¥å…·ã€æœ‰è¶£åŸåˆ›çš„ç‹¬ç«‹åšå®¢ï¼Œä»¥åŠç‹¬ç«‹å‘å¸ƒçš„è‰¯å¿ƒå¼€æºäº§å“ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦æŠŠä»–ä»¬å±•ç¤ºå‡ºæ¥ã€‚\nå¦‚æœ‰ä¾µæƒï¼Œè¯·æ issueï¼Œå¦‚æœ‰æ¨èï¼Œè¯·åˆ°æˆ‘ä»¬çš„ GitHub ä»“åº“æäº¤ pull requestsã€‚\nåœ¨çº¿å·¥å…· IT Toolsï¼Œç ”å‘äººå‘˜å¸¸ç”¨ JSON/æ—¶é—´æˆ³/æ•°å­¦/åŠ å¯† ç­‰ç­‰å„ç§åœ¨çº¿ç”Ÿæˆå’Œè½¬æ¢å·¥å…·ï¼šhttps://it-tools.tech ã€‚ Web Toolsï¼ŒJWT/JSON/URL/Base64 ç­‰ç¼–è§£ç å·¥å…·ï¼Œç®€æ´ï¼šhttps://www.jstoolset.com ã€‚ ç‹¬ç«‹åšå®¢ åœ°ç“œå“¥ï¼Œåˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦ï¼šhttps://www.diguage.com ã€‚ ç‹¬ç«‹äº§å“ Coming Soon\u0026hellip;\n","date":"2024-09-26","id":14,"permalink":"/blog/xlabs-link-exchange/","summary":"\u003cp\u003eåœ¨å»ºè®¾æœ¬åšå®¢çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†ä¸€äº›ä¼˜ç§€çš„å¼€å‘å·¥å…·ã€æœ‰è¶£åŸåˆ›çš„ç‹¬ç«‹åšå®¢ï¼Œä»¥åŠç‹¬ç«‹å‘å¸ƒçš„è‰¯å¿ƒå¼€æºäº§å“ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦æŠŠä»–ä»¬å±•ç¤ºå‡ºæ¥ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœ‰ä¾µæƒï¼Œè¯·æ issueï¼Œå¦‚æœ‰æ¨èï¼Œè¯·åˆ°æˆ‘ä»¬çš„ \u003ca href=\"https://github.com/xlabs-club/xlabs-club.github.io\" target=\"_blank\" rel=\"noopener\"\u003eGitHub\u003c/a\u003e\n ä»“åº“æäº¤ pull requestsã€‚\u003c/p\u003e\n\u003ch2 id=\"åœ¨çº¿å·¥å…·\"\u003eåœ¨çº¿å·¥å…·\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eIT Toolsï¼Œç ”å‘äººå‘˜å¸¸ç”¨ JSON/æ—¶é—´æˆ³/æ•°å­¦/åŠ å¯† ç­‰ç­‰å„ç§åœ¨çº¿ç”Ÿæˆå’Œè½¬æ¢å·¥å…·ï¼š\u003ca href=\"https://it-tools.tech\" target=\"_blank\" rel=\"noopener\"\u003ehttps://it-tools.tech\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003cli\u003eWeb Toolsï¼ŒJWT/JSON/URL/Base64 ç­‰ç¼–è§£ç å·¥å…·ï¼Œç®€æ´ï¼š\u003ca href=\"https://www.jstoolset.com\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.jstoolset.com\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ç‹¬ç«‹åšå®¢\"\u003eç‹¬ç«‹åšå®¢\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eåœ°ç“œå“¥ï¼Œåˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦ï¼š\u003ca href=\"https://www.diguage.com\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.diguage.com\u003c/a\u003e\nã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ç‹¬ç«‹äº§å“\"\u003eç‹¬ç«‹äº§å“\u003c/h2\u003e\n\u003cp\u003eComing Soon\u0026hellip;\u003c/p\u003e","tags":[],"title":"å«æ˜Ÿå®éªŒå®¤å‹æƒ…é“¾æ¥"},{"content":"æˆ‘ä»¬å…¬å¸çš„ä¸»è¦åº”ç”¨éƒ½æ˜¯ä»¥ Java ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œè¿™å‡ å¹´éšç€ä¸šåŠ¡çš„é«˜é€Ÿå¢é•¿ï¼Œåº”ç”¨æ•°ç›®è¶Šæ¥è¶Šå¤šï¼ŒCPU å†…å­˜èµ„æºå ç”¨è¶Šæ¥è¶Šå¤šï¼Œé¡¹ç›®ç»„ä¹‹é—´å¼€å‘åˆä½œæ•ˆç‡ä¹Ÿè¶Šæ¥è¶Šä½ã€‚\né¡ºåº”è¿™ä¸ªæ—¶ä»£é™æœ¬å¢æ•ˆçš„ç›®çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªèƒ½è§£å†³å½“å‰å‡ ä¸ªæ ¸å¿ƒé—®é¢˜çš„æ¡†æ¶ï¼š\næ¨¡å—åŒ–å¼€å‘ã€éƒ¨ç½²ã€èµ„æºå…±äº«çš„èƒ½åŠ›ï¼Œå‡å°‘ Cacheã€Class ç­‰èµ„æºå ç”¨ï¼Œæœ‰æ•ˆé™ä½å†…å­˜å ç”¨ã€‚ æ›´å¿«æ›´è½»çš„ä¾èµ–ï¼Œåº”ç”¨èƒ½å¤Ÿæ›´å¿«çš„å¯åŠ¨ã€‚ èƒ½å¤Ÿè®©å„ä¸ªé¡¹ç›®ç»„ä¸æ”¹ä»£ç æˆ–å°‘æ”¹ä»£ç å³å¯æ¥å…¥ï¼Œæ§åˆ¶å¼€å‘è¿ç§»çš„æˆæœ¬ï¼Œæ¯•ç«Ÿå¾ˆå¤šå†å²è€åº”ç”¨ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“è¿ç§»ã€‚ åŸºäºä»¥ä¸ŠèƒŒæ™¯ï¼Œæˆ‘ä»¬åœ¨ 2022 å¹´åŸºäº SOFAArk è¿è¡Œäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ•ˆæœä¸å¤ªç†æƒ³æš‚æ—¶æç½®ã€‚ä»Šå¹´ Koupleless é‡æ–°å¼€æºååšäº†ä¸€äº›å¢å¼ºå’Œå˜æ›´ï¼Œå¼€æºç¤¾åŒºæ´»è·ƒåº¦æœ‰æ‰€æå‡ï¼Œçœ‹å®£ä¼ æ•ˆæœå¾ˆå¥½ï¼Œæˆ‘ä»¬å†³å®šé‡æ–°è¯„ä¼°æ˜¯å¦å¯åœ¨å…¬å¸å†…æ¨å¹¿ã€‚\nä»€ä¹ˆæ˜¯ Koupleless Koupleless æ˜¯ä¸€ç§æ¨¡å—åŒ– Serverless æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå®ƒèƒ½è®©æ™®é€šåº”ç”¨ä½æˆæœ¬æ¼”è¿›ä¸º Serverless ç ”å‘æ¨¡å¼ï¼Œè®©ä»£ç ä¸èµ„æºè§£è€¦ï¼Œè½»æ¾ç‹¬ç«‹ç»´æŠ¤ï¼Œ ä¸æ­¤åŒæ—¶æ”¯æŒç§’çº§æ„å»ºéƒ¨ç½²ã€åˆå¹¶éƒ¨ç½²ã€åŠ¨æ€ä¼¸ç¼©ç­‰èƒ½åŠ›ä¸ºç”¨æˆ·æä¾›æè‡´çš„ç ”å‘è¿ç»´ä½“éªŒï¼Œæœ€ç»ˆå¸®åŠ©ä¼ä¸šå®ç°é™æœ¬å¢æ•ˆã€‚\nKoupleless æ˜¯èš‚èšé›†å›¢å†…éƒ¨ç»è¿‡ 5 å¹´æ‰“ç£¨æˆç†Ÿçš„ç ”å‘æ¡†æ¶å’Œè¿ç»´è°ƒåº¦å¹³å°èƒ½åŠ›ï¼Œç›¸è¾ƒäºä¼ ç»Ÿé•œåƒåŒ–çš„åº”ç”¨æ¨¡å¼ç ”å‘ã€è¿ç»´ã€è¿è¡Œé˜¶æ®µéƒ½æœ‰ 10 å€å·¦å³çš„æå‡ï¼Œæ€»ç»“èµ·æ¥ 5 å¤§ç‰¹ç‚¹ï¼šå¿«ã€çœã€çµæ´»éƒ¨ç½²ã€å¹³æ»‘æ¼”è¿›ã€ç”Ÿäº§è§„æ¨¡åŒ–éªŒè¯ã€‚\nä»¥ä¸Šéƒ½æ˜¯å®˜ç½‘çš„å®£ä¼ ï¼Œæ›´å¤šä»‹ç»è¯·é“¾æ¥åˆ°å®˜ç½‘æŸ¥çœ‹ã€‚\nåœ¨æ•´ä¸ª Koupleless å¹³å°é‡Œï¼Œéœ€è¦å››ä¸ªç»„ä»¶ï¼š\nç ”å‘å·¥å…· Arkctl, æä¾›æ¨¡å—åˆ›å»ºã€å¿«é€Ÿè”è°ƒæµ‹è¯•ç­‰èƒ½åŠ›ã€‚ è¿è¡Œç»„ä»¶ SOFAArk, Arkletï¼Œæä¾›æ¨¡å—è¿ç»´ã€æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå¤šæ¨¡å—è¿è¡Œç¯å¢ƒã€‚ï¼ˆè¿™ç®—ä¸¤ä¸ªç»„ä»¶ï¼Ÿï¼‰ æ§åˆ¶é¢ç»„ä»¶ ModuleControllerï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª K8S Operatorï¼Œæä¾›æ¨¡å—å‘å¸ƒä¸è¿ç»´èƒ½åŠ›ã€‚ æˆ‘ä»¬å…¬å¸æœ‰è‡ªå·±çš„å‘å¸ƒç³»ç»Ÿã€åº”ç”¨ç®¡ç†å¹³å°ï¼Œå¾ˆå°‘å…è®¸è¿è¡Œé¢å¤–çš„æ§åˆ¶é¢ç»„ä»¶ï¼Œé‚£ä¹ˆé™¤å» ModuleControllerï¼Œæˆ‘ä¸ªäººè®¤ä¸ºï¼ŒKoupleless çº¦ç­‰äº SOFAArkã€‚\nKoupleless å¢å¼ºäº† SOFAArk è¿ç»´éƒ¨ç½²ç›¸å…³çš„åŠŸèƒ½ï¼Œè§£å†³äº† SOFAArk åœ¨ä¼ä¸šå†…æ— æ³•å¼€ç®±å³ç”¨çš„é—®é¢˜ã€‚\nåº”ç”¨æ¥å…¥é‡è§é—®é¢˜ åŸºäºå®˜æ–¹æ–‡æ¡£æˆ‘ä»¬æ”¹é€ æ¥å…¥äº†å‡ ä¸ªåº”ç”¨ï¼Œåˆ†äº«å‡ ä¸ªæˆ‘ä»¬é‡è§çš„é—®é¢˜ã€‚\nå¯¹ Java 17 æˆ– 21 çš„æ”¯æŒä¸å¥½ã€‚ è™½ç„¶å®˜æ–¹å·²ç»å£°ç§°æ”¯æŒ Java 17ï¼Œä½†æ˜¯è‹¥ç”¨äº† Java 17 çš„è¯­æ³•æˆ–æ–°ç‰¹æ€§ï¼Œæ— æ³•ç¼–è¯‘é€šè¿‡ã€‚æœ€ååªå¥½è‡ªç¼–è¯‘ SOFAArk plugin ä¿®æ”¹ç›¸å…³ä¾èµ–è§£å†³ã€‚\nä¸æ”¯æŒ Arm æ¶æ„ã€‚ æœ¬åœ°ä½¿ç”¨æœ€æ–° MacBook å¯åŠ¨å¤±è´¥ï¼Œå¥åº·æ£€æµ‹ç»„ä»¶ä¸æ”¯æŒ Armï¼Œå¥‡æ€ªçš„æ˜¯å®˜æ–¹æœ‰ç›¸å…³çš„ issue ä¸”å·²ç»å…³é—­ï¼Œå´å¹¶æœªå‡çº§ç›¸å…³ä¾èµ–ã€‚\nä»¥ä¸‹é”™è¯¯å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œæ ¹æ®åŸå› æ˜¯ classloader ä¾èµ–å¤±è´¥ï¼Œæ²¡æ’é™¤å¹²å‡€ï¼ŒSpring å¿…é¡»å…¨éƒ¨ç”±åŸºåº§åŠ è½½ã€‚\nCaused by: java.lang.IllegalArgumentException: class org.springframework.cloud.bootstrap.RefreshBootstrapRegistryInitializer is not assignable to interface org.springframework.boot.BootstrapRegistryInitializer at org.springframework.util.Assert.assignableCheckFailed(Assert.java:720) at org.springframework.util.Assert.isAssignable(Assert.java:651) at org.springframework.util.Assert.isAssignable(Assert.java:682) at org.springframework.boot.SpringApplication.createSpringFactoriesInstances(SpringApplication.java:444) ... 22 more Dubbo service å®ä¾‹åŒ–å¤±è´¥ï¼Œæ ¹æ®åŸå› æ˜¯ classloader ä¾èµ–å¤±è´¥ï¼Œdubbo ç”±åŸºåº§åŠ è½½ï¼Œç›¸åº”çš„ api interfaceã€model ä¹Ÿå¿…é¡»ç”±åŸºåº§åŠ è½½ã€‚Bean çš„å®ä¾‹åŒ–å’Œè°ƒç”¨å¯ä»¥æ˜¯ biz æ¨¡å—ã€‚\nCaused by: java.lang.IllegalArgumentException: interface com.api.service.EditionService is not visible from class loader at com.alibaba.dubbo.common.bytecode.Proxy.getProxy(Proxy.java:98) at com.alibaba.dubbo.common.bytecode.Proxy.getProxy(Proxy.java:67) at com.alibaba.dubbo.rpc.proxy.javassist.JavassistProxyFactory.getProxy(JavassistProxyFactory.java:35) at com.alibaba.dubbo.rpc.proxy.AbstractProxyFactory.getProxy(AbstractProxyFactory.java:49) at com.alibaba.dubbo.rpc.proxy.wrapper.StubProxyFactoryWrapper.getProxy(StubProxyFactoryWrapper.java:60) at com.alibaba.dubbo.rpc.ProxyFactory$Adpative.getProxy(ProxyFactory$Adpative.java) Biz æ¨¡å—æŸäº› ClassNotFoundExceptionï¼Œæ’é™¤çš„å¤ªå¤šäº†ï¼ŒexcludeGroupIds=org.apache æŠŠ apache å…¨éƒ¨äº¤ç»™åŸºåº§äº†ï¼Œä½†æ˜¯åŸºåº§å¹¶æ²¡æœ‰ http-clientã€‚ä¾èµ–åŒ…ç®¡ç†æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„äº‹æƒ…ï¼Œå¤šäº†ä¹Ÿä¸è¡Œï¼Œå°‘äº†ä¹Ÿä¸è¡Œï¼Œæœ‰äº›æ˜¯å¯åŠ¨æŠ¥é”™ï¼Œæœ‰äº›æ˜¯è¿è¡ŒæœŸæŠ¥é”™ã€‚\nCaused by: java.lang.IllegalStateException: Failed to introspect Class [org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientConfigurations$RestClientBuilderConfiguration] Caused by: java.lang.ClassNotFoundException: org.apache.http.impl.nio.client.HttpAsyncClientBuilder at java.base/java.net.URLClassLoader.findClass(URLClassLoader.java:445) at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:593) at org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:151) at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:526) ... 52 more Spring Boot AutoConfiguration é—®é¢˜ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼Œä½†æ˜¯æ’é™¤ AutoConfiguration åï¼Œæœ¬åœ° IDEA å¯åŠ¨è”è°ƒå¿…é¡»ä¾èµ–åŸºåº§ã€‚\nåŸºåº§åªæ˜¯åŠ è½½ jar classï¼Œæ¨¡å—è´Ÿè´£å®ä¾‹åŒ– Beanï¼ŒåŸºåº§éœ€è¦æ’é™¤ AutoConfigurationã€‚ åŸºåº§å³åŠ è½½ jar åˆå®ä¾‹åŒ– Beanï¼Œæ¨¡å—å¤ç”¨ Beanï¼Œæ¨¡å—éœ€è¦æ’é™¤ AutoConfigurationã€‚ åŸºåº§åŠ è½½ jarï¼Œæ¨¡å—ä¸éœ€è¦å®ä¾‹åŒ– Beanï¼Œè¯¯è§¦å‘å®ä¾‹åŒ–ï¼Œå¸¸è§äº@ConditionalOnClassã€‚ ä¸æ”¯æŒ spring-boot-devtoolsï¼Œä»–æœ‰ç‹¬ç«‹çš„ RestartClassLoaderï¼ŒåŒç†å¦‚æœå…¶ä»–å¼€æºç»„ä»¶æœ‰ç‹¬ç«‹ ClassLoader ä¹Ÿå¯èƒ½æœ‰é—®é¢˜ï¼Œéœ€è¦ä»”ç»†è¯„ä¼°ã€‚\nä¸æ”¯æŒ spring-boot-actuator ä½¿ç”¨ç‹¬ç«‹ç«¯å£ã€‚\næ€»ç»“ æ”¶ç›Šï¼š\nå†…å­˜å ç”¨æœ‰æ˜æ˜¾é™ä½ï¼Œå¦‚æœå†ç»“åˆ staticã€service å…±äº«ï¼ŒæŠŠ i18nã€xxxCacheã€xxxUtilsã€xxxService æ²‰æ·€åˆ°åº•åº§ï¼Œèƒ½å¤§å¹…é™ä½èµ„æºå ç”¨ã€‚ é€šç”¨ Beanï¼Œç”šè‡³ redisã€kafka ç­‰è¿æ¥ï¼Œä¹Ÿå¯ç”±åŸºåº§å®ä¾‹åŒ–ï¼Œåªå®ä¾‹åŒ–ä¸€æ¬¡ï¼Œé™ä½èµ„æºï¼ŒåŒæ—¶å¯åŠ¨é€Ÿåº¦åŠ å€ã€‚ é€šç”¨åŠŸèƒ½åŸºåº§å¼€å‘ï¼ŒåŸºåº§èƒ½åŠ›è¶Šå¼ºï¼Œä¸Šå±‚ biz å¼€å‘æ•ˆç‡è¶Šé«˜ï¼Œå¯æé«˜ç ”å‘æ•ˆç‡ã€‚ æŒ‘æˆ˜ï¼š\næ–‡æ¡£ä¸å‹å¥½ï¼ŒåŠŸèƒ½è¿˜å¤„äº Beta ç‰ˆæœ¬ï¼Œä¸ç®¡æ˜¯ Koupleless è¿˜æ˜¯ SOFAArkã€‚å¦‚æœæƒ³çœŸæ­£è·‘èµ·æ¥ï¼Œéœ€è¦ä»”ç»†å»çœ‹æºç å’Œæºç è§£æçš„åšå®¢ï¼Œè€Œåšå®¢å¾ˆå¤šå·²ç»è¿‡æ—¶äº†ä¼šæŠŠä½ å¸¦è¿›å‘å»ã€‚å½“ç„¶å¦‚ä½•èƒ½è·å¾—å®˜æ–¹å›¢é˜Ÿæ”¯æŒï¼Œå°±å¦è¯´äº†ã€‚ å…³äºåŸºåº§å’Œ Biz æ¨¡å— static å˜é‡çš„é—®é¢˜ï¼Œä½ æƒ³å…±äº«çš„æ—¶å€™ï¼Œæ˜¯å¥½ä¸œè¥¿ï¼Œä½ ä¸æƒ³å…±äº«çš„æ—¶å€™ï¼Œå°±éœ€è¦ææ˜ç™½è¿™ä¸ªå˜é‡å…±äº«äº†å—ï¼Œè°åŠ è½½çš„ï¼Œå½±å“èŒƒå›´æ˜¯å“ªäº›ï¼Œå¦‚ä½•åšåˆ°ä¸å…±äº«ã€‚ç›®å‰æ²¡æƒ³åˆ°å¦‚ä½•è¯„ä¼° static çš„å½±å“èŒƒå›´ï¼Œåªèƒ½ case by case ç¿»æºç ã€‚ åŸºåº§å’Œ Biz æ¨¡å—ç£¨åˆï¼Œå“ªäº› jar äº¤ç»™åŸºåº§ï¼Œå“ªäº› Bean äº¤ç»™åŸºåº§ï¼Œéƒ½éœ€è¦æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œæ—¢ä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ï¼Œå¦åˆ™å¯èƒ½å¯åŠ¨å¤±è´¥ï¼Œå¯èƒ½è¿è¡ŒæœŸå¤±è´¥ã€‚èŠ±è´¹å¤§é‡çš„æ—¶å€™ç»´æŠ¤ pom.xmlï¼Œéœ€è¦æœ‰äººå¾ˆç†Ÿæ‚‰ pom ä¾èµ–ã€‚ classloader æ¨¡å‹å˜æ›´ï¼Œä»»ä½•æœ‰è‡ªå®šä¹‰ classloader çš„åœ°æ–¹éƒ½éœ€è¦é‡æ–°è¯„ä¼°ï¼Œå¯èƒ½éœ€è¦å˜æ›´ä»£ç ã€‚ å…³äº 2ã€3ã€4ï¼Œç†è§£äº† Koupleless åŸç†å°±èƒ½ç†è§£è¿™å‡ ä¸ªé—®é¢˜äº†ï¼Œæ¯ä¸€ä¸ªéƒ½å¯èƒ½è®©ä½ çš„åº”ç”¨è¿ç§»äº§ç”Ÿæ„æƒ³ä¸åˆ°çš„æ•ˆæœï¼Œéœ€è¦ä»”ç»†è¯„ä¼°ã€‚\nå¦‚æœä½ æ˜¯æ–°é¡¹ç›®ä¸”è¿«åˆ‡éœ€è¦ Koupleless çš„åŠŸèƒ½ï¼Œä¸å¦¨ä¸€è¯•ã€‚æœ€åç¥ Koupleless å‘å±•è¶Šæ¥è¶Šå¥½ï¼Œå¦‚æœ‰å…´è¶£å¯ä»¥å»å¼€æºç¤¾åŒºå»ºè®¾ã€‚\n","date":"2024-05-27","id":15,"permalink":"/blog/koupleless-first-boot/","summary":"\u003cp\u003eæˆ‘ä»¬å…¬å¸çš„ä¸»è¦åº”ç”¨éƒ½æ˜¯ä»¥ Java ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œè¿™å‡ å¹´éšç€ä¸šåŠ¡çš„é«˜é€Ÿå¢é•¿ï¼Œåº”ç”¨æ•°ç›®è¶Šæ¥è¶Šå¤šï¼ŒCPU å†…å­˜èµ„æºå ç”¨è¶Šæ¥è¶Šå¤šï¼Œé¡¹ç›®ç»„ä¹‹é—´å¼€å‘åˆä½œæ•ˆç‡ä¹Ÿè¶Šæ¥è¶Šä½ã€‚\u003c/p\u003e\n\u003cp\u003eé¡ºåº”è¿™ä¸ªæ—¶ä»£é™æœ¬å¢æ•ˆçš„ç›®çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªèƒ½è§£å†³å½“å‰å‡ ä¸ªæ ¸å¿ƒé—®é¢˜çš„æ¡†æ¶ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ¨¡å—åŒ–å¼€å‘ã€éƒ¨ç½²ã€èµ„æºå…±äº«çš„èƒ½åŠ›ï¼Œå‡å°‘ Cacheã€Class ç­‰èµ„æºå ç”¨ï¼Œæœ‰æ•ˆé™ä½å†…å­˜å ç”¨ã€‚\u003c/li\u003e\n\u003cli\u003eæ›´å¿«æ›´è½»çš„ä¾èµ–ï¼Œåº”ç”¨èƒ½å¤Ÿæ›´å¿«çš„å¯åŠ¨ã€‚\u003c/li\u003e\n\u003cli\u003eèƒ½å¤Ÿè®©å„ä¸ªé¡¹ç›®ç»„ä¸æ”¹ä»£ç æˆ–å°‘æ”¹ä»£ç å³å¯æ¥å…¥ï¼Œæ§åˆ¶å¼€å‘è¿ç§»çš„æˆæœ¬ï¼Œæ¯•ç«Ÿå¾ˆå¤šå†å²è€åº”ç”¨ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“è¿ç§»ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåŸºäºä»¥ä¸ŠèƒŒæ™¯ï¼Œæˆ‘ä»¬åœ¨ 2022 å¹´åŸºäº SOFAArk è¿è¡Œäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ•ˆæœä¸å¤ªç†æƒ³æš‚æ—¶æç½®ã€‚ä»Šå¹´ Koupleless é‡æ–°å¼€æºååšäº†ä¸€äº›å¢å¼ºå’Œå˜æ›´ï¼Œå¼€æºç¤¾åŒºæ´»è·ƒåº¦æœ‰æ‰€æå‡ï¼Œçœ‹å®£ä¼ æ•ˆæœå¾ˆå¥½ï¼Œæˆ‘ä»¬å†³å®šé‡æ–°è¯„ä¼°æ˜¯å¦å¯åœ¨å…¬å¸å†…æ¨å¹¿ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä»€ä¹ˆæ˜¯-koupleless\"\u003eä»€ä¹ˆæ˜¯ Koupleless\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://koupleless.io/home/\" target=\"_blank\" rel=\"noopener\"\u003eKoupleless\u003c/a\u003e\n æ˜¯ä¸€ç§æ¨¡å—åŒ– Serverless æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå®ƒèƒ½è®©æ™®é€šåº”ç”¨ä½æˆæœ¬æ¼”è¿›ä¸º Serverless ç ”å‘æ¨¡å¼ï¼Œè®©ä»£ç ä¸èµ„æºè§£è€¦ï¼Œè½»æ¾ç‹¬ç«‹ç»´æŠ¤ï¼Œ ä¸æ­¤åŒæ—¶æ”¯æŒç§’çº§æ„å»ºéƒ¨ç½²ã€åˆå¹¶éƒ¨ç½²ã€åŠ¨æ€ä¼¸ç¼©ç­‰èƒ½åŠ›ä¸ºç”¨æˆ·æä¾›æè‡´çš„ç ”å‘è¿ç»´ä½“éªŒï¼Œæœ€ç»ˆå¸®åŠ©ä¼ä¸šå®ç°é™æœ¬å¢æ•ˆã€‚\u003c/p\u003e\n\u003cp\u003eKoupleless æ˜¯èš‚èšé›†å›¢å†…éƒ¨ç»è¿‡ 5 å¹´æ‰“ç£¨æˆç†Ÿçš„ç ”å‘æ¡†æ¶å’Œè¿ç»´è°ƒåº¦å¹³å°èƒ½åŠ›ï¼Œç›¸è¾ƒäºä¼ ç»Ÿé•œåƒåŒ–çš„åº”ç”¨æ¨¡å¼ç ”å‘ã€è¿ç»´ã€è¿è¡Œé˜¶æ®µéƒ½æœ‰ 10 å€å·¦å³çš„æå‡ï¼Œæ€»ç»“èµ·æ¥ 5 å¤§ç‰¹ç‚¹ï¼šå¿«ã€çœã€çµæ´»éƒ¨ç½²ã€å¹³æ»‘æ¼”è¿›ã€ç”Ÿäº§è§„æ¨¡åŒ–éªŒè¯ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸Šéƒ½æ˜¯å®˜ç½‘çš„å®£ä¼ ï¼Œæ›´å¤šä»‹ç»è¯·é“¾æ¥åˆ°å®˜ç½‘æŸ¥çœ‹ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æ•´ä¸ª Koupleless å¹³å°é‡Œï¼Œéœ€è¦å››ä¸ªç»„ä»¶ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç ”å‘å·¥å…· Arkctl, æä¾›æ¨¡å—åˆ›å»ºã€å¿«é€Ÿè”è°ƒæµ‹è¯•ç­‰èƒ½åŠ›ã€‚\u003c/li\u003e\n\u003cli\u003eè¿è¡Œç»„ä»¶ SOFAArk, Arkletï¼Œæä¾›æ¨¡å—è¿ç»´ã€æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå¤šæ¨¡å—è¿è¡Œç¯å¢ƒã€‚ï¼ˆè¿™ç®—ä¸¤ä¸ªç»„ä»¶ï¼Ÿï¼‰\u003c/li\u003e\n\u003cli\u003eæ§åˆ¶é¢ç»„ä»¶ ModuleControllerï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª K8S Operatorï¼Œæä¾›æ¨¡å—å‘å¸ƒä¸è¿ç»´èƒ½åŠ›ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæˆ‘ä»¬å…¬å¸æœ‰è‡ªå·±çš„å‘å¸ƒç³»ç»Ÿã€åº”ç”¨ç®¡ç†å¹³å°ï¼Œå¾ˆå°‘å…è®¸è¿è¡Œé¢å¤–çš„æ§åˆ¶é¢ç»„ä»¶ï¼Œé‚£ä¹ˆé™¤å» ModuleControllerï¼Œæˆ‘ä¸ªäººè®¤ä¸ºï¼ŒKoupleless çº¦ç­‰äº SOFAArkã€‚\u003c/p\u003e\n\u003cp\u003eKoupleless å¢å¼ºäº† SOFAArk è¿ç»´éƒ¨ç½²ç›¸å…³çš„åŠŸèƒ½ï¼Œè§£å†³äº† SOFAArk åœ¨ä¼ä¸šå†…æ— æ³•å¼€ç®±å³ç”¨çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003ch2 id=\"åº”ç”¨æ¥å…¥é‡è§é—®é¢˜\"\u003eåº”ç”¨æ¥å…¥é‡è§é—®é¢˜\u003c/h2\u003e\n\u003cp\u003eåŸºäºå®˜æ–¹æ–‡æ¡£æˆ‘ä»¬æ”¹é€ æ¥å…¥äº†å‡ ä¸ªåº”ç”¨ï¼Œåˆ†äº«å‡ ä¸ªæˆ‘ä»¬é‡è§çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eå¯¹ Java 17 æˆ– 21 çš„æ”¯æŒä¸å¥½ã€‚\nè™½ç„¶å®˜æ–¹å·²ç»å£°ç§°æ”¯æŒ Java 17ï¼Œä½†æ˜¯è‹¥ç”¨äº† Java 17 çš„è¯­æ³•æˆ–æ–°ç‰¹æ€§ï¼Œæ— æ³•ç¼–è¯‘é€šè¿‡ã€‚æœ€ååªå¥½è‡ªç¼–è¯‘ SOFAArk plugin ä¿®æ”¹ç›¸å…³ä¾èµ–è§£å†³ã€‚\u003c/p\u003e","tags":["Java"],"title":"Koupleless è¯•ç”¨æŠ¥å‘Šæ€»ç»“ï¼Œè¸©å‘è®°å½•åˆ†äº«"},{"content":"æ±‡æ€»æ•´ç†äº†å®¹å™¨é•œåƒåˆ¶ä½œæœ€ä½³å®è·µã€å¤šæ¶æ„ç¼–è¯‘ã€Dockerfile ç¼–å†™å°æŠ€å·§ç­‰å¸¸ç”¨æŠ€æœ¯é—®é¢˜ï¼ŒåŒæ—¶ä»‹ç»ä¸‹æˆ‘æ—¥å¸¸ä½¿ç”¨çš„ ORASã€skopeo ç­‰è¾…åŠ©å·¥å…·ã€‚\næœ€ä½³å®è·µ æ•´ç†äº†ç”± Docker å®˜æ–¹å’Œç¤¾åŒºæ¨èçš„ç”¨äºæ„å»ºé«˜æ•ˆé•œåƒçš„æœ€ä½³å®è·µå’Œæ–¹æ³•ï¼Œå½“ç„¶æœ‰äº›å¯èƒ½å¹¶ä¸é€‚ç”¨äºä½ ï¼Œè¯·æ³¨æ„åˆ†è¾¨ã€‚\nä½¿ç”¨å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€é•œåƒã€‚å®˜æ–¹é•œåƒç»è¿‡äº†å……åˆ†éªŒè¯å¹¶é›†æˆäº†æœ€ä½³å®è·µã€‚\n# æ­£ä¾‹ï¼š FROM node # åä¾‹ï¼š FROM ubuntu RUN apt-get install -y node\rä¿æŒå°½å¯èƒ½å°çš„é•œåƒå¤§å°ï¼Œç»ä¸å®‰è£…æ— å…³ä¾èµ–ã€‚\nä¸¥æ ¼çš„ç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œä½¿ç”¨ç¡®å®šæ€§çš„æ ‡ç­¾ï¼ŒåŸºç¡€é•œåƒç¦ç”¨ latestã€‚\nä½¿ç”¨ .dockerignore æ–‡ä»¶æ’é™¤æ–‡ä»¶å¹²æ‰°ã€‚\næœ€ç»å¸¸å˜åŒ–çš„å‘½ä»¤è¶Šå¾€åæ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨åˆ†å±‚ç¼“å­˜æœºåˆ¶ã€‚\nDockerfile ä¸­æ¯è¡Œå‘½ä»¤äº§ç”Ÿä¸€å±‚ï¼Œè¯·åˆå¹¶å‘½ä»¤æ‰§è¡Œï¼Œæœ€å¤§é™åº¦å‡å°‘å±‚æ•°ã€‚\nä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œå‡å°‘æ‰€æ„å»ºé•œåƒçš„å¤§å°ã€‚\nç¦ç”¨ root ç”¨æˆ·ï¼Œä½¿ç”¨ç‹¬ç«‹çš„ use å’Œ groupã€‚\nå¯ç”¨é•œåƒå®‰å…¨æ‰«æï¼Œå¹¶åŠæ—¶æ›´æ–°ã€‚\nä¸€ä¸ªå®¹å™¨åªä¸“æ³¨åšä¸€ä»¶äº‹æƒ…ã€‚\nJava åº”ç”¨ç¨‹åºä¸è¦ä½¿ç”¨ PID ä¸º 1 çš„è¿›ç¨‹ï¼Œä½¿ç”¨ tini æˆ– dump-init ç®¡ç†è¿›ç¨‹ï¼Œé¿å…åƒµå°¸è¿›ç¨‹ã€‚\nä»¥ä¸Šéƒ½æ˜¯ä¸€äº›åŸºæœ¬çš„åŸåˆ™ï¼Œä½†æ˜¯å®é™…å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶å¯èƒ½ä¼šåƒæˆ‘ä¸€æ ·çº ç»“å‡ ä¸ªé—®é¢˜ã€‚\nå…³äºç¬¬ 1 ç‚¹ï¼Œä¸€å®šè¦ä½¿ç”¨å®˜æ–¹é•œåƒå—ã€‚æœªå¿…ï¼Œçœ‹æƒ…å†µã€‚æ¯”å¦‚æˆ‘ä»¬ä½œä¸ºå¹³å°ï¼Œæ¶‰åŠå¾ˆå¤šç§å¼€å‘è¯­è¨€ï¼Œå¾ˆå¤šç§ç»„åˆåœºæ™¯ï¼Œæ¯ä¸ªå®˜æ–¹åŸºç¡€é•œåƒå¯èƒ½éƒ½ä¸åŒï¼Œå°±ä¼šè‡ªå»ºåŸºç¡€é•œåƒï¼Œä»¥ä¾¿ç»Ÿä¸€æ“ä½œç³»ç»Ÿã€ç»Ÿä¸€è„šæœ¬å’Œå®‰å…¨ç»´æŠ¤ã€‚ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»ŸæŠ•çš„æ¯’ï¼Œå°±åƒå‡ºéª¨é±¼ç‰‡é‡Œæœªå‡€çš„åˆºï¼Œç»™äººä¸€ç§ä¸æœŸå¾…çš„ä¼¤ç—›ã€‚ ä¸ºäº†é•œåƒå¤§å°å’Œå®‰å…¨ï¼Œä¸€å®šè¦ä½¿ç”¨ Alpine æˆ– distroless é•œåƒå—ã€‚æˆ‘çš„å»ºè®®æ˜¯ä¸è¦ä½¿ç”¨ Alpine é•œåƒï¼Œå¦‚æœ‰èƒ½åŠ›æ‰ä½¿ç”¨ distroless é•œåƒã€‚æ¯•ç«Ÿ libc çš„å‘ï¼Œè°ç—›è°çŸ¥é“ã€‚ Dockerfile ç¼–å†™å°æŠ€å·§ ä½¿ç”¨ Heredocs è¯­æ³•ä»£æ›¿åˆé•¿åˆè‡­çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå½“ç„¶ Heredocs æ”¯æŒæ›´å¤šåŠŸèƒ½æ¯”å¦‚ run pythonã€å¤šæ–‡ä»¶å†…å®¹æ‹·è´ï¼Œå…·ä½“è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\n# ä»¥å‰ RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade -y \u0026amp;\u0026amp; \\ apt-get install -y ... # ä½¿ç”¨ Heredocs RUN \u0026lt;\u0026lt;EOF apt-get update apt-get upgrade -y apt-get install -y ... EOF # å•æ–‡ä»¶å†…å®¹æ‹·è´ï¼Œç›´æ¥ç”Ÿæˆæ–‡ä»¶å†…å®¹åˆ°ç›®æ ‡æ–‡ä»¶ COPY \u0026lt;\u0026lt;EOF /usr/share/nginx/html/index.html (your index page goes here) EOF # å¤šæ–‡ä»¶å†…å®¹æ‹·è´ï¼Œæ¯ä¸ªæ–‡ä»¶æŒ‡å®šä¸åŒçš„æ–‡ä»¶å†…å®¹ COPY \u0026lt;\u0026lt;robots.txt \u0026lt;\u0026lt;humans.txt /usr/share/nginx/html/ (robots content) robots.txt (humans content) humans.txt\rä½¿ç”¨ ARG å˜é‡åŠ¨æ€æ„å»ºï¼Œæ³¨æ„ ARG ä½œç”¨åŸŸã€‚\n# ARG å¯å†™é»˜è®¤å€¼ï¼Œä¹Ÿå¯ä¸å†™ ARG TOMCAT_TAG=9.0.93-jre21 # æŠŠ ARG æ”¾åˆ° FROM çš„å‰é¢ï¼ŒFROM æŒ‡ä»¤å³å¯ä½¿ç”¨å˜é‡ FROM docker.io/tomcat:${TOMCAT_TAG} # æƒ³åœ¨ FROM åé¢ç»§ç»­ä½¿ç”¨ ARGï¼Œéœ€åœ¨ FROM åå†å£°æ˜ä¸€æ¬¡ ARG TOMCAT_TAG=9.0.93-jre21 RUN echo \u0026#34;Tomcat tag is ${TOMCAT_TAG}\u0026#34; # ARG ä½œç”¨åŸŸï¼š # 1. åœ¨ç¬¬ä¸€ä¸ª FROM ä¹‹å‰çš„æ‰€æœ‰ ARG , åœ¨æ‰€æœ‰ FROM ä¸­ç”Ÿæ•ˆï¼Œä»…åœ¨ FROM ä¸­ç”Ÿæ•ˆã€‚ # 2. åœ¨ FROM åçš„ ARG, ä»…åœ¨å½“å‰ FROM ä½œç”¨åŸŸç”Ÿæ•ˆã€‚ å³å°½åœ¨å½“å‰ stage ç”Ÿæ•ˆã€‚\rä½¿ç”¨ COPY --from ä»£æ›¿ curl æˆ– wget é™æ€æ–‡ä»¶ä¸‹è½½ï¼Œé€‚ç”¨äºä¸€äº› COPY å³å¯ç”¨çš„æ–‡ä»¶ã€‚\n# å» github.com releases ä¸‹è½½æ–‡ä»¶å¯èƒ½å¾ˆæ…¢ï¼Œæœ‰äº›ç»„ä»¶æœ¬èº«æœ‰ docker ç‰ˆæœ¬ï¼ŒCOPY æ¥ç”¨ ARG JMX_VER=1.0.1 FROM docker.io/nxest/tomcat-jmx-agent:${JMX_VER} AS tomcat-jmx-agent COPY --from=tomcat-jmx-agent /plugins /opt/tomcat/plugins\ræ ¡éªŒ curl ç»“æœï¼Œå¦‚æœå¤±è´¥é€€å‡ºã€‚\n# å…³äº -jkfSL è¯·å‚è€ƒ man è¯´æ˜ curl -jkfSL -o vmtouch.zip \u0026#39;https://github.com/hoytech/vmtouch/archive/refs/tags/v1.3.1.zip\u0026#39;\rå˜é‡æ‰©å±•ï¼Œç®€åŒ– Shell ä¹¦å†™ã€‚\n${variable:-word}ï¼šå¦‚æœå˜é‡æœªè®¾ç½®ï¼Œåˆ™å°†å€¼è®¾ç½®ä¸º word ${variable:+word}ï¼šå¦‚æœå˜é‡å·²è®¾ç½®ï¼Œåˆ™å°†å€¼è®¾ç½®ä¸º word ${var1:-$var2}: å¦‚æœ var1 æœªè®¾ç½®åˆ™å– var1\ré€šè¿‡ \u0026ndash;build-arg æŒ‡å®š Http ä»£ç†ï¼Œæ³¨æ„ä¸è¦åœ¨ Dockerfile é‡Œé€šè¿‡ ENV æŒ‡å®šï¼ŒENV æŒ‡å®šä¸å®‰å…¨ä¸”å¯¹åç»­éƒ¨ç½²å‡ºæ¥çš„ Pod ä¹Ÿç”Ÿæ•ˆã€‚\ndocker buildx build --build-arg http_proxy=http://your-proxy --build-arg https_proxy=http://your-proxy --build-arg no_proxy=localhost,127.0.0.1,10.*,172.*,*.cn\rå¤šæ¶æ„ç¼–è¯‘ å¤šæ¶æ„ç¼–è¯‘ç›®å‰æ¯”è¾ƒæµè¡Œçš„å‡ ç§æ–¹æ¡ˆï¼š\ndocker é…åˆ qemu å®ç°äº¤å‰æ··åˆç¼–è¯‘ï¼Œä¸€å°æœºå™¨å³å¯ã€‚ä¼˜ç‚¹ï¼šç®€å•ã€‚ç¼ºç‚¹ï¼šå¼‚æ„ç¼–è¯‘é€Ÿåº¦å¾ˆæ…¢ã€‚ docker ä½¿ç”¨è¿œç«¯ builderï¼Œå¤šä¸ª builder æœºå™¨ï¼Œå„è‡ªç¼–è¯‘å„è‡ªåŸç”Ÿæ¶æ„ï¼Œdocker ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆå¹¶ manifestã€‚ç›¸å¯¹ç®€å•ï¼Œé€Ÿåº¦å¿«ã€‚ ä½¿ç”¨ buildkit æˆ– GoogleContainerTools/kaniko åœ¨ k8s é›†ç¾¤å†…ç¼–è¯‘ã€‚é€Ÿåº¦æœ€å¿«ï¼Œæ°´å¹³æ‰©ç¼©å®¹ï¼Œé€‚ç”¨äºå¤§å‹ç¼–è¯‘åœºæ™¯ï¼Œéœ€è¦å‡†å¤‡æ›´å¤šèµ„æºã€‚ å¦‚æœä½ æœ¬èº«å…·å¤‡å¤šæ¶æ„çš„æœºå™¨èµ„æºï¼Œä½¿ç”¨ docker è¿œç«¯ builder æˆ– kaniko åŒæ¶æ„ç¼–è¯‘ï¼Œé€Ÿåº¦å’Œæ€§èƒ½æ˜¯æœ€ç†æƒ³çš„ã€‚\né«˜åº¦ä¾èµ–æŒ‡ä»¤é›†çš„åº”ç”¨ï¼Œæ¯”å¦‚æŸäº›è€ python åŒ…æ—  arm ç‰ˆæœ¬è§¦å‘ç¼–è¯‘ï¼Œè·¨æ¶æ„ç¼–è¯‘å¯èƒ½éœ€è¦ 3 å°æ—¶ï¼Œè€ŒåŒæ¶æ„åªéœ€è¦ 10 åˆ†é’Ÿã€‚\nkaniko æ”¯æŒâ€œå¤šæ¶æ„ç¼–è¯‘â€ï¼Œä½†æ˜¯ä¸æ”¯æŒè·¨æ¶æ„ç¼–è¯‘ï¼Œä¸èƒ½åœ¨ amd64 æœºå™¨ä¸Šç¼–è¯‘ arm64 å®¹å™¨ï¼Œå¦‚æœéœ€è¦å¤šæ¶æ„åªèƒ½åœ¨ä¸åŒæœºå™¨ä¸Šå¤šæ¬¡ç¼–è¯‘ï¼Œç„¶åä½¿ç”¨ manifest-tool åˆå¹¶ã€‚\næ–¹å¼ 1ï¼šä¸ºä¸€å° docker æœºå™¨å¯ç”¨å¤šæ¶æ„ç¼–è¯‘ï¼š\n# åˆ›å»ºæ–°çš„ buildï¼Œæ”¯æŒå¤šæ¶æ„ï¼Œç›´æ¥ use ç”Ÿæ•ˆï¼Œå…³äº --driver ç±»å‹è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ docker buildx create --name=multi-platform --platform=linux/amd64,linux/arm64 --driver=docker-container --use --bootstrap # æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆï¼Œæ˜Ÿå·çš„ä»£è¡¨å½“å‰ç”Ÿæ•ˆçš„ docker buildx ls # æŒ‡å®š platformï¼Œbuild and push docker buildx build --platform linux/amd64,linux/arm64 --push --tag tester:1.0 # åˆ‡æ¢å…¶ä»–æ„å»ºå™¨ docker buildx use multi-platform # ä½¿ç”¨ buildx æä¾›çš„ imagetools inspect å·¥å…·å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¸­çš„æ¸…å•åˆ—è¡¨ä¿¡æ¯ docker buildx imagetools inspect tester:1.0\ræ–¹å¼ 2ï¼šç»„åˆä¸€å° AMD64ã€ä¸€å° ARM64 æœºå™¨ï¼Œå¤šèŠ‚ç‚¹å„è‡ªç¼–è¯‘ã€‚\næ”¾å¼€ docker çš„ tcp ç«¯å£ï¼Œæ³¨æ„ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸€å®šè¦å¯ç”¨ TLS è®¤è¯ï¼Œæ”¾å¼€ç«¯å£æ˜¯ä¸€ä»¶å¾ˆå±é™©çš„äº‹æƒ…ã€‚\n$ cat /etc/docker/daemon.json { \u0026#34;hosts\u0026#34;: [\u0026#34;unix:///var/run/docker.sock\u0026#34;, \u0026#34;tcp://0.0.0.0:2375\u0026#34;] } # åˆ›å»ºä¸€ä¸ªæ–°çš„ builderï¼ŒæŒ‡å®šæ”¯æŒçš„æ¶æ„ç±»å‹ docker buildx create --name multi-remote --node node-amd64 --platform linux/amd64 # ä½¿ç”¨ --appendï¼Œè¿½åŠ èŠ‚ç‚¹ï¼ŒæŒ‡å®šæ”¯æŒçš„æ¶æ„ç±»å‹ã€‚é™¤äº†ä½¿ç”¨ tcp æ–¹å¼ï¼Œä¹Ÿå¯ä½¿ç”¨ ssh æ–¹å¼ï¼Œssh éœ€è¦é…ç½®å…å¯†ç™»å½• docker buildx create --name multi-remote --append \\ --node node-arm64 --platform linux/arm64,linux/arm64/v8,linux/arm/v7 \\ tcp://your-arm64-node-ip:2375 # åˆ‡æ¢ï¼Œå¯ç”¨ docker buildx use multi-remote docker buildx inspect --bootstrap\ræŸ¥çœ‹ buildxï¼Œç¡®è®¤æ˜¯å¦ç”Ÿæ•ˆã€‚\n$ docker buildx ls NAME/NODE DRIVER/ENDPOINT STATUS BUILDKIT PLATFORMS builder docker-container \\_ builder0 \\_ unix:///var/run/docker.sock inactive multi-container* docker-container \\_ multi-container0 \\_ unix:///var/run/docker.sock running v0.16.0 linux/amd64*, linux/arm64*, linux/amd64/v2, linux/amd64/v3, linux/386, linux/riscv64, linux/ppc64le, linux/s390x, linux/mips64le, linux/mips64, linux/arm/v7, linux/arm/v6 multi-remote docker-container \\_ node-amd64 \\_ unix:///var/run/docker.sock inactive linux/amd64* \\_ node-arm64 \\_ tcp://192.168.100.200:2375 inactive linux/arm64*, linux/arm/v7* default docker \\_ default \\_ default running v0.13.2 linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/386 åœ¨ Dockerfile ä¸­åˆ¤æ–­æ¶æ„ï¼Œæ”¯æŒå¦‚ä¸‹æ¶æ„ç›¸å…³çš„å˜é‡ã€‚\nTARGETPLATFORM: æ„å»ºé•œåƒçš„ç›®æ ‡å¹³å°ï¼Œä¾‹å¦‚ linux/amd64, linux/arm/v7, windows/amd64ã€‚ TARGETOS: TARGETPLATFORM çš„ OS ç±»å‹ï¼Œä¾‹å¦‚ linux, windowsã€‚ TARGETARCH: TARGETPLATFORM çš„æ¶æ„ç±»å‹ï¼Œä¾‹å¦‚ amd64, arm64ã€‚ TARGETVARIANT: TARGETPLATFORM çš„å˜ç§ï¼Œè¯¥å˜é‡å¯èƒ½ä¸ºç©ºï¼Œä¾‹å¦‚ v7ã€‚ BUILDPLATFORM: æ„å»ºé•œåƒä¸»æœºå¹³å°ï¼Œä¾‹å¦‚ linux/amd64ã€‚ BUILDOS: BUILDPLATFORM çš„ OS ç±»å‹ï¼Œä¾‹å¦‚ linuxã€‚ BUILDARCH: BUILDPLATFORM çš„æ¶æ„ç±»å‹ï¼Œä¾‹å¦‚ amd64ã€‚ BUILDVARIANT: BUILDPLATFORM çš„å˜ç§ï¼Œè¯¥å˜é‡å¯èƒ½ä¸ºç©ºï¼Œä¾‹å¦‚ v7ã€‚ ä»£ç ä¸­åˆ¤æ–­æ¶æ„ä¸¾ä¾‹ã€‚\nFROM alpine:3.20 # éœ€è¦å…ˆå£°æ˜ ARG æ‰å¯ä½¿ç”¨ï¼Œ ä½†ä¸éœ€è¦ä¸»åŠ¨èµ‹å€¼ï¼Œdocker ä¼šè‡ªåŠ¨èµ‹å€¼ ARG TARGETARCH RUN \u0026lt;\u0026lt;EOF set -e if [ \u0026#34;${TARGETARCH}\u0026#34; = \u0026#34;amd64\u0026#34; ]; then echo \u0026#34;this is amd64\u0026#34; elif [ \u0026#34;${TARGETARCH}\u0026#34; = \u0026#34;arm64\u0026#34; ]; then echo \u0026#34;this is arm64\u0026#34; fi EOF\råœ¨ FROM ä¸­å¼ºåˆ¶åˆ‡æ¢æ¶æ„ï¼Œä½¿ç”¨ç‰¹å®šå¹³å°çš„åŸºç¡€é•œåƒã€‚\n# ä½¿ç”¨ç‰¹å®šå¹³å°çš„åŸºç¡€é•œåƒ FROM --platform=linux/amd64 ubuntu:20.04 FROM --platform=$TARGETPLATFORM ubuntu:20.04 # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„æŒ‡ä»¤ RUN apt-get update \u0026amp;\u0026amp; apt-get install -y curl\rè¾…åŠ©å·¥å…· hadolint hadolint æ˜¯ä¸€ä¸ª Dockerfile è¯­æ³•æ£€æµ‹å·¥å…·ï¼Œæ ¹æ®æœ€è¿‘å®è·µæ£€æµ‹è¯­æ³•ç»™å‡ºä¿®æ”¹æ–¹å¼ã€‚\nå¯ä»¥ç”¨å‘½ä»¤è¡Œæ‰§è¡Œï¼Œå¯ä»¥ Docker é•œåƒæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Online åœ¨çº¿åˆ†æ ã€‚\nskopeo skopeo æ˜¯ä¸€ä¸ªé•œåƒæ¬è¿å·¥å…·ã€‚\nä¸éœ€è¦è¿è¡Œå®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºå¯¹å®¹å™¨é•œåƒä¸å®¹å™¨ä»“åº“æ‰§è¡Œç®¡ç†æ“ä½œçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒ OCI é•œåƒä¸ Docker V2 é•œåƒã€‚\nå¯ä»¥æ‰§è¡Œçš„å…¸å‹æ“ä½œåœºæ™¯ï¼š\né€šè¿‡å„ç§å­˜å‚¨æœºåˆ¶å¤åˆ¶é•œåƒï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦ç‰¹æƒçš„æƒ…å†µä¸‹å°†é•œåƒä»ä¸€ä¸ª Registry å¤åˆ¶åˆ°å¦ä¸€ä¸ª Registryã€‚ æ£€æµ‹è¿œç¨‹é•œåƒå¹¶æŸ¥çœ‹å…¶å±æ€§ï¼ŒåŒ…æ‹¬å…¶å›¾å±‚ï¼Œæ— éœ€å°†é•œåƒæ‹‰åˆ°æœ¬åœ°ã€‚ ä»é•œåƒåº“ä¸­åˆ é™¤é•œåƒã€‚ å½“å­˜å‚¨åº“éœ€è¦æ—¶ï¼Œskopeo å¯ä»¥ä¼ é€’é€‚å½“çš„å‡­æ®å’Œè¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚ çœ‹ä¸€ä¸‹ä»–çš„ help å°±çŸ¥é“ä»€ä¹ˆæ„æ€äº†ã€‚\n$ skopeo --help Various operations with container images and container image registries Usage: skopeo [flags] skopeo [command] Available Commands: copy Copy an IMAGE-NAME from one location to another delete Delete image IMAGE-NAME inspect æŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ manifest æˆ–è€… image config è¯¦ç»†ä¿¡æ¯ list-tags List tags in the transport/repository specified by the SOURCE-IMAGE login Login to a container registry manifest-digest è®¡ç®—æ–‡ä»¶çš„æ¸…å•æ‘˜è¦æ˜¯ä¸€ä¸ª sha256sum å€¼ standalone-sign ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åˆ›å»ºç­¾å standalone-verify éªŒè¯æœ¬åœ°æ–‡ä»¶çš„ç­¾å sync å°†ä¸€ä¸ªæˆ–å¤šä¸ªå›¾åƒä»ä¸€ä¸ªä½ç½®åŒæ­¥åˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œéå¸¸å®ç”¨ # æŸ¥è¯¢æ”¯æŒæ”¯æŒçš„ä¼ è¾“æ ¼å¼ï¼Œä¸¾ä¾‹ $ skopeo copy --help Supported transports: containers-storage, dir, docker, docker-archive, docker-daemon, oci, oci-archive, ostree, sif, tarball Usage: skopeo copy [command options] SOURCE-IMAGE DESTINATION-IMAGE Examples: skopeo copy docker://quay.io/skopeo/stable:latest docker://registry.example.com/skopeo:latest æ—¥å¸¸ä½¿ç”¨å¯ç•™ä½œ shell è„šæœ¬ï¼Œå¿«é€Ÿå¤åˆ¶é•œåƒï¼ŒåŒ…æ‹¬ OCI æ ¼å¼çš„ helm chartsã€‚\n# æŒ‡å®šè‡ªå»ºçš„ harbor åœ°å€ expport PRIVATE_HARBOR=custom.harbor.local skopeo login ${PRIVATE_HARBOR} # æŒ‡å®š --multi-arch=allï¼Œå¤åˆ¶å¤šæ¶æ„é•œåƒ skopeo copy --multi-arch=all docker://ghcr.io/graalvm/jdk-community:23.0.1 docker://${PRIVATE_HARBOR}/ghcr.io/graalvm/jdk-community:23.0.1\ré‡è§é—®é¢˜å’Œè§£å†³åŠæ³• åœ¨ docker å¤šèŠ‚ç‚¹æ„å»ºæ—¶ï¼Œå¶å°”å‡ºç°ç¼–è¯‘å®Œäº†ï¼Œä¸€ç›´å¡åœ¨ exporting to client directory ä¸åŠ¨ï¼Œä»»åŠ¡æ— æ³•ç»“æŸã€‚\nå‚è€ƒå®˜æ–¹ buildkit/issues/2950 ï¼ŒæŒ‰ç…§å¤§å®¶çš„æè¿°ï¼Œbuild é•œåƒå¤§äº 500M æ—¶å°±å®¹æ˜“è§¦å‘æ­¤é—®é¢˜ã€‚\næˆ‘çš„è§£å†³åŠæ³•æ˜¯ï¼Œåœ¨ build æ—¶æŒ‡å®š compression=zstd å¯ç”¨å‹ç¼©ï¼ŒåŸºæœ¬ä¸Šèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘è¿™é‡Œä½¿ç”¨äº† zstd å‹ç¼©ï¼Œéœ€è¦åœ¨ docker ç¼–è¯‘æœºå™¨ä¸Šå®‰è£… zstd å¹¶ä¸”éœ€è¦ K8S è¿è¡Œé›†ç¾¤æ”¯æŒï¼Œå¦åˆ™æ‹‰å–é•œåƒæ—¶å¯èƒ½å‡ºç°ä¸æ”¯æŒçš„ç±»å‹ zstdï¼Œç®€å•èµ·è§æ”¹ä¸º gzip å‹ç¼©å³å¯ã€‚\n# compression=zstd è§£å†³ buildkit/issues/2950 exporting å¶å°”å¡æ­»é—®é¢˜ # type=image,oci-mediatypes=false ç¼–è¯‘å‡º docker v2 æ ¼å¼é•œåƒï¼Œä¸ºäº†å…¼å®¹æœ‰äº›è€ç‰ˆæœ¬é›†ç¾¤è¿˜ä¸æ”¯æŒ oci æ ¼å¼ # --provenance=false æ˜¯ä¸ºäº†ä¸ç”Ÿæˆçƒ¦äººçš„æ—  tag metadata docker buildx build --output type=image,oci-mediatypes=false,compression=zstd --provenance=false --push\r","date":"2024-05-24","id":16,"permalink":"/blog/docker-best-practices/","summary":"\u003cp\u003eæ±‡æ€»æ•´ç†äº†å®¹å™¨é•œåƒåˆ¶ä½œæœ€ä½³å®è·µã€å¤šæ¶æ„ç¼–è¯‘ã€Dockerfile ç¼–å†™å°æŠ€å·§ç­‰å¸¸ç”¨æŠ€æœ¯é—®é¢˜ï¼ŒåŒæ—¶ä»‹ç»ä¸‹æˆ‘æ—¥å¸¸ä½¿ç”¨çš„ ORASã€skopeo ç­‰è¾…åŠ©å·¥å…·ã€‚\u003c/p\u003e\n\u003ch2 id=\"æœ€ä½³å®è·µ\"\u003eæœ€ä½³å®è·µ\u003c/h2\u003e\n\u003cp\u003eæ•´ç†äº†ç”± Docker å®˜æ–¹å’Œç¤¾åŒºæ¨èçš„ç”¨äºæ„å»ºé«˜æ•ˆé•œåƒçš„æœ€ä½³å®è·µå’Œæ–¹æ³•ï¼Œå½“ç„¶æœ‰äº›å¯èƒ½å¹¶ä¸é€‚ç”¨äºä½ ï¼Œè¯·æ³¨æ„åˆ†è¾¨ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€é•œåƒã€‚å®˜æ–¹é•œåƒç»è¿‡äº†å……åˆ†éªŒè¯å¹¶é›†æˆäº†æœ€ä½³å®è·µã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e# æ­£ä¾‹ï¼š\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e    FROM node\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# åä¾‹ï¼š\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e    FROM ubuntu\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e    RUN apt-get install -y node\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¿æŒå°½å¯èƒ½å°çš„é•œåƒå¤§å°ï¼Œç»ä¸å®‰è£…æ— å…³ä¾èµ–ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¸¥æ ¼çš„ç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œä½¿ç”¨ç¡®å®šæ€§çš„æ ‡ç­¾ï¼ŒåŸºç¡€é•œåƒç¦ç”¨ latestã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨ .dockerignore æ–‡ä»¶æ’é™¤æ–‡ä»¶å¹²æ‰°ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæœ€ç»å¸¸å˜åŒ–çš„å‘½ä»¤è¶Šå¾€åæ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨åˆ†å±‚ç¼“å­˜æœºåˆ¶ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDockerfile ä¸­æ¯è¡Œå‘½ä»¤äº§ç”Ÿä¸€å±‚ï¼Œè¯·åˆå¹¶å‘½ä»¤æ‰§è¡Œï¼Œæœ€å¤§é™åº¦å‡å°‘å±‚æ•°ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œå‡å°‘æ‰€æ„å»ºé•œåƒçš„å¤§å°ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eç¦ç”¨ root ç”¨æˆ·ï¼Œä½¿ç”¨ç‹¬ç«‹çš„ use å’Œ groupã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¯ç”¨é•œåƒå®‰å…¨æ‰«æï¼Œå¹¶åŠæ—¶æ›´æ–°ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¸€ä¸ªå®¹å™¨åªä¸“æ³¨åšä¸€ä»¶äº‹æƒ…ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eJava åº”ç”¨ç¨‹åºä¸è¦ä½¿ç”¨ PID ä¸º 1 çš„è¿›ç¨‹ï¼Œä½¿ç”¨ tini æˆ– dump-init ç®¡ç†è¿›ç¨‹ï¼Œé¿å…åƒµå°¸è¿›ç¨‹ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eä»¥ä¸Šéƒ½æ˜¯ä¸€äº›åŸºæœ¬çš„åŸåˆ™ï¼Œä½†æ˜¯å®é™…å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶å¯èƒ½ä¼šåƒæˆ‘ä¸€æ ·çº ç»“å‡ ä¸ªé—®é¢˜ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…³äºç¬¬ 1 ç‚¹ï¼Œä¸€å®šè¦ä½¿ç”¨å®˜æ–¹é•œåƒå—ã€‚æœªå¿…ï¼Œçœ‹æƒ…å†µã€‚æ¯”å¦‚æˆ‘ä»¬ä½œä¸ºå¹³å°ï¼Œæ¶‰åŠå¾ˆå¤šç§å¼€å‘è¯­è¨€ï¼Œå¾ˆå¤šç§ç»„åˆåœºæ™¯ï¼Œæ¯ä¸ªå®˜æ–¹åŸºç¡€é•œåƒå¯èƒ½éƒ½ä¸åŒï¼Œå°±ä¼šè‡ªå»ºåŸºç¡€é•œåƒï¼Œä»¥ä¾¿ç»Ÿä¸€æ“ä½œç³»ç»Ÿã€ç»Ÿä¸€è„šæœ¬å’Œå®‰å…¨ç»´æŠ¤ã€‚ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»ŸæŠ•çš„æ¯’ï¼Œå°±åƒå‡ºéª¨é±¼ç‰‡é‡Œæœªå‡€çš„åˆºï¼Œç»™äººä¸€ç§ä¸æœŸå¾…çš„ä¼¤ç—›ã€‚\u003c/li\u003e\n\u003cli\u003eä¸ºäº†é•œåƒå¤§å°å’Œå®‰å…¨ï¼Œä¸€å®šè¦ä½¿ç”¨ Alpine æˆ– distroless é•œåƒå—ã€‚æˆ‘çš„å»ºè®®æ˜¯ä¸è¦ä½¿ç”¨ Alpine é•œåƒï¼Œå¦‚æœ‰èƒ½åŠ›æ‰ä½¿ç”¨ distroless é•œåƒã€‚æ¯•ç«Ÿ libc çš„å‘ï¼Œè°ç—›è°çŸ¥é“ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"dockerfile-ç¼–å†™å°æŠ€å·§\"\u003eDockerfile ç¼–å†™å°æŠ€å·§\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨ Heredocs è¯­æ³•ä»£æ›¿åˆé•¿åˆè‡­çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå½“ç„¶ Heredocs æ”¯æŒæ›´å¤šåŠŸèƒ½æ¯”å¦‚ run pythonã€å¤šæ–‡ä»¶å†…å®¹æ‹·è´ï¼Œå…·ä½“è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\u003c/p\u003e","tags":["k8s"],"title":"å®¹å™¨é•œåƒåˆ¶ä½œæœ€ä½³å®è·µï¼Œå¤šæ¶æ„ç¼–è¯‘ï¼ŒDockerfile ç¼–å†™å°æŠ€å·§å’Œè¸©å‘è®°å½•ï¼Œé•œåƒç»´æŠ¤è¾…åŠ©å·¥å…· ORASã€skopeo ç­‰ä»‹ç»"},{"content":"\rè™½ç„¶ Java ç•Œæµè¡Œ ä½ å‘ä»»ä½ å‘ï¼Œæˆ‘ç”¨ Java 8ã€‚ä½†æ ¹æ® Azul ç»„ç»‡å‘å¸ƒçš„ 2025 Java æœ€æ–°ä½¿ç”¨æŠ¥å‘Š æ˜¾ç¤ºï¼ŒJava 17 æ‚„æ‚„ç™»ä¸Šäº†ä½¿ç”¨ç‡æœ€é«˜çš„å®åº§ï¼ŒJava 21 ä¹Ÿç´§éšå…¶åã€‚ è‡³äºæ–°å‘å¸ƒçš„ Java 25ï¼Œ èƒ½ä¸èƒ½æ‰¿æ‹…èµ· Make Java Great Again çš„è‰°å·¨ä»»åŠ¡ï¼Œè¿˜éœ€è¦æ—¶é—´çš„è€ƒéªŒï¼Œè®©å­å¼¹å†é£ä¸€ä¼šã€‚\nä»Šå¤©æˆ‘ä»¬å°†ä»‹ç»ä¸‹ï¼Œä» Java 8 åˆ° Java 25ï¼Œæœ‰å“ªäº›æ–°ç‰¹æ€§ï¼Œæœ‰ä»€ä¹ˆå·¥å…·å¯ååŠ©å‡çº§ï¼Œä»¥åŠåœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ã€‚\nJava 25 æ ¸å¿ƒç‰¹æ€§é€Ÿè§ˆ Java 25 ä½œä¸º 2025 å¹´ 3 æœˆå‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†å¤šé¡¹é‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨æ€§èƒ½ä¼˜åŒ–ã€å¼€å‘ä½“éªŒå’Œå®‰å…¨æ€§æ–¹é¢æœ‰æ˜¾è‘—æå‡ï¼š\nJava 25 å…³é”®äº®ç‚¹ ç´§å‡‘å¯¹è±¡å¤´ (JEP 519) - ç”Ÿäº§å°±ç»ª\nå¯¹è±¡å¤´ä» 12 å­—èŠ‚å‹ç¼©åˆ° 8 å­—èŠ‚ å†…å­˜å ç”¨é™ä½ 3-5%, æœ€é«˜å¯è¾¾ 22% CPU ä½¿ç”¨æœ€å¤šå‡å°‘ 30%(Amazon å®æµ‹ï¼‰ ä»…éœ€æ·»åŠ  JVM å‚æ•° -XX:+UseCompactObjectHeaders, æ— éœ€ä¿®æ”¹ä»£ç  ç‰¹åˆ«é€‚åˆå¾®æœåŠ¡ã€Spring Bootã€JSON å¤„ç†ç­‰å°å¯¹è±¡å¯†é›†åœºæ™¯ ç®€åŒ– main æ–¹æ³• (JEP 463) - é™ä½ Java å­¦ä¹ é—¨æ§›\næ”¯æŒæ— ç±»å£°æ˜çš„ void main() æ–¹æ³• æ— éœ€ public static ä¿®é¥°ç¬¦ é€‚åˆåˆå­¦è€…å’Œè„šæœ¬åŒ–åœºæ™¯ // Java 25 ç®€åŒ–å†™æ³• void main() { println(\u0026#34;Hello, World!\u0026#34;); }\rçµæ´»æ„é€ å‡½æ•°ä½“ (JEP 447) - å¢å¼ºä»£ç å®‰å…¨æ€§\nå…è®¸åœ¨ super()/this() è°ƒç”¨å‰æ‰§è¡Œå‚æ•°æ ¡éªŒ é¿å…æå–é™æ€æ–¹æ³•çš„æ¨¡æ¿ä»£ç  æå‡å¯¹è±¡æ„å»ºæ—¶çš„å®‰å…¨æ€§ åŸºæœ¬ç±»å‹æ¨¡å¼åŒ¹é…å¢å¼º - æ‰©å±•æ¨¡å¼åŒ¹é…èƒ½åŠ›\næ”¯æŒ intã€byteã€charã€boolean ç­‰åŸºæœ¬ç±»å‹çš„æ¨¡å¼åŒ¹é… å®ç°åŸºæœ¬ç±»å‹é—´çš„å®‰å…¨è½¬æ¢æ£€æŸ¥ ç§»é™¤ 32 ä½ x86 æ”¯æŒ (JEP 503) - ä¸“æ³¨ 64 ä½ä¼˜åŒ–\nç®€åŒ–ä»£ç åº“ï¼Œä¸“æ³¨ç°ä»£ 64 ä½æ¶æ„ä¼˜åŒ– æ›´å¥½åœ°åˆ©ç”¨ SIMD æŒ‡ä»¤é›† G1/ZGC é’ˆå¯¹ 64 ä½æ¶æ„æ·±åº¦ä¼˜åŒ– Java Flight Recorder å¢å¼º\nJEP 509: Linux ä¸Šé«˜ç²¾åº¦ CPU é‡‡æ · JEP 518: æ”¹è¿›é‡‡æ ·æœºåˆ¶ JEP 520: æ–¹æ³•çº§æ‰§è¡Œæ—¶é—´è·Ÿè¸ª Java 25 vs å…¶ä»–ç‰ˆæœ¬å¯¹æ¯” ç‰¹æ€§ç»´åº¦ Java 8 Java 11 Java 17 Java 21 Java 25 å‘å¸ƒæ—¶é—´ 2014 2018 2021 2023 2025.9 Lambda/Stream âœ… âœ… âœ… âœ… âœ… æ¨¡å—åŒ–ç³»ç»Ÿ âŒ âœ… âœ… âœ… âœ… Record ç±»å‹ âŒ âŒ âœ…ï¼ˆé¢„è§ˆï¼‰ âœ… âœ… Switch è¡¨è¾¾å¼ âŒ âŒ âœ… âœ… âœ… æ–‡æœ¬å— âŒ âŒ âœ… âœ… âœ… è™šæ‹Ÿçº¿ç¨‹ âŒ âŒ âŒ âœ… âœ…ï¼ˆä¼˜åŒ–ï¼‰ å‘é‡ API âŒ âŒ âŒï¼ˆå­µåŒ–ï¼‰ âœ…ï¼ˆå­µåŒ–ï¼‰ âœ…ï¼ˆæ­£å¼ï¼‰ ç´§å‡‘å¯¹è±¡å¤´ âŒ âŒ âŒ âŒï¼ˆé¢„è§ˆï¼‰ âœ… ç®€åŒ– main âŒ âŒ âŒ âŒï¼ˆé¢„è§ˆï¼‰ âœ… GC é€‰é¡¹ Parallel/CMS G1ï¼ˆé»˜è®¤ï¼‰ G1/ZGC G1/åˆ†ä»£ ZGC G1/ZGCï¼ˆå¢å¼ºï¼‰ å¯åŠ¨æ€§èƒ½ åŸºå‡† +10% +15% +20% +25% å†…å­˜æ•ˆç‡ åŸºå‡† +5% +10% +15% +20-25% å®‰å…¨ç®¡ç†å™¨ âœ… âœ… âš ï¸åºŸå¼ƒ âš ï¸åºŸå¼ƒ âŒæ°¸ä¹…ç¦ç”¨ ä¸ºä»€ä¹ˆé€‰æ‹© Java 25 å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Java 8/11:\nè·å¾—å·¨å¤§çš„æ€§èƒ½æå‡ (20-40% ååé‡æå‡ï¼‰ ç°ä»£åŒ–çš„è¯­æ³•ç³–è®©ä»£ç æ›´ç®€æ´ å¼ºå¤§çš„ GC èƒ½åŠ› (G1/ZGC åˆ†ä»£ä¼˜åŒ–ï¼‰ è™šæ‹Ÿçº¿ç¨‹è®©å¹¶å‘ç¼–ç¨‹æ›´ç®€å• å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Java 17/21:\nç´§å‡‘å¯¹è±¡å¤´å¸¦æ¥å…è´¹çš„æ€§èƒ½æå‡ (3-30%) è™šæ‹Ÿçº¿ç¨‹ + synchronized é—®é¢˜å·²è§£å†³ (Java 24) å‘é‡ API æ­£å¼å‘å¸ƒï¼ŒAI/ç§‘å­¦è®¡ç®—æ€§èƒ½å¤§å¹…æå‡ æ›´å®Œå–„çš„ JFR ç›‘æ§èƒ½åŠ› æ€§èƒ½æ•°æ®å¯¹æ¯” ï¼ˆåŸºäºå®é™…ç”Ÿäº§ç¯å¢ƒï¼‰:\nå†…å­˜å ç”¨ï¼šJava 25 æ¯” Java 21 å‡å°‘ 5-10% GC åœé¡¿ï¼šä½¿ç”¨ç´§å‡‘å¯¹è±¡å¤´å GC é¢‘ç‡é™ä½ 15% JSON è§£æï¼šJackson æ€§èƒ½æå‡ 10% å¹¶å‘æ€§èƒ½ï¼šè™šæ‹Ÿçº¿ç¨‹ä¼˜åŒ–åæå‡ 20-30% Java 8 ä»¥æ¥ä»¤äººå¿ƒåŠ¨çš„ç‰¹æ€§ ä¸‹å›¾å±•ç¤ºäº†è‡ª Java 8 ä»¥æ¥æ¯ä¸ª Java ç‰ˆæœ¬ä¸­çš„ JEPï¼ˆJDK Enhancement Proposalï¼Œå³ JDK å¢å¼ºææ¡ˆï¼‰ æ•°é‡ï¼Œä¸‹é¢å°†æ‘˜å‡ºå‡ ä¸ªæ¯”è¾ƒä»¤äººå¿ƒåŠ¨ä¸”ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„ç‰¹æ€§è¿›è¡Œä»‹ç»ã€‚\nè¯­æ³•ç³– è¯­æ³•ç³–ç‰¹æ€§è®©ä»£ç ç¼–å†™æ›´åŠ ç®€æ´ä¼˜é›…ï¼Œæå‡å¼€å‘ä½“éªŒã€‚\né›†åˆ \u0026amp;\u0026amp; Stream API å¢å¼º - Java 8/9/12/16/21\nJava 8 å¼•å…¥ Stream APIï¼Œæ”¯æŒå‡½æ•°å¼æ•°æ®å¤„ç†\nJava 9 æ–°å¢ dropWhile()ã€takeWhile()ã€iterate() å¢å¼ºã€ofNullable()\nJava 12 æ–°å¢ Collectors.teeing() æ–¹æ³•\nJava 16 æ–°å¢ Stream.toList() å’Œ mapMulti() æ–¹æ³•\nJava 21 é¡ºåºé›†åˆè¯­æ³•ç³–ï¼Œæ¯”å¦‚ List.getFirst() å’Œ List.getLast() æ–¹æ³•ï¼Œå†ä¹Ÿä¸ç”¨å°å¿ƒå¦‚ä½•è®¡ç®— index äº†\nç®€æ´çš„é›†åˆåˆ›å»ºæ–¹å¼ï¼Œåˆ›å»ºä¸å¯å˜é›†åˆ\nä»£ç ç¤ºä¾‹ï¼š\n// å·¥å‚æ–¹æ³•ç®€åŒ–ï¼Œæ³¨æ„ï¼šè¿™äº›é›†åˆæ˜¯ä¸å¯å˜çš„ï¼Œè°ƒç”¨ä¿®æ”¹æ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ List\u0026lt;String\u0026gt; list = List.of(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;); Set\u0026lt;String\u0026gt; set = Set.of(\u0026#34;x\u0026#34;, \u0026#34;y\u0026#34;, \u0026#34;z\u0026#34;); Map\u0026lt;String, Integer\u0026gt; map = Map.of(\u0026#34;key1\u0026#34;, 1, \u0026#34;key2\u0026#34;, 2); // Java 9 æ¡ä»¶è¿‡æ»¤ List\u0026lt;Integer\u0026gt; numbers = List.of(1, 2, 3, 4, 5, 6); List\u0026lt;Integer\u0026gt; taken = numbers.stream() .takeWhile(n -\u0026gt; n \u0026lt; 4) // [1, 2, 3] .toList(); // Java 16+ ç®€åŒ–åˆ—è¡¨æ”¶é›† List\u0026lt;String\u0026gt; result = list.stream() .filter(s -\u0026gt; s.length() \u0026gt; 5) .toList(); // Java 9 æœ‰é™è¿­ä»£ Stream.iterate(1, n -\u0026gt; n \u0026lt; 100, n -\u0026gt; n * 2) .forEach(System.out::println); // 1, 2, 4, 8, 16, 32, 64 // Java 16 ä¸€å¯¹å¤šæ˜ å°„ Stream.of(1, 2, 3) .mapMulti((number, consumer) -\u0026gt; { consumer.accept(number); consumer.accept(number * 2); }) .forEach(System.out::println); // 1, 2, 2, 4, 3, 6 // Java 21 List æ–°æ–¹æ³• List\u0026lt;String\u0026gt; list = List.of(\u0026#34;ç¬¬ä¸€ä¸ª\u0026#34;, \u0026#34;ç¬¬äºŒä¸ª\u0026#34;, \u0026#34;ç¬¬ä¸‰ä¸ª\u0026#34;, \u0026#34;æœ€åä¸€ä¸ª\u0026#34;); String first = list.getFirst(); String last = list.getLast();\rObjects æ–¹æ³•å¢å¼º - Java 9\næ–°å¢å¤šä¸ªå®ç”¨çš„å¯¹è±¡æ“ä½œæ–¹æ³•ï¼Œç®€åŒ– null æ£€æŸ¥å’Œç´¢å¼•éªŒè¯\nä»£ç ç¤ºä¾‹ï¼š\nString inputName = null; List\u0026lt;String\u0026gt; list = List.of(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;); // ç©ºå€¼å¤„ç† String name1 = Objects.requireNonNullElse(inputName, \u0026#34;é»˜è®¤åç§°\u0026#34;); String name2 = Objects.requireNonNullElseGet(inputName, () -\u0026gt; \u0026#34;åŠ¨æ€ç”Ÿæˆåç§°\u0026#34;); // toString ç©ºå€¼å®‰å…¨å¤„ç† String toStringResult = Objects.toString(inputName, \u0026#34;nullDefault value\u0026#34;); // ç´¢å¼•æ£€æŸ¥ int index = Objects.checkIndex(3, list.size()); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦æœ‰æ•ˆ Objects.checkFromToIndex(1, 4, list.size()); // æ£€æŸ¥èŒƒå›´ [1, 4) Objects.checkFromIndexSize(1, 3, list.size()); // æ£€æŸ¥ä»ç´¢å¼• 1 å¼€å§‹é•¿åº¦ä¸º 3 çš„èŒƒå›´\rString å¢å¼ºæ–¹æ³• - Java 11\næ–°å¢å¤šä¸ªå®ç”¨çš„å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•\nä»£ç ç¤ºä¾‹ï¼š\nString text = \u0026#34; Hello World \u0026#34;; // æ–°å¢æ–¹æ³• boolean isBlank = text.isBlank(); // æ£€æŸ¥æ˜¯å¦ä¸ºç©ºæˆ–åªåŒ…å«ç©ºç™½å­—ç¬¦ String stripped = text.strip(); // å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦ String repeated = text.repeat(3); // é‡å¤å­—ç¬¦ä¸² Stream\u0026lt;String\u0026gt; lines = text.lines(); // æŒ‰è¡Œåˆ†å‰²æˆæµ String indented = text.stripIndent(); // å»é™¤ç¼©è¿›\ræ–‡æœ¬å— \u0026amp;\u0026amp; å­—ç¬¦ä¸²æ¨¡æ¿ - Java 15/21\næ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡ï¼Œæ— éœ€è½¬ä¹‰å­—ç¬¦\nJava 21 é¢„è§ˆç‰¹æ€§ï¼šå­—ç¬¦ä¸²æ¨¡æ¿ï¼ˆString Templatesï¼‰æ”¯æŒ STR. åµŒå…¥è¡¨è¾¾å¼\nä»£ç ç¤ºä¾‹ï¼š\n// åŸºç¡€æ–‡æœ¬å— String json = \u0026#34;\u0026#34;\u0026#34; { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;age\u0026#34;: 25 } \u0026#34;\u0026#34;\u0026#34;; // Java 21 å­—ç¬¦ä¸²æ¨¡æ¿ï¼ˆé¢„è§ˆç‰¹æ€§ï¼‰ String name = \u0026#34;å¼ ä¸‰\u0026#34;; int age = 25; String json = STR.\u0026#34;\u0026#34;\u0026#34; { \u0026#34;name\u0026#34;: \u0026#34;\\{name}\u0026#34;, \u0026#34;age\u0026#34;: \\{age} } \u0026#34;\u0026#34;\u0026#34;;\rRecord ç±»å‹ï¼ˆJEP 395ï¼‰ - Java 16\nç®€æ´çš„æ•°æ®ç±»å®šä¹‰ï¼Œè‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°ã€è®¿é—®å™¨ç­‰\nä»£ç ç¤ºä¾‹ï¼š\npublic record Person(String name, int age) {} // ä½¿ç”¨ç¤ºä¾‹ Person person = new Person(\u0026#34;å¼ ä¸‰\u0026#34;, 25); System.out.println(person.name()); // æ³¨æ„ï¼šfastjson 1.x ä¸æ”¯æŒåºåˆ—åŒ–ï¼Œæ­¤å¤„è¾“å‡º {} System.out.println(com.alibaba.fastjson.JSON.toJSONString(person)); // fastjson 2.x æ‰æ”¯æŒåºåˆ—åŒ–ï¼Œæ­¤å¤„è¾“å‡º {\u0026#34;age\u0026#34;:25,\u0026#34;name\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;} System.out.println(com.alibaba.fastjson2.JSON.toJSONString(person));\rSwitch è¡¨è¾¾å¼ï¼ˆJEP 361ï¼‰ - Java 14\nSwitch å¯ä»¥ä½œä¸ºè¡¨è¾¾å¼è¿”å›å€¼ï¼Œæ”¯æŒç®­å¤´è¯­æ³•ï¼Œæ›´åŠ ç®€æ´ï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒå¿˜äº† return äº†\nä»£ç ç¤ºä¾‹ï¼š\nDayOfWeek day = DayOfWeek.MONDAY; String result = switch(day) { case MONDAY -\u0026gt; \u0026#34;å‘¨ä¸€\u0026#34;; case TUESDAY -\u0026gt; \u0026#34;å‘¨äºŒ\u0026#34;; case WEDNESDAY -\u0026gt; \u0026#34;å‘¨ä¸‰\u0026#34;; default -\u0026gt; \u0026#34;å…¶ä»–\u0026#34;; }; System.out.println(result);\ræ¨¡å¼åŒ¹é…ï¼ˆJEP 394, 433, 441ï¼‰ - Java 16/17/21/25\nå¢å¼º instanceof æ“ä½œç¬¦ï¼Œæ”¯æŒæ¨¡å¼åŒ¹é…ï¼ŒåŒ¹é…åç›´æ¥è½¬æ¢\nJava 25 æ–°å¢ï¼šæ”¯æŒåŸºæœ¬ç±»å‹ï¼ˆintã€byteã€charã€booleanï¼‰çš„æ¨¡å¼åŒ¹é…\nä»£ç ç¤ºä¾‹ï¼š\nObject obj = \u0026#34;Hello World\u0026#34;; // Java 16+ æ¨¡å¼åŒ¹é… if (obj instanceof String s \u0026amp;\u0026amp; s.length() \u0026gt; 5) { System.out.println(\u0026#34;é•¿å­—ç¬¦ä¸²ï¼š\u0026#34; + s.toUpperCase()); } // Switch æ¨¡å¼åŒ¹é… String result = switch(obj) { case String s when s.length() \u0026gt; 5 -\u0026gt; \u0026#34;é•¿å­—ç¬¦ä¸²ï¼š\u0026#34; + s; case String s -\u0026gt; \u0026#34;çŸ­å­—ç¬¦ä¸²ï¼š\u0026#34; + s; case Integer i -\u0026gt; \u0026#34;æ•°å­—ï¼š\u0026#34; + i; default -\u0026gt; \u0026#34;æœªçŸ¥ç±»å‹\u0026#34;; }; // Java 25 åŸºæœ¬ç±»å‹æ¨¡å¼åŒ¹é…ï¼ŒåŸºæœ¬ç±»å‹é—´çš„å®‰å…¨è½¬æ¢æ£€æŸ¥ Object num = 42; if (num instanceof int i) { System.out.println(\u0026#34;æ˜¯ int ç±»å‹ï¼š\u0026#34; + i); }\rç®€åŒ– main æ–¹æ³•ï¼ˆJEP 463ï¼‰ - Java 25\næ”¯æŒæ— ç±»å£°æ˜çš„ void main() æ–¹æ³•ï¼Œæ— éœ€ public static ä¿®é¥°ç¬¦\nä»£ç ç¤ºä¾‹ï¼š\n// ä¼ ç»Ÿå†™æ³• public class HelloWorld { public static void main(String[] args) { System.out.println(\u0026#34;Hello, World!\u0026#34;); } } // Java 25 ç®€åŒ–å†™æ³• void main() { IO.println(\u0026#34;Hello, World!\u0026#34;); } // æ”¯æŒå¸¦å‚æ•°çš„ä¸»æ–¹æ³• void main(String[] args) { System.out.println(\u0026#34;å‚æ•°ä¸ªæ•°ï¼š\u0026#34; + args.length); }\rç›´æ¥è¿è¡Œ Java æ–‡ä»¶ï¼ˆJEP 330ã€JEP 458ï¼‰ - Java 11\næ”¯æŒç›´æ¥è¿è¡Œå•ä¸ªæºæ–‡ä»¶ï¼Œæ— éœ€å…ˆç¼–è¯‘\næ”¯æŒ Shebang è„šæœ¬è¿è¡Œæ–¹å¼ï¼Œå¯åŠ¨å¤šæ–‡ä»¶æºä»£ç ç¨‹åºï¼Œä¸€ä¸ªæ–‡ä»¶é‡Œå®šä¹‰å¤š classs\nä»£ç ç¤ºä¾‹ï¼š\n// æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œ Java æ–‡ä»¶ // åˆ›å»ºæ–‡ä»¶ HelloWorld.java // è¿è¡Œå‘½ä»¤ï¼šjava HelloWorld.java // è¾“å‡ºï¼šHello, World! public class HelloWorld { public static void main(String[] args) { System.out.println(\u0026#34;Hello, World!\u0026#34;); } } // æ–¹å¼äºŒï¼šShebang è„šæœ¬è¿è¡Œ // èµ‹äºˆæ‰§è¡Œæƒé™ï¼šchmod +x hello // ç›´æ¥è¿è¡Œï¼š./hello // è¾“å‡ºï¼šHello from script! // ç»“åˆ Java 25 ç®€åŒ– main æ–¹æ³• #!/usr/bin/java --source 25 void main() { System.out.println(\u0026#34;ç®€åŒ–çš„è„šæœ¬å…¥å£ï¼\u0026#34;); }\rçµæ´»æ„é€ å‡½æ•°ä½“ï¼ˆJEP 447ï¼‰ - Java 25\nå…è®¸åœ¨ super() æˆ– this() è°ƒç”¨å‰æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼Œå¦‚å‚æ•°æ ¡éªŒï¼Œæå‡ä»£ç å¯è¯»æ€§å’Œçµæ´»æ€§ï¼Œé¿å…å°†æ ¡éªŒé€»è¾‘æå–åˆ°é™æ€æ–¹æ³•çš„æ¨¡æ¿ä»£ç ï¼Œå¢å¼ºå¯¹è±¡æ„å»ºæ—¶çš„å®‰å…¨æ€§ã€‚\nä»£ç ç¤ºä¾‹ï¼š\npublic class Person { private final String name; private final int age; // Java 25 çµæ´»æ„é€ å‡½æ•°ä½“ public Person(String name, int age) { // å¯ä»¥åœ¨ super() è°ƒç”¨å‰æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ if (name == null || name.trim().isEmpty()) { throw new IllegalArgumentException(\u0026#34;å§“åä¸èƒ½ä¸ºç©º\u0026#34;); } if (age \u0026lt; 0) { throw new IllegalArgumentException(\u0026#34;å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°\u0026#34;); } // ç°åœ¨å¯ä»¥è°ƒç”¨ super() æˆ– this() this.name = name.trim(); this.age = age; } // è°ƒç”¨å…¶ä»–æ„é€ å‡½æ•°å‰çš„å‚æ•°æ ¡éªŒ public Person(String name) { if (name == null || name.trim().isEmpty()) { throw new IllegalArgumentException(\u0026#34;å§“åä¸èƒ½ä¸ºç©º\u0026#34;); } this(name, 0); // è°ƒç”¨ä¸Šé¢çš„æ„é€ å‡½æ•° } }\ræ€§èƒ½ä¼˜åŒ– æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§å¤§å¹…æå‡äº† Java åº”ç”¨çš„è¿è¡Œæ•ˆç‡ï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†å™¨çš„æ¼”è¿›æ˜¯æœ€é‡è¦çš„æ”¹è¿›ä¹‹ä¸€ã€‚\nG1 åƒåœ¾æ”¶é›†å™¨æ¼”è¿› G1 è‡ª Java 7 å¼•å…¥ï¼ŒJava 9 æˆä¸ºé»˜è®¤æ”¶é›†å™¨ï¼ŒæŒç»­è¿›åŒ–çš„ G1 ä»æ˜¯ç›®å‰æœ€å…¨é¢æœ€å‡è¡¡çš„æ”¶é›†å™¨ã€‚\næ ¸å¿ƒç‰¹æ€§ï¼š\nåˆ†åŒºç®¡ç†ï¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼ŒåŠ¨æ€è°ƒæ•´å¹´è½»ä»£å’Œè€å¹´ä»£æ¯”ä¾‹ å¹¶å‘æ ‡è®°ï¼šåœ¨åº”ç”¨çº¿ç¨‹è¿è¡Œçš„åŒæ—¶è¿›è¡Œåƒåœ¾å›æ”¶æ ‡è®°ï¼Œå‡å°‘åœé¡¿æ—¶é—´ å¯é¢„æµ‹åœé¡¿æ—¶é—´ï¼šé€šè¿‡ -XX:MaxGCPauseMillis å‚æ•°æ§åˆ¶æœ€å¤§åœé¡¿æ—¶é—´ Java 8 åˆ° Java 25ï¼Œ6 ä¸ªä¸“é—¨é’ˆå¯¹ G1 çš„ JEPï¼Œ ä¸»è¦æ”¹è¿›ï¼š\nJava 9ï¼šæˆä¸ºé»˜è®¤åƒåœ¾æ”¶é›†å™¨ï¼Œä¼˜åŒ–äº†æ··åˆå›æ”¶ç®—æ³• Java 10ï¼šå¹¶è¡Œ Full GCï¼ˆJEP 307ï¼‰ï¼Œæå‡ Full GC æ€§èƒ½ Java 12ï¼šå¯ä¸­æ–­æ··åˆé›†åˆï¼ˆJEP 344ï¼‰+ åŠæ—¶è¿”å›æœªä½¿ç”¨å†…å­˜ï¼ˆJEP 346ï¼‰ Java 14ï¼šNUMA æ„ŸçŸ¥å†…å­˜åˆ†é…ï¼ˆJEP 345ï¼‰ï¼Œä¼˜åŒ– NUMA ç³»ç»Ÿæ€§èƒ½ Java 16ï¼šå¹¶å‘çº¿ç¨‹æ ˆæ‰«æï¼ˆJEP 376ï¼‰ï¼Œå‡å°‘å¹¶å‘æ ‡è®°æ—¶é—´ Java 17ï¼šåŠ¨æ€çº¿ç¨‹æ ˆæ‰«æï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–å¹¶å‘æ€§èƒ½ Java 21ï¼šåˆ†ä»£ G1 ä¼˜åŒ–ï¼Œæå‡å¹´è½»ä»£å›æ”¶æ•ˆç‡ Java 22ï¼šå¯é…ç½®å¡è¡¨å¤§å°ï¼Œæ”¯æŒæ›´å¤§å †åŒºåŸŸï¼ˆæœ€å¤§ 512MBï¼‰ Java 23ï¼šå†™å…¥å±éšœä¼˜åŒ–ï¼Œå‡å°‘ååé‡æŸå¤± Java 24ï¼šå¹¶å‘æ ‡è®°å‘¨æœŸä¼˜åŒ–ï¼Œæ”¹è¿›ä½å›¾ä½¿ç”¨ + åæœŸå±éšœæ‰©å±•ï¼ˆJEP 475ï¼‰ Java 25ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–å†™å…¥å±éšœå’Œå¹¶å‘æ€§èƒ½ G1 æ€§èƒ½ä¼˜åŒ– JEP è¯¦è§£ï¼š\nå¹¶è¡Œ Full GCï¼ˆJEP 307ï¼‰ - Java 10\nä¼ ç»Ÿ Full GC æ˜¯å•çº¿ç¨‹çš„ï¼Œå¯¼è‡´é•¿æ—¶é—´åœé¡¿ã€‚JEP 307 å¼•å…¥å¹¶è¡Œ Full GCï¼š\nå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç† Full GCï¼Œåœé¡¿æ—¶é—´å‡å°‘ 60-80% ç‰¹åˆ«é€‚ç”¨äºå¤§å †å†…å­˜åº”ç”¨çš„ç´§æ€¥å›æ”¶åœºæ™¯ # G1 å¹¶è¡Œ Full GC å‚æ•° -XX:+UseG1GC -XX:MaxGCPauseMillis=200 # ç›®æ ‡åœé¡¿æ—¶é—´ -XX:G1HeapRegionSize=16m # å †åŒºåŸŸå¤§å°\rå¯ä¸­æ–­æ··åˆé›†åˆï¼ˆJEP 344ï¼‰ - Java 12\nè§£å†³æ··åˆé›†åˆå¯èƒ½å¯¼è‡´çš„é•¿æ—¶é—´åœé¡¿é—®é¢˜ï¼š\nå…è®¸åœ¨æ··åˆå›æ”¶è¿‡ç¨‹ä¸­ä¸­æ–­ï¼Œåœé¡¿æ—¶é—´æ§åˆ¶åœ¨ 200ms ä»¥å†… æé«˜åº”ç”¨å“åº”æ€§ï¼Œå‡å°‘ç”¨æˆ·ä½“éªŒå½±å“ # G1 å¯ä¸­æ–­æ··åˆé›†åˆå‚æ•° -XX:+UseG1GC -XX:G1MixedGCCountTarget=8 # æ··åˆå›æ”¶ç›®æ ‡æ¬¡æ•° -XX:G1OldCSetRegionThreshold=10% # è€å¹´ä»£å›æ”¶æ¯”ä¾‹\råŠæ—¶è¿”å›æœªä½¿ç”¨å†…å­˜ï¼ˆJEP 346ï¼‰ - Java 12\nG1 èƒ½å¤Ÿä¸»åŠ¨å½’è¿˜æœªä½¿ç”¨çš„å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿï¼š\nå‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ é—´æ¥å‡å°‘ GC é¢‘ç‡å’Œåœé¡¿æ—¶é—´ å†…å­˜ä½¿ç”¨æ•ˆç‡æå‡ 20-30% # G1 å†…å­˜å½’è¿˜å‚æ•° -XX:+UseG1GC -XX:+G1UncommitDelay=300 # å»¶è¿Ÿå½’è¿˜æ—¶é—´ï¼ˆç§’ï¼‰ -XX:G1MinHeapFreeRatio=20 # æœ€å°ç©ºé—²å †æ¯”ä¾‹\rNUMA æ„ŸçŸ¥å†…å­˜åˆ†é…ï¼ˆJEP 345ï¼‰ - Java 14\né’ˆå¯¹ NUMAï¼ˆç°ä»£çš„å¤šè·¯æœåŠ¡å™¨å‡ ä¹éƒ½é‡‡ç”¨ NUMA æ¶æ„ï¼‰ æ¶æ„ä¼˜åŒ–å†…å­˜åˆ†é…ç­–ç•¥ï¼š\nå°±è¿‘åˆ†é…åŸåˆ™ï¼Œå‡å°‘è·¨ NUMA èŠ‚ç‚¹è®¿é—® åœ¨ NUMA ç³»ç»Ÿä¸Šæ€§èƒ½æå‡ 10-20% # NUMA ä¼˜åŒ–å‚æ•° -XX:+UseG1GC -XX:+UseNUMA # å¯ç”¨ NUMA ä¼˜åŒ– -XX:+UseNUMAInterleaving # å¯ç”¨å†…å­˜äº¤é”™åˆ†é…\rå¹¶å‘çº¿ç¨‹æ ˆæ‰«æï¼ˆJEP 376ï¼‰ - Java 16\nä¼ ç»Ÿ GC éœ€è¦æš‚åœåº”ç”¨çº¿ç¨‹æ‰«ææ ˆï¼ŒJEP 376 å®ç°å¹¶å‘æ‰«æï¼š\nå¹¶å‘æ‰«æçº¿ç¨‹æ ˆï¼Œå‡å°‘ STWï¼ˆStop-The-Worldï¼‰æ—¶é—´ ååé‡æå‡ 15-25% åæœŸå±éšœæ‰©å±•ï¼ˆJEP 475ï¼‰ - Java 24\nä¼˜åŒ– G1 çš„å†™å…¥å±éšœæœºåˆ¶ï¼š\né‡æ–°è®¾è®¡åƒåœ¾æ”¶é›†å™¨ä¸åº”ç”¨ç¨‹åºçš„åŒæ­¥æœºåˆ¶ è§£å†³ G1 ååé‡æ¯”å…¶ä»–æ”¶é›†å™¨ä½ 20% çš„é—®é¢˜ æ˜¾è‘—å‡å°‘å¯¹ååé‡çš„å½±å“ # G1 åæœŸå±éšœä¼˜åŒ–å‚æ•° -XX:+UseG1GC -XX:+G1UseAdaptiveIHOP # è‡ªé€‚åº” IHOP -XX:G1MixedGCLiveThresholdPercent=85\rå†™å…¥å±éšœä¼˜åŒ–ï¼ˆJava 23ï¼‰ï¼š\né‡æ–°è®¾è®¡åƒåœ¾æ”¶é›†å™¨ä¸åº”ç”¨ç¨‹åºçš„åŒæ­¥æœºåˆ¶ æ˜¾è‘—å‡å°‘å¯¹ååé‡çš„å½±å“ï¼Œè§£å†³ G1 ååé‡æ¯”å…¶ä»–æ”¶é›†å™¨ä½ 20% çš„é—®é¢˜ é€šè¿‡ JDK-8340827 å®ç°æ ¹æœ¬æ€§çš„åŒæ­¥æœºåˆ¶æ”¹è¿› å¡è¡¨å¤§å°é…ç½®ï¼ˆJava 22ï¼‰ï¼š\nå¼•å…¥å¯é…ç½®çš„å¡è¡¨å¤§å°ï¼ˆJDK-8272773ï¼‰ æ”¯æŒæ›´å¤§çš„å †åŒºåŸŸï¼Œä»åŸæ¥çš„ 32MB æå‡åˆ° 512MBï¼ˆJDK-8275056ï¼‰ æä¾›æ›´çµæ´»çš„å†…å­˜ç®¡ç†ç­–ç•¥ å¹¶å‘æ ‡è®°ä¼˜åŒ–ï¼ˆJava 24ï¼‰ï¼š\næ”¹è¿›ä½å›¾ä½¿ç”¨æ–¹å¼ï¼Œä»åŒä½å›¾æ”¹ä¸ºå•ä½å›¾è®¾è®¡ å‡å°‘ G1 åŸç”Ÿå†…å­˜æ¶ˆè€—ï¼ŒèŠ‚çœ 1.5% çš„ Java å †å¤§å° ä¼˜åŒ–å¹¶å‘æ ‡è®°å‘¨æœŸçš„æ€§èƒ½ è®°å¿†é›†ä¼˜åŒ–ï¼š\nå®ç°è®°å¿†é›†å€™é€‰é›†åˆçš„æ—©æœŸä¿®å‰ª å‡å°‘ 20% çš„è®°å¿†é›†å†…å­˜ä½¿ç”¨ æ”¹è¿›æ”¶é›†é›†å€™é€‰å¯¹è±¡çš„ç®¡ç†æ•ˆç‡ ZGC åƒåœ¾æ”¶é›†å™¨æ¼”è¿› ZGC ä¸“ä¸ºä½å»¶è¿Ÿè®¾è®¡ï¼Œé€‚åˆå¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„åœºæ™¯ã€‚\næ ¸å¿ƒç‰¹æ€§ï¼š\nè¶…ä½åœé¡¿æ—¶é—´ï¼šç›®æ ‡åœé¡¿æ—¶é—´ \u0026lt; 10msï¼Œä¸”ä¸éšå †å¤§å°å¢é•¿ å¹¶å‘å¤„ç†ï¼šå‡ ä¹æ‰€æœ‰ GC å·¥ä½œéƒ½å¹¶å‘è¿›è¡Œ å¤§å †å†…å­˜æ”¯æŒï¼šæ”¯æŒ 8MB åˆ° 16TB çš„å †å†…å­˜ Java 11 åˆ° Java 25 ä¸»è¦æ”¹è¿›ï¼š\nJava 11ï¼šZGC é¦–æ¬¡å¼•å…¥ï¼Œæ”¯æŒ Linux x64 Java 13ï¼šæ”¯æŒ Windows å’Œ macOS Java 14ï¼šæ”¯æŒ macOS å’Œ Windows Java 15ï¼šZGC æ­£å¼å‘å¸ƒï¼ˆJEP 377ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒå¯ç”¨ Java 16ï¼šæ”¯æŒå¹¶å‘çº¿ç¨‹æ ˆæ‰«æ Java 17ï¼šæ”¯æŒè¶…å¤§å †ï¼ˆ16TBï¼‰ Java 21ï¼šå¼€å§‹æ”¯æŒåˆ†ä»£ ZGCï¼ˆJEP 439ï¼‰ï¼Œå¤§å¹…æå‡æ€§èƒ½ Java 22ï¼šåˆ†ä»£ ZGC æ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ– Java 23ï¼šé»˜è®¤å¯ç”¨åˆ†ä»£ ZGC Java 24ï¼šJEP 490 ç§»é™¤ ZGC éä¸–ä»£æ¨¡å¼ åˆ†ä»£ ZGC çš„é‡å¤§æ”¹è¿›ï¼ˆJava 21ï¼‰ï¼š\nåˆ†ç¦»å¹´è½»ä»£å’Œè€å¹´ä»£ï¼šé’ˆå¯¹ä¸åŒç”Ÿå‘½å‘¨æœŸå¯¹è±¡é‡‡ç”¨ä¸åŒå›æ”¶ç­–ç•¥ æ€§èƒ½æå‡ï¼šç›¸æ¯”éåˆ†ä»£ç‰ˆæœ¬ï¼Œååé‡æå‡ 20-40% å»¶è¿Ÿä¼˜åŒ–ï¼šåœé¡¿æ—¶é—´è¿›ä¸€æ­¥é™ä½ å†…å­˜æ•ˆç‡ï¼šå‡å°‘å†…å­˜åˆ†é…å¼€é”€ï¼Œå®æµ‹è‡³å°‘é™ä½ 5%ï¼Œéƒ¨åˆ†åœºæ™¯é™ä½ 20% ZGC æ€§èƒ½ä¼˜åŒ– JEP è¯¦è§£ï¼š\nZGC æ­£å¼å‘å¸ƒï¼ˆJEP 377ï¼‰ - Java 15\nå¯æ‰©å±•çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼š\nåœé¡¿æ—¶é—´ \u0026lt; 10msï¼Œæ”¯æŒ 8MB åˆ° 16TB å †å†…å­˜ å¹¶å‘å¤„ç†å‡ ä¹æ‰€æœ‰ GC å·¥ä½œ ç‰¹åˆ«é€‚åˆå¤§å†…å­˜ã€ä½å»¶è¿Ÿè¦æ±‚çš„åº”ç”¨ # ZGC å‚æ•°é…ç½® -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+ZUncommit # åŠæ—¶å½’è¿˜å†…å­˜ -XX:ZUncommitDelay=300 # å½’è¿˜å»¶è¿Ÿæ—¶é—´\råˆ†ä»£ ZGCï¼ˆJEP 439ï¼‰ - Java 21\nZGC çš„åˆ†ä»£ç‰ˆæœ¬ï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼š\nåˆ†ç¦»å¹´è½»ä»£å’Œè€å¹´ä»£ç®¡ç†ç­–ç•¥ ååé‡ç›¸æ¯”éåˆ†ä»£ç‰ˆæœ¬æå‡ 20-40% åœé¡¿æ—¶é—´è¿›ä¸€æ­¥ä¼˜åŒ– # åˆ†ä»£ ZGC å‚æ•° -XX:+UseZGC -XX:+ZGenerational # å¯ç”¨åˆ†ä»£ ZGC -XX:+UseStringDeduplication # å­—ç¬¦ä¸²å»é‡\ræ€§èƒ½å†…å­˜ä¼˜åŒ–ä¸“é¡¹ é™¤äº†åƒåœ¾æ”¶é›†å™¨ä¼˜åŒ–å¤–ï¼Œè¿˜æœ‰å¤šä¸ªé€šç”¨çš„æ€§èƒ½å’Œå†…å­˜ä¼˜åŒ– JEPã€‚\nG1 å†…å­˜å½’è¿˜ï¼ˆJEP 346ï¼‰ - Java 12\nG1 åƒåœ¾æ”¶é›†å™¨çš„å†…å­˜å½’è¿˜æœºåˆ¶ï¼š\nä¸»åŠ¨å½’è¿˜æœªä½¿ç”¨çš„å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿ å†…å­˜ä½¿ç”¨æ•ˆç‡æå‡ 20-30%ï¼Œå‡å°‘å†…å­˜å ç”¨ ZGC å†…å­˜å½’è¿˜ï¼ˆJEP 377ï¼‰ - Java 15\nZGC çš„ä¸»åŠ¨å†…å­˜å½’è¿˜åŠŸèƒ½ï¼š\né»˜è®¤å¯ç”¨å†…å­˜å½’è¿˜ï¼ŒåŠæ—¶é‡Šæ”¾æœªä½¿ç”¨çš„å †å†…å­˜ é€šè¿‡ -XX:+ZUncommit å’Œ -XX:ZUncommitDelay å‚æ•°æ§åˆ¶ ç‰¹åˆ«é€‚åˆå†…å­˜ä½¿ç”¨æ³¢åŠ¨è¾ƒå¤§çš„åº”ç”¨ # ZGC å†…å­˜å½’è¿˜å‚æ•° -XX:+UseZGC -XX:+ZUncommit # å¯ç”¨å†…å­˜å½’è¿˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰ -XX:ZUncommitDelay=300 # å½’è¿˜å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰ -XX:MinHeapFreeRatio=20 # æœ€å°ç©ºé—²å †æ¯”ä¾‹\rå¼¹æ€§å…ƒç©ºé—´å†…å­˜å½’è¿˜ï¼ˆJEP 387ï¼‰ - Java 16\nå…ƒç©ºé—´çš„å†…å­˜å½’è¿˜ä¼˜åŒ–ï¼š\nåŠ¨æ€è°ƒæ•´å…ƒç©ºé—´å¤§å°ï¼ŒåŠæ—¶é‡Šæ”¾æœªä½¿ç”¨çš„ç±»å…ƒæ•°æ®å†…å­˜ å‡å°‘å†…å­˜ç¢ç‰‡åŒ–ï¼Œæé«˜å†…å­˜å½’è¿˜æ•ˆç‡ å†…å­˜èŠ‚çœ 20-40%ï¼Œç‰¹åˆ«é€‚åˆåŠ¨æ€ç±»åŠ è½½åœºæ™¯ # å¼¹æ€§å…ƒç©ºé—´å‚æ•° -XX:MetaspaceSize=64m # åˆå§‹å¤§å° -XX:MaxMetaspaceSize=256m # æœ€å¤§å¤§å° -XX:+UseCompressedClassPointers # å¯ç”¨ç±»æŒ‡é’ˆå‹ç¼© -XX:MetaspaceReclaimPolicy=aggressive # ç§¯æå›æ”¶ç­–ç•¥\rç´§å‡‘å­—ç¬¦ä¸²ï¼ˆJEP 254ï¼‰ - Java 9\nä¼ ç»Ÿ Java String ä½¿ç”¨ UTF-16 ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å ç”¨ 2 å­—èŠ‚ã€‚JEP 254 å¼•å…¥æ™ºèƒ½ç¼–ç é€‰æ‹©ï¼š\nLatin-1 å­—ç¬¦ï¼ˆå¦‚è‹±æ–‡ã€æ•°å­—ï¼‰ä½¿ç”¨ 1 å­—èŠ‚å­˜å‚¨ å…¶ä»–å­—ç¬¦ä»ä½¿ç”¨ 2 å­—èŠ‚å­˜å‚¨ å†…å­˜èŠ‚çœï¼šçº¯ ASCII/Latin-1 å­—ç¬¦ä¸²å¯èŠ‚çœ 50% å†…å­˜ // Java 8: æ¯ä¸ªå­—ç¬¦ 2 å­—èŠ‚ String english = \u0026#34;Hello World\u0026#34;; // 22 å­—èŠ‚ // Java 9+: æ™ºèƒ½é€‰æ‹©ç¼–ç  String english = \u0026#34;Hello World\u0026#34;; // 11 å­—èŠ‚ï¼ˆèŠ‚çœ 50%ï¼‰ String chinese = \u0026#34;ä½ å¥½ä¸–ç•Œ\u0026#34;; // 8 å­—èŠ‚ï¼ˆä»ä¸º UTF-16ï¼‰\rå­—ç¬¦ä¸²å»é‡ï¼ˆJEP 192ï¼‰ - Java 8u20\nG1 åƒåœ¾æ”¶é›†å™¨ä¸­çš„å­—ç¬¦ä¸²å»é‡åŠŸèƒ½ï¼š\nè‡ªåŠ¨è¯†åˆ«å †ä¸­å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²å¯¹è±¡ åˆå¹¶é‡å¤å­—ç¬¦ä¸²ï¼Œå‡å°‘å†…å­˜å ç”¨ ç‰¹åˆ«é€‚ç”¨äºå¤§é‡é‡å¤å­—ç¬¦ä¸²çš„åº”ç”¨ // å¯ç”¨å­—ç¬¦ä¸²å»é‡ï¼ˆG1 é»˜è®¤å¯ç”¨ï¼‰ -XX:+UseStringDeduplication // é€‚ç”¨åœºæ™¯ï¼šé…ç½®æ–‡ä»¶è§£æã€æ—¥å¿—å¤„ç†ã€æ•°æ®å¯¼å…¥ç­‰ List\u0026lt;String\u0026gt; configs = Arrays.asList(\u0026#34;server.port=8080\u0026#34;, \u0026#34;server.port=8080\u0026#34;, \u0026#34;server.port=8080\u0026#34;); // ä¸‰ä¸ªå­—ç¬¦ä¸²å¯¹è±¡åˆå¹¶ä¸ºä¸€ä¸ªï¼ŒèŠ‚çœ 2/3 å†…å­˜\rå­—ç¬¦ä¸²è¿æ¥ä¼˜åŒ–ï¼ˆJEP 280ï¼‰ - Java 9\nä½¿ç”¨ invokedynamic åŠ¨æ€é€‰æ‹©æœ€ä¼˜å­—ç¬¦ä¸²è¿æ¥ç­–ç•¥ï¼š\nå‡å°‘ä¸´æ—¶ StringBuilder å¯¹è±¡åˆ›å»º é™ä½å†…å­˜åˆ†é…å‹åŠ› æå‡å­—ç¬¦ä¸²è¿æ¥æ€§èƒ½ // Java 8: å¯èƒ½åˆ›å»ºå¤šä¸ªä¸´æ—¶å¯¹è±¡ String result = \u0026#34;Hello\u0026#34; + \u0026#34; \u0026#34; + \u0026#34;World\u0026#34; + \u0026#34;!\u0026#34;; // Java 9+: åŠ¨æ€ä¼˜åŒ–ï¼Œå‡å°‘ä¸´æ—¶å¯¹è±¡ String result = \u0026#34;Hello\u0026#34; + \u0026#34; \u0026#34; + \u0026#34;World\u0026#34; + \u0026#34;!\u0026#34;;\rç´§å‡‘å¯¹è±¡å¤´ï¼ˆJEP 519ï¼‰ - Java 24/25\nä½œä¸º Java 24/25 æœ€å…·æ€§ä»·æ¯”ç‰¹æ€§ï¼Œä»…éœ€ä¸€ä¸ª JVM å¯åŠ¨å‚æ•°ï¼Œå³å¯å¼€å¯ï¼Œåº”ç”¨æ— éœ€æ”¹ä»£ç ï¼Œæ— ä»»ä½• API å˜æ›´ã€‚\nå‡å°‘å¯¹è±¡å¤´å¤§å°ï¼Œé™ä½æ¯ä¸ªå¯¹è±¡çš„å†…å­˜å¼€é”€ï¼š\nå°†å¯¹è±¡å¤´ä»åŸæ¥çš„ 12 å­—èŠ‚å‹ç¼©æˆ 8 å­—èŠ‚ å°†ç±»æŒ‡é’ˆä» 32-bit å‹ç¼©ä¸º 22-bit æ•´ä½“å†…å­˜ä½¿ç”¨å¯é™ä½ 3-5%ï¼Œæœ€å¤š 22% å †å†…å­˜èŠ‚çœ æœ€é«˜ 30% CPU å‡å°‘ï¼ˆAmazon çº¿ä¸Šå®æµ‹ï¼‰ GC é¢‘ç‡é™ä½ 15% Jackson JSON è§£æï¼Œæ‰§è¡Œæ—¶é—´å‡å°‘ 10%ï¼Œ reddit æ–‡æ¡£ ç‰¹åˆ«æœ‰åˆ©äºå¤§é‡å°å¯¹è±¡çš„åº”ç”¨ï¼Œå¾®æœåŠ¡ã€Spring Bootã€JSON è§£æã€Map/Set å¯†é›†ä½¿ç”¨ç­‰åœºæ™¯ ç§»é™¤ 32 ä½ x86 ç§»æ¤ç‰ˆæœ¬ï¼ˆJEP 503ï¼‰ - Java 25\nç§»é™¤å¯¹ 32 ä½ x86 æ¶æ„çš„æ”¯æŒï¼Œä¸“æ³¨ç°ä»£ 64 ä½ä¼˜åŒ–ï¼š\nç®€åŒ–ä»£ç åº“ï¼šç§»é™¤ 32 ä½ç›¸å…³çš„å†…å­˜å¯¹é½å’Œä¼˜åŒ–ä»£ç  ä¸“æ³¨ 64 ä½ä¼˜åŒ–ï¼šJVM å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç°ä»£ 64 ä½æ¶æ„ç‰¹æ€§ å‡å°‘ç»´æŠ¤è´Ÿæ‹…ï¼šå¼€å‘å›¢é˜Ÿå¯ä»¥ä¸“æ³¨äº 64 ä½å¹³å°çš„æ€§èƒ½ä¼˜åŒ– å†…å­˜æ•ˆç‡æå‡ï¼šç§»é™¤ 32 ä½å…¼å®¹æ€§ä»£ç ï¼Œå‡å°‘ JVM å†…å­˜å ç”¨ æŒ‡é’ˆä¼˜åŒ–ï¼š64 ä½æ¶æ„ä¸‹çš„å‹ç¼© OOP ä¼˜åŒ–æ›´é«˜æ•ˆ SIMD æŒ‡ä»¤é›†ï¼šæ›´å¥½åœ°åˆ©ç”¨ç°ä»£ CPU çš„å‘é‡åŒ–æŒ‡ä»¤ åƒåœ¾æ”¶é›†å™¨ä¼˜åŒ–ï¼šG1ã€ZGC ç­‰æ”¶é›†å™¨é’ˆå¯¹ 64 ä½æ¶æ„æ·±åº¦ä¼˜åŒ– å†…å­˜ä¼˜åŒ–æ•ˆæœæ€»ç»“ï¼š\nä¼˜åŒ–é¡¹ç›® å†…å­˜èŠ‚çœ é€‚ç”¨åœºæ™¯ G1 å†…å­˜å½’è¿˜ 20-30% æ‰€æœ‰ G1 åº”ç”¨ ZGC å†…å­˜å½’è¿˜ 15-25% å¤§å†…å­˜æ³¢åŠ¨åº”ç”¨ å¼¹æ€§å…ƒç©ºé—´ 20-40% åŠ¨æ€ç±»åŠ è½½ ç´§å‡‘å­—ç¬¦ä¸² 50%ï¼ˆçº¯ ASCIIï¼‰ æ–‡æœ¬å¤„ç†ã€é…ç½®æ–‡ä»¶ å­—ç¬¦ä¸²å»é‡ 10-30% å¤§é‡é‡å¤å­—ç¬¦ä¸² ç´§å‡‘å¯¹è±¡å¤´ 3-5% å¤§é‡å°å¯¹è±¡ ç§»é™¤ 32 ä½æ”¯æŒ 5-10% æ‰€æœ‰ 64 ä½åº”ç”¨ æŠ€æœ¯å˜é© 30 å²çš„ Java è¿˜èƒ½æ‰“å—ï¼Œæœªæ¥åˆèƒ½é™ªæˆ‘ä»¬èµ°å¤šè¿œã€‚\nJava è¿‡å»è¢«è¯Ÿç—…â€œå•°å—¦ã€å…¥é—¨é—¨æ§›é«˜ã€å†…å­˜å ç”¨å¤§â€ï¼Œä½†ç¤¾åŒºä¸ç”Ÿæ€çš„æŒç»­æ”¹è¿›ï¼Œå·²ç»å¤§å¹…æ”¹å–„äº†è¿™äº›é—®é¢˜ã€‚è¿‘å¹´çš„ OpenJDK é‡ç‚¹é¡¹ç›®å°¤ä¸ºäº®çœ¼ï¼š\nProject Loomï¼šå¼•å…¥è™šæ‹Ÿçº¿ç¨‹ï¼Œè®©ç™¾ä¸‡çº§å¹¶å‘è¿æ¥å¼€å‘å˜å¾—ç®€å•é«˜æ•ˆã€‚ Project Valhallaï¼šå¢åŠ å€¼ç±»å‹ï¼Œå‡å°‘å†…å­˜å¼€é”€ï¼Œæé«˜æ•°æ®å¯†é›†å‹ä»»åŠ¡æ€§èƒ½ã€‚ Project Panamaï¼šè®© Java ä¸ C/C++ ç­‰è¯­è¨€çš„äº’æ“ä½œæ›´å®‰å…¨é«˜æ•ˆï¼Œå°¤å…¶é€‚é… AI å·¥ä½œè´Ÿè½½ã€‚ å†åŠ ä¸Š Quarkusã€Micronautã€Spring Boot ä»¥åŠ GraalVM çš„åŸç”Ÿç¼–è¯‘ï¼ŒJava åœ¨å¯åŠ¨é€Ÿåº¦ã€å»¶è¿Ÿæ§åˆ¶ç­‰æ–¹é¢çš„çŸ­æ¿æ­£åœ¨è¢«è¿…é€Ÿè¡¥é½ã€‚\næˆ‘ä»¬æ¥ä»‹ç»å‡ ä¸ªèƒ½ç§°å¾—ä¸ŠæŠ€æœ¯å˜é©çš„ç‰¹æ€§ã€‚\næ¶æ„è®¾è®¡é©å‘½ï¼šæ¨¡å—ç³»ç»Ÿï¼ˆJEP 261ï¼‰ - Java 9\næ¨¡å—ç³»ç»Ÿæ˜¯ Java æ¶æ„è®¾è®¡çš„æ ¹æœ¬æ€§å˜é©ï¼š\nå¼ºå°è£…ï¼šçœŸæ­£çš„è®¿é—®æ§åˆ¶ï¼Œé˜²æ­¢å†…éƒ¨ API è¢«è¯¯ç”¨ ä¾èµ–ç®¡ç†ç°ä»£åŒ–ï¼šæ˜¾å¼å£°æ˜æ¨¡å—ä¾èµ–ï¼Œè§£å†³ JAR Hell é—®é¢˜ åº”ç”¨æ¶æ„ä¼˜åŒ–ï¼šæ”¯æŒæ¨¡å—åŒ–åº”ç”¨è®¾è®¡ï¼Œæé«˜å¯ç»´æŠ¤æ€§ JVM å¯åŠ¨ä¼˜åŒ–ï¼šåªåŠ è½½å¿…è¦çš„æ¨¡å—ï¼Œæå‡å¯åŠ¨æ€§èƒ½ // module-info.java module com.example.myapp { requires java.base; requires java.logging; requires java.net.http; exports com.example.api; exports com.example.internal to com.example.test; provides com.example.spi.ServiceProvider with com.example.impl.DefaultServiceProvider; }\rå¹¶å‘ç¼–ç¨‹é©å‘½ï¼šè™šæ‹Ÿçº¿ç¨‹ï¼ˆJEP 444ï¼‰ - Java 21\nè™šæ‹Ÿçº¿ç¨‹æ˜¯ Java å¹¶å‘ç¼–ç¨‹çš„é©å‘½æ€§å˜é©ï¼Œå½»åº•æ”¹å˜äº†ä¼ ç»Ÿçš„çº¿ç¨‹æ¨¡å‹ï¼š\nç™¾ä¸‡çº§å¹¶å‘æ”¯æŒï¼šä»ä¼ ç»Ÿçš„æ•°åƒä¸ªå¹³å°çº¿ç¨‹æ‰©å±•åˆ°ç™¾ä¸‡çº§è™šæ‹Ÿçº¿ç¨‹ ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ï¼šæ¶ˆé™¤å¤æ‚çš„å›è°ƒåœ°ç‹±ï¼Œè®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç  èµ„æºæ•ˆç‡é©å‘½ï¼šè™šæ‹Ÿçº¿ç¨‹æ¶ˆè€—æå°‘å†…å­˜ï¼ˆKB çº§åˆ« vs MB çº§åˆ«ï¼‰ ç¼–ç¨‹æ¨¡å‹å˜é©ï¼šä»\u0026quot;çº¿ç¨‹æ± ç®¡ç†\u0026quot;è½¬å‘\u0026quot;ä»»åŠ¡ç›´æ¥æäº¤\u0026quot; // ä¼ ç»Ÿçº¿ç¨‹æ± æ–¹å¼ï¼ˆå¤æ‚ä¸”èµ„æºæ¶ˆè€—å¤§ï¼‰ ExecutorService executor = Executors.newFixedThreadPool(100); for (int i = 0; i \u0026lt; 10000; i++) { executor.submit(() -\u0026gt; { // å¤„ç†ä»»åŠ¡ }); } // è™šæ‹Ÿçº¿ç¨‹æ–¹å¼ï¼ˆç®€æ´ä¸”é«˜æ•ˆï¼‰ try (var executor = Executors.newVirtualThreadPerTaskExecutor()) { for (int i = 0; i \u0026lt; 10000; i++) { executor.submit(() -\u0026gt; { // å¤„ç†ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿçº¿ç¨‹ }); } }\rç„¶è€Œï¼Œè™šæ‹Ÿçº¿ç¨‹å¼•å…¥åï¼Œå¼€å‘è€…å‘ç°äº†ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šsynchronized å¯¼è‡´çš„ Pinningã€‚\nå½“è™šæ‹Ÿçº¿ç¨‹åœ¨ synchronized å—å†…å‘ç”Ÿé˜»å¡æ“ä½œæ—¶ï¼Œè™šæ‹Ÿçº¿ç¨‹ä¼šè¢«\u0026quot;å›ºå®š\u0026quot;ï¼ˆpinnedï¼‰åˆ°è½½ä½“çº¿ç¨‹ä¸Šï¼Œæ— æ³•é‡Šæ”¾è½½ä½“çº¿ç¨‹ä¾›å…¶ä»–è™šæ‹Ÿçº¿ç¨‹ä½¿ç”¨ï¼š\n// é—®é¢˜ä»£ç ï¼šsynchronized å¯¼è‡´ pinning public class PinningExample { private final Object lock = new Object(); public void problematicMethod() { synchronized (lock) { // å¦‚æœåœ¨åŒæ­¥å—å†…å‘ç”Ÿé˜»å¡ï¼Œè™šæ‹Ÿçº¿ç¨‹ä¼šè¢«å›ºå®š try { Thread.sleep(1000); // é˜»å¡æ“ä½œï¼ // æˆ–è€…ï¼šFiles.readString(path); // IO é˜»å¡ } catch (InterruptedException e) { Thread.currentThread().interrupt(); } } } }\rJava 24 é€šè¿‡ä¼˜åŒ–å¯¹è±¡ç›‘è§†å™¨çš„å®ç°ï¼Œè§£å†³äº† synchronized å¯¼è‡´çš„ pinning é—®é¢˜ï¼š\næ™ºèƒ½ Pinningï¼šJVM ç°åœ¨èƒ½å¤Ÿæ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦å›ºå®šè™šæ‹Ÿçº¿ç¨‹ å»¶è¿Ÿ Pinningï¼šåªåœ¨çœŸæ­£éœ€è¦æ—¶æ‰å›ºå®šè™šæ‹Ÿçº¿ç¨‹åˆ°è½½ä½“çº¿ç¨‹ æ€§èƒ½æå‡ï¼šå¤§å¹…å‡å°‘äº†è™šæ‹Ÿçº¿ç¨‹è¢«å›ºå®šçš„æƒ…å†µï¼Œæé«˜å¹¶å‘æ€§èƒ½ // Java 24+ ä¼˜åŒ–åçš„ä»£ç  public class OptimizedExample { private final Object lock = new Object(); public void optimizedMethod() { synchronized (lock) { // Java 24 ä¸­ï¼Œå³ä½¿æœ‰é˜»å¡æ“ä½œï¼Œè™šæ‹Ÿçº¿ç¨‹ä¹Ÿèƒ½æ­£ç¡®é‡Šæ”¾ try { Thread.sleep(1000); // ä¸å†å¯¼è‡´ pinning // æˆ–è€…ï¼šFiles.readString(path); // IO é˜»å¡ä¹Ÿèƒ½æ­£ç¡®å¤„ç† } catch (InterruptedException e) { Thread.currentThread().interrupt(); } } } } // æ¨èåšæ³•ï¼šä½¿ç”¨ ReentrantLock æ›¿ä»£ synchronized public class BestPracticeExample { private final ReentrantLock lock = new ReentrantLock(); public void bestPracticeMethod() { lock.lock(); try { // ä½¿ç”¨ ReentrantLockï¼Œè™šæ‹Ÿçº¿ç¨‹æ°¸è¿œä¸ä¼šè¢«å›ºå®š Thread.sleep(1000); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } finally { lock.unlock(); } } }\rå†…å­˜ç®¡ç†é©æ–°ï¼šå¤–éƒ¨å­˜å‚¨å™¨è®¿é—® APIï¼ˆJEP 393, 412, 442, 454ï¼‰ - Java 16/17/19/20\nå¤–éƒ¨å­˜å‚¨å™¨è®¿é—® API æ˜¯ Java å†…å­˜ç®¡ç†çš„é‡å¤§å˜é©ï¼š\nå®‰å…¨å †å¤–å†…å­˜è®¿é—®ï¼šæ›¿ä»£å±é™©çš„ Unsafe APIï¼Œæä¾›ç±»å‹å®‰å…¨çš„å†…å­˜æ“ä½œ é›¶æ‹·è´ä¼˜åŒ–ï¼šç›´æ¥æ“ä½œå †å¤–å†…å­˜ï¼Œé¿å… JVM å †ä¸ç³»ç»Ÿå†…å­˜é—´çš„æ•°æ®æ‹·è´ é«˜æ€§èƒ½åº”ç”¨æ”¯æŒï¼šä¸ºå¤§æ•°æ®ã€æœºå™¨å­¦ä¹ ã€æ¸¸æˆå¼•æ“ç­‰é«˜æ€§èƒ½åœºæ™¯æä¾›æ”¯æŒ èµ„æºç®¡ç†ç°ä»£åŒ–ï¼šåŸºäºä½œç”¨åŸŸçš„èµ„æºç®¡ç†ï¼Œç¡®ä¿å†…å­˜å®‰å…¨ // ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨ Unsafeï¼ˆå±é™©ä¸”ä¸æ¨èï¼‰ // Unsafe unsafe = Unsafe.getUnsafe(); // long address = unsafe.allocateMemory(size); // ç°ä»£æ–¹å¼ï¼šä½¿ç”¨å¤–éƒ¨å­˜å‚¨å™¨è®¿é—® API try (MemorySession session = MemorySession.openConfined()) { MemorySegment segment = MemorySegment.allocateNative(1024, session); // ç±»å‹å®‰å…¨çš„å†…å­˜è®¿é—® VarHandle handle = MemoryLayout.sequenceLayout(1024, ValueLayout.JAVA_INT) .varHandle(MemoryLayout.PathElement.sequenceElement()); handle.set(segment, 0, 42); // è®¾ç½®ç¬¬ä¸€ä¸ªæ•´æ•° int value = (int) handle.get(segment, 0); // è¯»å–ç¬¬ä¸€ä¸ªæ•´æ•° }\rå¹³å°ç°ä»£åŒ–ï¼šGraalVM åŸç”Ÿé•œåƒï¼ˆJEP 391, 457ï¼‰ - Java 16/21\nGraalVM åŸç”Ÿé•œåƒä»£è¡¨äº† Java å¹³å°çš„ç°ä»£åŒ–æ–¹å‘ï¼š\nAOT ç¼–è¯‘ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œè¿è¡Œæ—¶æ— éœ€ JIT ç¼–è¯‘ æè‡´å¯åŠ¨é€Ÿåº¦ï¼šæ¯«ç§’çº§å¯åŠ¨æ—¶é—´ï¼Œé€‚åˆ Serverless å’Œå®¹å™¨åŒ– å†…å­˜å ç”¨ä¼˜åŒ–ï¼šåªåŒ…å«åº”ç”¨éœ€è¦çš„ä»£ç ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ äº‘åŸç”Ÿå‹å¥½ï¼šå®Œç¾é€‚é…å®¹å™¨å’Œå¾®æœåŠ¡æ¶æ„ # ç”ŸæˆåŸç”Ÿé•œåƒ native-image --no-fallback \\ --enable-preview \\ -jar myapp.jar \\ myapp-native # è¿è¡ŒåŸç”Ÿé•œåƒï¼ˆæ— éœ€ JVMï¼‰ ./myapp-native\ræ€§èƒ½ç›‘æ§é©å‘½ï¼šJava Flight Recorderï¼ˆJFRï¼‰ - Java 8 åˆ° 25\nJava Flight Recorderï¼ˆJFRï¼‰æ˜¯ Java å¹³å°çš„æ€§èƒ½ç›‘æ§é©å‘½ï¼Œæä¾›äº†ç”Ÿäº§çº§ä½å¼€é”€çš„äº‹ä»¶æ”¶é›†å’Œåˆ†æèƒ½åŠ›ã€‚å®ƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„å¼€é”€é€šå¸¸ä½äº 1%ï¼Œå¯ä»¥é•¿æœŸè¿è¡Œè€Œä¸å½±å“åº”ç”¨æ€§èƒ½ï¼Œè¦†ç›–æ“ä½œç³»ç»Ÿã€JVMã€åº”ç”¨ç¨‹åºçº§åˆ«çš„è¯¦ç»†ç›‘æ§ï¼Œä¸ Java Mission Control é›†æˆæä¾›å¯è§†åŒ–åˆ†æï¼Œå®ç°å†…å­˜æ³„æ¼ã€æ€§èƒ½ç“¶é¢ˆã€GC é—®é¢˜çš„ä¸€ç«™å¼è¯Šæ–­ã€‚\n// å¯åŠ¨ JFR è®°å½• java -XX:+FlightRecorder \\ -XX:StartFlightRecording=duration=60s,filename=app.jfr \\ -jar MyApp.jar // è‡ªå®šä¹‰ JFR äº‹ä»¶ @Name(\u0026#34;com.example.CustomEvent\u0026#34;) @Label(\u0026#34;Custom Business Event\u0026#34;) @Category(\u0026#34;Business\u0026#34;) public class CustomEvent extends Event { @Label(\u0026#34;User ID\u0026#34;) public long userId; @Label(\u0026#34;Operation Duration\u0026#34;) public long duration; @Label(\u0026#34;Success\u0026#34;) public boolean success; } // è®°å½•è‡ªå®šä¹‰äº‹ä»¶ public class BusinessService { public void processUser(long userId) { try (var event = new CustomEvent()) { event.userId = userId; event.begin(); // æ‰§è¡Œä¸šåŠ¡é€»è¾‘ doBusinessLogic(); event.success = true; } catch (Exception e) { // å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿä¼šè®°å½•äº‹ä»¶ } } }\rJFR çš„å‘å±•å†ç¨‹ç»å†äº†å¤šä¸ªé‡è¦é˜¶æ®µã€‚\nJava 8 é¦–æ¬¡å¼•å…¥ JFR ä½œä¸ºå•†ä¸šåŠŸèƒ½ï¼Œä½†ä»…é™ Oracle JDK ä½¿ç”¨ã€‚ç›´åˆ° Java 11 çš„ JEP 328ï¼ŒJFR æ‰è¢«é›†æˆåˆ° OpenJDK æˆä¸ºå¼€æºåŠŸèƒ½ï¼Œæä¾›å®Œæ•´çš„ JFR API å’Œäº‹ä»¶æ¡†æ¶ï¼Œæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶å’Œé…ç½®ã€‚\n# Java 11+ å¯åŠ¨ JFR java -XX:+FlightRecorder \\ -XX:StartFlightRecording=settings=profile \\ -jar MyApp.jar\rJava 14 çš„ JEP 349 å¼•å…¥äº†äº‹ä»¶æµ APIï¼Œæ”¯æŒå®æ—¶äº‹ä»¶å¤„ç†ï¼Œå…è®¸ç¨‹åºåŒ–è®¿é—® JFR äº‹ä»¶æ•°æ®ï¼Œæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨ã€‚\n// äº‹ä»¶æµ API ç¤ºä¾‹ try (var es = FlightRecorder.getFlightRecorder().getEventStream()) { es.onEvent(\u0026#34;jdk.GarbageCollection\u0026#34;, event -\u0026gt; { System.out.println(\u0026#34;GC: \u0026#34; + event.getString(\u0026#34;name\u0026#34;) + \u0026#34;, duration: \u0026#34; + event.getDuration()); }); es.start(); }\rJava 17 çš„ JEP 380 å®Œå–„äº†äº‹ä»¶æµ API çš„ç¨³å®šæ€§ï¼Œæä¾›æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†ï¼Œæ”¯æŒæ›´å¤æ‚çš„äº‹ä»¶è¿‡æ»¤å’Œå¤„ç†ã€‚\nJava 25 å¸¦æ¥äº†ä¸‰ä¸ªé‡è¦çš„ JFR å¢å¼ºã€‚\nJEP 509 åœ¨ Linux ä¸Šæä¾›é«˜ç²¾åº¦ CPU æ—¶é—´é‡‡æ ·ï¼Œæ”¯æŒæ›´è¯¦ç»†çš„ CPU ä½¿ç”¨åˆ†æï¼Œå¸®åŠ©è¯†åˆ« CPU å¯†é›†å‹æ“ä½œã€‚\n# Java 25 CPU å‰–æå¢å¼º java -XX:+FlightRecorder \\ -XX:+FlightRecorderOption=EnableCPUProfiling \\ -jar MyApp.jar\rJEP 518 æ”¹è¿›äº†é‡‡æ ·æœºåˆ¶ï¼Œå‡å°‘å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“ï¼Œæ”¯æŒä¸å…¶ä»–ç›‘æ§å·¥å…·çš„åä½œï¼Œæä¾›æ›´å‡†ç¡®çš„æ€§èƒ½æ•°æ®ã€‚\nJEP 520 æ·»åŠ äº†æ–¹æ³•çº§åˆ«çš„æ‰§è¡Œæ—¶é—´è·Ÿè¸ªï¼Œæ”¯æŒæ–¹æ³•è°ƒç”¨é“¾åˆ†æï¼Œå¸®åŠ©è¯†åˆ«æ€§èƒ½çƒ­ç‚¹æ–¹æ³•ã€‚\n// Java 25 æ–¹æ³•è·Ÿè¸ªå¢å¼º @JfrEvent public class MethodExecutionEvent extends Event { @Label(\u0026#34;Method Name\u0026#34;) public String methodName; @Label(\u0026#34;Class Name\u0026#34;) public String className; @Label(\u0026#34;Execution Time\u0026#34;) public long executionTime; }\ré€šè¿‡ Java å¯åŠ¨å‘½ä»¤è¡Œç›‘æ§æ–¹æ³•çº§åˆ«çš„æ‰§è¡Œï¼š\n# é’ˆå¯¹ç‰¹å®šåŒ…çš„æ–¹æ³•ç›‘æ§ java -XX:+FlightRecorder \\ -XX:StartFlightRecording=settings=profile \\ -XX:FlightRecorderOption=EnableMethodProfiling=true \\ -XX:FlightRecorderOption=MethodProfilingInclude=com.example.business.* \\ -XX:FlightRecorderOption=MethodProfilingExclude=com.example.util.* \\ -jar MyApp.jar\rå¯¹äºä¸šåŠ¡å…³é”®äº‹ä»¶ï¼Œå¯ä»¥è®¾è®¡è‡ªå®šä¹‰äº‹ä»¶æ¥è·Ÿè¸ªé‡è¦çš„ä¸šåŠ¡æ“ä½œï¼š\n// ä¸šåŠ¡å…³é”®äº‹ä»¶ @Name(\u0026#34;com.company.OrderProcessing\u0026#34;) @Label(\u0026#34;Order Processing Event\u0026#34;) public class OrderProcessingEvent extends Event { @Label(\u0026#34;Order ID\u0026#34;) public String orderId; @Label(\u0026#34;Processing Stage\u0026#34;) public String stage; @Label(\u0026#34;Customer ID\u0026#34;) public long customerId; }\räº‹ä»¶æµç›‘æ§å¯ä»¥å®æ—¶å¤„ç† JFR äº‹ä»¶ï¼Œå®ç°åŠ¨æ€çš„ç›‘æ§å’Œå‘Šè­¦ï¼š\n// å®æ—¶ç›‘æ§ç¤ºä¾‹ public class JFRMonitor { public void startMonitoring() { try (var es = FlightRecorder.getFlightRecorder().getEventStream()) { es.onEvent(\u0026#34;jdk.ThreadStart\u0026#34;, this::handleThreadStart); es.onEvent(\u0026#34;jdk.GarbageCollection\u0026#34;, this::handleGC); es.onEvent(\u0026#34;com.company.OrderProcessing\u0026#34;, this::handleOrder); es.start(); } } }\rJFR çš„æŠ€æœ¯ä»·å€¼ä½“ç°åœ¨å¤šä¸ªæ–¹é¢ï¼šæ— éœ€åœæœºå³å¯è·å–è¯¦ç»†çš„æ€§èƒ½æ•°æ®ï¼Œå¿«é€Ÿå®šä½å†…å­˜æ³„æ¼ã€GC é—®é¢˜ã€æ€§èƒ½ç“¶é¢ˆï¼ŒåŸºäºçœŸå®æ•°æ®åšå‡ºæ‰©å®¹å’Œä¼˜åŒ–å†³ç­–ï¼Œé€šè¿‡æ•°æ®é©±åŠ¨çš„ä¼˜åŒ–æå‡åº”ç”¨æ€§èƒ½ã€‚\nJFR ä»£è¡¨äº† Java å¹³å°ç›‘æ§èƒ½åŠ›çš„æ ¹æœ¬æ€§æå‡ï¼Œä»ä¼ ç»Ÿçš„æ—¥å¿—åˆ†æè½¬å‘äº†äº‹ä»¶é©±åŠ¨çš„æ€§èƒ½åˆ†æï¼Œä¸ºç°ä»£ Java åº”ç”¨æä¾›äº†å¼ºå¤§çš„å¯è§‚æµ‹æ€§æ”¯æŒã€‚\nAI è®¡ç®—é©å‘½ï¼šå‘é‡ APIï¼ˆJEP 338, 414, 417, 426, 438, 460, 489ï¼‰ - Java 16 åˆ° 25\nå‘é‡ API æ˜¯ Java åœ¨ AI æ—¶ä»£çš„é‡è¦æŠ€æœ¯é©å‘½ï¼Œé€šè¿‡ SIMDï¼ˆå•æŒ‡ä»¤å¤šæ•°æ®ï¼‰æŠ€æœ¯å®ç°é«˜æ€§èƒ½å¹¶è¡Œè®¡ç®—ï¼š\nSIMD å¹¶è¡Œè®¡ç®—ï¼šå•æ¡æŒ‡ä»¤å¤„ç†å¤šä¸ªæ•°æ®å…ƒç´ ï¼Œå……åˆ†åˆ©ç”¨ç°ä»£ CPU çš„å‘é‡å¤„ç†å•å…ƒ AI æ€§èƒ½æå‡ï¼šæœºå™¨å­¦ä¹ æ¨ç†é€Ÿåº¦æå‡ 30-50%ï¼Œå·ç§¯ç¥ç»ç½‘ç»œè®­ç»ƒé€Ÿåº¦æå‡çº¦ 50% è·¨å¹³å°å…¼å®¹ï¼šè‡ªåŠ¨é€‚é…ä¸åŒç¡¬ä»¶æ¶æ„ï¼Œæ— éœ€æ·±å…¥äº†è§£åº•å±‚å®ç° ç§‘å­¦è®¡ç®—ä¼˜åŒ–ï¼šçŸ©é˜µè¿ç®—ã€å›¾åƒå¤„ç†ç­‰è®¡ç®—å¯†é›†å‹ä»»åŠ¡æ€§èƒ½å¤§å¹…æå‡ // å‘é‡ API åŸºç¡€ä½¿ç”¨ import jdk.incubator.vector.*; public class VectorAPIExample { public static void main(String[] args) { // åˆ›å»ºå‘é‡ VectorSpecies\u0026lt;Float\u0026gt; species = FloatVector.SPECIES_256; float[] a = {1.0f, 2.0f, 3.0f, 4.0f, 5.0f, 6.0f, 7.0f, 8.0f}; float[] b = {2.0f, 3.0f, 4.0f, 5.0f, 6.0f, 7.0f, 8.0f, 9.0f}; float[] c = new float[a.length]; // å‘é‡åŒ–è®¡ç®— for (int i = 0; i \u0026lt; a.length; i += species.length()) { var va = FloatVector.fromArray(species, a, i); var vb = FloatVector.fromArray(species, b, i); var vc = va.add(vb); vc.intoArray(c, i); } } } // AI æ¨ç†ä¸­çš„å‘é‡è®¡ç®— public class AIInference { public static void matrixMultiply(float[] a, float[] b, float[] result, int rows, int cols) { VectorSpecies\u0026lt;Float\u0026gt; species = FloatVector.SPECIES_256; for (int i = 0; i \u0026lt; rows; i++) { for (int j = 0; j \u0026lt; cols; j += species.length()) { var va = FloatVector.fromArray(species, a, i * cols + j); var vb = FloatVector.fromArray(species, b, j); var vc = va.mul(vb); vc.intoArray(result, i * cols + j); } } } } // å›¾åƒå¤„ç†ä¸­çš„å‘é‡æ“ä½œ public class ImageProcessing { public static void applyFilter(float[] pixels, float[] filter, float[] output, int width, int height) { VectorSpecies\u0026lt;Float\u0026gt; species = FloatVector.SPECIES_256; for (int y = 0; y \u0026lt; height; y++) { for (int x = 0; x \u0026lt; width; x += species.length()) { var vpixels = FloatVector.fromArray(species, pixels, y * width + x); var vfilter = FloatVector.fromArray(species, filter, 0); var vresult = vpixels.mul(vfilter); vresult.intoArray(output, y * width + x); } } } }\rå‘é‡ API çš„å‘å±•å†ç¨‹ä½“ç°äº† Java åœ¨ AI æ—¶ä»£çš„æŒç»­æ¼”è¿›ï¼š\nJava 16 é¦–æ¬¡å¼•å…¥å‘é‡ API ä½œä¸ºå­µåŒ–å™¨åŠŸèƒ½ï¼ˆJEP 338ï¼‰ï¼Œæä¾›äº†åŸºç¡€çš„å‘é‡æ“ä½œèƒ½åŠ›ã€‚Java 17 çš„ JEP 414 è¿›ä¸€æ­¥å®Œå–„äº† API è®¾è®¡ï¼Œå¢å¼ºäº†ç±»å‹å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚\nJava 18 çš„ JEP 417 å’Œ Java 19 çš„ JEP 426 æŒç»­ä¼˜åŒ–äº†å‘é‡ API çš„æ€§èƒ½å’Œæ˜“ç”¨æ€§ï¼Œæ”¯æŒæ›´å¤šæ•°æ®ç±»å‹å’Œæ“ä½œã€‚Java 20 çš„ JEP 438 å¼•å…¥äº†å‘é‡æ©ç å’Œæ›´å¤æ‚çš„å‘é‡æ“ä½œã€‚\nJava 21 çš„ JEP 460 è¿›ä¸€æ­¥æå‡äº†å‘é‡ API çš„ç¨³å®šæ€§ï¼ŒJava 22 çš„ JEP 489 æ ‡å¿—ç€å‘é‡ API ä»å­µåŒ–å™¨çŠ¶æ€è½¬ä¸ºæ­£å¼åŠŸèƒ½ï¼Œæˆä¸º Java å¹³å°çš„æ ‡å‡† APIã€‚\nå‘é‡ API çš„æŠ€æœ¯ä»·å€¼åœ¨äºä¸º Java åœ¨ AI å’Œç§‘å­¦è®¡ç®—é¢†åŸŸæä¾›äº†å¼ºå¤§çš„æ€§èƒ½æ”¯æŒï¼Œé€šè¿‡ç¡¬ä»¶çº§åˆ«çš„å¹¶è¡Œè®¡ç®—ï¼Œè®© Java åº”ç”¨èƒ½å¤Ÿåœ¨æœºå™¨å­¦ä¹ ã€å›¾åƒå¤„ç†ã€ç§‘å­¦ä»¿çœŸç­‰é«˜æ€§èƒ½è®¡ç®—åœºæ™¯ä¸­ä¿æŒç«äº‰åŠ›ã€‚\nå®‰å…¨é©æ–°ï¼šæŠ—é‡å­å¯†ç å­¦æ”¯æŒï¼ˆJEP 496, 497ï¼‰ - Java 24\néšç€é‡å­è®¡ç®—æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œä¼ ç»Ÿçš„åŠ å¯†ç®—æ³•é¢ä¸´å‰æ‰€æœªæœ‰çš„å®‰å…¨å¨èƒã€‚Java 24 å¼•å…¥äº†æŠ—é‡å­å¯†ç å­¦æ”¯æŒï¼Œä¸ºæœªæ¥é‡å­è®¡ç®—æ—¶ä»£çš„å®‰å…¨é˜²æŠ¤åšå¥½å‡†å¤‡ï¼š\næŠ—é‡å­æ”»å‡»ï¼šé‡‡ç”¨åŸºäºæ ¼çš„å¯†ç å­¦ç®—æ³•ï¼ŒæŠµå¾¡é‡å­è®¡ç®—æœºçš„æ”»å‡»å¨èƒ å‰ç»æ€§å®‰å…¨ï¼šæå‰åº”å¯¹é‡å­è®¡ç®—å¯èƒ½å¸¦æ¥çš„åŠ å¯†ä½“ç³»é¢ è¦† æ ‡å‡†åŒ–æ”¯æŒï¼šéµå¾ª NIST æŠ—é‡å­å¯†ç å­¦æ ‡å‡†ï¼Œç¡®ä¿ç®—æ³•å¯é æ€§ å¹³æ»‘è¿‡æ¸¡ï¼šæ–°ç®—æ³•ä¸ç°æœ‰å®‰å…¨æ¡†æ¶å…¼å®¹ï¼Œä¾¿äºç³»ç»Ÿå‡çº§ // æŠ—é‡å­å¯†é’¥å°è£…æœºåˆ¶ï¼ˆKEMï¼‰ import java.security.*; import javax.crypto.*; import javax.crypto.spec.*; public class PostQuantumCrypto { public static void main(String[] args) throws Exception { // ç”ŸæˆåŸºäºæ ¼çš„å¯†é’¥å¯¹ KeyPairGenerator kpg = KeyPairGenerator.getInstance(\u0026#34;LatticeKEM\u0026#34;); kpg.initialize(2048); // æŠ—é‡å­å®‰å…¨å¼ºåº¦ KeyPair kp = kpg.generateKeyPair(); PublicKey publicKey = kp.getPublic(); PrivateKey privateKey = kp.getPrivate(); // å¯†é’¥å°è£…ï¼ˆKey Encapsulationï¼‰ KeyAgreement ka = KeyAgreement.getInstance(\u0026#34;LatticeKEM\u0026#34;); ka.init(privateKey); ka.doPhase(publicKey, true); byte[] sharedSecret = ka.generateSecret(); // ä½¿ç”¨å…±äº«å¯†é’¥è¿›è¡ŒåŠ å¯† SecretKeySpec secretKey = new SecretKeySpec(sharedSecret, \u0026#34;AES\u0026#34;); Cipher cipher = Cipher.getInstance(\u0026#34;AES/GCM/NoPadding\u0026#34;); cipher.init(Cipher.ENCRYPT_MODE, secretKey); String plaintext = \u0026#34;æŠ—é‡å­åŠ å¯†æ•°æ®\u0026#34;; byte[] encryptedData = cipher.doFinal(plaintext.getBytes()); System.out.println(\u0026#34;åŠ å¯†æˆåŠŸï¼Œæ•°æ®é•¿åº¦ï¼š\u0026#34; + encryptedData.length); } } // æŠ—é‡å­æ•°å­—ç­¾å public class PostQuantumSignature { public static void digitalSignature() throws Exception { // ç”ŸæˆåŸºäºæ ¼çš„ç­¾åå¯†é’¥å¯¹ KeyPairGenerator kpg = KeyPairGenerator.getInstance(\u0026#34;LatticeDSA\u0026#34;); kpg.initialize(256); // æŠ—é‡å­å®‰å…¨å‚æ•° KeyPair kp = kpg.generateKeyPair(); // åˆ›å»ºæ•°å­—ç­¾å Signature signature = Signature.getInstance(\u0026#34;LatticeDSA\u0026#34;); signature.initSign(kp.getPrivate()); String message = \u0026#34;é‡è¦æ–‡æ¡£å†…å®¹\u0026#34;; signature.update(message.getBytes()); byte[] digitalSignature = signature.sign(); // éªŒè¯ç­¾å signature.initVerify(kp.getPublic()); signature.update(message.getBytes()); boolean isValid = signature.verify(digitalSignature); System.out.println(\u0026#34;ç­¾åéªŒè¯ç»“æœï¼š\u0026#34; + isValid); } } // æ··åˆåŠ å¯†æ–¹æ¡ˆï¼ˆä¼ ç»Ÿ + æŠ—é‡å­ï¼‰ public class HybridCrypto { public static void hybridEncryption() throws Exception { // ä½¿ç”¨ä¼ ç»Ÿ RSA åŠ å¯†æŠ—é‡å­çš„ä¼šè¯å¯†é’¥ KeyPairGenerator rsaKpg = KeyPairGenerator.getInstance(\u0026#34;RSA\u0026#34;); rsaKpg.initialize(2048); KeyPair rsaKp = rsaKpg.generateKeyPair(); // ä½¿ç”¨æŠ—é‡å­ç®—æ³•ç”Ÿæˆä¼šè¯å¯†é’¥ KeyPairGenerator latticeKpg = KeyPairGenerator.getInstance(\u0026#34;LatticeKEM\u0026#34;); latticeKpg.initialize(256); KeyPair latticeKp = latticeKpg.generateKeyPair(); // æ··åˆåŠ å¯†æµç¨‹ Cipher rsaCipher = Cipher.getInstance(\u0026#34;RSA\u0026#34;); rsaCipher.init(Cipher.ENCRYPT_MODE, rsaKp.getPublic()); // ç”¨ RSA åŠ å¯†æŠ—é‡å­å¯†é’¥ byte[] encryptedLatticeKey = rsaCipher.doFinal(latticeKp.getPublic().getEncoded()); System.out.println(\u0026#34;æ··åˆåŠ å¯†å®Œæˆï¼Œç¡®ä¿å‘åå…¼å®¹æ€§\u0026#34;); } }\rJava 24 çš„æŠ—é‡å­å¯†ç å­¦æ”¯æŒæ ‡å¿—ç€ Java å®‰å…¨ä½“ç³»çš„é‡å¤§å‡çº§ï¼š\nJEP 496ï¼šåŸºäºæ ¼çš„å¯†é’¥å°è£…æœºåˆ¶å¼•å…¥äº†æŠ—é‡å­æ”»å‡»çš„å¯†é’¥åå•†åè®®ï¼Œç¡®ä¿åœ¨é‡å­è®¡ç®—ç¯å¢ƒä¸‹å¯†é’¥äº¤æ¢çš„å®‰å…¨æ€§ã€‚è¯¥æœºåˆ¶é‡‡ç”¨åŸºäºæ ¼çš„æ•°å­¦ç»“æ„ï¼Œå³ä½¿åœ¨é‡å­è®¡ç®—æœºé¢å‰ä¹Ÿèƒ½ä¿æŒå¼ºå¤§çš„å®‰å…¨æ€§ã€‚\nJEP 497ï¼šåŸºäºæ ¼çš„æ•°å­—ç­¾åç®—æ³•æä¾›äº†æŠ—é‡å­æ”»å‡»çš„æ•°å­—ç­¾åæ–¹æ¡ˆï¼Œä¿éšœæ•°æ®çš„å®Œæ•´æ€§å’Œèº«ä»½éªŒè¯ã€‚æ–°çš„ç­¾åç®—æ³•åœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œæä¾›äº†é¢å‘æœªæ¥çš„å®‰å…¨ä¿éšœã€‚\næŠ—é‡å­å¯†ç å­¦çš„æŠ€æœ¯ä»·å€¼ä½“ç°åœ¨å¤šä¸ªæ–¹é¢ï¼šä¸º Java åº”ç”¨æä¾›é¢å‘æœªæ¥çš„å®‰å…¨é˜²æŠ¤ï¼Œç¡®ä¿åœ¨é‡å­è®¡ç®—æ—¶ä»£çš„æ•°æ®å®‰å…¨ï¼Œé€šè¿‡æ ‡å‡†åŒ–ç®—æ³•é™ä½å®‰å…¨é£é™©ï¼Œä¸ºå…³é”®åŸºç¡€è®¾æ–½æä¾›é•¿æœŸå®‰å…¨ä¿éšœã€‚\nè¿™äº›å®‰å…¨é©æ–°ç¡®ä¿äº† Java å¹³å°èƒ½å¤Ÿåœ¨é‡å­è®¡ç®—å¨èƒé¢å‰ä¿æŒå¼ºå¤§çš„å®‰å…¨é˜²æŠ¤èƒ½åŠ›ï¼Œä¸ºå¼€å‘è€…åœ¨æœªæ¥æ„å»ºå®‰å…¨å¯é çš„åº”ç”¨ç³»ç»Ÿæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚\nå‡çº§å…¼å®¹æ–¹æ³•æªæ–½ ä¸‹é¢ä»‹ç»å‡ ç§åœ¨å‡çº§è¿‡ç¨‹ä¸­éå¸¸æœ‰ç”¨çš„æ–¹æ³•æªæ–½ã€‚\nMaven çš„ profile æœºåˆ¶ åˆ©ç”¨ Maven çš„ profile æœºåˆ¶ï¼Œé…åˆ JDK ç‰ˆæœ¬å·ï¼Œè‡ªåŠ¨æ¿€æ´»ä¸åŒçš„é…ç½®ã€‚\n\u0026lt;profiles\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;Java1.8\u0026lt;/id\u0026gt; \u0026lt;activation\u0026gt; \u0026lt;!-- åœ¨ JDK 1.8 æ—¶è‡ªåŠ¨æ¿€æ´»--\u0026gt; \u0026lt;jdk\u0026gt;1.8\u0026lt;/jdk\u0026gt; \u0026lt;/activation\u0026gt; \u0026lt;!-- è®¾ç½®ä¸åŒçš„ properties å’Œ dependencies --\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;spring.version\u0026gt;5.3.33\u0026lt;/spring.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;!-- åœ¨çˆ¶ POM ä¸­ä½¿ç”¨ dependencyManagement ç”Ÿå‘½ --\u0026gt; \u0026lt;!-- åœ¨éœ€è¦çš„å­æ¨¡å—ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ --\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.0.1\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-surefire-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.5\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;includes\u0026gt; \u0026lt;include\u0026gt;**/*Test.java\u0026lt;/include\u0026gt; \u0026lt;/includes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.13.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;showWarnings\u0026gt;true\u0026lt;/showWarnings\u0026gt; \u0026lt;fork\u0026gt;true\u0026lt;/fork\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/profile\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;Java21\u0026lt;/id\u0026gt; \u0026lt;activation\u0026gt; \u0026lt;!-- åœ¨ Java 21 ä»¥ä¸Šæ¿€æ´» --\u0026gt; \u0026lt;jdk\u0026gt;[21,)\u0026lt;/jdk\u0026gt; \u0026lt;/activation\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;spring.version\u0026gt;6.0.19\u0026lt;/spring.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;!-- åœ¨çˆ¶ POM ä¸­ä½¿ç”¨ dependencyManagement ç”Ÿå‘½ --\u0026gt; \u0026lt;!-- åœ¨éœ€è¦çš„å­æ¨¡å—ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ --\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;jakarta.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jakarta.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;6.0.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openjdk.nashorn\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nashorn-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;15.4\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.glassfish.jaxb\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jaxb-runtime\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.9\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.annotation\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.annotation-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-surefire-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.5\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;includes\u0026gt; \u0026lt;include\u0026gt;**/*Test.java\u0026lt;/include\u0026gt; \u0026lt;/includes\u0026gt; \u0026lt;argLine\u0026gt; --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED --add-opens java.base/java.math=ALL-UNNAMED --add-opens java.base/java.time=ALL-UNNAMED \u0026lt;/argLine\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;showWarnings\u0026gt;true\u0026lt;/showWarnings\u0026gt; \u0026lt;fork\u0026gt;true\u0026lt;/fork\u0026gt; \u0026lt;compilerArgs\u0026gt; \u0026lt;arg\u0026gt;-J--add-opens=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED\u0026lt;/arg\u0026gt; \u0026lt;/compilerArgs\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/profile\u0026gt; \u0026lt;/profiles\u0026gt;\rJava Multi-Release JAR Java Multi-Release JARï¼ˆå¤šç‰ˆæœ¬ JARï¼‰æ˜¯ Java 9 å¼•å…¥çš„é‡è¦ç‰¹æ€§ï¼Œå…è®¸åœ¨åŒä¸€ä¸ª JAR æ–‡ä»¶ä¸­åŒ…å«é’ˆå¯¹ä¸åŒ Java ç‰ˆæœ¬çš„ç±»æ–‡ä»¶ã€‚\nç‰¹ç‚¹ï¼š\nè¿è¡Œæ—¶ JVM ä¼šæ ¹æ®å½“å‰ Java ç‰ˆæœ¬è‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„ç±»æ–‡ä»¶ å¦‚æœæŒ‡å®šç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œä¼šå›é€€åˆ°é»˜è®¤ç‰ˆæœ¬ éœ€è¦ç¡®ä¿æ‰€æœ‰ç‰ˆæœ¬çš„å…¬å…± API ä¿æŒä¸€è‡´ ç¼–è¯‘æ—¶éœ€è¦æŒ‡å®šæ­£ç¡®çš„ Java ç‰ˆæœ¬ Multi-Release JAR é€šè¿‡åœ¨ JAR çš„META-INF/versions/ç›®å½•ä¸‹ç»„ç»‡ä¸åŒç‰ˆæœ¬çš„ç±»æ–‡ä»¶ï¼š\nmyapp.jar â”œâ”€â”€ META-INF/ â”‚ â”œâ”€â”€ MANIFEST.MF â”‚ â””â”€â”€ versions/ â”‚ â”œâ”€â”€ 9/ â”‚ â”‚ â””â”€â”€ com/example/Utils.class â”‚ â”œâ”€â”€ 11/ â”‚ â”‚ â””â”€â”€ com/example/Utils.class â”‚ â””â”€â”€ 17/ â”‚ â””â”€â”€ com/example/Utils.class â”œâ”€â”€ com/example/ â”‚ â””â”€â”€ Utils.class # é»˜è®¤ç‰ˆæœ¬ï¼ˆJava 8ï¼‰ â””â”€â”€ com/example/ â””â”€â”€ Main.class Maven é…ç½® \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;release\u0026gt;8\u0026lt;/release\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-jar-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.3.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;archive\u0026gt; \u0026lt;manifestEntries\u0026gt; \u0026lt;Multi-Release\u0026gt;true\u0026lt;/Multi-Release\u0026gt; \u0026lt;/manifestEntries\u0026gt; \u0026lt;/archive\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;!-- ä¸ºä¸åŒ Java ç‰ˆæœ¬ç¼–è¯‘ --\u0026gt; \u0026lt;profiles\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;java9\u0026lt;/id\u0026gt; \u0026lt;activation\u0026gt; \u0026lt;jdk\u0026gt;9\u0026lt;/jdk\u0026gt; \u0026lt;/activation\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;release\u0026gt;9\u0026lt;/release\u0026gt; \u0026lt;compileSourceRoots\u0026gt; \u0026lt;compileSourceRoot\u0026gt;src/main/java9\u0026lt;/compileSourceRoot\u0026gt; \u0026lt;/compileSourceRoots\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/profile\u0026gt; \u0026lt;/profiles\u0026gt;\rä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯ å‘åå…¼å®¹ï¼šåŒä¸€ä¸ª JAR å¯ä»¥åœ¨ä¸åŒ Java ç‰ˆæœ¬ä¸Šè¿è¡Œ æ€§èƒ½ä¼˜åŒ–ï¼šåœ¨æ”¯æŒçš„ç‰ˆæœ¬ä¸Šä½¿ç”¨æ›´é«˜æ•ˆçš„å®ç° æ¸è¿›å‡çº§ï¼šå…è®¸åº“ä½œè€…é€æ­¥è¿ç§»åˆ°æ–°ç‰¹æ€§ å‡å°‘ç»´æŠ¤ï¼šé¿å…ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„ JAR æ–‡ä»¶ Java æ¨¡å—åŒ–å…¼å®¹ åˆæ¬¡å‡çº§æ—¶ä¸€å®šä¼šé‡åˆ°è¿™ç§é”™è¯¯ã€‚\nCaused by: java.lang.reflect.InaccessibleObjectException: Unable to make field protected int[] java.util.Calendar.fields accessible: module java.base does not \u0026#34;opens java.util\u0026#34; to unnamed module @21282ed8 ä¹Ÿä¸€å®šçŸ¥é“æ€ä¹ˆè§£å†³äº†ï¼Œå°†æ²¡å¼€æ”¾çš„æ¨¡å—å¼ºåˆ¶å¯¹å¤–å¼€æ”¾ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°é€‰é¡¹ï¼š\n--add-exports å¯¼å‡ºåŒ…ï¼Œæ„å‘³ç€å…¶ä¸­çš„æ‰€æœ‰å…¬å…±ç±»å‹å’Œæˆå‘˜éƒ½å¯ä»¥åœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶è®¿é—®ã€‚ --add-opens æ‰“å¼€åŒ…ï¼Œæ„å‘³ç€å…¶ä¸­çš„æ‰€æœ‰ç±»å‹å’Œæˆå‘˜ï¼ˆä¸ä»…æ˜¯å…¬å…±ç±»å‹ï¼‰éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶è®¿é—®ã€‚ ä¸¤è€…çš„åŒºåˆ«åœ¨äº --add-opens å¼€æ”¾çš„æ›´åŠ å½»åº•ï¼Œä¸ä»… public ç±»å‹ã€å˜é‡åŠæ–¹æ³•å¯ä»¥è®¿é—®ï¼Œå°±è¿é public å…ƒç´ ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ setAccessible(true) åä¹Ÿå¯ä»¥è®¿é—®ã€‚ç®€å•èµ·è§ï¼Œç›´æ¥ä½¿ç”¨ --add-opens å³å¯ã€‚\nä½¿ç”¨ Maven å‘½ä»¤æ—¶ï¼Œé…ç½® maven-surefire-plugin æ’ä»¶ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-surefire-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;argLine\u0026gt; --add-opens=java.base/java.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.math=ALL-UNNAMED \u0026lt;/argLine\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt;\råœ¨ IntelliJ IDEA è¿è¡Œç¨‹åºå¦‚æœæŠ¥é”™ï¼Œå¯ä»¥é€šè¿‡åœ¨ â€œVM Optionâ€ é…ç½®é¡¹ä¸­ï¼Œå¢åŠ  Java æ¨¡å—åŒ– --add-opens ç›¸å…³å¯åŠ¨å‚æ•°å³å¯æ­£å¸¸å¯åŠ¨ã€‚\nå®Œæ•´ --add-opens åˆ—è¡¨ï¼š\n--add-opens=java.base/java.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.util.concurrent=ALL-UNNAMED --add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED --add-opens=java.base/java.math=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED --add-opens=java.base/java.security=ALL-UNNAMED --add-opens=java.base/java.text=ALL-UNNAMED --add-opens=java.base/java.time=ALL-UNNAMED --add-opens=java.base/jdk.internal.access=ALL-UNNAMED --add-opens=java.base/jdk.internal.misc=ALL-UNNAMED\rè¾…åŠ©è¿ç§»å·¥å…· ä» Java 8 å‡çº§åˆ° 25ï¼Œæ€»ä½“é£é™©è¿˜æ˜¯å¾ˆå¤§ï¼Œæ€»ç»“èµ·æ¥å¯èƒ½æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„èŠ‚ç‚¹ï¼š\nJava 8 â†’ Java 9ï¼ˆæ¨¡å—ç³»ç»Ÿå¼ºåˆ¶å°è£…ï¼‰\nå†…éƒ¨ API è®¿é—®é™åˆ¶ï¼šsun.*ã€com.sun.* åŒ…è®¿é—®å—é™ åå°„è®¿é—®å—é™ï¼šsetAccessible() å¯¹æ¨¡å—ç§æœ‰æˆå‘˜å¤±æ•ˆ æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤è¡Œä¸ºå˜æ›´ï¼šå¦‚æœä½ ä½¿ç”¨ java.util.regex.Patternï¼Œè¯·ä¸€å®šè¦å…³æ³¨ Java 9 æ­¤ç‰¹æ€§å˜æ›´ï¼Œé»˜è®¤åŒ¹é…ç»“æœæœ‰å˜åŒ–ï¼Œç¯‡å¹…å¤ªé•¿è¯¦æƒ…è¯·å‚è€ƒ Behavior Change in Regular Expression Matching ã€‚ Java 9 â†’ Java 11ï¼ˆç»„ä»¶ç§»é™¤ï¼‰\nJava EE æ¨¡å—ç§»é™¤ï¼šjava.ee.* æ¨¡å—è¢«ç§»é™¤ JavaFX ç§»é™¤ï¼šæ¡Œé¢åº”ç”¨éœ€è¦å•ç‹¬å®‰è£…ï¼Œæœ‰äº›ä½¿ç”¨ javafx.utils çš„ä»£ç éœ€è¦å¯»æ‰¾æ›¿ä»£å“ JAXB ç§»é™¤ï¼šjavax.xml.bind.* åŒ…è¢«ç§»é™¤ï¼Œéœ€è¦å•ç‹¬æ·»åŠ ä¾èµ– JAX-WS ç§»é™¤ï¼šjavax.xml.ws.* åŒ…è¢«ç§»é™¤ï¼Œéœ€è¦å•ç‹¬æ·»åŠ ä¾èµ– JAX-RS ç§»é™¤ï¼šjavax.ws.rs.* åŒ…è¢«ç§»é™¤ï¼Œéœ€è¦å•ç‹¬æ·»åŠ ä¾èµ– Java 11 â†’ Java 17ï¼ˆæ›´å¤šç»„ä»¶ç§»é™¤ï¼‰\nNashorn JavaScript å¼•æ“ç§»é™¤ï¼šScriptEngine æ‰§è¡Œ JavaScript ä¼šæŠ¥é”™ Pack200 å·¥å…·ç§»é™¤ï¼šä½¿ç”¨ Pack200 å‹ç¼©çš„åº”ç”¨æ— æ³•è¿è¡Œ CORBA æ¨¡å—ç§»é™¤ï¼šjava.corba.* æ¨¡å—è¢«å®Œå…¨ç§»é™¤ AWT Utilities ç§»é™¤ï¼šsun.awt.util.* å·¥å…·ç±»è¢«ç§»é™¤ Java 17 â†’ Java 21ï¼ˆå…¼å®¹æ€§é—®é¢˜ï¼‰\nå®‰å…¨ç®¡ç†å™¨åºŸå¼ƒè­¦å‘Šï¼šJava 17 å¼€å§‹æ ‡è®°ä¸ºåºŸå¼ƒï¼ŒJava 21 è­¦å‘Šå¢å¼º éƒ¨åˆ†åå°„ã€Agent ç›¸å…³ API å˜æ›´ï¼Œéœ€è¦ä»”ç»†æµ‹è¯• Java 21 â†’ Java 25ï¼ˆå®‰å…¨ç®¡ç†å™¨æ°¸ä¹…ç¦ç”¨ï¼‰\nJEP 486ï¼šå®‰å…¨ç®¡ç†å™¨è¢«æ°¸ä¹…ç¦ç”¨ï¼Œæ— æ³•å†å¯ç”¨å’Œå®‰è£…ï¼Œä½¿ç”¨ SecurityManager çš„åº”ç”¨å°†æ— æ³•å¯åŠ¨ JEP 498ï¼šä½¿ç”¨ sun.misc.Unsafe å†…å­˜è®¿é—®æ–¹æ³•æ—¶å‘å‡ºè¿è¡Œæ—¶è­¦å‘Šï¼Œå»ºè®®è¿ç§»åˆ° VarHandle æˆ–å¤–éƒ¨å‡½æ•°ä¸å†…å­˜ API é™¤äº†è¢«ç§»é™¤çš„æ¨¡å—ï¼Œéƒ¨åˆ† API æ–¹æ³•çº§åˆ«ä¹Ÿæœ‰å°èŒƒå›´çš„å˜æ›´ã€‚\næ¨èæœ€å®‰å…¨çš„æ–¹å¼ï¼šå¼€å‘ã€ç¼–è¯‘ã€è¿è¡Œå§‹ç»ˆä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬ã€‚\nåœ¨å‡çº§ä¹‹å‰ï¼Œå¯é€šè¿‡ä»¥ä¸‹å·¥å…·å¯¹æ€»ä½“æœ‰ä¸€ä¸ªæ¦‚è§ˆï¼Œå¿ƒé‡Œæœ‰è°±æ‰èƒ½å®‰å…¨å‡çº§ï¼Œå¦å¤–æä¾›ä¸€äº›è¾…åŠ©è¿ç§»åˆ°æ–°ç‰ˆæœ¬çš„å·¥å…·ï¼Œä»…ä¾›å‚è€ƒã€‚\nSDKMAN æ¨èä½¿ç”¨ SDKMAN å®‰è£…å’Œç®¡ç† JDKï¼Œæ–¹ä¾¿ä¸åŒç‰ˆæœ¬åˆ‡æ¢ã€‚é™¤äº† JDKï¼Œä»–è¿˜æä¾›äº† Java ç”Ÿæ€é‡Œå¸¸ç”¨çš„ Mavenã€Gradleã€Groovyã€Spring Boot ç­‰å¾ˆå¤šç»„ä»¶çš„å®‰è£…ç®¡ç†ã€‚\njdeps jdeps æ˜¯ Java è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åˆ†æä¾èµ–å…³ç³»å’Œç”Ÿæˆæ¨¡å—ä¿¡æ¯æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬åªå€Ÿç”¨ä»–çš„å…¶ä¸­ä¸€é¡¹åŠŸèƒ½ã€‚\né€šè¿‡ jdeps --jdk-internals æ£€æŸ¥æ˜¯å¦æœ‰ä½¿ç”¨å†…éƒ¨ APIï¼Œä»¥ä¸‹ä¾‹å­æ˜¾ç¤ºä½¿ç”¨äº† sun.net.util.IPAddressUtil è¿™ä¸ª Java å†…éƒ¨å·¥å…·ç±»ï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„æºç ç±»å’Œ jar åŒ…ä½ç½®ã€‚\nå¯ä»¥ç»§ç»­ä½¿ç”¨ Java ä¸­çš„å†…éƒ¨ APIï¼Œå¦å¤– OpenJDK Wiki é¡µé¢ Java Dependency Analysis Tool æ¨èäº†æŸäº›å¸¸ç”¨ JDK å†…éƒ¨ API çš„æ›¿æ¢é¡¹ï¼Œå¯å‚è€ƒè¿™äº›å»ºè®®æ›¿æ¢æ‰ã€‚\n$ jdeps -dotoutput \u0026lt;dot-file-dir\u0026gt; -jdkinternals \u0026lt;one-or-more-jar-files....\u0026gt; $ jdeps --jdk-internals --multi-release 21 --class-path . target/xxx.jar . -\u0026gt; java.base com.my.SecurityChecker -\u0026gt; sun.net.util.IPAddressUtil JDK internal API (java.base) Warning: JDK internal APIs are unsupported and private to JDK implementation that are subject to be removed or changed incompatibly and could break your application. Please modify your code to eliminate dependence on any JDK internal APIs. For the most recent update on JDK internal API replacements, please check: https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool jdeprscan jdeprscan ä¹Ÿæ˜¯ Java è‡ªå¸¦åˆ†æå·¥å…·ï¼Œå¯æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†å·²å¼ƒç”¨æˆ–å·²åˆ é™¤çš„ APIã€‚ä½¿ç”¨å·²å¼ƒç”¨çš„ API ä¸æ˜¯é˜»å¡æ€§é—®é¢˜ï¼Œè¿˜èƒ½æ¥ç€è·‘ï¼Œä½†æ˜¯å»ºè®®æ›¿æ¢æ‰ã€‚ä½¿ç”¨å·²åˆ é™¤çš„ APIï¼Œé‚£å°±å½»åº•è·‘ä¸èµ·æ¥äº†ã€‚\n# äº†è§£è‡ª Java 8 åˆ° 25 åºŸå¼ƒçš„å…·ä½“ API $ jdeprscan --release 25 --list # å¦‚æœåªæƒ³çœ‹ä¸€åˆ é™¤çš„ï¼ŒåŠ ä¸Š --for-removal ï¼Œåˆ—å‡ºå·²åˆ é™¤çš„ API $ jdeprscan --release 25 --list --for-removal @Deprecated(since=\u0026#34;9\u0026#34;, forRemoval=true) class javax.security.cert.Certificate @Deprecated(since=\u0026#34;9\u0026#34;, forRemoval=true) class javax.security.cert.CertificateEncodingException â€¦â€¦ @Deprecated(since=\u0026#34;18\u0026#34;, forRemoval=true) void java.lang.Enum.finalize() @Deprecated(since=\u0026#34;17\u0026#34;, forRemoval=true) void java.lang.System.setSecurityManager(java.lang.SecurityManager) @Deprecated(since=\u0026#34;17\u0026#34;, forRemoval=true) java.lang.SecurityManager java.lang.System.getSecurityManager() @Deprecated(since=\u0026#34;21\u0026#34;, forRemoval=true) javax.management.MBeanServerConnection javax.management.remote.JMXConnector.getMBeanServerConnection(javax.security.auth.Subject) @Deprecated(since=\u0026#34;25\u0026#34;, forRemoval=true) class java.net.URLPermission @Deprecated(since=\u0026#34;25\u0026#34;, forRemoval=true) class java.net.NetPermission æ‰«æè‡ªå·±çš„ä»£ç ä¸­æ˜¯å¦æœ‰ä½¿ç”¨åºŸå¼ƒ APIï¼š\n# æ³¨æ„é€šè¿‡ --class-path å¢åŠ ä¾èµ–çš„ jar åŒ… $ jdeprscan --release 21 --class-path log4j-api-2.13.0.jar my-application.jar error: cannot find class sun/misc/BASE64Encoder class com/company/Util uses deprecated method java/lang/Double::\u0026lt;init\u0026gt;(D)V ä»¥ä¸Šä¾‹å­ï¼Œcom.company.Util ç±»åœ¨è°ƒç”¨ java.lang.Double ç±»çš„å·²å¼ƒç”¨æ„é€ å‡½æ•°ã€‚ javadoc ä¼šå»ºè®®ç”¨æ¥ä»£æ›¿å·²å¼ƒç”¨ API çš„ APIã€‚ ä½†æ˜¯æ— æ³•è§£å†³\u0026quot;error: cannot find class sun/misc/BASE64Encoder\u0026quot;é—®é¢˜ï¼Œå› ä¸ºå®ƒæ˜¯å·²åˆ é™¤çš„ APIï¼Œ è‡ª Java 8 å‘å¸ƒä»¥æ¥ï¼Œåº”ä½¿ç”¨ java.util.Base64ã€‚\næ³¨æ„ä½¿ç”¨ jdeprscan éœ€è¦é€šè¿‡ \u0026ndash;class-path æŒ‡å®šä¾èµ–é¡¹ï¼Œå¯å…ˆæ‰§è¡Œ mvn dependency:copy-dependencies å‘½ä»¤ï¼Œæ­¤æ—¶ä¼š copy ä¾èµ–é¡¹åˆ° target/dependency ç›®å½•ã€‚\nå¦‚æœä½ åŠ äº† \u0026ndash;class-path ä¾èµ–ï¼Œå¤§æ¦‚ç‡è¿˜æ˜¯æŠ¥é”™è¯¯ error: cannot find classï¼Œç›®æµ‹å¯»æ‰¾ä¾èµ–é¡¹æ˜¯æ ¹æ® target/dependency ä¸­çš„åå­—é¡ºåºæ‰¾çš„ï¼Œä¸æ˜¯å¸¸è§„çš„ java è¿›ç¨‹ä¸€æ¬¡æ€§åŠ è½½å®Œï¼Œä¸çŸ¥é“è¿™ç®—ä¸ç®— jdeprscan çš„è®¾è®¡ Bugï¼Œå…·ä½“è§£å†³åŠæ³•å¯å‚è€ƒ jdeprscan-throws-cannot-find-class-error ã€‚\næˆ‘é‡‡ç”¨çš„è§£å†³æ–¹å¼æ˜¯æŠŠæ‰€æœ‰ä¾èµ– jar æ–‡ä»¶éƒ½æ¥åˆ°æŸä¸ªæ–‡ä»¶å¤¹ï¼Œè§£å‹æˆ classesï¼Œç„¶å class-path ä½¿ç”¨æ­¤æ–‡ä»¶ã€‚è¿™æ ·è¿˜æœ‰ä¸ªå¥½å¤„ï¼Œæ‰«ææŠ¥å‘Šé‡Œåªæœ‰æˆ‘çœŸæ­£è¦æ‰«æçš„å½“å‰é¡¹ç›®çš„æŠ¥å‘Šï¼Œä¸åŒ…å«ç¬¬ä¸‰æ–¹ jar çš„ã€‚\nä»¥ä¸Šè¿‡ç¨‹å‘½ä»¤è¡Œå‚è€ƒï¼š\nmvn dependency:copy-dependencies -Dsilent=true mkdir -p target/dependency-classes for jar in target/dependency/*.jar; do unzip -o \u0026#34;$jar\u0026#34; -d target/dependency-classes done jdeprscan --class-path target/dependency-classes target/really-project.jar\ré™¤äº†ä½¿ç”¨ jdeprscan å‘½ä»¤è¡Œä»¥å¤–ï¼Œä¹Ÿå¯åœ¨ä½ é¡¹ç›®çš„ maven pom æ–‡ä»¶ä¸­å¼•å…¥ maven-jdeps-pluginï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼Œå¼•å…¥åå¦‚æœæœ‰ä½¿ç”¨åºŸå¼ƒ APIï¼Œå°†åœ¨ mvn package çš„æ—¶å€™ç›´æ¥å¤±è´¥æŠ¥é”™ï¼Œé¿å…æœ‰äººæ— æ„å¼•å…¥åºŸå¼ƒ APIã€‚\n\u0026lt;project\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-jdeps-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.2\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;!-- verify main classes --\u0026gt; \u0026lt;goal\u0026gt;jdkinternals\u0026lt;/goal\u0026gt; \u0026lt;!-- verify test classes --\u0026gt; \u0026lt;goal\u0026gt;test-jdkinternals\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;multiRelease\u0026gt;21\u0026lt;/multiRelease\u0026gt; \u0026lt;!-- å…¶ä»–å‚æ•°æŒ‰éœ€é…ç½® --\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt;\rforbiddenapis maven forbiddenapis é™¤äº†æä¾›è‡ªå®šä¹‰ API æ£€æŸ¥ä»¥å¤–ï¼Œå…¶å®è¿˜å†…ç½®äº†ä¸€äº› jdk-unsafeã€jdk-deprecatedã€jdk-internal æ£€æŸ¥è§„åˆ™ã€‚\nå¦å¤–ä¸ä»¥ä¸Š jdepsã€jdeprscan çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œforbiddenapis èƒ½åšåˆ°åœ¨ç¼–è¯‘æœŸå°±ç›´æ¥ç¦æ­¢ï¼Œç¡®ä¿åªè¦ç¼–è¯‘æˆåŠŸå°±èƒ½å®‰å…¨è¿è¡Œã€‚\næ›´è¯¦ç»†ä½¿ç”¨å‚è€ƒ Maven å¦‚ä½•åœ¨ç¼–è¯‘æ—¶ç¦æ­¢è°ƒç”¨æŸäº›ç‰¹å®š API ã€‚\nEMT4J Eclipse Migration Toolkit for Java (EMT4J) ä¹Ÿæ˜¯ä¸€ä¸ªé™æ€åˆ†æå·¥å…·ï¼Œå¯è¾“å‡ºåˆ†ææŠ¥å‘Šï¼Œä¹Ÿå¯ç›´æ¥ apply åˆ° gitï¼Œæ”¯æŒé€šè¿‡ maven æ’ä»¶ã€cli å‘½ä»¤è¡Œã€Java Agent 3 ç§æ–¹å¼åˆ†æã€‚\nç›®å‰å‘å¸ƒæ¯”è¾ƒæ…¢ï¼Œå·² Realease ç‰ˆæœ¬åªåˆ†æåˆ° Java 17ï¼Œåªæœ‰ master åˆ†æ”¯æ”¯æŒ Java 21ï¼Œå¯ä»¥åŸºäº master åˆ†æ”¯è‡ªå·±ç¼–è¯‘æ„å»ºã€‚\n# ä»¥ä¸‹ç¤ºä¾‹è‡ªå·±ç¼–è¯‘æ„å»ºï¼Œmaster åˆ†æ”¯è¿˜ä¸å¤ªç¨³å®šï¼Œå¯èƒ½å‡ºé”™ $ git clone git@github.com:adoptium/emt4j.git $ cd emt4j $ mvn clean package -Prelease # ä»¥ä¸Šæ­¥éª¤ç”Ÿæˆ emt4j-${version}.zip åœ¨ emt4j-assembly/target ç›®å½•ä¸‹ã€‚ # è§£å‹ä»¥ä¸Š zip åï¼Œå¾—åˆ° emt4j tree -L 2 . â”œâ”€â”€ bin â”‚Â â”œâ”€â”€ analysis.bat â”‚Â â””â”€â”€ analysis.sh â””â”€â”€ lib â”œâ”€â”€ agent â”œâ”€â”€ analysis â””â”€â”€ maven-plugin # æ³¨æ„ emt4j éœ€è¦ä½¿ç”¨ Java 8 è¿è¡Œï¼Œæ‰€ä»¥å…ˆæŠŠè‡ªå·±çš„ Java ç¯å¢ƒåˆ‡æ¢åˆ° Java 8 $ sh bin/analysis.sh -f 8 -t 17 -o report.html my-java-project-dir # åœ¨ report.html èƒ½çœ‹åˆ°åˆ†æå†…å®¹å’Œå»ºè®®ï¼Œå¦‚ Issues Context Location: refclass:file:my-java-project-dir/target/classes/com/mypackage/spring/BaseAbstractDataSource.class!/com.mypackage.spring.BaseAbstractDataSource!/, Target: java.lang.Class.newInstance()Ljava/lang/Object; å¯é€šè¿‡ emt4j-maven-plugin è¿›è¡Œæ£€æŸ¥ã€‚å¢åŠ ä»¥ä¸‹ pluginï¼Œæ‰§è¡Œ mvn emt4j:check æˆåŠŸåæŸ¥çœ‹æŠ¥å‘Šã€‚\næ³¨æ„ emt4j-maven-plugin ç›®å‰ç‰ˆæœ¬ 0.8.0 æ¯”è¾ƒè€ï¼Œè¯·ä½¿ç”¨ Java 8 æˆ– Java 17 è·‘ mvn å‘½ä»¤ï¼Œç‰ˆæœ¬å¤ªé«˜ä¼šå¤±è´¥ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.eclipse.emt4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;emt4j-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.8.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;!-- å½“å‰ç‰ˆæœ¬ --\u0026gt; \u0026lt;fromVersion\u0026gt;8\u0026lt;/fromVersion\u0026gt; \u0026lt;!-- æœŸæœ›å‡çº§ç‰ˆæœ¬ï¼Œ0.8.0 è¿˜ä¸æ”¯æŒ Java 21 --\u0026gt; \u0026lt;toVersion\u0026gt;17\u0026lt;/toVersion\u0026gt; \u0026lt;outputFile\u0026gt;target/report.html\u0026lt;/outputFile\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt;\rä¸æƒ³ä½¿ç”¨ xml é…ç½®çš„ï¼Œå¯å‚è€ƒä»¥ä¸‹å‘½ä»¤è¡Œç›´æ¥ run pluginã€‚\n# å®˜æ–¹å½“å‰å‘å¸ƒçš„ç‰ˆæœ¬ mvn process-test-classes org.eclipse.emt4j:emt4j-maven-plugin:0.8.0:check -DfromVersion=8 -DtoVersion=17 -DoutputFile=emt4j-report.html # è¿™ä¸ªæ˜¯æˆ‘è‡ªå·±åŸºäº master åˆ†æ”¯ç¼–è¯‘çš„ 0.91 ç‰ˆæœ¬ï¼Œæ”¯æŒ Java21 mvn process-test-classes org.eclipse.emt4j:emt4j-maven-plugin:0.91:process -DfromVersion=8 -DtoVersion=21 -DoutputFile=emt4j-report.html\ræ£€æŸ¥ç»“æœé”™è¯¯å¯èƒ½å¾ˆå¤šï¼Œæ ¹æ®ä¼˜å…ˆçº§ä¿®æ”¹ï¼Œæ¯”å¦‚ä»¥ä¸‹æˆ‘çš„æ£€æŸ¥ç»“æœï¼Œæ£€æŸ¥ç»“æœæ”¯æŒä¸­è‹±æ–‡å±•ç¤ºã€‚\nNon-heap memory footprint increasing Description Priority: p1 Issue Count: 1 Netty uses the direct byte buffer internally. There 2 ways to manage the direct buffer lifecycle, the first it\u0026#39;s managed by Netty self, and the second is managed by JVM. In JDK 8, netty uses the first way, but in JDK 11, netty uses the second. The first cannot be monitored through MXBean, but the second can be monitored. How to fix If you want keep the first way,add the option to JVM:\u0026#34;-Dio.netty.tryReflectionSetAccessible=true --add-opens=java.base/jdk.internal.misc=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED\u0026#34; when running on JDK 11.But if use the second way,the netty should upgrade to a version at least 4.1.33. Because the older netty use a remove API tht release byte buffer. Issues Context Target: file:/Users/l10178/.m2/repository/io/netty/netty/3.10.0.Final/netty-3.10.0.Final.jar ä¼˜å…ˆçº§ï¼šp1 æœ‰ä¸€äº› class å·²ç»è¢«åˆ é™¤äº†éœ€è¦ä¿®æ”¹ä»£ç æ›¿æ¢æˆä¸ºæ–°çš„ API ä½ç½®ï¼šfile:xxx/Base64Util.class, ç›®æ ‡ï¼šsun.misc.BASE64Decoder ä¼˜å…ˆçº§ï¼šp3 é€šè¿‡æµ‹è¯•å·²çŸ¥çš„ä¸€äº›ä¸å…¼å®¹çš„ jar å¦‚ä½•ä¿®å¤ï¼š file:/root/.m2/repository/dom4j/dom4j/1.6.1/dom4j-1.6.1.jar ä¸åŒ¹é…è§„åˆ™ \u0026#34;Version should \u0026gt;= \u0026#39;2.0\u0026#39; \u0026#34; OpenRewrite OpenRewrite ä¸€é”®å‡çº§ä¾èµ–åŒ…ï¼Œç›´æ¥ä¿®æ”¹é‡æ„æºç ã€‚\næ¯”å¦‚ BigDecimal éƒ¨åˆ† API æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¦‚ java.math.BigDecimal.divide(Ljava/math/BigDecimal;II)ï¼Œéœ€è¦æ›¿æ¢ä¸ºæ˜ç¡®æšä¸¾ç±»å‹çš„ RoundingMode, å°±å¯ä½¿ç”¨ OpenRewrite bigdecimalroundingconstantstoenums ä¸€é”®æ›¿æ¢ã€‚\nmvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-static-analysis:RELEASE -Drewrite.activeRecipes=org.openrewrite.staticanalysis.BigDecimalRoundingConstantsToEnums -Drewrite.exportDatatables=true\rOpenRewrite é™¤äº†ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ä½¿ç”¨å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ç‰¹åˆ«å–œæ¬¢çš„åœ°æ–¹ï¼Œå°±æ˜¯å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸°å¯Œçš„ç»éªŒè¾“å‡ºï¼Œå…¶å®ä»–æœ¬èº«å·²ç»æ¼”å˜æˆäº†ä¸€ä¸ª SaaS äº§å“ã€‚\næ¯”å¦‚é€šè¿‡æŸ¥çœ‹ Migrate to Java 25 çš„åˆ—è¡¨å®šä¹‰ï¼Œå°±èƒ½çŸ¥é“ Java 25 æœ‰å“ªäº›ä¸»è¦çš„å˜æ›´ã€‚\ntype: specs.openrewrite.org/v1beta/recipe name: org.openrewrite.java.migrate.UpgradeToJava25 displayName: Migrate to Java 25 description: | This recipe will apply changes commonly needed when migrating to Java 25. This recipe will also replace deprecated API with equivalents when there is a clear migration strategy. Build files will also be updated to use Java 25 as the target/source and plugins will be also be upgraded to versions that are compatible with Java 25. tags: - java25 recipeList: - org.openrewrite.java.migrate.UpgradeToJava21 - org.openrewrite.java.migrate.UpgradeJavaVersion: version: 25 - org.openrewrite.java.migrate.lang.MigrateProcessWaitForDuration - org.openrewrite.java.migrate.lang.ReplaceUnusedVariablesWithUnderscore - org.openrewrite.java.migrate.util.MigrateInflaterDeflaterToClose - org.openrewrite.java.migrate.AccessController - org.openrewrite.java.migrate.RemoveSecurityPolicy - org.openrewrite.java.migrate.RemoveSecurityManager - org.openrewrite.java.migrate.SystemGetSecurityManagerToNull - org.openrewrite.java.migrate.MigrateZipErrorToZipException\rå…¥é—¨æŒ‡å¯¼å¯å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼šæ™ºèƒ½ä»£ç é‡æ„ ã€‚\nç›¸æ¯”äºä»¥ä¸Šå‡ ä¸ªå·¥å…·ï¼ŒOpenRewrite æ›´æˆç†Ÿæ˜“ç”¨ï¼Œä¸ IDEA ä¸šå·²é›†æˆï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹å‹å¥½ã€‚\nJaCoLine JaCoLine æ£€æŸ¥ Java å‘½ä»¤è¡Œé€‰é¡¹å‚æ•°æœ‰æ²¡æœ‰é—®é¢˜ï¼Œè¯†åˆ«å‡ºå·²ç»è¿‡æ—¶ä¸æ”¯æŒçš„å‚æ•°ã€‚\nJava å‚æ•°æŸ¥è¯¢å·¥å…· Java å‚æ•°å¤ªå¤šï¼Œåˆ° VM Options Explorer - Corretto JDK21 ä¸­å‚ç…§ï¼Œé‡Œé¢æ ¹æ® JDK çš„ç‰ˆæœ¬ä»¥åŠå‘è¡Œå•†ï¼Œåˆ—å‡ºæ¥æ‰€æœ‰çš„ç›¸å…³å‚æ•°ï¼Œé€‰æ‹©å¥½å¯¹åº”å‘è¡Œå•†çš„æ­£ç¡®ç‰ˆæœ¬ï¼Œå°±å¯ä»¥æœç´¢æˆ–è€…æŸ¥çœ‹ java å‘½ä»¤æ”¯æŒçš„æ‰€æœ‰å‚æ•°äº†ã€‚\nç”Ÿäº§ç¯å¢ƒå‚æ•°é…ç½® æŸ¥çœ‹å½“å‰ Java ç‰ˆæœ¬æ”¯æŒçš„å‚æ•°å’Œç³»ç»Ÿé»˜è®¤å€¼ï¼š\n$ java -XX:+PrintFlagsFinal -version size_t MinMetaspaceExpansion = 327680 {product} {default} uint MinMetaspaceFreeRatio = 40 {product} {default} double MinRAMPercentage = 50.000000 {product} {default} uintx MinSurvivorRatio = 3 {product} {default} size_t MinTLABSize = 2048 {product} {default} intx MultiArrayExpandLimit = 6 {C2 product} {default} uintx NUMAChunkResizeWeight = 20 {product} {default} size_t NUMAInterleaveGranularity = 2097152 {product} {default} size_t NUMASpaceResizeRate = 1073741824 {product} {default} bool NUMAStats = false {product} {default} ccstr NativeMemoryTracking = off {product} {default} bool NeverActAsServerClassMachine = false {pd product} {default} bool NeverTenure = false {product} {default} uintx NewRatio = 2 {product} {default} size_t NewSize = 5570560 {product} {ergonomic} æŸ¥çœ‹å½“å‰è¿è¡Œ Java ç¨‹åºæœ€ç»ˆç”Ÿæ•ˆçš„å‚æ•°é…ç½®ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¡Œï¼š\n$ jcmd $(pgrep java) VM.flags | tr \u0026#39; \u0026#39; \u0026#39;\\n\u0026#39; -XX:MaxRAM=1073741824 -XX:MaxRAMPercentage=75.000000 -XX:+UseCompressedOops -XX:+UseG1GC -XX:+UseStringDeduplication // çœç•¥â€¦â€¦ å‡çº§åˆ° Java 25 ä»¥åä»¥ä¸‹æ˜¯æ ¹æ®æˆ‘ä»¬å…¬å¸å¸¸è§„ç»éªŒæ¨èçš„é…ç½®ï¼Œéæ™®ä¸–å¯ç”¨ï¼Œè¯·æ ¹æ®è‡ªå·±çš„åº”ç”¨æƒ…å†µè‡»é€‰ã€‚\nå¦‚æœæ˜¯ Java 21 åœ¨ä½¿ç”¨ ZGCï¼Œæ¨èå¯ç”¨åˆ†ä»£ -XX:+ZGenerational ï¼Œå¯¹ç¨³å®šæ€§ã€ååé‡ã€å†…å­˜å ç”¨éƒ½æœ‰å¾ˆå¤§ä¼˜åŒ–ã€‚Java 23 é»˜è®¤å¯ç”¨åˆ†ä»£ ZGCï¼ŒJava 24 å·²åºŸå¼ƒéåˆ†ä»£ ZGCï¼Œä»¥åå°±åªæœ‰åˆ†ä»£ ZGCã€‚ åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ G1 ä»ç„¶æ˜¯æœ€ç¨³çš„é€‰æ‹©ï¼Œå†…å­˜å ç”¨æ¯” ZGC ä½ï¼ŒCPU æ›´ç¨³å®šã€‚å¤§éƒ¨åˆ†åœºæ™¯ä¸‹å°å†…å­˜åº”ç”¨ï¼Œå¹¶ä¸éœ€è¦ ZGCã€‚ äº²æµ‹å¤§éƒ¨åˆ†åº”ç”¨ Java 25 æ¯” Java 21 å†…å­˜å ç”¨çº¦å°‘ 5%-10%ï¼ŒGC æ›´ç¨³å®šã€‚ åŸºç¡€å‚æ•°ï¼š\n-server - ä½¿ç”¨æœåŠ¡å™¨æ¨¡å¼ JVM -XX:+UnlockExperimentalVMOptions - è§£é”å®éªŒæ€§ VM é€‰é¡¹ -XX:+UseStringDeduplication - å¯ç”¨å­—ç¬¦ä¸²å»é‡ä¼˜åŒ– -XX:+UseCompactObjectHeaders - ä½¿ç”¨ç´§å‡‘å¯¹è±¡å¤´ï¼ŒJava 24 ä»¥å -XX:ParallelGCThreads=4 - STW æœŸé—´ï¼Œå¹¶è¡Œ GC çº¿ç¨‹æ•°ä¸º 4 -XX:ConcGCThreads=4 - å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œå¹¶å‘ GC çº¿ç¨‹æ•°ä¸º 4 -XX:InitialRAMPercentage=20.0 - åˆå§‹å †å†…å­˜å ç‰©ç†å†…å­˜ 20%ï¼Œä½œç”¨ç­‰æ•ˆäº Xmsï¼ŒXms ä¼˜å…ˆçº§æ›´ -XX:MaxRAMPercentage=50.0 - æœ€å¤§å †å†…å­˜å ç‰©ç†å†…å­˜ 50%ï¼Œä½œç”¨ç­‰æ•ˆäº Xmx -XX:+ExitOnOutOfMemoryError - OOM æ—¶é€€å‡º JVM -Djava.security.egd=file:/dev/./urandom - ä½¿ç”¨éé˜»å¡éšæœºæ•°ç”Ÿæˆå™¨ -Dfile.encoding=UTF-8 - è®¾ç½®æ–‡ä»¶ç¼–ç ä¸º UTF-8 -Dsun.jnu.encoding=UTF-8 - è®¾ç½® JNU ç¼–ç ä¸º UTF-8 -Dio.netty.tryReflectionSetAccessible=true - Netty åå°„è®¿é—®è®¾ç½® -Djdk.nio.maxCachedBufferSize=1048576 - NIO ç¼“å­˜ç¼“å†²åŒºå¤§å°é™åˆ¶ä¸º 1MB G1 ç›¸å…³å‚æ•°ï¼š\n-XX:MaxGCPauseMillis=500 - è®¾ç½® GC çš„ç›®æ ‡æœ€å¤§åœé¡¿æ—¶é—´ä¸º 500 æ¯«ç§’ï¼Œé»˜è®¤å€¼ï¼š200 æ¯«ç§’ï¼Œé™ä½åœé¡¿ç›®æ ‡ä¼šé™ä½ååé‡ï¼Œåä¹‹äº¦ç„¶ã€‚ä½œä¸ºæ™ºèƒ½çš„ç°ä»£åŒ– GCï¼ŒG1 ä¼šå°è¯•è‡ªåŠ¨è°ƒæ•´å„ç§ GC è¡Œä¸ºï¼ˆæ§åˆ¶å¹´è½»ä»£å¤§å°ã€æ··åˆ GC æ¬¡æ•°ç­‰ï¼‰æ¥æ»¡è¶³è¿™ä¸ªåœé¡¿æ—¶é—´ç›®æ ‡ï¼Œå¦‚æœæ— æ³•è¾¾åˆ°ç›®æ ‡ï¼Œä¼šè®°å½•åœ¨ GC æ—¥å¿—ä¸­ã€‚ -XX:InitiatingHeapOccupancyPercent=25 - å½“å †å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ° 25% æ—¶å¯åŠ¨å¹¶å‘ GC å‘¨æœŸï¼Œé»˜è®¤å€¼ï¼š45%ï¼Œæå‰å¯åŠ¨ GC é¿å… STWã€‚ MaxGCPauseMillis è°ƒæ•´ç­–ç•¥ï¼š\nå¦‚æœä½ çš„åº”ç”¨å¯¹å»¶è¿Ÿéå¸¸æ•æ„Ÿï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œæ¯”å¦‚ 50 æˆ– 100 æ¯«ç§’ï¼Œä»¥å‡å°‘æ¯æ¬¡ GC çš„åœé¡¿æ—¶é—´ã€‚ å¦‚æœåº”ç”¨æ›´æ³¨é‡ååé‡è€Œä¸æ˜¯å»¶è¿Ÿï¼Œå¯ä»¥é€‚å½“å¢åŠ è¿™ä¸ªå€¼ï¼Œæ¯”å¦‚ 200 æˆ– 300 æ¯«ç§’ï¼Œä»¥æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚ è®¾ç½®å¤ªå°çš„å€¼å¯èƒ½å¯¼è‡´ç³»ç»ŸèŠ±è´¹æ›´å¤šçš„æ—¶é—´è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå› ä¸º JVM ä¼šä¸ºäº†æ»¡è¶³æœ€å¤§æš‚åœæ—¶é—´è€Œé¢‘ç¹è§¦å‘ GCï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´é«˜é¢‘ç‡çš„ GC ã€‚ è®¾ç½®è¾ƒå¤§çš„å€¼å¯èƒ½ä¼šå¢åŠ åœé¡¿æ—¶é—´ï¼Œä½†å¯ä»¥å‡å°‘ GC çš„é¢‘ç‡ï¼Œä»è€Œæé«˜åº”ç”¨çš„æ•´ä½“ååé‡ã€‚ ZGC ç›¸å…³å‚æ•°ï¼š\n-XX:+UseZGC - ä½¿ç”¨ ZGC -XX:+ZUncommit - å½’è¿˜æœªä½¿ç”¨çš„å†…å­˜ -XX:ZUncommitDelay=300 - è®¾ç½® ZGC å½’è¿˜å»¶è¿Ÿä¸º 300 ç§’ å¯é€‰å‚æ•°ï¼š\n-Xss512k - è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°ä¸º 512KBï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚é»˜è®¤ 1MB å¤ªå¤§äº†ã€‚ -XX:MinHeapFreeRatio=10 - è®¾ç½® GC åå †å†…å­˜æœ€å°ç©ºé—²æ¯”ä¾‹ 10%ï¼Œå½“å †å†…å­˜ç©ºé—²æ¯”ä¾‹ä½äº 20%æ—¶ï¼ŒJVM ä¼šæ‰©å±•å †å¤§å°ã€‚é»˜è®¤ 40%ã€‚ -XX:MaxHeapFreeRatio=30 - è®¾ç½® GC åå †å†…å­˜æœ€å¤§ç©ºé—²æ¯”ä¾‹ 30%ï¼Œå½“å †å†…å­˜ç©ºé—²æ¯”ä¾‹é«˜äº 30%æ—¶ï¼ŒJVM ä¼šæ”¶ç¼©å †å¤§å°ã€‚ä¿ƒè¿› Java å†…å­˜æ›´å¿«äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œä½†åŒæ—¶ CPU å¯èƒ½åé«˜ã€‚é»˜è®¤ 70%ã€‚ -XX:+AlwaysPreTouch - JVM å¯åŠ¨æ—¶ç«‹å³ä¸ºæ‰€æœ‰å †å†…å­˜ï¼ˆæŒ‰ç…§ Xms å¤§å°ï¼‰åˆ†é…ç‰©ç†å†…å­˜å¹¶å†™å…¥é›¶å€¼ï¼Œå¯åŠ¨æ—¶é—´å˜é•¿ï¼Œä½†è¿è¡Œæ—¶æ€§èƒ½æ›´ç¨³å®šã€‚é¿å…å› å†…å­˜åˆ†é…å¯¼è‡´çš„ GC åœé¡¿æ³¢åŠ¨ï¼Œæ“ä½œç³»ç»Ÿæ›´å®¹æ˜“åˆ†é…è¿ç»­ç‰©ç†å†…å­˜é¡µï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€‚ å †ç©ºé—´çš„ç©ºé—²ç™¾åˆ†æ¯”è®¡ç®—å…¬å¼ä¸ºï¼šHeapFreeRatio =(CurrentFreeHeapSize/CurrentTotalHeapSize) * 100ï¼Œå€¼çš„åŒºé—´ä¸º 0 åˆ° 100ã€‚å¦‚æœ HeapFreeRatio \u0026lt; MinHeapFreeRatioï¼Œåˆ™éœ€è¦è¿›è¡Œå †æ‰©å®¹ï¼Œå¦‚æœ HeapFreeRatio \u0026gt; MaxHeapFreeRatioï¼Œåˆ™éœ€è¦è¿›è¡Œå †ç¼©å®¹ï¼Œæ‰©ç¼©å®¹çš„æ—¶æœºåº”è¯¥åœ¨æ¯æ¬¡åƒåœ¾å›æ”¶ä¹‹åã€‚\nå¦‚æœ Xmx==Xms InitialRAMPercentage==MaxRAMPercentage è¿™ä¸¤ä¸ª HeapFreeRatio å‚æ•°å°±å¤±å»äº†æ„ä¹‰ï¼Œä»–æ€ä¹ˆæ‰©ç¼©éƒ½ä¸ä¼šçªç ´ Xms å’Œ Xmx çš„é™åˆ¶ã€‚\né‡è§é—®é¢˜å’Œè§£å†³åŠæ³• Java ç›®æ ‡ç‰ˆæœ¬ä¸åŒ¹é…ï¼šæœ‰äº›é¡¹ç›®è®¾ç½® \u0026lt;java.version\u0026gt;21\u0026lt;/java.version\u0026gt; è¿è¡ŒåŒæ—¶ç»™åˆ«äººæä¾›äº† SDKï¼Œä½†æ˜¯ SDK ä½¿ç”¨è€…è¿˜æ˜¯ Java 8ã€‚æ­¤æ—¶å°±éœ€è¦æ˜ç¡®è®¾ç½®ç¼–è¯‘ç›®æ ‡ç‰ˆæœ¬ä¸º Java 8ï¼Œå¦è€…ä½¿ç”¨è€…å°±ä¼šæŠ¥é”™ã€‚è€Œä¸”è¿™ä¸ªæŠ¥é”™å¯èƒ½ä¼šå»¶è¿Ÿåˆ°è¿è¡ŒæœŸï¼Œæ¯”å¦‚ MQ ååºåˆ—åŒ–çš„æ—¶å€™æ‰è§¦å‘ï¼Œè¿™æ ·å°±å¾ˆå±é™©ã€‚\n\u0026lt;java.version\u0026gt;21\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.release\u0026gt;8\u0026lt;/maven.compiler.release\u0026gt;\rä¸€å®šè¦å‡çº§ä¾èµ–åŒ…å—ï¼Œä¸å‡çº§èƒ½ç¼–è¯‘é€šè¿‡ï¼Œç›´æ¥ç”¨ Java 21 èƒ½ä¸èƒ½è·‘èµ·æ¥ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ã€‚\nä»¥æˆ‘ä»¬å®é™…ç»éªŒæ¥çœ‹ï¼Œç¡®å®æœ‰å¾ˆå¤šåº”ç”¨ä¸å‡çº§å¯ç›´æ¥è¿è¡Œï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œå–å†³äºæœ‰æ²¡æœ‰ä½¿ç”¨å·²åˆ é™¤ APIã€‚å¼€å‘ã€ç¼–è¯‘ã€è¿è¡Œå§‹ç»ˆä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬èƒ½é¿å…å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ã€‚\nåºåˆ—åŒ–ï¼šalibaba fastjson 1.x ä¸æ”¯æŒ Java record, å°†ä¸€ä¸ª record å¯¹è±¡è½¬ä¸º String ç»“æœæ˜¯ {}, è€Œä¸”ä¸æŠ¥é”™ï¼fastjson2 æ‰æ”¯æŒã€‚\nå­—èŠ‚ç ä¹‹ç±»çš„å·¥å…·åŒ…æ¯”å¦‚ javassistã€asmã€byte-buddy ä¸€å®šè¦å‡çº§åˆ°é…å¥—çš„ç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½å‡ºç°ç¼–è¯‘æœŸé”™è¯¯ï¼Œè®¾ç½®æ˜¯è¿è¡ŒæœŸé”™è¯¯æ¯”å¦‚ dubboã€‚\nå‡çº§åˆ° Java 21 ä»¥åï¼Œå†…å­˜å ç”¨åè€Œæ›´é«˜äº†ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´å†…å­˜é€’å¢æœ€å OOMï¼Œåæ¥å®šä½æ˜¯å‘½ä¸­äº† netty çš„ Bugï¼Œè¯¦ç»†ä»‹ç»å‚è€ƒï¼šjdk17 ä¸‹ netty å¯¼è‡´å †å†…å­˜ç–¯æ¶¨åŸå› æ’æŸ¥ ã€‚\nå‡çº§åˆ° Java 21 ä»¥åï¼Œå†æ¬¡å†…å­˜å ç”¨æ›´é«˜ï¼Œä» dump æ–‡ä»¶é‡Œï¼Œçœ‹åˆ°äº†æœ‰å¤§çº¦ 800 ä¸ª ThreadLocal å’Œ BufferCache å¯¹è±¡ï¼Œæœ€ç»ˆå®šä½å‘½ä¸­äº† JAVA NIO è¿™ä¸ªé—®é¢˜ ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¯åŠ¨å‘½ä»¤è¡Œå¢åŠ äº† -Djdk.nio.maxCachedBufferSize=1048576 å‚æ•°åä¸å† OOMã€‚\nå†…å­˜å ç”¨é«˜ï¼Œä¸é¢„æœŸä¸¥é‡ä¸ç¬¦ï¼Œæœ€ç»ˆå®šä½æ˜¯ glibc å†…å­˜ä¸å½’è¿˜é—®é¢˜ï¼šä» trace æ¥çœ‹ JVM è¿›ç¨‹æœ¬èº«é‡Šæ”¾äº†å†…å­˜ï¼Œä½†æ˜¯ glibc å¹¶æ²¡æœ‰å½’è¿˜æ“ä½œç³»ç»Ÿï¼Œæœ€åæŠŠ glibc åˆ‡æ¢æˆ jemallocï¼Œå†…å­˜ç«‹é©¬ä¸‹é™ 30%ã€‚å®šä½è¿‡ç¨‹å’Œè§£å†³åŠæ³•å‚è€ƒï¼šK8S Pod å®¹å™¨å†… Java è¿›ç¨‹å†…å­˜åˆ†æï¼Œå†…å­˜è™šé«˜ä»¥åŠå®¹å™¨ OOM æˆ– Jave OOM é—®é¢˜å®šä½ ã€‚\nTLS ä¸å…¼å®¹é—®é¢˜ï¼Œå¾ˆå¤šè€ç³»ç»Ÿï¼Œæ¯”å¦‚è€ç‰ˆæœ¬ MySQLã€SQLServerï¼Œè¿˜æ˜¯ä½¿ç”¨è€ç‰ˆæœ¬ TLSï¼Œå°±ä¼šå‡ºç°ç±»ä¼¼å¦‚ä¸‹é”™è¯¯ã€‚JDK 17 æ˜¯æ”¯æŒ TLS1.0 ~ TLS1.3 çš„ï¼Œä½†æ˜¯é»˜è®¤ä½¿ç”¨çš„ TLS ç‰ˆæœ¬æ˜¯ TLS 1.3, è€ç‰ˆæœ¬è¢«ç¦ç”¨äº†ï¼Œéœ€è¦ä¸»åŠ¨æ”¾å¼€ã€‚\n# é”™è¯¯æ—¥å¿— The server selected protocol version TLS10 is not accepted by client preferences [TLS13, TLS12]ã€‚ # é…ç½®æ–‡ä»¶ $JAVA_HOME/conf/security/java.security # æ‰¾åˆ°é‡Œé¢çš„ä¸€è¡Œé…ç½®ï¼š jdk.tls.disabledAlgorithms=SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, \\ DH keySize \u0026lt; 1024, EC keySize \u0026lt; 224, 3DES_EDE_CBC, anon, NULL # è¯´æ˜ï¼šJDK ä¸­çš„ jdk.tls.disabledAlgorithms å‚æ•°ç”¨äºç¦ç”¨ä¸å®‰å…¨æˆ–ä¸éœ€è¦çš„ TLS å¯†ç ç®—æ³•ï¼Œ ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚é€šè¿‡é…ç½®è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥æŒ‡å®š JDK ä¸æ”¯æŒçš„å¯†ç ç®—æ³•æˆ–åè®®ï¼Œä»¥é™ä½å®ƒä»¬çš„ä¼˜å…ˆçº§ï¼Œ å‡å°‘è¢«æ”»å‡»çš„é£é™©ã€‚ # æˆ‘ä»¬æŠŠ TLSv1ï¼ŒTLSv1.1 è¿™ä¸¤ä¸ªåˆ é™¤æ‰ï¼Œå˜æˆå¦‚ä¸‹ï¼š jdk.tls.disabledAlgorithms=SSLv3, RC4, DES, MD5withRSA, \\ DH keySize \u0026lt; 1024, EC keySize \u0026lt; 224, 3DES_EDE_CBC, anon, NULL åŸç†å¦‚ä¸Šï¼Œå®é™…æ“ä½œæ—¶ï¼Œä¸å»ºè®®ç›´æ¥å»æ”¹åŸ java.security æ–‡ä»¶ï¼Œå¯æŒ‰ä»¥ä¸‹æ–¹å¼æ“ä½œã€‚\n# è‡ªå®šä¹‰ä¸€ä¸ªæ–°æ–‡ä»¶ custom.java.securityï¼Œå†…å®¹åªåŒ…å« disabledAlgorithms é…ç½® jdk.tls.disabledAlgorithms=RC4, DES, MD5withRSA, \\ DH keySize \u0026lt; 1024, EC keySize \u0026lt; 224, 3DES_EDE_CBC, anon, NULL, \\ include jdk.disabled.namedCurves # ç„¶åå¯åŠ¨çš„å‘½ä»¤è¡Œå¢åŠ ä»¥ä¸‹å‚æ•°é…ç½®ï¼ŒæŒ‡å®šè‡ªå®šä¹‰çš„ java.security æ–‡ä»¶è¦†ç›–æ–‡ä»¶é‡Œæœ‰çš„å€¼ -Djava.security.properties=$JAVA_HOME/conf/security/custom.java.security # æ³¨æ„æ³¨æ„ï¼Œç”¨ä¸¤ä¸ªç­‰å· == æŒ‡å®šè‡ªå®šä¹‰çš„ java.security æ–‡ä»¶ï¼Œæ˜¯è¦†ç›–æ•´ä¸ª Java é»˜è®¤çš„ java.security æ–‡ä»¶ï¼ŒåŸæ–‡ä»¶å…¨éƒ¨å¤±æ•ˆï¼Œåªç”¨è‡ªå®šä¹‰æ–‡ä»¶é‡Œçš„é…ç½® -Djava.security.properties==$JAVA_HOME/conf/security/custom.java.security ä½¿ç”¨è‡ªå®šä¹‰ classloader çš„è¯·å…³æ³¨ï¼Œåœ¨ JDK 8 ä¸­ system classloader æ˜¯ URLClassLoader çš„å­ç±»ï¼Œä½†æ˜¯åœ¨ JDK 11 ä¸­åˆ™ä¸å†æˆç«‹ã€‚å®é™…ä¸Šå®ƒå·²ç»å˜æˆäº†ä¸€ä¸ªå†…éƒ¨çš„ class loader å¦‚æœå°† system classloader è½¬æ¢ä¸º URLClassLoader ä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚\nä» JDK 8 åˆ° JDK 9ï¼Œ Arrays.asList(x).toArray() è¿”å›ç±»å‹ç”Ÿå‘ç”Ÿå˜åŒ–ã€‚Arrays.asList(x).toArray().getClass() æ ¹æ® javadoc åº”è¯¥è¿”å›çš„æ˜¯ Object[], ä½†æ˜¯åœ¨ JDK 8 ä¸­ï¼Œå¦‚æœ x æ˜¯ String[], è¿”å›çš„ç±»å‹ä¹Ÿæ˜¯ String[]. ä¸‹é¢çš„ä»£ç åœ¨ JDK 8 ä¸ä¼šæœ‰å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨ JDK 9 ä¼šæŠ›å‡º ClassCastException å¼‚å¸¸ã€‚è§£å†³åŠæ³•ï¼šä½¿ç”¨æ”¯æŒæ³›å‹çš„æ–¹æ³• T[] toArray(T[] a) è¿›è¡Œè½¬æ¢ã€‚\nJava 21 è™šæ‹Ÿçº¿ç¨‹ + synchronized å¯èƒ½å¯¼è‡´ block çš„å‘ï¼Œåœ¨ Java 24 å·²è§£å†³ï¼Œå…·ä½“æè¿°å‚è€ƒ virtual thread synchronized ã€‚\nåœ¨ Java 21 å…¬å…±çº¿ç¨‹æ± çš„ ContextClassLoader æ˜¯ AppClassloaderï¼Œè€Œä¸æ˜¯ä»è°ƒç”¨çº¿ç¨‹ç»§æ‰¿çš„ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ç±»åŠ è½½é—®é¢˜ã€‚å½“ä½ åœ¨ä½¿ç”¨ java.util.concurrent.CompletableFuture.runAsyncã€java.util.stream.Stream.parallel()ã€List.parallelStream()ã€Thread.currentThread().getContextClassLoader().getResource() æ—¶ï¼Œè¯·å…³æ³¨ã€‚ ä¸€ä¸ªå…¸å‹çš„å¯èƒ½å¸¦æ¥çš„ Bug å‚è€ƒ ä½¿ç”¨ CompletableFuture æ—¶ï¼Œå…³äº ClassLoader å¼•èµ·çš„é—®é¢˜ ã€‚\nmodule jdk.proxy3 does not \u0026ldquo;opens jdk.proxy3\u0026rdquo; to unnamed module.\nç½‘ä¸ŠåŒ…æ‹¬äººå·¥æ™ºèƒ½æ¨èçš„ç­”æ¡ˆéƒ½æ˜¯ add-opensï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªæ–¹å¼ï¼Œæ¯•ç«Ÿä»¥å‰é‡è§ unnamed module éƒ½æ˜¯è¿™ä¹ˆå¹²çš„ã€‚\n-â€“add-opens=jdk.proxy3=ALL-UNNAMED --add-opens=java.base/java.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.lang.reflect=ALL-UNNAMED å®é™…ä¸Šéƒ½ä¸ç”Ÿæ•ˆã€‚Java é‡Œå¹¶æ²¡æœ‰ä¸€ä¸ªçœŸçš„å« jdk.proxy3 çš„æ¨¡å—ï¼Œè¿™æ˜¯ç”± Dynamic Proxy åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªè™šæ‹Ÿæ–¹æ³•ã€‚æœ€æ ¹æœ¬çš„è§£å†³åŠæ³•è¿˜æ˜¯å‡çº§ä»£ç ï¼Œä¸è¦è°ƒç”¨ Java è¿‡æ—¶çš„æ–¹æ³•ã€‚æˆ‘è¿™é‡Œæ˜¯å› ä¸º Groovy è°ƒç”¨äº§ç”Ÿï¼Œå‡çº§äº†ä¸€ä¸‹ Groovyï¼Œå®Œç¾è§£å†³ã€‚\nå‚è€ƒèµ„æ–™ ä» Java 15 åˆ° 23 å…³äº G1 GC çš„ä¼˜åŒ–\nhttps://tschatzl.github.io/ Oracle å‡ºçš„ Java 21 è¿ç§»æŒ‡å—ï¼ŒåŒ…å«æ–°ç‰¹æ€§ä»‹ç»ã€Removed APIsã€Removed Tools and Components ç­‰\nhttps://docs.oracle.com/en/java/javase/21/migrate/getting-started.html Microsoft transition from java 8 to java 11\nhttps://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11 Java Dependency Analysis Tool\nhttps://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool ä»€ä¹ˆæ˜¯å¤šç‰ˆæœ¬ Jarï¼ˆMulti Release Jarï¼‰\nhttps://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files Java G1 é‡è¦å‚æ•°è®¾ç½®å‚è€ƒ\nhttps://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp åœ°ç“œå“¥ JVM GC æ€§èƒ½æµ‹è¯•ï¼ˆä¸‰ï¼‰ï¼šçœŸå®æµé‡\nhttps://www.diguage.com/post/gc-performance-real-qps/ åœ°ç“œå“¥ OpenJDK 21 å‡çº§æŒ‡å—\nhttps://www.diguage.com/post/upgrade-to-openjdk21/ jdeprscan can not find class è§£å†³åŠæ³•\nhttps://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error/ ä» Java 8 å‡çº§åˆ° Java 17 è¸©å‘å…¨è¿‡ç¨‹\nhttps://cloud.tencent.com/developer/article/2257886 é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº Java å‡çº§æ€»ç»“\nhttps://www.zhihu.com/tardis/zm/art/585377119?source_id=1003 ","date":"2024-05-23","id":17,"permalink":"/blog/migrating-java8-to-java25/","summary":"å…¨é¢è§£æ Java 25 æ–°ç‰¹æ€§ä¸å‡çº§å®æˆ˜ï¼ŒåŒ…å«æ€§èƒ½ä¼˜åŒ–ã€è¿ç§»å·¥å…·ã€é¿å‘æŒ‡å—","tags":["Java 25","Java25","JDK 25","Java","Spring Boot","è™šæ‹Ÿçº¿ç¨‹","ZGC","G1 GC","æ€§èƒ½ä¼˜åŒ–","Java å‡çº§","JVM è°ƒä¼˜"],"title":"Java 25 å®Œæ•´å‡çº§æŒ‡å—ï¼šä» Java 8 åˆ° Java 25 æ–°ç‰¹æ€§ã€æ€§èƒ½ä¼˜åŒ–ã€è¿ç§»å®æˆ˜å…¨è§£æ"},{"content":"åœ¨æ­å»ºæœ¬åœ° Kubernetus é›†ç¾¤åï¼Œç”±äºç¯å¢ƒåœ¨å†…ç½‘ï¼Œåšä¸äº†åŸŸåéªŒè¯ï¼Œæ— æ³•ä½¿ç”¨ Let\u0026rsquo;s Encrypt é¢å‘å’Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œç„¶è€Œå¾ˆå¤šåº”ç”¨è¦æ±‚å¿…é¡»å¯ç”¨ HTTPSï¼Œåªèƒ½ç”¨è‡ªç­¾å CA è¯ä¹¦ï¼Œå¹¶ç”±æ­¤ CA ç»§ç»­é¢å‘å…¶ä»–è¯ä¹¦ã€‚\næ‰€ä»¥æˆ‘ä»¬å‡†å¤‡äº†ä»¥ä¸‹å·¥å…·ï¼Œå¼€å§‹æ­å»ºã€‚\nPulumi : å½“å‰éå¸¸æµè¡Œçš„ IaC å·¥å…·ï¼Œå€¼å¾—ä¸€è¯•ã€‚ cert-manager : äº‘åŸç”Ÿè¯ä¹¦ç®¡ç†ï¼Œç”¨äºè‡ªåŠ¨ç®¡ç†å’Œé¢å‘å„ç§å‘è¡Œæ¥æºçš„ TLS è¯ä¹¦ã€‚å®ƒå°†ç¡®ä¿è¯ä¹¦æœ‰æ•ˆå¹¶å®šæœŸæ›´æ–°ï¼Œå¹¶å°è¯•åœ¨åˆ°æœŸå‰çš„é€‚å½“æ—¶é—´æ›´æ–°è¯ä¹¦ã€‚ æ ¸å¿ƒæ­¥éª¤å’Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼Œæ›´å¤šæºç è¯·å‚è€ƒæˆ‘ä»¬çš„ GitHub é¡¹ç›® xlabs-ops ã€‚\nä½¿ç”¨ Pulumi å®‰è£… cert-managerï¼Œç”Ÿæˆè‡ªç­¾å CA è¯ä¹¦ï¼Œæ ¹æ®è‡ªç­¾å CA è¯ä¹¦ç”Ÿæˆ cert-manager ClusterIssuerï¼Œéƒ½åœ¨å¦‚ä¸‹ä»£ç äº†ã€‚\nimport * as pulumi from \u0026#34;@pulumi/pulumi\u0026#34;; import * as kubernetes from \u0026#34;@pulumi/kubernetes\u0026#34;; import * as tls from \u0026#34;@pulumi/tls\u0026#34;; // éƒ¨ç½² cert-manager Helm chart const certManagerRelease = new kubernetes.helm.v3.Release(\u0026#34;cert-manager\u0026#34;, { name: \u0026#34;cert-manager\u0026#34;, chart: \u0026#34;cert-manager\u0026#34;, version: \u0026#34;1.14.5\u0026#34;, namespace: \u0026#34;cert-manager\u0026#34;, createNamespace: true, timeout: 600, repositoryOpts: { repo: \u0026#34;https://charts.jetstack.io\u0026#34; }, values: { installCRDs: true } }); // ç”Ÿæˆä¸€ä¸ª CA private key const caPrivateKey = new tls.PrivateKey(\u0026#34;caPrivateKey\u0026#34;, { algorithm: \u0026#34;RSA\u0026#34; }); // ç”Ÿæˆä¸€ä¸ª è‡ªç­¾å CA è¯ä¹¦ const caCert = new tls.SelfSignedCert(\u0026#34;caCert\u0026#34;, { // keyAlgorithm: \u0026#34;RSA\u0026#34;, privateKeyPem: caPrivateKey.privateKeyPem, isCaCertificate: true, validityPeriodHours: 87600, // 10 year allowedUses: [\u0026#34;cert_signing\u0026#34;, \u0026#34;crl_signing\u0026#34;], subject: { commonName: \u0026#34;your.domain.com\u0026#34;, organization: \u0026#34;Xlabs Club\u0026#34; } }); // ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ CA crt å’Œ key çš„ Kubernetes Secret const caSecret = new kubernetes.core.v1.Secret(\u0026#34;caSecret\u0026#34;, { metadata: { name: \u0026#34;selfsigned-cert-manager-ca\u0026#34;, namespace: \u0026#34;cert-manager\u0026#34; }, type: \u0026#34;Opaque\u0026#34;, stringData: { \u0026#34;tls.crt\u0026#34;: caCert.certPem, \u0026#34;tls.key\u0026#34;: caPrivateKey.privateKeyPem } }); // åˆ›å»ºä¸€ä¸ªè‡ªç­¾åçš„ ClusterIssuer ç»™ ingress ç”¨ const clusterIssuer = new kubernetes.apiextensions.CustomResource( \u0026#34;selfsigned-issuer\u0026#34;, { apiVersion: \u0026#34;cert-manager.io/v1\u0026#34;, kind: \u0026#34;ClusterIssuer\u0026#34;, metadata: { name: \u0026#34;selfsigned-issuer\u0026#34;, // æ³¨æ„ ClusterIssuer å’Œ caSecret æ”¾åœ¨åŒä¸€ä¸ª namespaceï¼Œä¸å†™ namespace æ—¶ ClusterIssuer æ‰¾ä¸åˆ° caSecret namespace: \u0026#34;cert-manager\u0026#34; }, spec: { ca: { secretName: caSecret.metadata.name } } }, { dependsOn: certManagerRelease } ); export const certManagerVersion = certManagerRelease.version; export const clusterIssuerName = clusterIssuer.metadata.name; // Export CA è¯ä¹¦ï¼Œä¾¿äºå®¢æˆ·ç«¯å¯¼å…¥ä¿¡ä»»è¯ä¹¦ export const caCertificatePem = caCert.certPem;\rä»¥ä¸Šæ‰§è¡Œ pulumi up åï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªè‡ªç­¾åçš„ CA è¯ä¹¦ã€ä¸€ä¸ªå¯ç”¨äºä¸º ingress è‡ªåŠ¨ç­¾å‘ TLS çš„ ClusterIssuerã€‚\nåœ¨ K8S ingress ä¸Šï¼Œå¢åŠ ä»¥ä¸‹ annotations å³å¯è‡ªåŠ¨ç”Ÿæˆ TLS è¯ä¹¦ï¼Œæ³¨æ„åå­— selfsigned-issuer ä¸ä¸Šé¢åˆ›å»ºçš„åå­—ä¿æŒä¸€è‡´ã€‚\napiVersion: networking.k8s.io/v1 kind: Ingress metadata: annotations: cert-manager.io/cluster-issuer: selfsigned-issuer\rå¦å¤–æä¾›ä¸€ä¸ªå°æ’æ›²ï¼Œå®é™…ä¸Š cert-manager çš„ ClusterIssuer ä¸éœ€è¦æŒ‡å®š namespaceï¼Œä½†æ˜¯åœ¨åˆ›å»ºçš„æ—¶å€™å‘ç°ä¸å†™ namespaceï¼ŒcaSecret åˆ›å»ºåœ¨ default namespace åï¼ŒClusterIssuer æ‰¾ä¸åˆ° caSecretï¼Œæ‰€ä»¥ä¸ºä»–ä»¬ä¸¤ä¸ªéƒ½ç‰¹åˆ«æŒ‡å®šäº† namespaceã€‚\nè®© Edge/Chrome ä¿¡ä»»è‡ªç­¾åè¯ä¹¦ ä»¥ä¸Šç”Ÿæˆçš„è‡ªç­¾åè¯ä¹¦åœ¨æµè§ˆå™¨è®¿é—®æ—¶ï¼Œä¼šæœ‰çº¢è‰²æç¤ºä¸å®‰å…¨ï¼Œè¢«ç¦æ­¢è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦å°†æˆ‘ä»¬çš„ CA è¯ä¹¦å¯¼å…¥æœ¬æœºå¹¶é€‰æ‹©ä¿¡ä»»ã€‚\n# å¯¼å‡ºä¸Šé¢æ­¥éª¤ç”Ÿäº§çš„ CA è¯ä¹¦ pulumi stack output caCertificatePem --show-secrets \u0026gt; ca.crt.pem\rMac ç”¨æˆ·ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤è¡Œï¼Œæˆ–æ‰“å¼€ Keychain Access åº”ç”¨ç¨‹åºæ‰‹åŠ¨å¯¼å…¥å¹¶åœ¨ info trust ä¸­é€‰æ‹© always trustã€‚\nsudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ca.crt.pem\rå¯¹äº Ubuntu ç”¨æˆ·ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯¼å…¥ã€‚æŸäº› Ubuntu Desktop å¢åŠ ä¿¡ä»»è¯ä¹¦åï¼ŒEdge ä»ç„¶æç¤ºè¯ä¹¦æ— æ•ˆï¼Œåœ¨ Edge åœ°å€æ è¾“å…¥ edge://settings/privacy/manageCertificates é‡æ–°å¯¼å…¥äº†ä¸€æ¬¡å°±è§£å†³äº†ã€‚\nmv ca.crt.pem ca.crt sudo apt-get install -y ca-certificates sudo cp ca.crt /usr/local/share/ca-certificates/my-local-ca.crt sudo update-ca-certificates\rWindows ç”¨æˆ·ï¼ŒåŒå‡» ca.crt å®‰è£…è¯ä¹¦åˆ°â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„â€ã€‚\n","date":"2024-04-29","id":18,"permalink":"/blog/trust-cert-manager-selfsigned-tls/","summary":"\u003cp\u003eåœ¨æ­å»ºæœ¬åœ° Kubernetus é›†ç¾¤åï¼Œç”±äºç¯å¢ƒåœ¨å†…ç½‘ï¼Œåšä¸äº†åŸŸåéªŒè¯ï¼Œæ— æ³•ä½¿ç”¨ Let\u0026rsquo;s Encrypt é¢å‘å’Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œç„¶è€Œå¾ˆå¤šåº”ç”¨è¦æ±‚å¿…é¡»å¯ç”¨ HTTPSï¼Œåªèƒ½ç”¨è‡ªç­¾å CA è¯ä¹¦ï¼Œå¹¶ç”±æ­¤ CA ç»§ç»­é¢å‘å…¶ä»–è¯ä¹¦ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æˆ‘ä»¬å‡†å¤‡äº†ä»¥ä¸‹å·¥å…·ï¼Œå¼€å§‹æ­å»ºã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.pulumi.com/\" target=\"_blank\" rel=\"noopener\"\u003ePulumi\u003c/a\u003e\n: å½“å‰éå¸¸æµè¡Œçš„ IaC å·¥å…·ï¼Œå€¼å¾—ä¸€è¯•ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cert-manager.io/\" target=\"_blank\" rel=\"noopener\"\u003ecert-manager\u003c/a\u003e\n: äº‘åŸç”Ÿè¯ä¹¦ç®¡ç†ï¼Œç”¨äºè‡ªåŠ¨ç®¡ç†å’Œé¢å‘å„ç§å‘è¡Œæ¥æºçš„ TLS è¯ä¹¦ã€‚å®ƒå°†ç¡®ä¿è¯ä¹¦æœ‰æ•ˆå¹¶å®šæœŸæ›´æ–°ï¼Œå¹¶å°è¯•åœ¨åˆ°æœŸå‰çš„é€‚å½“æ—¶é—´æ›´æ–°è¯ä¹¦ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ ¸å¿ƒæ­¥éª¤å’Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼Œæ›´å¤šæºç è¯·å‚è€ƒæˆ‘ä»¬çš„ GitHub é¡¹ç›® \u003ca href=\"https://github.com/xlabs-club/xlabs-ops\" target=\"_blank\" rel=\"noopener\"\u003exlabs-ops\u003c/a\u003e\nã€‚\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨ Pulumi å®‰è£… cert-managerï¼Œç”Ÿæˆè‡ªç­¾å CA è¯ä¹¦ï¼Œæ ¹æ®è‡ªç­¾å CA è¯ä¹¦ç”Ÿæˆ cert-manager ClusterIssuerï¼Œéƒ½åœ¨å¦‚ä¸‹ä»£ç äº†ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ts\" data-lang=\"ts\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003epulumi\u003c/span\u003e \u003cspan class=\"kr\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;@pulumi/pulumi\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003ekubernetes\u003c/span\u003e \u003cspan class=\"kr\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;@pulumi/kubernetes\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003etls\u003c/span\u003e \u003cspan class=\"kr\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;@pulumi/tls\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// éƒ¨ç½² cert-manager Helm chart\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecertManagerRelease\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehelm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ev3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eRelease\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;cert-manager\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cert-manager\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003echart\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cert-manager\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003eversion\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;1.14.5\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"kr\"\u003enamespace\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cert-manager\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003ecreateNamespace\u003c/span\u003e: \u003cspan class=\"kt\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003etimeout\u003c/span\u003e: \u003cspan class=\"kt\"\u003e600\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003erepositoryOpts\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003erepo\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;https://charts.jetstack.io\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003evalues\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003einstallCRDs\u003c/span\u003e: \u003cspan class=\"kt\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ç”Ÿæˆä¸€ä¸ª CA private key\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaPrivateKey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003etls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ePrivateKey\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;caPrivateKey\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003ealgorithm\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;RSA\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ç”Ÿæˆä¸€ä¸ª è‡ªç­¾å CA è¯ä¹¦\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaCert\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003etls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSelfSignedCert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;caCert\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e// keyAlgorithm: \u0026#34;RSA\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e  \u003cspan class=\"nx\"\u003eprivateKeyPem\u003c/span\u003e: \u003cspan class=\"kt\"\u003ecaPrivateKey.privateKeyPem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003eisCaCertificate\u003c/span\u003e: \u003cspan class=\"kt\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003evalidityPeriodHours\u003c/span\u003e: \u003cspan class=\"kt\"\u003e87600\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 10 year\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e  \u003cspan class=\"nx\"\u003eallowedUses\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;cert_signing\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;crl_signing\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003esubject\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ecommonName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;your.domain.com\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eorganization\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Xlabs Club\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ CA crt å’Œ key çš„ Kubernetes Secret\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaSecret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ev1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eSecret\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;caSecret\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003emetadata\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;selfsigned-cert-manager-ca\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kr\"\u003enamespace\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cert-manager\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"kr\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Opaque\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003estringData\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;tls.crt\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaCert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecertPem\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;tls.key\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaPrivateKey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprivateKeyPem\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// åˆ›å»ºä¸€ä¸ªè‡ªç­¾åçš„ ClusterIssuer ç»™ ingress ç”¨\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eclusterIssuer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eapiextensions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eCustomResource\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;selfsigned-issuer\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cert-manager.io/v1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003ekind\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ClusterIssuer\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003emetadata\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;selfsigned-issuer\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e// æ³¨æ„ ClusterIssuer å’Œ caSecret æ”¾åœ¨åŒä¸€ä¸ª namespaceï¼Œä¸å†™ namespace æ—¶ ClusterIssuer æ‰¾ä¸åˆ° caSecret\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e      \u003cspan class=\"kr\"\u003enamespace\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cert-manager\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003espec\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nx\"\u003eca\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003esecretName\u003c/span\u003e: \u003cspan class=\"kt\"\u003ecaSecret.metadata.name\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003edependsOn\u003c/span\u003e: \u003cspan class=\"kt\"\u003ecertManagerRelease\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecertManagerVersion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecertManagerRelease\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eclusterIssuerName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eclusterIssuer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Export CA è¯ä¹¦ï¼Œä¾¿äºå®¢æˆ·ç«¯å¯¼å…¥ä¿¡ä»»è¯ä¹¦\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaCertificatePem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecaCert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecertPem\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eä»¥ä¸Šæ‰§è¡Œ \u003ccode\u003epulumi up\u003c/code\u003e åï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªè‡ªç­¾åçš„ CA è¯ä¹¦ã€ä¸€ä¸ªå¯ç”¨äºä¸º ingress è‡ªåŠ¨ç­¾å‘ TLS çš„ ClusterIssuerã€‚\u003c/p\u003e","tags":["k8s","pulumi"],"title":"ä½¿ç”¨ Pulumi éƒ¨ç½² cert-manager åˆ›å»º K8S è‡ªç­¾åè¯ä¹¦å¹¶ä¿¡ä»»è¯ä¹¦"},{"content":"å› ä¸ºå·¥ä½œç»å¸¸éœ€è¦ç”¨åˆ° K8Sï¼Œè€Œä¸”æœ‰æ—¶å› ç½‘ç»œåŸå› ä¸èƒ½å®Œå…¨ä¾èµ–å…¬å¸ç½‘ç»œï¼Œæˆ–è€…å› ä¸ºæµ‹è¯•æ–°åŠŸèƒ½ä¸èƒ½ç›´æ¥å‘å¸ƒåˆ°å…¬å¸ K8S é›†ç¾¤ï¼Œæ‰€ä»¥å°±æœ‰äº†æœ¬åœ°æ­å»º K8S çš„éœ€æ±‚ã€‚\nå¦å¤–å¦‚æœä½ æœ‰ä»¥ä¸‹éœ€æ±‚ï¼Œæ­¤æ–‡æ¡£ä¸­æåˆ°çš„æ–¹æ¡ˆä¹Ÿå¯èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼š\nå¼€å‘æœºå™¨æ¨¡æ‹Ÿ Armã€AMD64 ç­‰ä¸åŒ CPU æ¶æ„ã€‚ æœ¬åœ°æ­å»ºå®Œå…¨éš”ç¦»çš„å¼€å‘ç¯å¢ƒï¼Œæ¯”å¦‚ä¸ºæµ‹è¯• dockerã€podmanã€buildkitã€containd ç­‰ä¸åŒè½¯ä»¶è®¾ç½®çš„ç‹¬ç«‹ç¯å¢ƒã€‚ CI/CD æµç¨‹ä¸­å³ç”¨å³æ¶ˆçš„è½»é‡çº§è™šæ‹Ÿæœºæ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ä¸­éœ€è¦è™šæ‹Ÿæœºæˆ– K8Sï¼Œå¿«é€Ÿå¯åŠ¨ï¼Œç”¨å®Œåˆ é™¤ã€‚ æœ‰é™çš„èµ„æºæ¨¡æ‹Ÿå¤§æ‰¹é‡çš„ K8S èŠ‚ç‚¹ï¼Œæµ‹è¯• K8S API èƒ½åŠ›ã€‚ ä»¥ä¸‹ä»‹ç»ä¸€ä¸‹æˆ‘ç”¨è¿‡çš„å‡ ç§ä¸åŒæ–¹æ¡ˆï¼Œçº¯å±ä¸ªäººè§‚ç‚¹ä»…ä¾›å‚è€ƒã€‚\nä½¿ç”¨ Docker Desktop å¹¶å¯ç”¨ Kubernetes åŠŸèƒ½ã€‚\nä¼˜ç‚¹ï¼šä½¿ç”¨æœ€ç®€å•ï¼Œå¼€ç®±å³ç”¨ã€‚\nç¼ºç‚¹ï¼šåªæ”¯æŒå•èŠ‚ç‚¹ K8Sï¼Œä¸” K8S éƒ¨åˆ†åŠŸèƒ½ä¸æ”¯æŒï¼Œä¸æ˜“å®šåˆ¶ã€‚\nDocker run K3D, K3D run K3Sã€‚\nä¼˜ç‚¹ï¼šç®€å•ï¼Œä»»ä½•æ”¯æŒ docker çš„å·¥å…·ï¼ˆRancher Desktopã€Podmanï¼‰ å¯åŠ¨ä¸€ä¸ªå®¹å™¨å³å¯ã€‚\nç¼ºç‚¹ï¼šåªæ”¯æŒ K3Sï¼Œç¨³å®šæ€§è¶Šæ¥è¶Šä¸è¡Œäº†ï¼Œä»¥å‰å¤šä¼˜ç§€å•Šã€‚\nmultipass å¯åŠ¨è™šæ‹Ÿæœºï¼Œç„¶åå®‰è£… K8Sã€K3S æˆ– minikubeã€‚\nä¼˜ç‚¹ï¼šmultipass å¯å¯åŠ¨ç©ºç™½ ubuntu è™šæ‹Ÿæœºï¼Œæˆ–è€…å¯åŠ¨å·²ç»å®‰è£…å¥½ minikube çš„è™šæ‹Ÿæœºã€‚\nç¼ºç‚¹ï¼šåªæ”¯æŒ ubuntuï¼Œè™šæ‹Ÿæœºä¸å®¿ä¸»æœºåŒæ¶æ„ã€‚\nlima å¯åŠ¨è™šæ‹Ÿæœºï¼Œç„¶åå®‰è£… K8Sã€K3S æˆ– minikubeã€‚\nä¼˜ç‚¹ï¼šæ”¯æŒè™šæ‹Ÿå¤šç§ Linux å‘è¡Œç‰ˆï¼Œæ”¯æŒå¼‚æ„ CPU è™šæ‹Ÿæœºï¼ŒåŒæ—¶èƒ½ä»£æ›¿ Docker Desktopã€‚\nç¼ºç‚¹ï¼šæ¶æ„ç¨å¤æ‚ï¼Œå¯åŠ¨ç•¥æ…¢ï¼Œä¸å¦‚ multipass ç¨³å®šï¼Œä¸æ”¯æŒè¿è¡Œåœ¨ Windowsã€‚\nä»¥ä¸Šæ–¹æ¡ˆï¼Œåœ¨ç½‘ç»œç•…é€šçš„æƒ…å†µä¸‹ï¼Œå‡èƒ½åœ¨ 10 åˆ†é’Ÿå†…å¯åŠ¨ä¸€ä¸ªå•èŠ‚ç‚¹ K8Sï¼Œæ‰€ä»¥æ•´ä½“æ–¹æ¡ˆéƒ½ä¸å¤æ‚ã€‚\nå¦‚ä½•é€‰æ‹©ï¼š\nå¦‚æœä½ éœ€è¦åœ¨å…¬å¸ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸æƒ³ä¹°å•†ä¸š License çš„è¯ï¼Œå¯ç›´æ¥æ’é™¤ Docker Desktopã€‚\nå¦‚æœä½ æ˜¯ä¸€ä¸ªæ·±åº¦ K8S å¼€å‘è€…ï¼Œéœ€è¦å¯¹ K8S é›†ç¾¤æœ‰äº›æŠŠæ§ï¼Œæœ‰è¾ƒå¤šå®šåˆ¶ï¼Œå¯æ’é™¤ K3Dã€‚\nå¦‚æœä½ çš„å¼€å‘æœºå™¨æ˜¯ Windowsï¼Œå¯æ’é™¤ limaï¼Œæˆªæ­¢å†™ç¨¿è¿˜ä¸æ”¯æŒè¿è¡Œåœ¨ Windows ä¸Šï¼Œä»Šå¤©æ˜¯å¦æ”¯æŒè¯·å‚è€ƒä»–çš„å®˜æ–¹æ–‡æ¡£ã€‚\nåœ¨è¿‡å»çš„å¾ˆå¤šå¹´ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨ multipass è™šæ‹Ÿå‡º ubuntu è™šæ‹Ÿæœºï¼Œæœ‰äº†è™šæ‹Ÿæœºå°±æƒ³å¹²å•¥å¹²å•¥äº†ï¼Œè‡ªå·±æŒ‰éœ€å®‰è£… K8S æˆ– K3Sï¼Œç›¸å¯¹æ¯”è¾ƒç¨³å®šï¼Œä½¿ç”¨ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œè¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„æ–¹æ¡ˆã€‚\nç›´åˆ°æˆ‘æ¢äº† MacBook Arm æ¶æ„ï¼Œç»å¸¸éœ€è¦è”è°ƒæˆ–æµ‹è¯•ä¸€äº› AMD64 çš„åŠŸèƒ½ï¼Œä¸ºæ–¹ä¾¿å¼‚æ„ç¼–è¯‘å’Œæµ‹è¯•ï¼Œä¸å¾—ä¸å¯»æ‰¾ä¸€ç§æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ¢åˆ°äº† limaã€‚\nlima æ”¯æŒ ARM on Intelã€Intel on ARM å¼‚æ„è™šæ‹Ÿæœºï¼Œå¼‚æ„æœºå™¨æ•´ä½“æ€§èƒ½ä¸Šä¼šæœ‰æ‰€æŸå¤±ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³æ—¥å¸¸å¼€å‘è”è°ƒä½¿ç”¨ã€‚\nmultipass å¿«é€Ÿå®‰è£… K3S multipass æ˜¯ Ubuntu èƒŒåçš„å‚å•† Canonical æ¨å‡ºçš„ä¸€æ¬¾è™šæ‹ŸåŒ–å·¥å…·ï¼Œå¯è¿è¡Œåœ¨ Windowsã€Macã€Linux ä¸Šï¼Œåœ¨æœ¬åœ°å¿«é€Ÿå¯åŠ¨ Ubuntu è™šæ‹Ÿæœºã€‚\nåœ¨å¯åŠ¨å‰ä½¿ç”¨ multipass find çœ‹ä¸‹æœ‰å“ªäº›å¯ç”¨é•œåƒã€‚\n$ multipass find Image Aliases Version Description 20.04 focal 20240408 Ubuntu 20.04 LTS 22.04 jammy,lts 20240319 Ubuntu 22.04 LTS 23.10 mantic 20240410 Ubuntu 23.10 Blueprint Aliases Version Description anbox-cloud-appliance latest Anbox Cloud Appliance docker 0.4 A Docker environment with Portainer and related tools minikube latest minikube is local Kubernetes ä½¿ç”¨ multipass å¯åŠ¨ä¸€ä¸ª ubuntu è™šæ‹Ÿæœºï¼Œç„¶åå®‰è£… k3sï¼Œå®‰è£…å®ŒæˆåæŠŠ k3s çš„ kube config æ–‡ä»¶æ‹·è´åˆ°æœ¬æœºï¼Œä»¥ä¾¿èƒ½æ‰§è¡Œ helm å’Œ kubectl å‘½ä»¤ã€‚\n# å¯åŠ¨ä¸€ä¸ªæ–°è™šæ‹Ÿæœºï¼Œåå­—å« k3sï¼Œä½¿ç”¨ ubuntu 22.04 é•œåƒ multipass launch --name k3s --cpus 8 --memory 16G --disk 256G 22.04 # æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯ï¼Œè·å– IPï¼Œåé¢è¿æ¥æµ‹è¯•ä½¿ç”¨ multipass ç»™æˆ‘ä»¬çš„å†…éƒ¨ IP multipass info k3s # è¿›å…¥è™šæ‹Ÿæœº multipass shell k3s # Install or upgrade k3s as master curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_KUBECONFIG_MODE=600 INSTALL_K3S_CHANNEL=latest sh - # æŒ‰ç…§æˆåŠŸåæ‹·è´ /etc/rancher/k3s/k3s.yaml å½“åš kube/config æ–‡ä»¶ã€‚\rlima å¿«é€Ÿå…¥é—¨ Linux Machines (Lima) ä¹Ÿæ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–å·¥å…·ï¼Œç›®å‰æ˜¯ CNCF sandbox å·¥ç¨‹ï¼Œå¤§å‚èƒŒä¹¦é¢‡æœ‰å‰æ™¯ã€‚\nlima ç‰ˆæœ¬è¿˜åœ¨ä¸æ–­è¿­ä»£ï¼Œå…·ä½“ä½¿ç”¨è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¸‹æ˜¯å…¥é—¨å¸¸ç”¨å‘½ä»¤ã€‚\n# æŸ¥çœ‹æ¨¡æ¿åˆ—è¡¨ limactl start --list-templates # ä½¿ç”¨ Ubuntu æ¨¡ç‰ˆå¯åŠ¨ä¸€ä¸ªé»˜è®¤è™šæ‹Ÿæœºï¼Œæ­¤æ—¶éœ€è¦ä¸‹è½½é•œåƒæ¨¡æ¿æ–‡ä»¶ï¼Œé•œåƒæ¯”è¾ƒå¤§è€å¿ƒç­‰å¾… limactl start --name=default --cpus=2 --memory=4 --disk=32 template://ubuntu # åœ¨ MacBook Arm ä¸ŠæŒ‡å®šä½¿ç”¨ --arch=x86_64 æ¶æ„ limactl create --name=agent --arch=x86_64 --cpus=2 --memory=4 --disk=32 template://ubuntu # ç›´æ¥å¯åŠ¨ k8s æ¨¡æ¿ limactl start --name=k8s --cpus=2 --memory=4 --disk=32 template://k8s # å¯¼å‡ºå¯ç”¨çš„ KUBECONFIG export KUBECONFIG=$(limactl list k8s --format \u0026#39;unix://{{.Dir}}/copied-from-guest/kubeconfig.yaml\u0026#39;) # æŸ¥çœ‹å½“å‰è™šæ‹Ÿæœºåˆ—è¡¨ limactl list # å¯åœè™šæ‹Ÿæœºï¼Œagent æ˜¯ä¸Šé¢åˆ›å»ºå‡ºæ¥çš„è™šæ‹Ÿæœºåå­— limactl start agent limactl stop agent # è¿›å…¥è™šæ‹Ÿæœº shell ç¯å¢ƒ limactl shell agent\r","date":"2024-04-13","id":19,"permalink":"/blog/easiest-k8s-on-macos/","summary":"\u003cp\u003eå› ä¸ºå·¥ä½œç»å¸¸éœ€è¦ç”¨åˆ° K8Sï¼Œè€Œä¸”æœ‰æ—¶å› ç½‘ç»œåŸå› ä¸èƒ½å®Œå…¨ä¾èµ–å…¬å¸ç½‘ç»œï¼Œæˆ–è€…å› ä¸ºæµ‹è¯•æ–°åŠŸèƒ½ä¸èƒ½ç›´æ¥å‘å¸ƒåˆ°å…¬å¸ K8S é›†ç¾¤ï¼Œæ‰€ä»¥å°±æœ‰äº†æœ¬åœ°æ­å»º K8S çš„éœ€æ±‚ã€‚\u003c/p\u003e\n\u003cp\u003eå¦å¤–å¦‚æœä½ æœ‰ä»¥ä¸‹éœ€æ±‚ï¼Œæ­¤æ–‡æ¡£ä¸­æåˆ°çš„æ–¹æ¡ˆä¹Ÿå¯èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¼€å‘æœºå™¨æ¨¡æ‹Ÿ Armã€AMD64 ç­‰ä¸åŒ CPU æ¶æ„ã€‚\u003c/li\u003e\n\u003cli\u003eæœ¬åœ°æ­å»ºå®Œå…¨éš”ç¦»çš„å¼€å‘ç¯å¢ƒï¼Œæ¯”å¦‚ä¸ºæµ‹è¯• dockerã€podmanã€buildkitã€containd ç­‰ä¸åŒè½¯ä»¶è®¾ç½®çš„ç‹¬ç«‹ç¯å¢ƒã€‚\u003c/li\u003e\n\u003cli\u003eCI/CD æµç¨‹ä¸­å³ç”¨å³æ¶ˆçš„è½»é‡çº§è™šæ‹Ÿæœºæ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ä¸­éœ€è¦è™šæ‹Ÿæœºæˆ– K8Sï¼Œå¿«é€Ÿå¯åŠ¨ï¼Œç”¨å®Œåˆ é™¤ã€‚\u003c/li\u003e\n\u003cli\u003eæœ‰é™çš„èµ„æºæ¨¡æ‹Ÿå¤§æ‰¹é‡çš„ K8S èŠ‚ç‚¹ï¼Œæµ‹è¯• K8S API èƒ½åŠ›ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥ä¸‹ä»‹ç»ä¸€ä¸‹æˆ‘ç”¨è¿‡çš„å‡ ç§ä¸åŒæ–¹æ¡ˆï¼Œçº¯å±ä¸ªäººè§‚ç‚¹ä»…ä¾›å‚è€ƒã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨ Docker Desktop å¹¶å¯ç”¨ Kubernetes åŠŸèƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eä¼˜ç‚¹ï¼šä½¿ç”¨æœ€ç®€å•ï¼Œå¼€ç®±å³ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eç¼ºç‚¹ï¼šåªæ”¯æŒå•èŠ‚ç‚¹ K8Sï¼Œä¸” K8S éƒ¨åˆ†åŠŸèƒ½ä¸æ”¯æŒï¼Œä¸æ˜“å®šåˆ¶ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDocker run K3D, K3D run K3Sã€‚\u003c/p\u003e\n\u003cp\u003eä¼˜ç‚¹ï¼šç®€å•ï¼Œä»»ä½•æ”¯æŒ docker çš„å·¥å…·ï¼ˆRancher Desktopã€Podmanï¼‰ å¯åŠ¨ä¸€ä¸ªå®¹å™¨å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eç¼ºç‚¹ï¼šåªæ”¯æŒ K3Sï¼Œç¨³å®šæ€§è¶Šæ¥è¶Šä¸è¡Œäº†ï¼Œä»¥å‰å¤šä¼˜ç§€å•Šã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://multipass.run/\" target=\"_blank\" rel=\"noopener\"\u003emultipass\u003c/a\u003e\n å¯åŠ¨è™šæ‹Ÿæœºï¼Œç„¶åå®‰è£… K8Sã€K3S æˆ– minikubeã€‚\u003c/p\u003e\n\u003cp\u003eä¼˜ç‚¹ï¼šmultipass å¯å¯åŠ¨ç©ºç™½ ubuntu è™šæ‹Ÿæœºï¼Œæˆ–è€…å¯åŠ¨å·²ç»å®‰è£…å¥½ minikube çš„è™šæ‹Ÿæœºã€‚\u003c/p\u003e\n\u003cp\u003eç¼ºç‚¹ï¼šåªæ”¯æŒ ubuntuï¼Œè™šæ‹Ÿæœºä¸å®¿ä¸»æœºåŒæ¶æ„ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://lima-vm.io/\" target=\"_blank\" rel=\"noopener\"\u003elima\u003c/a\u003e\n å¯åŠ¨è™šæ‹Ÿæœºï¼Œç„¶åå®‰è£… K8Sã€K3S æˆ– minikubeã€‚\u003c/p\u003e\n\u003cp\u003eä¼˜ç‚¹ï¼šæ”¯æŒè™šæ‹Ÿå¤šç§ Linux å‘è¡Œç‰ˆï¼Œæ”¯æŒå¼‚æ„ CPU è™šæ‹Ÿæœºï¼ŒåŒæ—¶èƒ½ä»£æ›¿ Docker Desktopã€‚\u003c/p\u003e","tags":["k8s"],"title":"MacOS æ­å»ºæœ¬åœ° K8S å¼€å‘ç¯å¢ƒæ–¹æ¡ˆé€‰å‹ï¼ŒåŸºäº multipassã€lima ç­‰ä¸åŒæ–¹æ¡ˆä¼˜ç¼ºç‚¹ä»‹ç»å¯¹æ¯”"},{"content":"é—®é¢˜èƒŒæ™¯ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Http æœåŠ¡åœ¨ K8S å†…éƒ¨ç½²äº† 3 ä¸ª Podï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ Service NodePort è¿›è¡Œè¿æ¥ï¼Œå‘ç°æµé‡å‡ ä¹éƒ½é›†ä¸­åˆ°äº†ä¸€ä¸ª Pod ä¸Šï¼Œå„ Pod æ‰¿è½½æµé‡å¾ˆä¸å‡è¡¡ã€‚\nå·²çŸ¥çš„æƒ…å†µæ˜¯ï¼š\nK8S Service åº•å±‚æ˜¯ ipvs round-robin è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒæŒ‰é“ç†è®²åº”è¯¥æ˜¯å‡è¡¡çš„ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ç”¨äº† Keep-Alive é•¿è¿æ¥ã€‚ ç»è¿‡æŠ“åŒ…åˆ†æï¼Œè´Ÿè½½è¾ƒé«˜çš„ Pod ä¿æŒç€è¾ƒå¤š KeepAlive é•¿è¿æ¥ã€‚å°† kube-proxy çš„ ipvs è½¬å‘æ¨¡å¼è®¾ç½®ä¸º Least-Connectionï¼Œå³å€¾å‘è½¬å‘ç»™è¿æ¥æ•°å°‘çš„ Podï¼Œå¯èƒ½ä¼šæœ‰æ‰€ç¼“è§£ï¼Œä½†ä¹Ÿä¸ä¸€å®šï¼Œå› ä¸º ipvs çš„è´Ÿè½½å‡è¡¡çŠ¶æ€æ˜¯åˆ†æ•£åœ¨å„ä¸ªèŠ‚ç‚¹çš„ï¼Œå¹¶æ²¡æœ‰æ”¶æ•›åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ— æ³•åœ¨å…¨å±€å±‚é¢æ„ŸçŸ¥å“ªä¸ª Pod ä¸Šçš„è¿æ¥æ•°å°‘ï¼Œå¹¶ä¸èƒ½çœŸæ­£åšåˆ° Least-Connectionã€‚\næœåŠ¡ç«¯ä¸»åŠ¨è¦æ±‚æ–­å¼€é•¿è¿æ¥ å®¢æˆ·ç«¯è¿æ¥æˆ‘ä»¬å¯èƒ½æ— æ³•æ§åˆ¶ï¼Œé‚£ä¹ˆå¦‚ä½•ä»æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€é•¿è¿æ¥ã€‚\nä»¥ Tomcat ä¸ºä¾‹ï¼Œå®ƒæä¾›äº† maxKeepAliveRequests å‚æ•°ï¼Œåˆ°è¾¾æ­¤å‚æ•°é˜ˆå€¼åï¼ŒTomcat ä¼šåœ¨ Response Header ä¸­ä¸»åŠ¨åŠ ä¸€ä¸ª Connection: closeï¼Œæ­£å¸¸æƒ…å†µä¸‹å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ­¤å“åº”åä¼šä¸»åŠ¨æ–­å¼€é•¿è¿æ¥ã€‚\nå¯¹äºå…¶ä»–ä¸æ”¯æŒæ­¤å‚æ•°çš„æœåŠ¡å™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰ Filter æˆ–è€…è‡ªå®šä»£ç ï¼Œåˆ°è¾¾æŸé˜ˆå€¼ååœ¨ Response Header ä¸­ä¸»åŠ¨è¿½åŠ  Connection: closeã€‚\nå¯¹äº Spring Boot å¯é€šè¿‡ properties é…ç½®ã€‚\n# Spring Boot Tomcat server.tomcat.max-keep-alive-requests=100 # Spring Boot WebFlux server.netty.max-keep-alive-requests=100\rå¯¹äºç‹¬ç«‹éƒ¨ç½² Tomcatï¼Œå¯åœ¨ server.xml æ–‡ä»¶ Connector ä¸­é…ç½® maxKeepAliveRequestsï¼ŒTomcat xml å¯è§£æå¯åŠ¨å‚æ•°ï¼Œå¯åŠ¨æ—¶å¢åŠ  -D=server.tomcat.max-keep-alive-requests=200 æ¥è°ƒæ•´é»˜è®¤å€¼å¤§å°ï¼Œå¦å¤–æ³¨æ„ï¼ŒTomcat xml ä¸æ”¯æŒè§£æ ENV ç¯å¢ƒå˜é‡ï¼Œåªæ”¯æŒè§£æ -D å¯åŠ¨å‚æ•°ã€‚\n\u0026lt;Connector port=\u0026#34;80\u0026#34; protocol=\u0026#34;org.apache.coyote.http11.Http11Nio2Protocol\u0026#34; maxKeepAliveRequests=\u0026#34;${server.tomcat.max-keep-alive-requests:-100}\u0026#34;/\u0026gt;\rä»¥ä¸Šï¼Œä¹Ÿè§£é‡Šäº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æœ‰äº›åœºæ™¯å¯èƒ½æƒ³ä¸€ç›´ä¿æŒé•¿è¿æ¥ï¼Œä¸ºä»€ä¹ˆæ”¶åˆ°ä¸€ä¸ª Connection: close Header æ–­å¼€äº†é•¿è¿æ¥ã€‚ å› ä¸º maxKeepAliveRequests é»˜è®¤å€¼æ˜¯ 100ã€‚\nå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ åœ¨ Spring Cloud å’Œ K8S ä½œä¸ºæœåŠ¡æ³¨å†Œå‘ç°çš„æ–¹æ¡ˆå¯¹æ¯”ä¸Šï¼Œæ­¤æ—¶å°±å¯ä»¥åŠ ä¸Šä¸€æ¡ï¼Œè´Ÿè½½å‡è¡¡æ¨¡å¼ä¸åŒã€‚\nSpring Cloud ä½“ç³»æ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œç”±å®¢æˆ·ç«¯é€‰æ‹©è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ­¤æ—¶ä¸ç®¡æ˜¯å¦æœ‰é•¿è¿æ¥ï¼Œæµé‡éƒ½ç›¸å¯¹å‡è¡¡ã€‚\nK8S Service æ˜¯æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼Œç”± K8S å†³å®šå¦‚ä½•è½¬å‘ï¼Œå¯¹äºé•¿è¿æ¥å¯èƒ½å‡ºç°æµé‡ä¸å‡è¡¡çš„ç°è±¡ã€‚\n","date":"2024-04-11","id":20,"permalink":"/blog/tomcat-keepalive-load-balancer/","summary":"\u003cp\u003eé—®é¢˜èƒŒæ™¯ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Http æœåŠ¡åœ¨ K8S å†…éƒ¨ç½²äº† 3 ä¸ª Podï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ Service NodePort è¿›è¡Œè¿æ¥ï¼Œå‘ç°æµé‡å‡ ä¹éƒ½é›†ä¸­åˆ°äº†ä¸€ä¸ª Pod ä¸Šï¼Œå„ Pod æ‰¿è½½æµé‡å¾ˆä¸å‡è¡¡ã€‚\u003c/p\u003e\n\u003cp\u003eå·²çŸ¥çš„æƒ…å†µæ˜¯ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eK8S Service åº•å±‚æ˜¯ ipvs round-robin è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ŒæŒ‰é“ç†è®²åº”è¯¥æ˜¯å‡è¡¡çš„ã€‚\u003c/li\u003e\n\u003cli\u003eå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ç”¨äº† Keep-Alive é•¿è¿æ¥ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eç»è¿‡æŠ“åŒ…åˆ†æï¼Œè´Ÿè½½è¾ƒé«˜çš„ Pod ä¿æŒç€è¾ƒå¤š KeepAlive é•¿è¿æ¥ã€‚å°† kube-proxy çš„ ipvs è½¬å‘æ¨¡å¼è®¾ç½®ä¸º Least-Connectionï¼Œå³å€¾å‘è½¬å‘ç»™è¿æ¥æ•°å°‘çš„ Podï¼Œå¯èƒ½ä¼šæœ‰æ‰€ç¼“è§£ï¼Œä½†ä¹Ÿä¸ä¸€å®šï¼Œå› ä¸º ipvs çš„è´Ÿè½½å‡è¡¡çŠ¶æ€æ˜¯åˆ†æ•£åœ¨å„ä¸ªèŠ‚ç‚¹çš„ï¼Œå¹¶æ²¡æœ‰æ”¶æ•›åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ— æ³•åœ¨å…¨å±€å±‚é¢æ„ŸçŸ¥å“ªä¸ª Pod ä¸Šçš„è¿æ¥æ•°å°‘ï¼Œå¹¶ä¸èƒ½çœŸæ­£åšåˆ° Least-Connectionã€‚\u003c/p\u003e\n\u003ch2 id=\"æœåŠ¡ç«¯ä¸»åŠ¨è¦æ±‚æ–­å¼€é•¿è¿æ¥\"\u003eæœåŠ¡ç«¯ä¸»åŠ¨è¦æ±‚æ–­å¼€é•¿è¿æ¥\u003c/h2\u003e\n\u003cp\u003eå®¢æˆ·ç«¯è¿æ¥æˆ‘ä»¬å¯èƒ½æ— æ³•æ§åˆ¶ï¼Œé‚£ä¹ˆå¦‚ä½•ä»æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€é•¿è¿æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ Tomcat ä¸ºä¾‹ï¼Œå®ƒæä¾›äº† maxKeepAliveRequests å‚æ•°ï¼Œåˆ°è¾¾æ­¤å‚æ•°é˜ˆå€¼åï¼ŒTomcat ä¼šåœ¨ Response Header ä¸­ä¸»åŠ¨åŠ ä¸€ä¸ª \u003ccode\u003eConnection: close\u003c/code\u003eï¼Œæ­£å¸¸æƒ…å†µä¸‹å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ­¤å“åº”åä¼šä¸»åŠ¨æ–­å¼€é•¿è¿æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äºå…¶ä»–ä¸æ”¯æŒæ­¤å‚æ•°çš„æœåŠ¡å™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰ Filter æˆ–è€…è‡ªå®šä»£ç ï¼Œåˆ°è¾¾æŸé˜ˆå€¼ååœ¨ Response Header ä¸­ä¸»åŠ¨è¿½åŠ  \u003ccode\u003eConnection: close\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äº Spring Boot å¯é€šè¿‡ properties é…ç½®ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-properties\" data-lang=\"properties\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Spring Boot Tomcat\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eserver.tomcat.max-keep-alive-requests\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Spring Boot WebFlux\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eserver.netty.max-keep-alive-requests\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e100\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eå¯¹äºç‹¬ç«‹éƒ¨ç½² Tomcatï¼Œå¯åœ¨ server.xml æ–‡ä»¶ Connector ä¸­é…ç½® maxKeepAliveRequestsï¼ŒTomcat xml å¯è§£æå¯åŠ¨å‚æ•°ï¼Œå¯åŠ¨æ—¶å¢åŠ  \u003ccode\u003e-D=server.tomcat.max-keep-alive-requests=200\u003c/code\u003e æ¥è°ƒæ•´é»˜è®¤å€¼å¤§å°ï¼Œå¦å¤–æ³¨æ„ï¼ŒTomcat xml ä¸æ”¯æŒè§£æ ENV ç¯å¢ƒå˜é‡ï¼Œåªæ”¯æŒè§£æ \u003ccode\u003e-D\u003c/code\u003e å¯åŠ¨å‚æ•°ã€‚\u003c/p\u003e","tags":["k8s"],"title":"K8S Service é•¿è¿æ¥å¯¼è‡´è´Ÿè½½ä¸å‡è¡¡é—®é¢˜åˆ†æå’Œè§£å†³åŠæ³•"},{"content":"åœ¨ K8S ä¸­ä½¿ç”¨ Helm éƒ¨ç½²äº†ä¸€äº›æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶é€šè¿‡ Helm è‡ªåŠ¨ç”Ÿæˆäº† PV å’Œ PVCï¼ŒæŸå¤©æƒ³æ‰©å®¹ï¼Œç«Ÿç„¶æŠ¥é”™äº†ã€‚\nä»¥ä¸‹ä»¥ bitnami zookeeper ä¸ºä¾‹ï¼Œå…¶ä»– StatefulSet åŒç†ã€‚\nä¸ºäº†å®ç°ç£ç›˜æ‰©å®¹ï¼Œæ”¹å¤§ persistence.sizeï¼Œæ¯”å¦‚ç”± 8Gi æ”¹ä¸º 10Giï¼Œç„¶åæ‰§è¡Œ helm upgradeï¼Œå‡ºç°é”™è¯¯ã€‚\nError: UPGRADE FAILED: cannot patch \u0026#34;zookeeper\u0026#34; with kind StatefulSet: StatefulSet.apps \u0026#34;zookeeper\u0026#34; is invalid: spec: Forbidden: updates to statefulset spec for fields other than \u0026#39;replicas\u0026#39;, \u0026#39;template\u0026#39;, \u0026#39;updateStrategy\u0026#39;, \u0026#39;persistentVolumeClaimRetentionPolicy\u0026#39; and \u0026#39;minReadySeconds\u0026#39; are forbidden å®é™…ä¸Šæˆ‘ä»¬æƒ³æ›´æ–°çš„æ˜¯ StatefulSet çš„ spec.volumeClaimTemplates ä¸­çš„ storage å¤§å°ï¼Œæ ¹æ®æç¤ºä¿¡æ¯ï¼ŒStatefulSet ç«Ÿç„¶ä¸å…è®¸ã€‚\nspec: volumeClaimTemplates: - apiVersion: v1 spec: resources: requests: storage: 8Gi\ræŸ¥çœ‹ K8S å®˜æ–¹è¯´æ˜ï¼Œæœç„¶å½“å‰ç‰ˆæœ¬ (1.29) è¿˜ä¸æ”¯æŒï¼Œå‚è€ƒé“¾æ¥å¦‚ä¸‹ã€‚\nKEP-0661: StatefulSet volume resize kubernetes/enhancements#3412 https://github.com/kubernetes/enhancements/pull/3412 Support Volume Expansion Through StatefulSets kubernetes/enhancements#661 https://github.com/kubernetes/enhancements/issues/661 æ³¨æ„æ­¤æ—¶ helm release çš„çŠ¶æ€æ˜¯ failedï¼Œå…ˆæŠŠ persistence.size æ”¹ä¸ºåŸå¤§å°ï¼Œç„¶åå†æ‰§è¡Œä¸€é helm upgradeï¼Œå…ˆæŠŠ release æ¢å¤æ­£å¸¸ã€‚\né‚£ä¹ˆå¦‚ä½•å®ç° StatefulSet ç£ç›˜å¹³è¡¡æ‰©å®¹ï¼Œissues/661 æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚\nç¡®ä¿ä½ ç”¨çš„ StorageClass æ”¯æŒæ‰©å®¹ï¼Œæ¯”å¦‚ NFSã€rancher/local-path-provisioner éƒ½æ˜¯ä¸æ”¯æŒæ‰©å®¹çš„ã€‚ åˆ é™¤ StatefulSetï¼Œä½†æ˜¯ä¿ç•™ Podï¼Œè®©æœåŠ¡ç»§ç»­è¿è¡Œã€‚åˆ é™¤æ—¶å¢åŠ  --cascade=orphan å‚æ•°ï¼Œæ‰§è¡Œ kubectl delete statefulset --cascade=orphan zookeeperã€‚ ä¿®æ”¹ Helm ä¸­å£°æ˜çš„ sizeï¼Œç»§ç»­æ‰§è¡Œ helm upgrade æ›´æ–°åº”ç”¨ï¼Œæ­¤æ—¶é€šè¿‡ kubectl å¯ä»¥çœ‹åˆ° PV/PVC å¤§å°å·²ç»å˜æ›´ï¼ŒStatefulSet å·²ç»é‡å»ºï¼Œä½†æ˜¯ Pod æ— ä»»ä½•å˜åŒ–ã€‚ é‡å»º Podï¼Œä½¿æ›´æ–°ç”Ÿæ•ˆï¼škubectl rollout restart statefulset zookeeper ã€‚ rancher/local-path-provisioner rancher/local-path-provisioner æ˜¯ Rancher æä¾›çš„ä¸€ä¸ªæœ¬åœ°å­˜å‚¨å·æ’ä»¶ï¼Œå®ƒä¸»è¦ç”¨äºåœ¨ Kubernetes é›†ç¾¤ä¸­åŠ¨æ€åˆ›å»ºå’Œç®¡ç†æœ¬åœ°å­˜å‚¨å·ï¼Œè®©æœ¬åœ°å­˜å‚¨ä½¿ç”¨èµ·æ¥æ›´ç®€å•ã€‚\næœ‰äº›åº”ç”¨ä½¿ç”¨äº†æ­¤ local-path ä½œä¸ºå­˜å‚¨ï¼Œä½†æ˜¯åœ¨æ›´æ–°å®Œ size åï¼Œå‘ç° PV å¤§å°å·²ç»å˜æ›´ï¼ŒPVC å¤§å°ä»ç„¶æ˜¯æ—§å€¼ï¼Œæ¯”å¦‚ä»¥ä¸‹ PVC å£°æ˜çš„æ˜¯ 10Giï¼Œä½†æ˜¯ status ä»ç„¶æ˜¯ 8Giã€‚\napiVersion: v1 kind: List items: - apiVersion: v1 kind: PersistentVolumeClaim spec: resources: requests: storage: 10Gi storageClassName: local-path status: capacity: storage: 8Gi phase: Bound\ré€šè¿‡ kubectl describe pvc å‘ç° Events ä¸­æœ‰ä»¥ä¸‹ warningã€‚\n# Warning ExternalExpanding 8h volume_expand Ignoring the PVC: didn\u0026#39;t find a plugin capable of expanding the volume; waiting for an external controller to process this PVC. ç„¶è€Œæˆ‘ä»¬çš„ local-path-provisioner å·²ç»å£°æ˜äº† allowVolumeExpansion: trueï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å€¼ä¹Ÿæ˜¯å¯¹çš„ï¼Œä¸ºå•¥ä¸è¡Œå‘¢ï¼Œå› ä¸ºå½“å‰ç‰ˆæœ¬ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯ v0.0.26ï¼‰ å°±æ˜¯ä¸æ”¯æŒã€‚\n$ kubectl get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE local-path cluster.local/local-path-provisioner Retain WaitForFirstConsumer true 2d ä½¿ç”¨ local-path-provisioner æ³¨æ„äº‹é¡¹ï¼š\nlocal-path-provisioner ä½¿ç”¨ hostPath æ˜ å°„ï¼Œä¸æ”¯æŒç£ç›˜æ‰©å®¹ï¼Œæ‰©å®¹åä¼šå‡ºç°ä»¥ä¸Š Warningã€‚ ä¸ç®¡æ˜¯ K8S hostPathã€Local volumes è¿˜æ˜¯ local-path-provisionerï¼Œéƒ½ä¸æ”¯æŒé™åˆ¶ç£ç›˜å¤§å°ï¼Œæ˜ å°„åˆ°ä¸»æœºçš„ hostPath ç£ç›˜æœ‰å¤šå¤§ï¼ŒPod å°±èƒ½ç”¨å¤šå¤§ã€‚PV/PVC å£°æ˜çš„å¤§å°éƒ½åªæ˜¯å£°æ˜å¹¶ä¸èµ·ä½œç”¨ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨ç»™ PV/PVC å°è¯•åšæ‰©å®¹ã€‚ ç›®å‰å¸¸ç”¨çš„ NFS å­˜å‚¨å’Œ local-path-provisioner ä¸€æ ·ï¼Œä¹Ÿä¸æ”¯æŒæ‰©å®¹å’Œé™åˆ¶ç£ç›˜å¤§å°ã€‚ ","date":"2024-03-31","id":21,"permalink":"/blog/statefulset-resize-pvc/","summary":"\u003cp\u003eåœ¨ K8S ä¸­ä½¿ç”¨ Helm éƒ¨ç½²äº†ä¸€äº›æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶é€šè¿‡ Helm è‡ªåŠ¨ç”Ÿæˆäº† PV å’Œ PVCï¼ŒæŸå¤©æƒ³æ‰©å®¹ï¼Œç«Ÿç„¶æŠ¥é”™äº†ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹ä»¥ bitnami zookeeper ä¸ºä¾‹ï¼Œå…¶ä»– StatefulSet åŒç†ã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºäº†å®ç°ç£ç›˜æ‰©å®¹ï¼Œæ”¹å¤§ \u003ccode\u003epersistence.size\u003c/code\u003eï¼Œæ¯”å¦‚ç”± 8Gi æ”¹ä¸º 10Giï¼Œç„¶åæ‰§è¡Œ helm upgradeï¼Œå‡ºç°é”™è¯¯ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003eError: UPGRADE FAILED: cannot patch \u0026#34;zookeeper\u0026#34; with kind StatefulSet: StatefulSet.apps \u0026#34;zookeeper\u0026#34; is invalid: spec: Forbidden: updates to statefulset spec for fields other than \u0026#39;replicas\u0026#39;, \u0026#39;template\u0026#39;, \u0026#39;updateStrategy\u0026#39;, \u0026#39;persistentVolumeClaimRetentionPolicy\u0026#39; and \u0026#39;minReadySeconds\u0026#39; are forbidden\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eå®é™…ä¸Šæˆ‘ä»¬æƒ³æ›´æ–°çš„æ˜¯ StatefulSet çš„ spec.volumeClaimTemplates ä¸­çš„ storage å¤§å°ï¼Œæ ¹æ®æç¤ºä¿¡æ¯ï¼ŒStatefulSet ç«Ÿç„¶ä¸å…è®¸ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumeClaimTemplates\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003estorage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e8Gi\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eæŸ¥çœ‹ K8S å®˜æ–¹è¯´æ˜ï¼Œæœç„¶å½“å‰ç‰ˆæœ¬ (1.29) è¿˜ä¸æ”¯æŒï¼Œå‚è€ƒé“¾æ¥å¦‚ä¸‹ã€‚\u003c/p\u003e","tags":[],"title":"K8S StatefulSet åº”ç”¨ PV/PVC å¹³æ»‘æ‰©å®¹"},{"content":"ä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œç»å¸¸åœ¨ MacOS é‡åˆ° Too many open files in system çš„æŠ¥é”™ï¼Œå°¤å…¶æ˜¯ç¢°åˆ°é»‘æ´ node_modules æ—¶ï¼Œå¦‚ä½•æŒä¹…åŒ–é…ç½®å½»åº•è§£å†³ï¼Œç›´æ¥ä¸Šä»£ç ã€‚\nè¾“å…¥ launchctl limit å³å¯çœ‹åˆ°å½“å‰çš„é™åˆ¶ï¼Œæˆ‘è¿™é‡Œ maxfiles æ˜¯æ”¹è¿‡ä»¥åçš„ã€‚\n$ launchctl limit cpu unlimited unlimited filesize unlimited unlimited data unlimited unlimited stack 8388608 67104768 core 0 unlimited rss unlimited unlimited memlock unlimited unlimited maxproc 1392 2088 maxfiles 10240 102400 å¼€å§‹åˆ›å»ºæ–‡ä»¶ sudo vi /Library/LaunchDaemons/limit.maxfiles.plist ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå¯æ ¹æ®è‡ªå·±çˆ±å¥½æ”¹åé¢çš„ä¸¤ä¸ªæ•°å­—å€¼ã€‚\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple//DTD PLIST 1.0//EN\u0026#34; \u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;\u0026gt; \u0026lt;plist version=\u0026#34;1.0\u0026#34;\u0026gt; \u0026lt;dict\u0026gt; \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;limit.maxfiles\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt; \u0026lt;array\u0026gt; \u0026lt;string\u0026gt;launchctl\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;limit\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;maxfiles\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;10240\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;102400\u0026lt;/string\u0026gt; \u0026lt;/array\u0026gt; \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;ServiceIPC\u0026lt;/key\u0026gt; \u0026lt;false/\u0026gt; \u0026lt;/dict\u0026gt; \u0026lt;/plist\u0026gt;\réªŒè¯æ–‡ä»¶æ ¼å¼å’Œå†…å®¹ï¼Œå¹¶åº”ç”¨ç”Ÿæ•ˆã€‚\nplutil /Library/LaunchDaemons/limit.maxfiles.plist sudo launchctl load -w /Library/LaunchDaemons/limit.maxfiles.plist å†æ¬¡è¾“å…¥ launchctl limit æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆã€‚\n","date":"2024-03-19","id":22,"permalink":"/blog/macos-too-many-open-files/","summary":"\u003cp\u003eä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œç»å¸¸åœ¨ MacOS é‡åˆ° Too many open files in system çš„æŠ¥é”™ï¼Œå°¤å…¶æ˜¯ç¢°åˆ°é»‘æ´ node_modules æ—¶ï¼Œå¦‚ä½•æŒä¹…åŒ–é…ç½®å½»åº•è§£å†³ï¼Œç›´æ¥ä¸Šä»£ç ã€‚\u003c/p\u003e\n\u003cp\u003eè¾“å…¥ launchctl limit å³å¯çœ‹åˆ°å½“å‰çš„é™åˆ¶ï¼Œæˆ‘è¿™é‡Œ maxfiles æ˜¯æ”¹è¿‡ä»¥åçš„ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"gp\"\u003e$\u003c/span\u003e launchctl limit\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  cpu         unlimited      unlimited\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  filesize    unlimited      unlimited\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  data        unlimited      unlimited\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  stack       8388608        67104768\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  core        0              unlimited\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  rss         unlimited      unlimited\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  memlock     unlimited      unlimited\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  maxproc     1392           2088\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e  maxfiles    10240         102400\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eå¼€å§‹åˆ›å»ºæ–‡ä»¶ \u003ccode\u003esudo vi /Library/LaunchDaemons/limit.maxfiles.plist\u003c/code\u003e ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå¯æ ¹æ®è‡ªå·±çˆ±å¥½æ”¹åé¢çš„ä¸¤ä¸ªæ•°å­—å€¼ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple//DTD PLIST 1.0//EN\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e        \u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;plist\u003c/span\u003e \u003cspan class=\"na\"\u003eversion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;dict\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eLabel\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003elimit.maxfiles\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eProgramArguments\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;array\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003elaunchctl\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003elimit\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003emaxfiles\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e10240\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e102400\u003cspan class=\"nt\"\u003e\u0026lt;/string\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;/array\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eRunAtLoad\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;true/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;key\u0026gt;\u003c/span\u003eServiceIPC\u003cspan class=\"nt\"\u003e\u0026lt;/key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;false/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;/dict\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/plist\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eéªŒè¯æ–‡ä»¶æ ¼å¼å’Œå†…å®¹ï¼Œå¹¶åº”ç”¨ç”Ÿæ•ˆã€‚\u003c/p\u003e","tags":["Tools"],"title":"MacOS æŒä¹…åŒ–é…ç½®ï¼Œå½»åº•è§£å†³ too many open files in system çš„é—®é¢˜"},{"content":"æ–‡ä»¶å‹ç¼©è§£å‹ç¼©å¿«é€Ÿå‚è€ƒã€‚\nå¸¸ç”¨æ–‡ä»¶æ ¼å¼ .tarï¼štar å…¶å®æ‰“åŒ…ï¼ˆæˆ–ç¿»è¯‘ä¸ºå½’æ¡£ï¼‰æ–‡ä»¶ï¼Œæœ¬èº«å¹¶æ²¡æœ‰å‹ç¼©ã€‚åœ¨ Linux é‡Œ man tar å¯ä»¥çœ‹åˆ°å®ƒçš„æè¿°ä¹Ÿæ˜¯â€œmanipulate tape archivesâ€ï¼ˆtar æœ€åˆè¢«ç”¨æ¥åœ¨ç£å¸¦ä¸Šåˆ›å»ºæ¡£æ¡ˆï¼Œç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šåˆ›å»ºæ¡£æ¡ˆï¼Œåªæ˜¯å®ƒçš„æè¿°è¿˜æ²¡æœ‰æ”¹ï¼‰ã€‚\n.gzï¼šgzip æ˜¯ GNU ç»„ç»‡å¼€å‘çš„ä¸€ä¸ªå‹ç¼©ç¨‹åºï¼Œ.gz ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯ gzip å‹ç¼©çš„ç»“æœã€‚\n.bz2ï¼šbzip2 æ˜¯ä¸€ä¸ªå‹ç¼©èƒ½åŠ›æ›´å¼ºçš„å‹ç¼©ç¨‹åºï¼Œ.bz2 ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯ bzip2 å‹ç¼©çš„ç»“æœã€‚\n.Zï¼šcompress ä¹Ÿæ˜¯ä¸€ä¸ªå‹ç¼©ç¨‹åºã€‚.Z ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯ compress å‹ç¼©çš„ç»“æœã€‚\n.zipï¼šä½¿ç”¨ zip è½¯ä»¶å‹ç¼©çš„æ–‡ä»¶ã€‚\n.tar.gzã€.tar.bz2ã€.tar.xz ç­‰å¯ä»¥ç†è§£ä¸ºæ‰“åŒ…+å‹ç¼©çš„æ•ˆæœï¼Œç”¨è½¯ä»¶è§£å‹å¯ä»¥å‘ç°æ¯”ã€‚gz å¤šäº†ä¸€å±‚åŒ…ã€‚gzip å’Œ bzip2ï¼Œä¸èƒ½åŒæ—¶å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œtar ç›¸å½“äºå¼€ä¸ªæŒ‚åŠ ä¸ŠåŒæ—¶å‹ç¼©çš„ç‰¹æ•ˆï¼Œtar å…ˆå½’æ¡£ä¸ºä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œè€Œå½’æ¡£ä¸ºå¤§æ–‡ä»¶çš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œæµ‹è¯•äº†ä¸€ä¸‹å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚\né™¤äº†è¿™äº›æ ¼å¼å¤–ï¼Œå¸¸è§çš„ debã€exeã€msiã€rpmã€dmgã€iso ç­‰å®‰è£…è½¯ä»¶ï¼Œå…¶å®éƒ½æ˜¯ç»è¿‡å‹ç¼©çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ²¡æœ‰å¿…è¦å†å‹ç¼©ã€‚è€Œ rar åŸºæœ¬è®¤ä¸ºæ˜¯ Windows å¹³å°ä¸“å±çš„å‹ç¼©ç®—æ³•äº†ï¼Œå„ä¸ª Linux å‘è¡Œç‰ˆéƒ½ä¸è‡ªå¸¦ rar å‹ç¼©è§£å‹ç¼©è½¯ä»¶ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°å¾ˆå¤šè½¯ä»¶å‘è¡Œçš„æ ¼å¼éƒ½æ˜¯ .tar.gz æˆ– .zipã€‚\nè§£å‹ç¼© æ ¹æ®æ–‡ä»¶ååç¼€è‡ªè¡Œé€‰æ‹©è§£å‹ç¼©å‘½ä»¤ã€‚\ntar -xf test.tar gzip -d test.gz gunzip test.gz # -C ç›´æ¥è§£å‹åˆ°æŒ‡å®šç›®å½• tar -xzf test.tar.gz -C /home bzip2 -d test.bz2 bunzip2 test.bz2 tar -xjf test.tar.bz2 tar -xvJf test.tar.xz\rå‹ç¼© è¯·æ ¹æ®éœ€è¦é€‰æ‹©å‹ç¼©ç®—æ³•ã€‚\n# å°†å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ jpg æ ¼å¼çš„æ–‡ä»¶æ‰“åŒ…ä¸º pictures.tar tar -cf pictures.tar *.jpg # å°† Picture ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…å¹¶ç”¨ gzip å‹ç¼©ä¸º pictures.tar.gz tar -czf pictures.tar.gz Picture/ # å°† Picture ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…å¹¶ç”¨ bzip2 å‹ç¼©ä¸º pictures.tar.bz2 tar -cjf pictures.tar.bz2 Picture/\r","date":"2024-03-10","id":23,"permalink":"/blog/tar-gz/","summary":"\u003cp\u003eæ–‡ä»¶å‹ç¼©è§£å‹ç¼©å¿«é€Ÿå‚è€ƒã€‚\u003c/p\u003e\n\u003ch2 id=\"å¸¸ç”¨æ–‡ä»¶æ ¼å¼\"\u003eå¸¸ç”¨æ–‡ä»¶æ ¼å¼\u003c/h2\u003e\n\u003cp\u003e.tarï¼štar å…¶å®æ‰“åŒ…ï¼ˆæˆ–ç¿»è¯‘ä¸ºå½’æ¡£ï¼‰æ–‡ä»¶ï¼Œæœ¬èº«å¹¶æ²¡æœ‰å‹ç¼©ã€‚åœ¨ Linux é‡Œ man tar å¯ä»¥çœ‹åˆ°å®ƒçš„æè¿°ä¹Ÿæ˜¯â€œmanipulate tape archivesâ€ï¼ˆtar æœ€åˆè¢«ç”¨æ¥åœ¨ç£å¸¦ä¸Šåˆ›å»ºæ¡£æ¡ˆï¼Œç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šåˆ›å»ºæ¡£æ¡ˆï¼Œåªæ˜¯å®ƒçš„æè¿°è¿˜æ²¡æœ‰æ”¹ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e.gzï¼šgzip æ˜¯ GNU ç»„ç»‡å¼€å‘çš„ä¸€ä¸ªå‹ç¼©ç¨‹åºï¼Œ.gz ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯ gzip å‹ç¼©çš„ç»“æœã€‚\u003c/p\u003e\n\u003cp\u003e.bz2ï¼šbzip2 æ˜¯ä¸€ä¸ªå‹ç¼©èƒ½åŠ›æ›´å¼ºçš„å‹ç¼©ç¨‹åºï¼Œ.bz2 ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯ bzip2 å‹ç¼©çš„ç»“æœã€‚\u003c/p\u003e\n\u003cp\u003e.Zï¼šcompress ä¹Ÿæ˜¯ä¸€ä¸ªå‹ç¼©ç¨‹åºã€‚.Z ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯ compress å‹ç¼©çš„ç»“æœã€‚\u003c/p\u003e\n\u003cp\u003e.zipï¼šä½¿ç”¨ zip è½¯ä»¶å‹ç¼©çš„æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003e.tar.gzã€.tar.bz2ã€.tar.xz ç­‰å¯ä»¥ç†è§£ä¸ºæ‰“åŒ…+å‹ç¼©çš„æ•ˆæœï¼Œç”¨è½¯ä»¶è§£å‹å¯ä»¥å‘ç°æ¯”ã€‚gz å¤šäº†ä¸€å±‚åŒ…ã€‚gzip å’Œ bzip2ï¼Œä¸èƒ½åŒæ—¶å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œtar ç›¸å½“äºå¼€ä¸ªæŒ‚åŠ ä¸ŠåŒæ—¶å‹ç¼©çš„ç‰¹æ•ˆï¼Œtar å…ˆå½’æ¡£ä¸ºä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œè€Œå½’æ¡£ä¸ºå¤§æ–‡ä»¶çš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œæµ‹è¯•äº†ä¸€ä¸‹å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚\u003c/p\u003e\n\u003cp\u003eé™¤äº†è¿™äº›æ ¼å¼å¤–ï¼Œå¸¸è§çš„ debã€exeã€msiã€rpmã€dmgã€iso ç­‰å®‰è£…è½¯ä»¶ï¼Œå…¶å®éƒ½æ˜¯ç»è¿‡å‹ç¼©çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ²¡æœ‰å¿…è¦å†å‹ç¼©ã€‚è€Œ rar åŸºæœ¬è®¤ä¸ºæ˜¯ Windows å¹³å°ä¸“å±çš„å‹ç¼©ç®—æ³•äº†ï¼Œå„ä¸ª Linux å‘è¡Œç‰ˆéƒ½ä¸è‡ªå¸¦ rar å‹ç¼©è§£å‹ç¼©è½¯ä»¶ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°å¾ˆå¤šè½¯ä»¶å‘è¡Œçš„æ ¼å¼éƒ½æ˜¯ .tar.gz æˆ– .zipã€‚\u003c/p\u003e\n\u003ch2 id=\"è§£å‹ç¼©\"\u003eè§£å‹ç¼©\u003c/h2\u003e\n\u003cp\u003eæ ¹æ®æ–‡ä»¶ååç¼€è‡ªè¡Œé€‰æ‹©è§£å‹ç¼©å‘½ä»¤ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -xf test.tar\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egzip -d test.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egunzip test.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# -C ç›´æ¥è§£å‹åˆ°æŒ‡å®šç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -xzf test.tar.gz -C /home\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebzip2 -d test.bz2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebunzip2 test.bz2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -xjf test.tar.bz2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -xvJf test.tar.xz\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003ch2 id=\"å‹ç¼©\"\u003eå‹ç¼©\u003c/h2\u003e\n\u003cp\u003eè¯·æ ¹æ®éœ€è¦é€‰æ‹©å‹ç¼©ç®—æ³•ã€‚\u003c/p\u003e","tags":[],"title":"æ–‡ä»¶å‹ç¼©è§£å‹ç¼©å¿«é€Ÿå‚è€ƒ"},{"content":"é¡¹ç›®ä¸­éœ€è¦æ ¹æ® SQL æ–‡ä»¶å¯¼å…¥æ•°æ®ï¼Œæ–‡ä»¶å¤§çº¦ 20Gï¼Œæ­£å¸¸å¯¼å…¥çº¦éœ€è¦ 2 å°æ—¶ï¼Œå¦‚ä½•æé«˜å¯¼å…¥é€Ÿåº¦ã€‚\nç»è¿‡å®éªŒæµ‹è¯•ï¼Œå¦‚æœä¸€ä¸ª SQL æ–‡ä»¶åªæœ‰ä¸€ä¸ªè¡¨çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ mysql load data infile è¯­æ³•ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ã€‚\næˆ‘ä»¬æ˜¯ä¸€ä¸ª SQL æ–‡ä»¶åŒ…å«äº†å¾ˆå¤šè¡¨ï¼Œmysql load data infile å°±ä¸æ”¯æŒäº†ï¼Œå¯è€ƒè™‘åœ¨å¯¼å…¥è¿‡ç¨‹ä¸­è®¾ç½®å¦‚ä¸‹å‚æ•°ï¼Œç»è¿‡æµ‹è¯• 20G å¤§çº¦éœ€è¦ 40 åˆ†é’Ÿï¼Œæ¯”ä¹‹å‰å¿«äº†å¾ˆå¤šã€‚\n# è¿›å…¥ mysql mysql -u root -p # åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœå·²ç»æœ‰æ•°æ®åº“å¿½ç•¥æ­¤æ­¥éª¤ï¼‰ CREATE DATABASE æ•°æ®åº“åï¼› # è®¾ç½®å‚æ•° set sql_log_bin=OFF;//å…³é—­æ—¥å¿— set autocommit=0;//å…³é—­ autocommit è‡ªåŠ¨æäº¤æ¨¡å¼ 0 æ˜¯å…³é—­ 1 æ˜¯å¼€å¯ï¼ˆé»˜è®¤ï¼‰ set global max_allowed_packet = 20 *1024* 1024 * 1024; # ä½¿ç”¨æ•°æ®åº“ use æ•°æ®åº“åï¼› # å¼€å¯äº‹åŠ¡ START TRANSACTION; # å¯¼å…¥ SQL æ–‡ä»¶å¹¶ COMMITï¼ˆå› ä¸ºå¯¼å…¥æ¯”è¾ƒè€—æ—¶ï¼Œå¯¼å…¥å’Œ COMMIT ä¸€è¡Œå‘½ä»¤ï¼Œè¿™æ ·ä¸ç”¨ç›¯ç€å±å¹•ç­‰æäº¤äº†ï¼‰ source /xxx.sqlï¼›COMMIT;\r","date":"2024-03-10","id":24,"permalink":"/blog/mysql-large-import/","summary":"\u003cp\u003eé¡¹ç›®ä¸­éœ€è¦æ ¹æ® SQL æ–‡ä»¶å¯¼å…¥æ•°æ®ï¼Œæ–‡ä»¶å¤§çº¦ 20Gï¼Œæ­£å¸¸å¯¼å…¥çº¦éœ€è¦ 2 å°æ—¶ï¼Œå¦‚ä½•æé«˜å¯¼å…¥é€Ÿåº¦ã€‚\u003c/p\u003e\n\u003cp\u003eç»è¿‡å®éªŒæµ‹è¯•ï¼Œå¦‚æœä¸€ä¸ª SQL æ–‡ä»¶åªæœ‰ä¸€ä¸ªè¡¨çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ mysql load data infile è¯­æ³•ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬æ˜¯ä¸€ä¸ª SQL æ–‡ä»¶åŒ…å«äº†å¾ˆå¤šè¡¨ï¼Œmysql load data infile å°±ä¸æ”¯æŒäº†ï¼Œå¯è€ƒè™‘åœ¨å¯¼å…¥è¿‡ç¨‹ä¸­è®¾ç½®å¦‚ä¸‹å‚æ•°ï¼Œç»è¿‡æµ‹è¯• 20G å¤§çº¦éœ€è¦ 40 åˆ†é’Ÿï¼Œæ¯”ä¹‹å‰å¿«äº†å¾ˆå¤šã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¿›å…¥ mysql\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysql -u root -p\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœå·²ç»æœ‰æ•°æ®åº“å¿½ç•¥æ­¤æ­¥éª¤ï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCREATE DATABASE æ•°æ®åº“åï¼›\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è®¾ç½®å‚æ•°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e \u003cspan class=\"nv\"\u003esql_log_bin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eOFF\u003cspan class=\"p\"\u003e;\u003c/span\u003e//å…³é—­æ—¥å¿—\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e \u003cspan class=\"nv\"\u003eautocommit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0\u003cspan class=\"p\"\u003e;\u003c/span\u003e//å…³é—­ autocommit è‡ªåŠ¨æäº¤æ¨¡å¼ \u003cspan class=\"m\"\u003e0\u003c/span\u003e æ˜¯å…³é—­  \u003cspan class=\"m\"\u003e1\u003c/span\u003e æ˜¯å¼€å¯ï¼ˆé»˜è®¤ï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e global \u003cspan class=\"nv\"\u003emax_allowed_packet\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e *1024* \u003cspan class=\"m\"\u003e1024\u003c/span\u003e * 1024\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä½¿ç”¨æ•°æ®åº“\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euse æ•°æ®åº“åï¼›\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¼€å¯äº‹åŠ¡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSTART TRANSACTION\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¯¼å…¥ SQL æ–‡ä»¶å¹¶ COMMITï¼ˆå› ä¸ºå¯¼å…¥æ¯”è¾ƒè€—æ—¶ï¼Œå¯¼å…¥å’Œ COMMIT ä¸€è¡Œå‘½ä»¤ï¼Œè¿™æ ·ä¸ç”¨ç›¯ç€å±å¹•ç­‰æäº¤äº†ï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /xxx.sqlï¼›COMMIT\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e","tags":[],"title":"MySQL å¤§æ–‡ä»¶å¯¼å…¥ä¼˜åŒ–ï¼Œæé«˜é€Ÿåº¦ï¼Œæå‡æ€§èƒ½"},{"content":"ä»‹ç»åŸºäº start.spring.io å¿«é€Ÿå®šåˆ¶è‡ªå·±çš„ Spring Boot è„šæ‰‹æ¶ï¼Œä¸»è¦åº”ç”¨åœºæ™¯ï¼š\nè§„èŒƒå…¬å¸è‡ªå·±çš„ parent pomï¼Œå¢åŠ ç‰¹å®šçš„ä¾èµ–é¡¹ã€‚ æ ¹æ®å…¬å¸è§„èŒƒç”Ÿæˆç»Ÿä¸€çš„åŒ…ç»“æ„ï¼Œç»Ÿä¸€å‘½åã€‚ æ ¹æ®éœ€è¦å¢åŠ ç‰¹å®šä»£ç æˆ–æ–‡ä»¶ï¼Œæ¯”å¦‚æ ¹æ®å…¬å¸è¦æ±‚ç»Ÿä¸€ logback.xmlã€ application.properties æ–‡ä»¶ã€‚ æä¾›å…¬å¸è‡ªç ”çš„äºŒæ–¹ jar åŒ…ã€‚ å¿«é€Ÿå¼€å§‹ åŸºæœ¬æ­¥éª¤ï¼š\nå¯¹äº spring.initializr æˆ‘ä»¬æ²¡æœ‰å®šåˆ¶çš„éœ€æ±‚ï¼Œç›´æ¥å¼•ç”¨å®˜æ–¹çš„ã€‚ æ‹·è´ä¸€ä»½ start.spring.io ï¼Œç›´æ¥åŸºäºè¿™ä¸ªé¡¹ç›®å¼€å‘ã€éƒ¨ç½²ã€è¿è¡Œã€‚ä»¥ä¸‹éƒ½æ˜¯å…³äºå¦‚ä½•ä¿®æ”¹ start.spring.ioã€‚ start.spring.io ä¸»è¦å…³æ³¨ä¸¤ä¸ªæ¨¡å—ï¼š\nstart-clientï¼šå‰ç«¯é¡µé¢ï¼Œå¯ä»¥å®šåˆ¶äº›è‡ªå·±çš„ logoã€title ç­‰ã€‚ start-siteï¼šæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ spring boot é¡¹ç›®ï¼Œå®é™… run èµ·æ¥çš„æœåŠ¡ï¼Œå¼•ç”¨äº† start-clientï¼Œç›´æ¥ run è¿™ä¸ªé¡¹ç›®çš„ main æ–¹æ³•å°±èƒ½çœ‹åˆ°æ•ˆæœã€‚ ä¸»è¦é…ç½®æ–‡ä»¶ï¼šstart-site/src/main/resources/application.ymlï¼Œé€šè¿‡ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥è¾¾åˆ°çš„æ•ˆæœå¦‚ä¸‹ã€‚\nä¿®æ”¹ start å¯åŠ¨æ—¶é»˜è®¤ groupï¼ŒæŠŠ com.example æ”¹ä¸ºå…¬å¸è‡ªå·±çš„ groupã€‚\ninitializr: group-id: value: com.yourgroup\rä¿®æ”¹çˆ¶ pomï¼Œä½¿ç”¨å…¬å¸è‡ªå·±çš„ pomã€‚\ninitializr: env: maven: # use your parent pom parent: groupId: com.yourself artifactId: your-parent version: 1.0.0 # relativePath: ../pom.xml includeSpringBootBom: false\ré™å®š Java å’Œ Spring Boot ç‰ˆï¼šä¿®æ”¹ languages å’Œ bootVersions å³å¯ã€‚\nå¢åŠ å…¬å¸è‡ªå·±çš„ starterï¼Œå‚è€ƒæ–‡ä»¶ä¸­ä¾‹å­å¢åŠ å³å¯ã€‚\næ ¸å¿ƒæ‰©å±•æ¥å£ ProjectContributor: ç”¨äºå®ç°æ–‡ä»¶ç»“æ„å˜åŒ–ï¼Œæ¯”å¦‚åŠ ä¸ªæ–‡ä»¶å¤¹ï¼Œå¢åŠ é…ç½®æ–‡ä»¶ã€ä»£ç ç‰‡æ®µç­‰ã€‚ BuildCustomizerï¼šåŠ¨æ€ä¿®æ”¹ pom.xmlï¼Œç”¨äºä¿®æ”¹ maven/gradle çš„ dependencies/repository/plugins ç­‰ã€‚ æ›´å¤šè‡ªå¸¦å®šåˆ¶æ¥å£å‚è€ƒï¼šMainSourceCodeCustomizer, MainCompilationUnitCustomizer, MainApplicationTypeCustomizer, TestSourceCodeCustomizer, TestApplicationTypeCustomizer. åœºæ™¯ï¼šç”Ÿæˆé»˜è®¤çš„ logback-spring.xmlã€‚\nimport io.spring.initializr.generator.project.contributor.SingleResourceProjectContributor; /** * å®šåˆ¶ logback xml æ–‡ä»¶ï¼Œä»å½“å‰é¡¹ç›®çš„`classpath:configuration`æ‹·è´åˆ°æŒ‡å®šçš„ src/main/resources ç›®å½•ä¸‹ */ public class LogbackContributor extends SingleResourceProjectContributor { public LogbackContributor() { this(\u0026#34;classpath:configuration/logback-spring.xml\u0026#34;); } public LogbackContributor(String resourcePattern) { super(\u0026#34;src/main/resources/logback-spring.xml\u0026#34;, resourcePattern); } }\råœºæ™¯ï¼šæŒ‰ç…§ç»Ÿä¸€è§„èŒƒç”Ÿæˆç›®å½•ç»“æ„ã€‚\n/** * æŒ‰ç…§è§„èŒƒç”Ÿæˆé»˜è®¤çš„ java ç›®å½•ç»“æ„ */ public class DefaultPackageContributor implements ProjectContributor { private final ProjectDescription description; public DefaultPackageContributor(ProjectDescription description) { this.description = description; } @Override public void contribute(Path projectRoot) throws IOException { Language language = description.getLanguage(); // \u0026#34;src/main/java/com.test.demo\u0026#34; Path packageRoot = projectRoot.resolve(\u0026#34;src/main/\u0026#34;) .resolve(language.id()) .resolve(description.getPackageName().replaceAll(\u0026#34;\\\\.\u0026#34;,\u0026#34;/\u0026#34;)); Files.createDirectories(packageRoot.resolve(\u0026#34;config\u0026#34;)); Files.createDirectories(packageRoot.resolve(\u0026#34;dao\u0026#34;)); Files.createDirectories(packageRoot.resolve(\u0026#34;service\u0026#34;)); Files.createDirectories(packageRoot.resolve(\u0026#34;web\u0026#34;)); } }\råœºæ™¯ï¼šåœ¨ xxx æ¡ä»¶ä¸‹åš xxxã€‚æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ spock ä½œä¸ºæµ‹è¯•æ¡†æ¶ï¼Œspock ä½¿ç”¨ groovy è¯­è¨€ã€‚å¦‚æœå¼•å…¥ spock çš„æ—¶å€™ï¼Œé»˜è®¤åœ¨ maven plugin é‡Œå¢åŠ  groovy æ’ä»¶ gmavenplus-pluginã€‚\nclass SpockMavenBuildCustomizer implements BuildCustomizer\u0026lt;MavenBuild\u0026gt; { @Override public void customize(MavenBuild build) { // add groovy plugin build.plugins() .add(\u0026#34;org.codehaus.gmavenplus\u0026#34;, \u0026#34;gmavenplus-plugin\u0026#34;); } }\r@ProjectGenerationConfiguration public class MyProjectGenerationConfiguration { @Bean @ConditionalOnRequestedDependency(\u0026#34;spock\u0026#34;) public SpockMavenBuildCustomizer spockMavenBuildCustomizer() { return new SpockMavenBuildCustomizer(); } }\r","date":"2024-03-09","id":25,"permalink":"/blog/spring-boot-start-site/","summary":"\u003cp\u003eä»‹ç»åŸºäº \u003ccode\u003estart.spring.io\u003c/code\u003e å¿«é€Ÿå®šåˆ¶è‡ªå·±çš„ Spring Boot è„šæ‰‹æ¶ï¼Œä¸»è¦åº”ç”¨åœºæ™¯ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eè§„èŒƒå…¬å¸è‡ªå·±çš„ parent pomï¼Œå¢åŠ ç‰¹å®šçš„ä¾èµ–é¡¹ã€‚\u003c/li\u003e\n\u003cli\u003eæ ¹æ®å…¬å¸è§„èŒƒç”Ÿæˆç»Ÿä¸€çš„åŒ…ç»“æ„ï¼Œç»Ÿä¸€å‘½åã€‚\u003c/li\u003e\n\u003cli\u003eæ ¹æ®éœ€è¦å¢åŠ ç‰¹å®šä»£ç æˆ–æ–‡ä»¶ï¼Œæ¯”å¦‚æ ¹æ®å…¬å¸è¦æ±‚ç»Ÿä¸€ logback.xmlã€ application.properties æ–‡ä»¶ã€‚\u003c/li\u003e\n\u003cli\u003eæä¾›å…¬å¸è‡ªç ”çš„äºŒæ–¹ jar åŒ…ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"å¿«é€Ÿå¼€å§‹\"\u003eå¿«é€Ÿå¼€å§‹\u003c/h2\u003e\n\u003cp\u003eåŸºæœ¬æ­¥éª¤ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå¯¹äº \u003ca href=\"https://github.com/spring-io/initializr\" target=\"_blank\" rel=\"noopener\"\u003espring.initializr\u003c/a\u003e\n æˆ‘ä»¬æ²¡æœ‰å®šåˆ¶çš„éœ€æ±‚ï¼Œç›´æ¥å¼•ç”¨å®˜æ–¹çš„ã€‚\u003c/li\u003e\n\u003cli\u003eæ‹·è´ä¸€ä»½ \u003ca href=\"https://github.com/spring-io/start.spring.io\" target=\"_blank\" rel=\"noopener\"\u003estart.spring.io\u003c/a\u003e\nï¼Œç›´æ¥åŸºäºè¿™ä¸ªé¡¹ç›®å¼€å‘ã€éƒ¨ç½²ã€è¿è¡Œã€‚ä»¥ä¸‹éƒ½æ˜¯å…³äºå¦‚ä½•ä¿®æ”¹ \u003ccode\u003estart.spring.io\u003c/code\u003eã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ccode\u003estart.spring.io\u003c/code\u003e ä¸»è¦å…³æ³¨ä¸¤ä¸ªæ¨¡å—ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003estart-clientï¼šå‰ç«¯é¡µé¢ï¼Œå¯ä»¥å®šåˆ¶äº›è‡ªå·±çš„ logoã€title ç­‰ã€‚\u003c/li\u003e\n\u003cli\u003estart-siteï¼šæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ spring boot é¡¹ç›®ï¼Œå®é™… run èµ·æ¥çš„æœåŠ¡ï¼Œå¼•ç”¨äº† start-clientï¼Œç›´æ¥ run è¿™ä¸ªé¡¹ç›®çš„ main æ–¹æ³•å°±èƒ½çœ‹åˆ°æ•ˆæœã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸»è¦é…ç½®æ–‡ä»¶ï¼š\u003ccode\u003estart-site/src/main/resources/application.yml\u003c/code\u003eï¼Œé€šè¿‡ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥è¾¾åˆ°çš„æ•ˆæœå¦‚ä¸‹ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä¿®æ”¹ start å¯åŠ¨æ—¶é»˜è®¤ groupï¼ŒæŠŠ \u003ccode\u003ecom.example\u003c/code\u003e æ”¹ä¸ºå…¬å¸è‡ªå·±çš„ groupã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003einitializr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup-id\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecom.yourgroup\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¿®æ”¹çˆ¶ pomï¼Œä½¿ç”¨å…¬å¸è‡ªå·±çš„ pomã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003einitializr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003emaven\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"c\"\u003e# use your parent pom\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003egroupId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecom.yourself\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eartifactId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eyour-parent\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e1.0.0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"c\"\u003e# relativePath: ../pom.xml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eincludeSpringBootBom\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eé™å®š Java å’Œ Spring Boot ç‰ˆï¼šä¿®æ”¹ languages å’Œ bootVersions å³å¯ã€‚\u003c/p\u003e","tags":["Spring Boot","Java"],"title":"Spring Boot Start è„šæ‰‹æ¶å®šåˆ¶å¼€å‘å’Œå¿«é€Ÿå…¥é—¨"},{"content":"åŸºäº Alibaba Sentinel å®ç°çš„åˆ†å¸ƒå¼é™æµä¸­é—´ä»¶æœåŠ¡ã€‚ä¸»è¦å¯¹æœåŠ¡æä¾›è€…æä¾›é™æµã€ç³»ç»Ÿä¿æŠ¤ï¼Œå¯¹æœåŠ¡è°ƒç”¨è€…æä¾›ç†”æ–­é™çº§ã€é™æµæ’é˜Ÿç­‰å¾…æ•ˆæœã€‚\nå®ç°ç›®æ ‡ï¼š\nä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œä¿æŠ¤è‡ªå·±ä¸è¢«æ‰“æ­»ï¼ŒæœåŠ¡å¯ä»¥æ…¢ä¸å¯ä»¥æŒ‚ã€‚ ä½œä¸ºå®¢æˆ·ç«¯åŠæ—¶é™é€Ÿå’Œç†”æ–­ï¼Œé˜²æ­¢å¯¹æœåŠ¡æä¾›æ–¹åŒ…å« Httpã€æ•°æ®åº“ã€MQ ç­‰é€ æˆå¤ªå¤§å‹åŠ›ï¼Œé˜²æ­¢æŠŠç³Ÿç³•çš„æƒ…å†µå˜å¾—æ›´ç³Ÿã€‚ ä»¥ç”¨æˆ·ã€ç§Ÿæˆ·ã€å¯¹è±¡ç­‰æ›´ç»†ç²’åº¦è¿›è¡Œæµé‡ç²¾ç»†æ§åˆ¶ã€‚ æœåŠ¡é¢„çƒ­ï¼Œåº”ç”¨æ–°å‘å¸ƒä¸Šçº¿ï¼Œç¼“å­˜å°šæœªå®Œå…¨å»ºç«‹ï¼Œé˜²æ­¢æµé‡ä¸€ä¸‹å­æŠŠæœåŠ¡æ‰“æ­»ã€‚ èƒ½å¤Ÿæ ¹æ® Prometheusã€ClickHouseã€Elasticsearch æä¾›çš„ç›‘æ§æŒ‡æ ‡ï¼ŒåŠ¨æ€ç”Ÿæˆè§„åˆ™ï¼Œè‡ªé€‚åº”è°ƒæ•´è§„åˆ™ã€‚ æ¦‚è¿° Sentinel çš„åŸºç¡€çŸ¥è¯†è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£æè¿°ï¼Œè¿™é‡Œå•ç‹¬ä»‹ç»ä¸€äº›ä¸æˆ‘ä»¬å®šåˆ¶ç›¸å…³çš„å†…å®¹ã€‚\né™æµç®€å•æ¥è¯´å°±ä¸‰ä¸ªç‚¹ï¼šèµ„æºã€è§„åˆ™ã€æ•ˆæœã€‚\nèµ„æºï¼šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è‡ªå·±å®šä¹‰ã€å¯ä»¥ç”¨æ³¨è§£è‡ªåŠ¨ç”Ÿæˆã€å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æŒ‰è§„åˆ™ç”Ÿæˆã€‚\nè§„åˆ™ï¼šSentinel å®šä¹‰çš„ä¸€ç³»åˆ—é™æµä¿æŠ¤è§„åˆ™ï¼Œæ¯”å¦‚æµé‡æ§åˆ¶è§„åˆ™ã€è‡ªé€‚åº”ä¿æŠ¤è§„åˆ™ã€‚\næ•ˆæœï¼šå®é™…ä¸Šâ€œæ•ˆæœâ€ä¹Ÿæ˜¯â€œè§„åˆ™â€å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚ä»»ä½•ä¸€æ¡è¯·æ±‚ï¼Œå‘½ä¸­æŸäº›èµ„æºè§„åˆ™åäº§ç”Ÿçš„æ•ˆæœï¼Œæ¯”å¦‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€åŒ€é€Ÿç­‰å¾…ã€‚\nSentinel å…¨å±€æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨é™åˆ¶ ä½¿ç”¨å¼€æºé»˜è®¤ Sentinel ç»„ä»¶ï¼Œæœ‰ä¸€äº›å‘ï¼Œæˆ–è€…è¯´éœ€è¦å…³æ³¨çš„æ³¨æ„äº‹é¡¹ï¼š\nå•ä¸ªè¿›ç¨‹å†…èµ„æºæ•°é‡é˜ˆå€¼æ˜¯ 6000ï¼Œå¤šå‡ºçš„èµ„æºè§„åˆ™å°†ä¸ä¼šç”Ÿæ•ˆï¼ˆå› ä¸ºæ˜¯æ‡’åŠ è½½ï¼Œèµ„æºå…ˆåˆ°å…ˆå¾—ï¼‰ï¼Œä¹Ÿä¸æç¤ºé”™è¯¯è€Œæ˜¯ç›´æ¥å¿½ç•¥ï¼Œèµ„æºæ•°é‡å¤ªå¤šå»ºè®®ä½¿ç”¨çƒ­ç‚¹å‚æ•°æ§åˆ¶ã€‚ å¯¹äºé™æµçš„é“¾è·¯æ¨¡å¼ï¼Œcontext é˜ˆå€¼æ˜¯ 2000ï¼Œæ‰€ä»¥é»˜è®¤çš„ WEB_CONTEXT_UNIFY ä¸º trueï¼Œå¦‚æœéœ€è¦é“¾è·¯é™æµéœ€è¦æŠŠè¿™ä¸ªæ”¹ä¸º falseã€‚ è‡ªå®šä¹‰æ—¶ï¼Œèµ„æºåä¸­ä¸è¦å¸¦ | çº¿ï¼Œ è¿™ä¸ªæ—¥å¿—ä¸­è¦ç”¨ï¼Œæ—¥å¿—ä»¥æ­¤ä½œä¸ºåˆ†å‰²ç¬¦ã€‚ Sentinel æ”¯æŒæŒ‰æ¥æºé™æµï¼Œæ³¨æ„ origin æ•°é‡ä¸èƒ½å¤ªå¤šï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æš´æ¶¨ã€‚ ä¸€ä¸ªèµ„æºå¯ä»¥æœ‰å¤šä¸ªè§„åˆ™ï¼Œä¸€æ¡è¯·æ±‚èƒ½å¦é€šè¿‡ï¼Œå–å†³äºè§„åˆ™é‡Œé˜ˆå€¼æœ€å°çš„é™åˆ¶æ¡ä»¶ã€‚ é™æµçš„ç›®çš„æ˜¯ä¿æŠ¤ç³»ç»Ÿï¼Œè®¡æ•°è®¡é‡å¹¶ä¸å‡†ç¡®ï¼Œæ‰€ä»¥ä¸è¦æ‹¿é™æµåšè®¡é‡æˆ–é…é¢æ§åˆ¶ã€‚ å¢åŠ é™æµä¸€å®šç¨‹åº¦ä¸Šé€šè¿‡æ—¶é—´æ¢ç©ºé—´ï¼Œé™ä½äº† CPUã€å†…å­˜è´Ÿè½½ï¼Œå¯¹ K8S HPA ç­–ç•¥ä¼šæœ‰ä¸€å®šå½±å“ã€‚åç»­æˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘æ ¹æ® Sentinel é™æµæŒ‡æ ‡è¿›è¡Œæ‰©ç¼©å®¹ã€‚ é™æµä¸­å¦‚æœæœ‰å¢åŠ ç­‰å¾…æ•ˆæœä¼šä½¿æ¥å£å˜æ…¢ï¼Œå„è°ƒç”¨é“¾éœ€è¦å…³æ³¨è°ƒç”¨è¶…æ—¶å’Œäº‹åŠ¡é…ç½®ã€‚ ç›®å‰ sentinel-web-servlet å’Œ sentinel-spring-webmvc-adapter å‡ä¸æ”¯æŒçƒ­ç‚¹å‚æ•°é™æµã€‚ä¸ºäº†æ”¯æŒçƒ­ç‚¹å‚æ•°éœ€è¦è‡ªè¡Œæ‰©å±•ã€‚ sentinel-web-servlet å’Œ sentinel-spring-webmvc-adapter ä¼šå°†æ¯ä¸ªåˆ°æ¥çš„ä¸åŒçš„ URL éƒ½ä½œä¸ºä¸åŒçš„èµ„æºå¤„ç†ï¼Œå› æ­¤å¯¹äº REST é£æ ¼çš„ APIï¼Œéœ€è¦è‡ªè¡Œå®ç° UrlCleaner æ¥å£æ¸…æ´—ä¸€ä¸‹èµ„æºï¼ˆæ¯”å¦‚å°†æ»¡è¶³ /foo/:id çš„ URL éƒ½å½’åˆ° /foo/* èµ„æºä¸‹ï¼‰ã€‚å¦åˆ™ä¼šå¯¼è‡´èµ„æºæ•°é‡è¿‡å¤šï¼Œè¶…å‡ºèµ„æºæ•°é‡é˜ˆå€¼ï¼ˆç›®å‰æ˜¯ 6000ï¼‰æ—¶å¤šå‡ºçš„èµ„æºçš„è§„åˆ™å°†ä¸ä¼šç”Ÿæ•ˆã€‚ Java ä¸­ sentinel-time-tick-thread çº¿ç¨‹ä¼šé¢å¤–å¤šå ç”¨çº¦ 1-2% CPUï¼Œè¯¦ç»†ä»£ç å‚è€ƒ com.alibaba.csp.sentinel.util.TimeUtilã€‚ ä¸€äº›æ–‡æ¡£ä¸­å°šæœªæ›´æ–°ä½†æ˜¯å¤§å®¶å¯èƒ½å…³å¿ƒçš„å†…å®¹ï¼š\nä» 1.8.7 ç‰ˆæœ¬å¼€å§‹èµ„æºåŒ¹é…æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨çš„æ˜¯ Java è‡ªå¸¦çš„æ­£åˆ™å¼•æ“ã€‚ ä» 1.8.7 ç‰ˆæœ¬å¯¹ QPS é™æµåšäº†ä¼˜åŒ–ï¼Œæ”¯æŒ QPS å¤§äº 1000 äº†ã€‚ çƒ­ç‚¹å‚æ•°é™æµå·²ç»æ”¯æŒæŒ‰ç…§çº¿ç¨‹æ•°é™æµï¼Œæ–‡æ¡£å°šæœªæ›´æ–°ï¼Œæ–‡æ¡£ä¸­è¯´åªæ”¯æŒ QPSã€‚ æ¥å…¥æŒ‡å¯¼ æ€»ä½“æ¶æ„å›¾ã€‚\næˆ‘ä»¬æ‰€æœ‰ç»„ä»¶ï¼Œè§„åˆ™åŠ è½½éƒ½æ˜¯ç”± Datasource ç»„ä»¶ç»Ÿä¸€åŠ è½½ï¼Œé…ç½®æ˜¯æ‡’åŠ è½½çš„ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™åŠ è½½ï¼Œå¦‚æœéœ€è¦å®šä¹‰è§„åˆ™è¯·åœ¨é…ç½®ä¸­å¿ƒå®šä¹‰ï¼Œè¿™æ˜¯ç”± Sentinel åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ï¼ˆå‚è€ƒæºç ï¼šcom.alibaba.csp.sentinel.Env.javaï¼‰é€šè¿‡ SPI åŠ è½½çš„ã€‚\næ³¨æ„ï¼šå¦‚æœä½ æœ‰è‡ªç¼–ç ä½¿ç”¨ Sentinel SDK è‡ªå¸¦çš„ XxxRuleManager.loadRules åŠ è½½è§„åˆ™ï¼Œä¼šè¢«è¿œç«¯é…ç½®ä¸­å¿ƒè¦†ç›–æ‰ï¼Œè¿œç«¯é…ç½®å˜æ›´è‡ªåŠ¨åˆ·æ–°åä¼šä»¥è¿œç«¯é…ç½®ä¸ºå‡†ï¼ŒæŠŠ XxxRuleManager.loadRules åŠ è½½çš„è§„åˆ™è¦†ç›–æ‰ã€‚\nåº•å±‚é™æµç­–ç•¥å®ç° Sentinel åº•å±‚é™æµç­–ç•¥å…±æœ‰ 2 ç§ï¼Œå¦å¤–æœ‰ 2 ä¸ª WARMUP çš„å˜ä½“ï¼Œæ€»å…± 4 ä¸ªã€‚å‚è€ƒæºç  com.alibaba.csp.sentinel.slots.block.flow.TrafficShapingController ã€‚\nåŸºäºç»å¯¹å€¼çš„ DefaultControllerï¼Œåªè¦æ€»å€¼æ ¡éªŒé€šè¿‡å³å¯ï¼Œæ¯”å¦‚ QPS 10ï¼Œ1s å†…å¯ä»¥å‰ 500ms é€šè¿‡ 10 ä¸ªï¼Œå 500ms é€šè¿‡ 0 ä¸ªï¼Œåªè¦åœ¨è¿™ 1s å†…æ²¡è¶…æ ‡å°±è¡Œã€‚ åŸºäºé¢‘ç‡çš„ ThrottlingControllerï¼Œæ¼æ¡¶ç®—æ³•ï¼Œæ¯”å¦‚ QPS 10ï¼Œè¦æ±‚ä»¥æ¯ 100ms ä¸€ä¸ªçš„å›ºå®šé¢‘ç‡æ‰§è¡Œã€‚å¦‚æœå‰ 500ms æœ‰ 10 ä¸ªè¯·æ±‚ï¼Œæœ€å¤šé€šè¿‡ 5 ä¸ªï¼Œå…¶ä»–çš„éƒ½è¦æ’é˜Ÿã€‚ å…³äºè¿™å‡ ç§ç­–ç•¥æ”¯æŒçš„èŒƒå›´ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹æºç  com.alibaba.csp.sentinel.slots.block.flow.FlowRuleUtil#generateRaterï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ã€‚\nprivate static TrafficShapingController generateRater(FlowRule rule) { if (rule.getGrade() == RuleConstant.FLOW_GRADE_QPS) { switch (rule.getControlBehavior()) { case RuleConstant.CONTROL_BEHAVIOR_WARM_UP: return new WarmUpController(rule.getCount(), rule.getWarmUpPeriodSec(), ColdFactorProperty.coldFactor); case RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER: return new ThrottlingController(rule.getMaxQueueingTimeMs(), rule.getCount()); case RuleConstant.CONTROL_BEHAVIOR_WARM_UP_RATE_LIMITER: return new WarmUpRateLimiterController(rule.getCount(), rule.getWarmUpPeriodSec(), rule.getMaxQueueingTimeMs(), ColdFactorProperty.coldFactor); case RuleConstant.CONTROL_BEHAVIOR_DEFAULT: default: } } return new DefaultController(rule.getCount(), rule.getGrade()); }\ræ ¹æ®ä»¥ä¸Šä»£ç ï¼Œå¯ä»¥ç¡®å®šé™æµå„ä¸ªå‚æ•°é€‚ç”¨çš„èŒƒå›´ï¼Œæ¯”å¦‚ â€œæŒ‰ç…§å¹¶å‘çº¿ç¨‹æ•°é™æµï¼Œå®ç°åŒ€é€Ÿç­‰å¾…æ•ˆæœâ€ å°±åšä¸åˆ°äº†ã€‚\nè§„åˆ™å‚æ•°è¯¦è§£ Sentinel è§„åˆ™çš„èµ„æºåå­—åŒ¹é…æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ–‡æ¡£é‡Œä»æœªæåŠï¼Œå¯èƒ½æ˜¯è€ƒè™‘åˆ°æ€§èƒ½ã€‚å¦‚æœè¦ä¸ºæŸä¸ªè§„åˆ™å¯ç”¨æ­£åˆ™ï¼Œéœ€ä¸»åŠ¨è®¾ç½® xxRule.setRegex(true)ï¼Œå¦å¤–æ³¨æ„ç”¨çš„æ˜¯ Java æ­£åˆ™åŒ¹é…ï¼Œä¸è¦å’Œ Spring Path çš„æ­£åˆ™åŒ¹é…æ··äº†ã€‚æ¯”å¦‚ Java é‡Œ .* ä»£è¡¨ä»»æ„åŒ¹é…ï¼ŒSpring * è¡¨è¾¾ä»»æ„åŒ¹é…ã€‚\nç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤è§„åˆ™ å‚æ•°ç¤ºä¾‹ï¼š\n{ \u0026#34;avgRt\u0026#34;: 500, \u0026#34;highestSystemLoad\u0026#34;: 100, \u0026#34;highestCpuUsage\u0026#34;: 90.0, \u0026#34;maxThread\u0026#34;: 100, \u0026#34;qps\u0026#34;: 200.0 }\rhighestSystemLoadï¼šå½“ç³»ç»Ÿ load1 è¶…è¿‡é˜ˆå€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ maxQps * minRt è®¡ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ CPU cores * 2.5ã€‚ highestCpuUsageï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ã€‚ avgRt ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚ maxThreadï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚ qpsï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚ ä»¥ä¸Šå‚æ•°é»˜è®¤æ˜¯ -1ï¼Œä»£è¡¨æ— é™åˆ¶ã€‚\næ³¨æ„ï¼š\nåœ¨ K8S ç¯å¢ƒä¸‹ï¼ŒSentinel è¯»å–å½“å‰æŒ‡æ ‡å€¼æ—¶ï¼ŒhighestSystemLoad è·å–çš„æ˜¯å®¿ä¸»æœºçš„ load1ï¼Œä¸æ˜¯ Pod çš„ã€‚å‚è€ƒï¼šhttps://github.com/alibaba/Sentinel/issues/2260 Sentinel è¯»å–å½“å‰æŒ‡æ ‡å€¼æ—¶ï¼Œè·å–çš„ CPU æŒ‡æ ‡å–çš„æ˜¯ Pod Cpu å’Œå®¿ä¸»æœº CPU çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœ å®¿ä¸»æœº CPU å ç”¨å¤ªé«˜ï¼ŒPod CPU å¾ˆä½ï¼Œä¼šè¯¯ä¼¤ï¼Œä¼šè§¦å‘é™æµã€‚ highestSystemLoad ç›¸å½“äºè¦ä¸è¦è‡ªé€‚åº”çš„å¼€å…³ï¼Œè¾¾åˆ°æ¡ä»¶åä¼šè®¡ç®—ä¸‹æ˜¯å¦è¿˜èƒ½æ‰¿å—æµé‡ï¼Œä¸è¡Œæ‰æ‹’ç»ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œè‡ªé€‚åº”â€ã€‚é™¤ highestSystemLoad å¤–ï¼Œå…¶ä»–å‡ ä¸ªå‚æ•°æ˜¯è¾¾åˆ°é˜ˆå€¼å°±æ‹’ç»ã€‚ è§„åˆ™ä¸­çš„å‡ ä¸ªå‚æ•°ï¼Œå¯ä»¥åœ¨ä¸€æ¡è§„åˆ™é‡Œå…¨éƒ¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åˆ†å¤šä¸ªè§„åˆ™é…ç½®ä¸åŒå‚æ•°ï¼Œä¹Ÿå¯ä»¥åªè®¾ç½®æŸä¸ªï¼ŒSentinel ä¼šè‡ªè¡Œåˆå¹¶å‚æ•°è®¡ç®—ã€‚ æµé‡æ§åˆ¶ å‚æ•°ç¤ºä¾‹ï¼š\n{ \u0026#34;resource\u0026#34;: \u0026#34;spring-cloud-samples:GET:/api-provider/pets/{id}\u0026#34;, \u0026#34;count\u0026#34;: 100.0, \u0026#34;grade\u0026#34;: 1, \u0026#34;controlBehavior\u0026#34;: 0, \u0026#34;warmUpPeriodSec\u0026#34;: 10, \u0026#34;maxQueueingTimeMs\u0026#34;: 5000, \u0026#34;limitApp\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;strategy\u0026#34;: 0 }\rresourceï¼šèµ„æºåï¼Œå³é™æµè§„åˆ™çš„ä½œç”¨å¯¹è±¡ count: é™æµé˜ˆå€¼ grade: é™æµé˜ˆå€¼ç±»å‹ï¼ŒQPSï¼ˆRuleConstant.FLOW_GRADE_QPS = 1ï¼‰ æˆ–çº¿ç¨‹æ•°ï¼ˆRuleConstant.FLOW_GRADE_THREAD = 0ï¼‰ã€‚ controlBehaviorï¼šé™æµæ•ˆæœï¼Œæœ‰ç›´æ¥æ‹’ç»ï¼ˆRuleConstant.CONTROL_BEHAVIOR_DEFAULT = 0ï¼‰ã€å†·å¯åŠ¨ï¼ˆRuleConstant.CONTROL_BEHAVIOR_WARM_UP=1ï¼‰ã€åŒ€é€Ÿå™¨ï¼ˆRuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER=2ï¼‰ã€å†·å¯åŠ¨-åŒ€é€Ÿå™¨ï¼ˆRuleConstant.CONTROL_BEHAVIOR_WARM_UP_RATE_LIMITER=3ï¼‰ã€‚ warmUpPeriodSecï¼šå†·å¯åŠ¨æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ 10sã€‚ maxQueueingTimeMsï¼šæœ€å¤§æ’é˜Ÿç­‰å¾…æ—¶é•¿ï¼Œé»˜è®¤ 500msã€‚ï¼ˆä»…åœ¨åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ + QPS ä¸‹ç”Ÿæ•ˆï¼‰ limitApp: æŒ‰æ¥æºé™æµï¼Œé»˜è®¤ default è¡¨ç¤ºå¿½ç•¥æ¥æºï¼Œæ‰€æœ‰æ¥æºéƒ½é™æµã€‚å¦‚æœ limitApp ä¸º nullï¼Œå°†å¿½ç•¥æ­¤æ¡è§„åˆ™ï¼Œä¸é™æµç›´æ¥æ”¾è¡Œã€‚ strategy: æ ¹æ®è°ƒç”¨å…³ç³»é€‰æ‹©ç­–ç•¥ï¼šæ ¹æ®è°ƒç”¨æ–¹é™æµï¼ˆSTRATEGY_DIRECT=0ï¼‰ï¼Œæ ¹æ®è°ƒç”¨é“¾è·¯å…¥å£é™æµï¼ˆSTRATEGY_CHAIN=1ï¼‰ï¼Œå…·æœ‰å…³ç³»çš„èµ„æºæµé‡æ§åˆ¶ï¼ˆSTRATEGY_RELATE=2ï¼‰ã€‚ æ³¨æ„ï¼š\nåŒ€é€Ÿå™¨æ¨¡å¼çš„æ—¶å€™æ ¹æ®å®é™…æƒ…å†µè®¾ç½® maxQueueingTimeMsï¼Œå¤„ç†å¥½æ’é˜Ÿè¶…æ—¶æƒ…å†µï¼Œå¦‚æœå¤ªé•¿å®¢æˆ·ç«¯å¯èƒ½è¶…æ—¶ï¼Œå¦‚æœå¤ªçŸ­ç›´æ¥æŠ›å‡ºè¶…æ—¶å¼‚å¸¸äº†ï¼Œè¾¾ä¸åˆ°åŒ€é€Ÿçš„æ•ˆæœã€‚ çƒ­ç‚¹å‚æ•°é™æµ çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚ Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚\nå‚æ•°ç¤ºä¾‹ï¼š\n{ \u0026#34;resource\u0026#34;: \u0026#34;spring-cloud-samples:GET:/api-provider/pets/{id}\u0026#34;, \u0026#34;count\u0026#34;: 100.0, \u0026#34;grade\u0026#34;: 1, \u0026#34;paramIdx\u0026#34;: 0, \u0026#34;controlBehavior\u0026#34;: 0, \u0026#34;warmUpPeriodSec\u0026#34;: 1, \u0026#34;maxQueueingTimeMs\u0026#34;: 5000, \u0026#34;durationInSec\u0026#34;: 1, \u0026#34;burstCount\u0026#34;: 0, \u0026#34;limitApp\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;paramFlowItemList\u0026#34;: [ { \u0026#34;object\u0026#34;: \u0026#34;ea-vip\u0026#34;, \u0026#34;classType\u0026#34;: \u0026#34;String\u0026#34;, \u0026#34;count\u0026#34;: 1000 } ], \u0026#34;strategy\u0026#34;: 0 }\ré»˜è®¤å‚æ•°å‚è€ƒæµé‡æ§åˆ¶è§„åˆ™çš„è§£é‡Šã€‚ paramIdxï¼šçƒ­ç‚¹å‚æ•°çš„ç´¢å¼•ï¼Œå¿…å¡«ï¼Œå¯¹åº” SphU.entry(xxx, args) ä¸­çš„ args å‚æ•°ç´¢å¼•ä½ç½®ï¼Œä» 0 å¼€å§‹ã€‚ durationInSecï¼šç»Ÿè®¡çª—å£æ—¶é—´é•¿åº¦ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œé»˜è®¤ 1sã€‚åœ¨æ­¤å•ä½æ—¶é—´ durationInSec å†…å…è®¸ count å€¼ï¼Œæ¯”å¦‚ 1s 10 ä¸ªï¼Œ10s 100 ä¸ªã€‚æ³¨æ„è¿™ä¸ª durationInSec ä¸è¦å¤ªé•¿ï¼Œå¦å¤–æ€è€ƒä¸€ä¸ªé—®é¢˜ 1s 10 ä¸ªå’Œ 10s 100 ä¸ªæ•°å­—ä¸Šç›¸ç­‰æ•ˆæœç›¸ç­‰å—ï¼Œæ˜¾ç„¶ä¸æ˜¯ã€‚ paramFlowItemListï¼šå‚æ•°ä¾‹å¤–é¡¹ï¼Œå¯ä»¥é’ˆå¯¹æŒ‡å®šçš„å‚æ•°å€¼å•ç‹¬è®¾ç½®é™æµé˜ˆå€¼ï¼Œä¸å—å‰é¢ count é˜ˆå€¼çš„é™åˆ¶ã€‚ä»…æ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹ã€‚ burstCount: ä¸ºåº”å¯¹çªå‘æµé‡\u0026quot;é¢å¤–å…è®¸\u0026quot;çš„æµé‡ï¼Œåœ¨åŸ count çš„åŸºç¡€ä¸Šå†é¢å¤–åŠ ä¸Šè¿™ä¸ªå€¼ï¼Œç›¸å½“äºä¿åº•ã€‚é»˜è®¤ä¸º 0ï¼Œä»…åœ¨ å¿«é€Ÿå¤±è´¥|Warm UP + QPS ä¸‹ç”Ÿæ•ˆã€‚ï¼ˆJava æ–‡æ¡£ä¸­æœªæåŠï¼Œä»£ç ä¸­æ”¯æŒï¼‰ æ³¨æ„ï¼š\nå¯ä»¥é€šè¿‡ paramFlowItemList è®¾ç½®ä¾‹å¤–é¡¹ï¼Œæ¯”å¦‚ä¸º VIP å•ç‹¬è®¾ç½®é™æµé˜ˆå€¼ã€‚ æ¯ä¸ªå‚æ•°ç´¢å¼• (paramIdx) å¯¹åº”çš„ä¸åŒå€¼æœ€å¤šç»Ÿè®¡ 4000ï¼ˆParameterMetric.BASE_PARAM_MAX_CAPACITYï¼‰ä¸ªã€‚ åœ¨ç»Ÿè®¡çª—å£æ—¶é—´é•¿åº¦ï¼ˆdurationInSecï¼‰å†…æœ€å¤šå…è®¸ç»Ÿè®¡ 20 ä¸‡ä¸ªã€‚å¯ä»¥ç†è§£ä¸º LRU çš„ Top Nã€‚ æ¥æºè®¿é—®æ§åˆ¶ å‚æ•°ç¤ºä¾‹ï¼š\n{ \u0026#34;resource\u0026#34;: \u0026#34;spring-cloud-samples:GET:/api-provider/pets/{id}\u0026#34;, \u0026#34;limitApp\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;strategy\u0026#34;: 0 }\rresourceï¼šèµ„æºåï¼Œå³é™æµè§„åˆ™çš„ä½œç”¨å¯¹è±¡ limitAppï¼šå¯¹åº”çš„é»‘åå•/ç™½åå•ï¼Œä¸åŒ origin ç”¨ , åˆ†éš”ï¼Œå¦‚ appA,appB strategyï¼šé™åˆ¶æ¨¡å¼ï¼ŒAUTHORITY_WHITE=0 ä¸ºç™½åå•æ¨¡å¼ï¼ŒAUTHORITY_BLACK=1 ä¸ºé»‘åå•æ¨¡å¼ï¼Œé»˜è®¤ä¸ºç™½åå•æ¨¡å¼ã€‚ ç†”æ–­é™çº§ ç°ä»£å¾®æœåŠ¡æ¶æ„éƒ½æ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±éå¸¸å¤šçš„æœåŠ¡ç»„æˆã€‚ä¸åŒæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œç»„æˆå¤æ‚çš„è°ƒç”¨é“¾è·¯ã€‚ä»¥ä¸Šçš„é—®é¢˜åœ¨é“¾è·¯è°ƒç”¨ä¸­ä¼šäº§ç”Ÿæ”¾å¤§çš„æ•ˆæœã€‚å¤æ‚é“¾è·¯ä¸Šçš„æŸä¸€ç¯ä¸ç¨³å®šï¼Œå°±å¯èƒ½ä¼šå±‚å±‚çº§è”ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªé“¾è·¯éƒ½ä¸å¯ç”¨ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹ä¸ç¨³å®šçš„å¼±ä¾èµ–æœåŠ¡è°ƒç”¨è¿›è¡Œç†”æ–­é™çº§ï¼Œæš‚æ—¶åˆ‡æ–­ä¸ç¨³å®šè°ƒç”¨ï¼Œé¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©ã€‚ç†”æ–­é™çº§ä½œä¸ºä¿æŠ¤è‡ªèº«çš„æ‰‹æ®µï¼Œé€šå¸¸åœ¨å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨ç«¯ï¼‰è¿›è¡Œé…ç½®ã€‚\nSentinel æä¾›ä»¥ä¸‹å‡ ç§ç†”æ–­ç­–ç•¥ï¼š\næ…¢è°ƒç”¨æ¯”ä¾‹ (SLOW_REQUEST_RATIO)ï¼šé€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´ï¼‰ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨ã€‚å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆstatIntervalMsï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚ å¼‚å¸¸æ¯”ä¾‹ (ERROR_RATIO)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆstatIntervalMsï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ã€‚ å¼‚å¸¸æ•° (ERROR_COUNT)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚ { \u0026#34;resource\u0026#34;: \u0026#34;spring-cloud-samples:GET:/api-provider/pets/{id}\u0026#34;, \u0026#34;grade\u0026#34;: 0, \u0026#34;count\u0026#34;: 100.0, \u0026#34;timeWindow\u0026#34;: 10, \u0026#34;minRequestAmount\u0026#34;: 5, \u0026#34;statIntervalMs\u0026#34;: 1000, \u0026#34;slowRatioThreshold\u0026#34;: 1 }\rgradeï¼šç†”æ–­ç­–ç•¥ï¼Œæ”¯æŒæ…¢è°ƒç”¨æ¯”ä¾‹/å¼‚å¸¸æ¯”ä¾‹/å¼‚å¸¸æ•°ç­–ç•¥ã€‚é»˜è®¤æ…¢è°ƒç”¨æ¯”ä¾‹ã€‚ countï¼šæ…¢è°ƒç”¨æ¯”ä¾‹æ¨¡å¼ä¸‹ä¸ºæ…¢è°ƒç”¨ä¸´ç•Œ RTï¼ˆè¶…å‡ºè¯¥å€¼è®¡ä¸ºæ…¢è°ƒç”¨ï¼‰ï¼›å¼‚å¸¸æ¯”ä¾‹/å¼‚å¸¸æ•°æ¨¡å¼ä¸‹ä¸ºå¯¹åº”çš„é˜ˆå€¼ã€‚ timeWindowï¼šç†”æ–­æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ã€‚ minRequestAmountï¼šç†”æ–­è§¦å‘çš„æœ€å°è¯·æ±‚æ•°ï¼Œè¯·æ±‚æ•°å°äºè¯¥å€¼æ—¶å³ä½¿å¼‚å¸¸æ¯”ç‡è¶…å‡ºé˜ˆå€¼ä¹Ÿä¸ä¼šç†”æ–­ã€‚é»˜è®¤ 5ã€‚ statIntervalMsï¼šç»Ÿè®¡æ—¶é•¿ï¼ˆå•ä½ä¸º msï¼‰ï¼Œå¦‚ 60*1000 ä»£è¡¨åˆ†é’Ÿçº§ã€‚é»˜è®¤ 1000msã€‚ slowRatioThresholdï¼šæ…¢è°ƒç”¨æ¯”ä¾‹é˜ˆå€¼ï¼Œä»…æ…¢è°ƒç”¨æ¯”ä¾‹æ¨¡å¼æœ‰æ•ˆã€‚ æ³¨æ„äº‹é¡¹ï¼š\nç†”æ–­é™çº§è§„åˆ™åœ¨æœåŠ¡ç«¯æ—¶ï¼ŒSpring çš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¸€èˆ¬ä¼šæ¶ˆåŒ–æ‰å¼‚å¸¸è½¬æ¢æˆä¸€ä¸ªåˆæ³•çš„ Responseï¼Œä¼šå¯¼è‡´ç†”æ–­è§„åˆ™ä¸­çš„å¼‚å¸¸æ•°è§„åˆ™å¤±æ•ˆï¼Œæˆ‘ä»¬åœ¨ Server ç«¯å¹¶ä¸å‡†å¤‡æ”¯æŒï¼Œå‚è€ƒ Issue ã€‚ å¯¹è±¡ç±»å‹ä½œä¸ºçƒ­ç‚¹å‚æ•° åœ¨çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™è¯´æ˜ä¸­ï¼Œæœ‰å•ç‹¬æåˆ°ä¸€ç‚¹ â€œå‚æ•°åªæ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹â€ã€‚\nå¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬çš„æ¥å£æ˜¯ POST ç±»å‹ï¼Œè¯·æ±‚å‚æ•°æ˜¯ä¸€ä¸ª Request Bodyï¼Œèƒ½ä¸èƒ½ä»¥æ­¤ä½œä¸ºçƒ­ç‚¹å‚æ•°å‘¢ã€‚\nèƒ½ã€‚å®ç°æ–¹å¼æ˜¯å¯¹æ­¤å¯¹è±¡å®ç° com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowArgument æ¥å£ï¼Œåœ¨æ¥å£ä¸­é€šè¿‡ paramFlowKey è¿”å›çœŸæ­£ä½œä¸ºçƒ­ç‚¹çš„æ•°æ®ã€‚\nclass User implements ParamFlowArgument { Integer id; String name; String address; public User(Integer id, String name, String address) { this.id = id; this.name = name; this.address = address; } @Override public Object paramFlowKey() { return name; } }\rä»¥ä¸Šä¾‹å­å°†ä½¿ç”¨ name ä½œä¸ºçœŸæ­£çš„çƒ­ç‚¹å‚æ•°ã€‚\nå½“ç„¶ï¼Œè‹¥éœ€è¦é…ç½®ä¾‹å¤–é¡¹æˆ–è€…ä½¿ç”¨é›†ç¾¤ç»´åº¦æµæ§ï¼Œåˆ™ä¼ å…¥çš„å‚æ•°åªæ”¯æŒåŸºæœ¬ç±»å‹ï¼Œè¦ä¸ç„¶ä¾‹å¤–é¡¹çš„è§„åˆ™é‡Œæ²¡æ³•é…ç½®ã€‚\né›†ç¾¤é™æµ é›†ç¾¤é™æµåŠŸèƒ½å°±ä¸å¤åˆ¶ç²˜è´´äº†ï¼Œè¿™é‡Œç€é‡æå‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š\né›†ç¾¤ Token Server ä¸æ”¯æŒé«˜å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è‡ªå·±åšé«˜å¯ç”¨æ”¹é€ ã€‚ å®¢æˆ·ç«¯è·å– Token å¤±è´¥ä¼šé™çº§åˆ°æœ¬åœ°é™æµã€‚ é›†ç¾¤é™æµåªæ˜¯è§£å†³é™æµé—®é¢˜ï¼Œä¸è§£å†³æµé‡ä¸å‡è¡¡é—®é¢˜ï¼Œè¿™æ˜¯ç½‘ç»œå±‚é¢çš„é—®é¢˜ã€‚å¸¸è§çš„å¦‚ http é•¿è¿æ¥æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥ä¿æŒï¼Œä¸€ä¸ªå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚å¯èƒ½ä¼šå‘ç»™åŒä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå•æœºé™æµé˜ˆå€¼æ˜¯ 10 QPSï¼Œéƒ¨ç½²äº† 3 ä¸ªèŠ‚ç‚¹ï¼Œç†è®ºä¸Šé›†ç¾¤çš„æ€» QPS å¯ä»¥è¾¾åˆ° 30ï¼Œä½†æ˜¯å®é™…ä¸Šç”±äºæµé‡ä¸å‡åŒ€å¯¼è‡´é›†ç¾¤æ€» QPS è¿˜æ²¡æœ‰è¾¾åˆ° 30 å°±å·²ç»è§¦å‘é™æµäº†ã€‚ å…³è”é™æµ åœ¨ Sentinel é™æµè§„åˆ™ä¸­ï¼Œæœ‰ä¸€ä¸ªå¤§å®¶å®¹æ˜“å¿½ç•¥çš„å±æ€§ï¼šæµæ§æ¨¡å¼ä¹‹å…³è”æ¨¡å¼ã€‚å¯å®ç°ç±»ä¼¼äºè¿›ç¨‹å†…çš„â€œèƒŒå‹â€æ¨¡å‹ã€‚\né™æµè§„åˆ™å¯ä»¥é€‰æ‹©ä¸‰ç§æµæ§æ¨¡å¼ï¼š\nç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼ã€‚ å…³è”ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµã€‚ é“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼š\næ•°æ®åº“è¯»å†™ç«äº‰ï¼šæ¯”å¦‚å¯¹æ•°æ®åº“åŒä¸€ä¸ªå­—æ®µçš„è¯»æ“ä½œå’Œå†™æ“ä½œå­˜åœ¨äº‰æŠ¢ï¼Œè¯»çš„é€Ÿåº¦è¿‡é«˜ä¼šå½±å“å†™å¾—é€Ÿåº¦ï¼Œå†™çš„é€Ÿåº¦è¿‡é«˜ä¼šå½±å“è¯»çš„é€Ÿåº¦ã€‚å¦‚æœæ”¾ä»»è¯»å†™æ“ä½œäº‰æŠ¢èµ„æºï¼Œåˆ™äº‰æŠ¢æœ¬èº«å¸¦æ¥çš„å¼€é”€ä¼šé™ä½æ•´ä½“çš„ååé‡ã€‚å¯ä½¿ç”¨å…³è”é™æµæ¥é¿å…å…·æœ‰å…³è”å…³ç³»çš„èµ„æºä¹‹é—´è¿‡åº¦çš„äº‰æŠ¢ï¼Œé™åˆ¶æŸä¸€æ–¹ã€‚ ä¿è¯ä¼˜å…ˆçº§ä»»åŠ¡ï¼šæ¯”å¦‚ç”¨æˆ·æ”¯ä»˜æ—¶éœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ï¼ŒåŒæ—¶ç”¨æˆ·è¦æŸ¥è¯¢è®¢å•ã€‚æŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œä¼šäº‰æŠ¢æ•°æ®åº“é”ï¼Œäº§ç”Ÿç«äº‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯æœ‰é™æ”¯ä»˜å’Œæ›´æ–°è®¢å•çš„ä¸šåŠ¡ï¼Œå› æ­¤å½“ä¿®æ”¹è®¢å•ä¸šåŠ¡è§¦å‘é˜ˆå€¼æ—¶ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è®¢å•ä¸šåŠ¡é™æµã€‚ é˜»æ­¢è¯·æ±‚æ”¾å¤§ï¼šæ¯”å¦‚æ¥å£ A æœ¬èº«æµé‡å¾ˆå°ï¼Œä½†æ˜¯ä¸€æ¬¡æ¥å£ A åˆè°ƒç”¨äº†å…¶ä»– 10 ä¸ªæ¥å£ï¼Œç›¸å½“äºè¯·æ±‚æ”¾å¤§äº† 10 å€ï¼Œå¦‚æœä»»ç”± A éšæ„è°ƒç”¨ï¼Œåç«¯æœåŠ¡åˆ™æ— æ³•æ‰¿æ‹…å‹åŠ›ï¼Œéœ€è¦å¯¹ A è¿›è¡Œé™æµã€‚ ä¸¾ä¾‹ï¼š\næ¯”å¦‚ http æ¥å£ /create ä½œä¸ºå…¥å£æµé‡ï¼Œè°ƒç”¨ä¸€æ¬¡ï¼Œéœ€è¦å¯¹æ•°æ®åº“ï¼ˆæˆ‘ä»¬æš‚å®šæ•°æ®åº“æ“ä½œç”Ÿäº§èµ„æºåæ˜¯ /databaseï¼‰æ‰§è¡Œ 10 æ¬¡æ“ä½œï¼Œå¦‚æœä¸é™åˆ¶ /createï¼Œå°±ä¼šæŠŠæ•°æ®åº“å‹å´©æºƒã€‚ é‚£ä¹ˆå¯ä»¥åœ¨æ•°æ®åº“èµ„æº/database åˆ°è¾¾é˜ˆå€¼ N æ—¶ï¼Œå¯¹/create è¿›è¡Œé™æµã€‚æ³¨æ„è¿™é‡Œï¼šé˜ˆå€¼æ˜¯æ•°æ®åº“èµ„æº /database çš„é˜ˆå€¼ï¼Œé™æµçš„å´æ˜¯èµ„æº /createï¼Œæ•°æ®åº“èµ„æº /database å¹¶ä¸è§¦å‘é™æµã€‚\næ³¨æ„ä½¿ç”¨é™åˆ¶ï¼šå…³è”é™æµä»…é™äºâ€œæµé‡æ§åˆ¶â€è§„åˆ™ï¼Œä¸æ”¯æŒçƒ­ç‚¹å‚æ•°é™æµè§„åˆ™ã€‚\næ—¥å¿—å’Œç›‘æ§æ¨¡å— æˆ‘ä»¬è‡ªå®šä¹‰äº†æ—¥å¿—æ¨¡å—ï¼Œåœ¨ block å’Œ metrics æ—¥å¿—ä¸­å¢åŠ  trace idã€user id ç­‰æ›´å¤šå‚æ•°ï¼Œé€šè¿‡ fluent-bit æ”¶é›†åˆ° ClickHouse ä¸­ã€‚\nå¯åœ¨ Granfana ä¸­ä»¥ ClickHouse ä½œä¸ºæ•°æ®æºé…ç½®è‡ªå·±éœ€è¦çš„è§†å›¾ï¼Œå¹¶ç»“åˆå‘Šè­¦ç»„ä»¶é…ç½®å‘Šè­¦ï¼Œæ¯”å¦‚åº”ç”¨ 1 åˆ†é’Ÿ block æ¬¡æ•°è¶…è¿‡ 10 æ¬¡è§¦å‘å‘Šè­¦ã€‚\nè‡ªå®šä¹‰å®ç° å¦‚æœå„ä¸ª adapter æ¨¡å—ä¸èƒ½æ»¡è¶³ä½ çš„è¦æ±‚ï¼Œå¯ä»¥è‡ªå·±ç¼–ç å®ç°ï¼Œä¸€ä¸ªå…¸å‹çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼ŒæŒ‰éœ€é€‰æ‹©ã€‚\npublic void sample() { String resource = anyStringName(); Entry entry = null; try { //æ”¯æŒæŒ‰ç…§æ¥æºè®¾ç½®è§„åˆ™ï¼ŒæŒ‡å®šè‡ªå·±çš„æ¥æºï¼Œä¸éœ€è¦æ¥æºçš„æ—¶å€™ä¸å†™è¿™è¡Œ ContextUtil.enter(SAMPLE_CONTEXT, APP_NAME); // æ‰§è¡Œ Sentinel æµç¨‹ï¼Œåˆ¤æ–­æ˜¯å¦æ”¾è¡Œã€‚æœ€åä¸€ä¸ª anyArgsArray æ˜¯çƒ­ç‚¹å‚æ•°ï¼Œå¦‚æœä¸éœ€è¦çƒ­ç‚¹å‚æ•°é™æµå°±å¯ä»¥ä¸å†™ entry = SphU.entry(resource, ResourceTypeConstants.COMMON_WEB, EntryType.OUT, anyArgsArray()); //å¼€å§‹æ‰§è¡Œè‡ªå·±çœŸæ­£çš„ä»£ç é€»è¾‘ doJobHere(); } catch (BlockException e) { //æ ¹æ®æƒ…å†µå¤„ç†å¼‚å¸¸ handleBlockException(e); } catch (Exception ex) { //å¦‚æœéœ€è¦ç†”æ–­é™çº§è§„åˆ™ï¼Œéœ€è¦é€šè¿‡è¿™ä¸ª traceEntry æ–¹æ³•æŠŠå¼‚å¸¸æ•°ç»Ÿè®¡ä¸Šï¼Œå¦åˆ™ç†”æ–­é™çº§é‡Œä¸èƒ½æŒ‰ç…§å¼‚å¸¸é™çº§ Tracer.traceEntry(ex, entry); throw ex; } finally { if (entry != null) { entry.close(); } ContextUtil.exit(); } }\rå®æˆ˜ç»éªŒå’Œè¸©å‘è®°å½• LB æˆ– K8S Service é•¿è¿æ¥è´Ÿè½½ä¸å‡è¡¡é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´è¯¯è§¦å‘é™æµï¼Œæœ¬æ¥è®¡ç®—å¥½çš„ä¸€ä¸ªå®ä¾‹æ‰¿è½½ 10 QPSï¼Œæ€ä¹ˆè¯·æ±‚å…¨é›†ä¸­åœ¨ä¸€ä¸ªå®ä¾‹ä¸Šï¼Œæ‰€ä»¥æœ€å¥½é¢„ç•™ä¸€äº›ä½™é‡ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªé—®é¢˜ä»¥åŠè§£å†³åŠæ³•å‚è€ƒ æ­¤åšå®¢ ã€‚\nå•æœºé™æµé˜ˆå€¼åˆ°åº•é…å¤šå°‘ã€‚\næ— ç›‘æ§ä¸æ‹è„‘è¢‹ï¼Œå¯ä»¥å…ˆé…ä¸€ä¸ªå¾ˆå¤§çš„é˜ˆå€¼ï¼Œä¸Šçº¿ metrics æ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—æŒ‡æ ‡ç¡®å®šæœ€å¤§å€¼æœ€å°å€¼åå†è¯„ä¼°é…ç½®å¤šå°‘åˆé€‚ã€‚\nå…¥å£ç½‘å…³å·²ç»é™æµäº†ï¼Œåº”ç”¨å±‚æˆ–æ•°æ®åº“è¿˜éœ€è¦é™æµå—ã€‚\nçœ‹å…·ä½“æƒ…å†µï¼Œåœ¨ä»¥å¾€çš„æ•™è®­ä¸­æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰©å¤§åˆ° N å¤šè¯·æ±‚çš„æƒ…å†µï¼Œè¿™æ—¶ä»…æœ‰ç½‘å…³é™æµå°±ä¸å¤Ÿäº†ã€‚\næ³¨æ„å¤šæœåŠ¡å…³è”é™æµã€‚\nå‡è®¾ä¸€ä¸ªæœåŠ¡ A ä¸€æ¬¡è¯·æ±‚éœ€è¦åŒæ—¶è°ƒç”¨æœåŠ¡ B ä¸€æ¬¡ï¼ŒæœåŠ¡ C ä¸€æ¬¡ã€‚ç„¶è€ŒæœåŠ¡ B é™æµ 100ï¼ŒæœåŠ¡ C é™æµ 200ï¼Œæ€»æœ‰å¤±è´¥çš„æƒ…å†µï¼ŒæœåŠ¡ A å°±è¦ä¸åœçš„å¹³è¡¡ä»–ä»¬çš„å…³ç³»ï¼Œé€ æˆèµ„æºæµªè´¹ç”šè‡³æ•°æ®ä¸ä¸€è‡´ã€‚\nFAQ Qï¼šSentinel èµ„æºç”Ÿæˆæ—¶å¦‚ä½•å¿½ç•¥æŸäº›èµ„æºã€‚\nAï¼šè‡ªå®šä¹‰ UrlCleanerï¼Œå¯¹æƒ³å¿½ç•¥çš„èµ„æºè¿”å›ç©ºå­—ç¬¦ã€‚\nQï¼šSentinel DataSource adapter å’Œ XxxRuleManager.loadRules ä¸¤ç§åŠ è½½è§„åˆ™çš„æ–¹å¼èƒ½ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚\nAï¼šé»˜è®¤ä¸èƒ½ã€‚æ¯”å¦‚ Nacos DataSource adapterï¼Œè¿œç«¯é…ç½®æœ‰å˜æ›´åè‡ªåŠ¨åˆ·æ–°ï¼Œä¼šä»¥è¿œç«¯é…ç½®ä¸ºå‡†ï¼Œè¦†ç›–æ‰ XxxRuleManager.loadRules ä¸»åŠ¨åŠ è½½çš„è§„åˆ™ã€‚å½“ç„¶ä¸€ç§å¦¥åçš„å¤„ç†æ–¹å¼æ˜¯è‡ªå®šä¹‰ DataSource åŠ è½½ï¼Œåœ¨åŠ è½½çš„æ—¶å€™é›†æˆå„ä¸ª Ruleï¼ŒåŠ ä¸€ä¸ªè‡ªå®šä¹‰æ ‡è®°ï¼Œå¯¹æ­¤æ ‡è®°çš„è§„åˆ™ä¸è¿›è¡Œè¦†ç›–ã€‚\nQï¼šå¯¹äºé™æµçš„å†·å¯åŠ¨æ•ˆæœï¼Œå†·å¯åŠ¨ç»“æŸè¿›å…¥ç¨³å®šçŠ¶æ€åï¼Œè¿˜ä¼šä¸ä¼šé‡æ–°å›åˆ°å†·å¯åŠ¨é˜¶æ®µã€‚\nAï¼šä¼šï¼Œä¸€æ®µæ—¶é—´æµé‡è¾ƒå°æˆ–æ— æµé‡åä¼šå›åˆ°å†·å¯åŠ¨é˜¶æ®µã€‚é€šä¿—æ¥è®²å°±æ˜¯ä¼šå…ˆåˆ¤æ–­ä¸€ä¸‹â€œå†·ä¸å†·â€ï¼Œå¾ˆä¹…æ²¡æœ‰æµé‡æˆ–è€…æµé‡å¾ˆå°ï¼Œä¸å°±å¾ˆå†·ã€‚Sentinel å›ºå®šé€Ÿç‡äº§ç”Ÿä»¤ç‰Œå†æ¶ˆè´¹ï¼ŒæœåŠ¡ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œæˆ–è€…æ¥å£å¾ˆä¹…æ²¡æœ‰è¢«è®¿é—®ï¼Œéƒ½ä¼šå¯¼è‡´å½“å‰æ—¶é—´ä¸ä¸Šæ¬¡ç”Ÿäº§ä»¤ç‰Œçš„æ—¶é—´ç›¸å·®ç”šè¿œï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡ç”Ÿäº§ä»¤ç‰Œå°†ä¼šç”Ÿäº§ maxPermits ä¸ªä»¤ç‰Œï¼Œç›´æ¥å°†ä»¤ç‰Œæ¡¶è£…æ»¡ã€‚ç”±äºä»¤ç‰Œæ¡¶å·²æ»¡ï¼Œæ¥ä¸‹æ¥ N ç§’å°±æ˜¯å†·å¯åŠ¨é˜¶æ®µã€‚å…·ä½“æŸ¥çœ‹å‚è€ƒèµ„æ–™é‡Œçš„å†·å¯åŠ¨ç®—æ³•è¯¦è§£ã€‚\nQ: å¾ˆå¤šå¼€å‘é€šè¿‡é”™è¯¯ç æ¥å¤„ç†æµç¨‹ï¼Œè€Œéé€šè¿‡å¼‚å¸¸ã€‚è¿™ç§å†™æ³•ï¼Œå¯¼è‡´ Sentinel ä¸èƒ½æ‹¦æˆªåˆ°å¼‚å¸¸ï¼Œæ— æ³•è§¦å‘é™çº§ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å¤„ç†æ–¹æ³•ã€‚\nA: å®é™…ä¸Š Sentinel æ˜¯é€šè¿‡ Tracer.trace(e) æ¥ç»Ÿè®¡ä¸šåŠ¡å¼‚å¸¸çš„ï¼Œå› æ­¤å¯ä»¥æ”¶åˆ°é”™è¯¯ç å°±è°ƒç”¨æ­¤å‡½æ•°æ¥ç»Ÿè®¡ä¸šåŠ¡å¼‚å¸¸ã€‚\nQ: æˆ‘çš„æœåŠ¡å“åº”æœ‰æ—¶å¿«æœ‰æ—¶æ…¢ï¼Œä¸ºäº†å°½å¯èƒ½ä¿è¯æœåŠ¡å¯ç”¨ï¼Œæˆ‘èƒ½ä¸èƒ½å‘æœªæ¥â€œå€Ÿâ€æŒ‡æ ‡ï¼Œæˆ–è€…æŸäº›æ¥å£æ¯”è¾ƒé‡è¦èƒ½å¦ä¼˜å…ˆå¤„ç†ã€‚\nAï¼šQPS æ¨¡å¼ä¸‹èƒ½ã€‚ä½†æ˜¯å„ä¸ª adapter éƒ½ä¸æ”¯æŒï¼Œéœ€è¦è‡ªå·±å®ç°ï¼Œå‚è€ƒ com.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController#canPass(com.alibaba.csp.sentinel.node.Node, int, boolean) å’Œ com.alibaba.csp.sentinel.SphU#entryWithPriority(java.lang.String, com.alibaba.csp.sentinel.EntryType)ï¼Œæ ¸å¿ƒåœ¨äºéœ€è¦ prioritized ä¸º trueã€‚\nå‚è€ƒèµ„æ–™ ä»¤ç‰Œæ¡¶ç®—æ³•åœ¨ Sentinel ä¸­çš„åº”ç”¨ï¼šhttps://blog.51cto.com/morris131/6506314 Sentinel ä¸­çš„å†·å¯åŠ¨é™æµç®—æ³•ï¼šhttps://cloud.tencent.com/developer/article/1674916 ","date":"2024-03-07","id":26,"permalink":"/blog/sentinel/","summary":"\u003cp\u003eåŸºäº Alibaba Sentinel å®ç°çš„åˆ†å¸ƒå¼é™æµä¸­é—´ä»¶æœåŠ¡ã€‚ä¸»è¦å¯¹æœåŠ¡æä¾›è€…æä¾›é™æµã€ç³»ç»Ÿä¿æŠ¤ï¼Œå¯¹æœåŠ¡è°ƒç”¨è€…æä¾›ç†”æ–­é™çº§ã€é™æµæ’é˜Ÿç­‰å¾…æ•ˆæœã€‚\u003c/p\u003e\n\u003cp\u003eå®ç°ç›®æ ‡ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œä¿æŠ¤è‡ªå·±ä¸è¢«æ‰“æ­»ï¼ŒæœåŠ¡å¯ä»¥æ…¢ä¸å¯ä»¥æŒ‚ã€‚\u003c/li\u003e\n\u003cli\u003eä½œä¸ºå®¢æˆ·ç«¯åŠæ—¶é™é€Ÿå’Œç†”æ–­ï¼Œé˜²æ­¢å¯¹æœåŠ¡æä¾›æ–¹åŒ…å« Httpã€æ•°æ®åº“ã€MQ ç­‰é€ æˆå¤ªå¤§å‹åŠ›ï¼Œé˜²æ­¢æŠŠç³Ÿç³•çš„æƒ…å†µå˜å¾—æ›´ç³Ÿã€‚\u003c/li\u003e\n\u003cli\u003eä»¥ç”¨æˆ·ã€ç§Ÿæˆ·ã€å¯¹è±¡ç­‰æ›´ç»†ç²’åº¦è¿›è¡Œæµé‡ç²¾ç»†æ§åˆ¶ã€‚\u003c/li\u003e\n\u003cli\u003eæœåŠ¡é¢„çƒ­ï¼Œåº”ç”¨æ–°å‘å¸ƒä¸Šçº¿ï¼Œç¼“å­˜å°šæœªå®Œå…¨å»ºç«‹ï¼Œé˜²æ­¢æµé‡ä¸€ä¸‹å­æŠŠæœåŠ¡æ‰“æ­»ã€‚\u003c/li\u003e\n\u003cli\u003eèƒ½å¤Ÿæ ¹æ® Prometheusã€ClickHouseã€Elasticsearch æä¾›çš„ç›‘æ§æŒ‡æ ‡ï¼ŒåŠ¨æ€ç”Ÿæˆè§„åˆ™ï¼Œè‡ªé€‚åº”è°ƒæ•´è§„åˆ™ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"æ¦‚è¿°\"\u003eæ¦‚è¿°\u003c/h2\u003e\n\u003cp\u003eSentinel çš„åŸºç¡€çŸ¥è¯†è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£æè¿°ï¼Œè¿™é‡Œå•ç‹¬ä»‹ç»ä¸€äº›ä¸æˆ‘ä»¬å®šåˆ¶ç›¸å…³çš„å†…å®¹ã€‚\u003c/p\u003e\n\u003cp\u003eé™æµç®€å•æ¥è¯´å°±ä¸‰ä¸ªç‚¹ï¼šèµ„æºã€è§„åˆ™ã€æ•ˆæœã€‚\u003c/p\u003e\n\u003cp\u003eèµ„æºï¼šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è‡ªå·±å®šä¹‰ã€å¯ä»¥ç”¨æ³¨è§£è‡ªåŠ¨ç”Ÿæˆã€å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æŒ‰è§„åˆ™ç”Ÿæˆã€‚\u003c/p\u003e\n\u003cp\u003eè§„åˆ™ï¼šSentinel å®šä¹‰çš„ä¸€ç³»åˆ—é™æµä¿æŠ¤è§„åˆ™ï¼Œæ¯”å¦‚æµé‡æ§åˆ¶è§„åˆ™ã€è‡ªé€‚åº”ä¿æŠ¤è§„åˆ™ã€‚\u003c/p\u003e\n\u003cp\u003eæ•ˆæœï¼šå®é™…ä¸Šâ€œæ•ˆæœâ€ä¹Ÿæ˜¯â€œè§„åˆ™â€å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚ä»»ä½•ä¸€æ¡è¯·æ±‚ï¼Œå‘½ä¸­æŸäº›èµ„æºè§„åˆ™åäº§ç”Ÿçš„æ•ˆæœï¼Œæ¯”å¦‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€åŒ€é€Ÿç­‰å¾…ã€‚\u003c/p\u003e\n\u003ch3 id=\"sentinel-å…¨å±€æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨é™åˆ¶\"\u003eSentinel å…¨å±€æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨é™åˆ¶\u003c/h3\u003e\n\u003cp\u003eä½¿ç”¨å¼€æºé»˜è®¤ Sentinel ç»„ä»¶ï¼Œæœ‰ä¸€äº›å‘ï¼Œæˆ–è€…è¯´éœ€è¦å…³æ³¨çš„æ³¨æ„äº‹é¡¹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå•ä¸ªè¿›ç¨‹å†…èµ„æºæ•°é‡é˜ˆå€¼æ˜¯ 6000ï¼Œå¤šå‡ºçš„èµ„æºè§„åˆ™å°†ä¸ä¼šç”Ÿæ•ˆï¼ˆå› ä¸ºæ˜¯æ‡’åŠ è½½ï¼Œèµ„æºå…ˆåˆ°å…ˆå¾—ï¼‰ï¼Œä¹Ÿä¸æç¤ºé”™è¯¯è€Œæ˜¯ç›´æ¥å¿½ç•¥ï¼Œèµ„æºæ•°é‡å¤ªå¤šå»ºè®®ä½¿ç”¨çƒ­ç‚¹å‚æ•°æ§åˆ¶ã€‚\u003c/li\u003e\n\u003cli\u003eå¯¹äºé™æµçš„é“¾è·¯æ¨¡å¼ï¼Œcontext é˜ˆå€¼æ˜¯ 2000ï¼Œæ‰€ä»¥é»˜è®¤çš„ WEB_CONTEXT_UNIFY ä¸º trueï¼Œå¦‚æœéœ€è¦é“¾è·¯é™æµéœ€è¦æŠŠè¿™ä¸ªæ”¹ä¸º falseã€‚\u003c/li\u003e\n\u003cli\u003eè‡ªå®šä¹‰æ—¶ï¼Œèµ„æºåä¸­ä¸è¦å¸¦ \u003ccode\u003e|\u003c/code\u003e çº¿ï¼Œ è¿™ä¸ªæ—¥å¿—ä¸­è¦ç”¨ï¼Œæ—¥å¿—ä»¥æ­¤ä½œä¸ºåˆ†å‰²ç¬¦ã€‚\u003c/li\u003e\n\u003cli\u003eSentinel æ”¯æŒæŒ‰æ¥æºé™æµï¼Œæ³¨æ„ \u003ccode\u003eorigin\u003c/code\u003e æ•°é‡ä¸èƒ½å¤ªå¤šï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æš´æ¶¨ã€‚\u003c/li\u003e\n\u003cli\u003eä¸€ä¸ªèµ„æºå¯ä»¥æœ‰å¤šä¸ªè§„åˆ™ï¼Œä¸€æ¡è¯·æ±‚èƒ½å¦é€šè¿‡ï¼Œå–å†³äºè§„åˆ™é‡Œé˜ˆå€¼æœ€å°çš„é™åˆ¶æ¡ä»¶ã€‚\u003c/li\u003e\n\u003cli\u003eé™æµçš„ç›®çš„æ˜¯ä¿æŠ¤ç³»ç»Ÿï¼Œè®¡æ•°è®¡é‡å¹¶ä¸å‡†ç¡®ï¼Œæ‰€ä»¥ä¸è¦æ‹¿é™æµåšè®¡é‡æˆ–é…é¢æ§åˆ¶ã€‚\u003c/li\u003e\n\u003cli\u003eå¢åŠ é™æµä¸€å®šç¨‹åº¦ä¸Šé€šè¿‡æ—¶é—´æ¢ç©ºé—´ï¼Œé™ä½äº† CPUã€å†…å­˜è´Ÿè½½ï¼Œå¯¹ K8S HPA ç­–ç•¥ä¼šæœ‰ä¸€å®šå½±å“ã€‚åç»­æˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘æ ¹æ® Sentinel é™æµæŒ‡æ ‡è¿›è¡Œæ‰©ç¼©å®¹ã€‚\u003c/li\u003e\n\u003cli\u003eé™æµä¸­å¦‚æœæœ‰å¢åŠ ç­‰å¾…æ•ˆæœä¼šä½¿æ¥å£å˜æ…¢ï¼Œå„è°ƒç”¨é“¾éœ€è¦å…³æ³¨è°ƒç”¨è¶…æ—¶å’Œäº‹åŠ¡é…ç½®ã€‚\u003c/li\u003e\n\u003cli\u003eç›®å‰ sentinel-web-servlet å’Œ sentinel-spring-webmvc-adapter å‡ä¸æ”¯æŒçƒ­ç‚¹å‚æ•°é™æµã€‚ä¸ºäº†æ”¯æŒçƒ­ç‚¹å‚æ•°éœ€è¦è‡ªè¡Œæ‰©å±•ã€‚\u003c/li\u003e\n\u003cli\u003esentinel-web-servlet å’Œ sentinel-spring-webmvc-adapter ä¼šå°†æ¯ä¸ªåˆ°æ¥çš„ä¸åŒçš„ URL éƒ½ä½œä¸ºä¸åŒçš„èµ„æºå¤„ç†ï¼Œå› æ­¤å¯¹äº REST é£æ ¼çš„ APIï¼Œéœ€è¦è‡ªè¡Œå®ç° UrlCleaner æ¥å£æ¸…æ´—ä¸€ä¸‹èµ„æºï¼ˆæ¯”å¦‚å°†æ»¡è¶³ /foo/:id çš„ URL éƒ½å½’åˆ° /foo/* èµ„æºä¸‹ï¼‰ã€‚å¦åˆ™ä¼šå¯¼è‡´èµ„æºæ•°é‡è¿‡å¤šï¼Œè¶…å‡ºèµ„æºæ•°é‡é˜ˆå€¼ï¼ˆç›®å‰æ˜¯ 6000ï¼‰æ—¶å¤šå‡ºçš„èµ„æºçš„è§„åˆ™å°†ä¸ä¼šç”Ÿæ•ˆã€‚\u003c/li\u003e\n\u003cli\u003eJava ä¸­ \u003ccode\u003esentinel-time-tick-thread\u003c/code\u003e çº¿ç¨‹ä¼šé¢å¤–å¤šå ç”¨çº¦ 1-2% CPUï¼Œè¯¦ç»†ä»£ç å‚è€ƒ \u003ccode\u003ecom.alibaba.csp.sentinel.util.TimeUtil\u003c/code\u003eã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eä¸€äº›æ–‡æ¡£ä¸­å°šæœªæ›´æ–°ä½†æ˜¯å¤§å®¶å¯èƒ½å…³å¿ƒçš„å†…å®¹ï¼š\u003c/p\u003e","tags":["Java"],"title":"åŸºäº Alibaba Sentinel å®ç°çš„åˆ†å¸ƒå¼é™æµä¸­é—´ä»¶æœåŠ¡ä»¥åŠé‡åˆ°çš„å‘å’Œæ³¨æ„äº‹é¡¹"},{"content":"èƒŒæ™¯ï¼šå…¬å¸ Windows åŠå…¬æœºå—åŸŸæ§å®‰å…¨ç­–ç•¥é™åˆ¶ï¼Œéƒ¨åˆ†æ–‡ä»¶æ— æƒç›´æ¥ä¿®æ”¹ï¼Œå¦å¤–å¼€å‘å¸¸ç”¨çš„è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ä¹Ÿå˜ç°æ— æ³•è®¾ç½®ã€‚ æ­¤é—®é¢˜è§£å†³æ–¹å¼å¦‚ä¸‹ã€‚\næå‡æ–‡ä»¶æƒé™ ç‚¹å‡» Windows + X å¿«æ·é”® â€“ é€‰æ‹©ã€Œå‘½ä»¤æç¤ºç¬¦ï¼ˆç®¡ç†å‘˜ï¼‰ã€‚\nåœ¨ CDM çª—å£ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚\ntakeown /f C:\\è¦ä¿®å¤çš„æ–‡ä»¶è·¯å¾„\råœ¨æ‹¿åˆ°æ–‡ä»¶æ‰€æœ‰æƒåï¼Œè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–æ–‡ä»¶çš„å®Œå…¨æ§åˆ¶æƒé™ã€‚\nicacls C:\\è¦ä¿®å¤çš„æ–‡ä»¶è·¯å¾„ /Grant Administrators:F\rå‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡ Windows ä¸‹å‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ–¹å¼ä¸º setx å˜é‡å å˜é‡å€¼ï¼Œå˜é‡å€¼å¸¦ç©ºæ ¼ç­‰ç‰¹æ®Šç¬¦å·çš„ï¼Œç”¨å¼•å·å¼•èµ·æ¥ã€‚\n# é€šè¿‡å‘½ä»¤è¡Œè®¾ç½® Java Home setx JAVA_HOME \u0026#34;C:\\Program Files\\Java\\jdk-11.0.2\u0026#34; # è®¾ç½® GO Path setx GOPATH \u0026#34;D:\\workspace\\go\u0026#34;\r","date":"2024-02-26","id":27,"permalink":"/blog/windows-takeown/","summary":"\u003cp\u003eèƒŒæ™¯ï¼šå…¬å¸ Windows åŠå…¬æœºå—åŸŸæ§å®‰å…¨ç­–ç•¥é™åˆ¶ï¼Œéƒ¨åˆ†æ–‡ä»¶æ— æƒç›´æ¥ä¿®æ”¹ï¼Œå¦å¤–å¼€å‘å¸¸ç”¨çš„è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ä¹Ÿå˜ç°æ— æ³•è®¾ç½®ã€‚\næ­¤é—®é¢˜è§£å†³æ–¹å¼å¦‚ä¸‹ã€‚\u003c/p\u003e\n\u003ch2 id=\"æå‡æ–‡ä»¶æƒé™\"\u003eæå‡æ–‡ä»¶æƒé™\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eç‚¹å‡» Windows + X å¿«æ·é”® â€“ é€‰æ‹©ã€Œå‘½ä»¤æç¤ºç¬¦ï¼ˆç®¡ç†å‘˜ï¼‰ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåœ¨ CDM çª—å£ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-cmd\" data-lang=\"cmd\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etakeown /f C:\\è¦ä¿®å¤çš„æ–‡ä»¶è·¯å¾„\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåœ¨æ‹¿åˆ°æ–‡ä»¶æ‰€æœ‰æƒåï¼Œè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–æ–‡ä»¶çš„å®Œå…¨æ§åˆ¶æƒé™ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-cmd\" data-lang=\"cmd\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eicacls C:\\è¦ä¿®å¤çš„æ–‡ä»¶è·¯å¾„ /Grant Administrators:F\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"å‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡\"\u003eå‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡\u003c/h2\u003e\n\u003cp\u003eWindows ä¸‹å‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ–¹å¼ä¸º \u003ccode\u003esetx å˜é‡å å˜é‡å€¼\u003c/code\u003eï¼Œå˜é‡å€¼å¸¦ç©ºæ ¼ç­‰ç‰¹æ®Šç¬¦å·çš„ï¼Œç”¨å¼•å·å¼•èµ·æ¥ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-cmd\" data-lang=\"cmd\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# é€šè¿‡å‘½ä»¤è¡Œè®¾ç½® Java Home\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esetx JAVA_HOME \u003cspan class=\"s2\"\u003e\u0026#34;C:\\Program Files\\Java\\jdk-11.0.2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# è®¾ç½® GO Path\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esetx GOPATH \u003cspan class=\"s2\"\u003e\u0026#34;D:\\workspace\\go\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e","tags":["Tools"],"title":"Windows ä½¿ç”¨è„šæœ¬æé«˜æƒé™ä»¥åŠè®¾ç½®ç¯å¢ƒå˜é‡"},{"content":"Git ä¸ºä¸åŒç›®å½•é…ç½®ä¸åŒçš„ configï¼Œæ¯”å¦‚åœ¨åŒä¸€ä¸ªç”µè„‘ä¸ŠåŒºåˆ†ä¸ªäººå¼€å‘è´¦å·å’Œå…¬å¸å¼€å‘è´¦å·ï¼Œå¼€æºé¡¹ç›®æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¬å¸é¡¹ç›®æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™æ ·åœ¨æäº¤ä»£ç çš„æ—¶å€™å°±ä¸ä¼šæ··ä¹±ã€‚\nä¸ºè´¦æˆ· B å‡†å¤‡ä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š ~/.gitconfig-bï¼Œå†…å®¹æ ¹æ®éœ€è¦å®šä¹‰ã€‚\n[user] name = userb-name email = userb-email@test.com\rä¿®æ”¹ ~/.gitconfig æ–‡ä»¶ï¼Œå¢åŠ ä»¥ä¸‹é…ç½®ï¼Œå¼•ç”¨ä¸Šé¢åˆ›å»ºçš„é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„å…¶ä¸­çš„è·¯å¾„ç”¨ç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”è·¯å¾„ä»¥ / ç»“å°¾ã€‚\n[includeIf \u0026#34;gitdir:/project/path-b/\u0026#34;] path = /Users/xxxx/.gitconfig-b\rä¿å­˜åï¼Œåœ¨ /project/path-b/ ä¸‹æ–°çš„ä»“åº“éƒ½ä¼šä»¥ .gitconfig-b ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±æäº¤äº†ã€‚\næ³¨æ„å¦‚æœä½¿ç”¨ ssh key æ–¹å¼ï¼Œåœ¨ç”Ÿæˆ key çš„æ—¶å€™ ssh-keygen åå­—æŒ‡å®šæ–‡ä»¶åï¼Œå¤šä¸ª key ä¸è¦è¦†ç›–äº†ã€‚\n","date":"2024-02-26","id":28,"permalink":"/blog/git-multi-user/","summary":"\u003cp\u003eGit ä¸ºä¸åŒç›®å½•é…ç½®ä¸åŒçš„ configï¼Œæ¯”å¦‚åœ¨åŒä¸€ä¸ªç”µè„‘ä¸ŠåŒºåˆ†ä¸ªäººå¼€å‘è´¦å·å’Œå…¬å¸å¼€å‘è´¦å·ï¼Œå¼€æºé¡¹ç›®æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¬å¸é¡¹ç›®æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™æ ·åœ¨æäº¤ä»£ç çš„æ—¶å€™å°±ä¸ä¼šæ··ä¹±ã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºè´¦æˆ· B å‡†å¤‡ä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š ~/.gitconfig-bï¼Œå†…å®¹æ ¹æ®éœ€è¦å®šä¹‰ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-txt\" data-lang=\"txt\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e[user]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name = userb-name\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  email = userb-email@test.com\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eä¿®æ”¹ ~/.gitconfig æ–‡ä»¶ï¼Œå¢åŠ ä»¥ä¸‹é…ç½®ï¼Œå¼•ç”¨ä¸Šé¢åˆ›å»ºçš„é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„å…¶ä¸­çš„è·¯å¾„ç”¨ç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”è·¯å¾„ä»¥ / ç»“å°¾ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-txt\" data-lang=\"txt\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e[includeIf \u0026#34;gitdir:/project/path-b/\u0026#34;]\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epath = /Users/xxxx/.gitconfig-b\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eä¿å­˜åï¼Œåœ¨ /project/path-b/ ä¸‹æ–°çš„ä»“åº“éƒ½ä¼šä»¥ .gitconfig-b ä¸­çš„ç”¨æˆ·åå’Œé‚®ç®±æäº¤äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„å¦‚æœä½¿ç”¨ ssh key æ–¹å¼ï¼Œåœ¨ç”Ÿæˆ key çš„æ—¶å€™ ssh-keygen åå­—æŒ‡å®šæ–‡ä»¶åï¼Œå¤šä¸ª key ä¸è¦è¦†ç›–äº†ã€‚\u003c/p\u003e","tags":["Tools"],"title":"Git SSH å®¢æˆ·ç«¯åŒä¸€æœºå™¨å¤šç”¨æˆ·å¤šä»“åº“é…ç½®"},{"content":"æˆ‘æœ‰ä¸€ä¸ª Spring Boot åº”ç”¨æœåŠ¡ï¼Œæä¾›äº†ä¸€äº›ç®€å•çš„æŸ¥è¯¢æ¥å£ï¼Œæœ¬èº«è¿è¡Œå¾ˆæ­£å¸¸ï¼Œé€šè¿‡ curl æˆ–å…¶ä»– http å®¢æˆ·ç«¯ localhost è¯·æ±‚éƒ½æ²¡æœ‰é—®é¢˜ã€‚\næŸå¤©é€šè¿‡ Traefik ä»£ç†äº†æ­¤æœåŠ¡ï¼Œç»è¿‡ä»£ç†åå†è®¿é—®ï¼ŒæŸä¸ªæ¥å£ä¸€ç›´éƒ½æ˜¯ 500 internal server errorï¼Œå…¶ä»–æ¥å£éƒ½æ²¡æœ‰é—®é¢˜ã€‚é€šè¿‡ tcpdump æŠ“åŒ…å‘ç°ï¼Œåº”ç”¨æœåŠ¡å¹¶æ²¡æœ‰è¿”å›ä»»ä½• 500 é”™è¯¯ï¼Œè€Œä¸”å“åº”æ—¶é—´å’Œ Body ä½“å¤§å°éƒ½å¾ˆæ­£å¸¸ã€‚\næ ¹æ®ç½‘ä¸Šç»éªŒæ’æŸ¥äº† Traefik SSL è¯ä¹¦é—®é¢˜ã€è·¯å¾„é—®é¢˜ã€æ¶ˆæ¯ä½“å¤ªå¤§é—®é¢˜ã€è¯·æ±‚ Header ä¸åˆè§„é—®é¢˜ï¼Œéƒ½ä¸€ä¸€å¦å®šã€‚æœ€åæ— æ„é—´çœ‹äº†ä¸€çœ¼ Response Headerï¼Œå‘ç° Spring Boot åº”ç”¨è¿”å›äº†ä¸¤ä¸ª Transfer-Encoding: chunked Headerã€‚\nå†æ ¹æ®æ­¤ Header æœç´¢ï¼Œå‘ç°æœç„¶æœ‰äººé‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œè¯·å‚è€ƒè¿™å‡ ä¸ªé“¾æ¥ã€‚\nhttps://github.com/traefik/traefik/issues/7741 https://github.com/spring-projects/spring-framework/issues/21523 https://github.com/spring-projects/spring-boot/issues/37646 https://stackoverflow.com/questions/77042701/nginx-upstream-sent-duplicate-header-line-transfer-encoding-chunked-previo ä»ä¸Šé¢é“¾æ¥æè¿°ä¸­å¯çŸ¥ï¼Œä¸ä»… Traefik ä¼šå‡ºç°æ­¤é—®é¢˜ï¼Œnginx åŒ…å«ä»¥ nginx ä¸ºåŸºç¡€çš„ ingress ä¹Ÿä¼šå‡ºç°åŒæ ·é—®é¢˜ï¼Œä¸è¿‡ nginx è¿”å›é”™è¯¯ä¿¡æ¯ç±»ä¼¼ Nginx: upstream sent duplicate header line: \u0026quot;Transfer-Encoding: chunked\u0026quot;, previous value: \u0026quot;Transfer-Encoding: chunkedâ€ ï¼Œè¿”å›é”™è¯¯ç ä¸€èˆ¬æ˜¯ 502 Bad Gatewayã€‚\næˆ‘æ‰€ä½¿ç”¨çš„ Traefik(2.10.6) å’Œ Spring Boot(2.7.17) éƒ½æ˜¯å½“å‰æ—¥æœŸæœ€æ–°ç‰ˆæœ¬ï¼Œç›®å‰ä»ç„¶æœ‰é—®é¢˜ã€‚\nå‡ºç°æ­¤é—®é¢˜çš„ä»£ç ç±»ä¼¼å¦‚ä¸‹ã€‚\nimport org.springframework.beans.factory.annotation.Autowired; import org.springframework.http.ResponseEntity; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.client.RestTemplate; @Controller @RequestMapping(\u0026#34;/status\u0026#34;) public class StatusController { @Autowired private RestTemplate restTemplate; @GetMapping(value = \u0026#34;/test\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; getStatus() { return restTemplate.getForEntity(\u0026#34;http://another-service/actuator/health\u0026#34;, String.class); } }\rä¿®æ”¹ä¸ºå¦‚ä¸‹æ–¹å¼å³è§£å†³é—®é¢˜ã€‚\nimport org.springframework.beans.factory.annotation.Autowired; import org.springframework.http.ResponseEntity; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.client.RestTemplate; @Controller @RequestMapping(\u0026#34;/status\u0026#34;) public class StatusController { @Autowired private RestTemplate restTemplate; @GetMapping(value = \u0026#34;/test\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; getStatus() { // ä¸è¦ç›´æ¥ç”¨ RestTemplate è¿”å›å€¼ï¼Œä½¿ç”¨ ResponseEntity é‡æ–°åŒ…è£…ä¸€æ¬¡ return ResponseEntity.ok(restTemplate.getForEntity(\u0026#34;http://another-service/actuator/health\u0026#34;, String.class)); } }\rå¦å¤–æ ¹æ® GitHub Issue åé¦ˆï¼Œä¸ä»… RestTemplateï¼Œä½¿ç”¨ OpenFeign ä¹Ÿä¼šè§¦å‘ä»¥ä¸Šé—®é¢˜ã€‚\nåŒç†ï¼Œå¦‚æœå¤§å®¶é‡åˆ°æœåŠ¡ç»è¿‡ Nginxã€Traefik ä»£ç†åå‡ºç°çš„ç–‘éš¾é—®é¢˜ï¼Œå¯å…³æ³¨ä¸‹ Response Header æ˜¯å¦æœ‰å¼‚å¸¸ã€‚\n","date":"2023-11-26","id":29,"permalink":"/blog/duplicate-transfer-encoding-chunked/","summary":"\u003cp\u003eæˆ‘æœ‰ä¸€ä¸ª Spring Boot åº”ç”¨æœåŠ¡ï¼Œæä¾›äº†ä¸€äº›ç®€å•çš„æŸ¥è¯¢æ¥å£ï¼Œæœ¬èº«è¿è¡Œå¾ˆæ­£å¸¸ï¼Œé€šè¿‡ curl æˆ–å…¶ä»– http å®¢æˆ·ç«¯ localhost è¯·æ±‚éƒ½æ²¡æœ‰é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eæŸå¤©é€šè¿‡ Traefik ä»£ç†äº†æ­¤æœåŠ¡ï¼Œç»è¿‡ä»£ç†åå†è®¿é—®ï¼ŒæŸä¸ªæ¥å£ä¸€ç›´éƒ½æ˜¯ \u003ccode\u003e500 internal server error\u003c/code\u003eï¼Œå…¶ä»–æ¥å£éƒ½æ²¡æœ‰é—®é¢˜ã€‚é€šè¿‡ tcpdump æŠ“åŒ…å‘ç°ï¼Œåº”ç”¨æœåŠ¡å¹¶æ²¡æœ‰è¿”å›ä»»ä½• 500 é”™è¯¯ï¼Œè€Œä¸”å“åº”æ—¶é—´å’Œ Body ä½“å¤§å°éƒ½å¾ˆæ­£å¸¸ã€‚\u003c/p\u003e\n\u003cp\u003eæ ¹æ®ç½‘ä¸Šç»éªŒæ’æŸ¥äº† Traefik SSL è¯ä¹¦é—®é¢˜ã€è·¯å¾„é—®é¢˜ã€æ¶ˆæ¯ä½“å¤ªå¤§é—®é¢˜ã€è¯·æ±‚ Header ä¸åˆè§„é—®é¢˜ï¼Œéƒ½ä¸€ä¸€å¦å®šã€‚æœ€åæ— æ„é—´çœ‹äº†ä¸€çœ¼ Response Headerï¼Œå‘ç° Spring Boot åº”ç”¨è¿”å›äº†ä¸¤ä¸ª \u003ccode\u003eTransfer-Encoding: chunked\u003c/code\u003e Headerã€‚\u003c/p\u003e\n\u003cp\u003eå†æ ¹æ®æ­¤ Header æœç´¢ï¼Œå‘ç°æœç„¶æœ‰äººé‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œè¯·å‚è€ƒè¿™å‡ ä¸ªé“¾æ¥ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/traefik/traefik/issues/7741\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/traefik/traefik/issues/7741\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/spring-projects/spring-framework/issues/21523\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/spring-projects/spring-framework/issues/21523\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/spring-projects/spring-boot/issues/37646\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/spring-projects/spring-boot/issues/37646\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/77042701/nginx-upstream-sent-duplicate-header-line-transfer-encoding-chunked-previo\" target=\"_blank\" rel=\"noopener\"\u003ehttps://stackoverflow.com/questions/77042701/nginx-upstream-sent-duplicate-header-line-transfer-encoding-chunked-previo\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»ä¸Šé¢é“¾æ¥æè¿°ä¸­å¯çŸ¥ï¼Œä¸ä»… Traefik ä¼šå‡ºç°æ­¤é—®é¢˜ï¼Œnginx åŒ…å«ä»¥ nginx ä¸ºåŸºç¡€çš„ ingress ä¹Ÿä¼šå‡ºç°åŒæ ·é—®é¢˜ï¼Œä¸è¿‡ nginx è¿”å›é”™è¯¯ä¿¡æ¯ç±»ä¼¼ \u003ccode\u003eNginx: upstream sent duplicate header line: \u0026quot;Transfer-Encoding: chunked\u0026quot;, previous value: \u0026quot;Transfer-Encoding: chunkedâ€\u003c/code\u003e ï¼Œè¿”å›é”™è¯¯ç ä¸€èˆ¬æ˜¯ 502 Bad Gatewayã€‚\u003c/p\u003e","tags":["Java"],"title":"é‡å¤ Transfer-Encoding Response Header å¼•èµ·çš„ Traefik ä»£ç†æœåŠ¡ 500 é—®é¢˜"},{"content":"","date":"2023-09-07","id":30,"permalink":"/blog/","summary":"å«æ˜Ÿå®éªŒå®¤æŠ€æœ¯åšå®¢ï¼Œä¸€äº›å…³äº AIOpsã€DataOpsã€DevOpsã€GitOpsã€FinOps ã€äº‘åŸç”Ÿã€å¹³å°å·¥ç¨‹ã€Java å¼€å‘çš„æŠ€æœ¯åˆ†äº«ï¼Œå³ä¸Šè§’ç‚¹æœç´¢æœä½ æ‰€æƒ³ã€‚","tags":[],"title":"Blog"},{"content":"é—®é¢˜æè¿°ï¼š\nä¸€ä¸ª Java åº”ç”¨è·‘åœ¨ K8S å®¹å™¨å†…ï¼ŒPod å†…åªæœ‰ Java è¿™ä¸€ä¸ªè¿›ç¨‹ã€‚åº”ç”¨è·‘äº†ä¸€æ®µæ—¶é—´åï¼ŒCPUã€å†…å­˜å ç”¨éƒ½ä¸é«˜ï¼Œä½†æ˜¯å´å‡ºç°ä»¥ä¸‹ OutOfMemoryError é”™è¯¯ã€‚\nException in thread \u0026#34;slow-fetch-15\u0026#34; java.lang.OutOfMemoryError: unable to create new native thread 428 at java.lang.Thread.start0(Native Method) 429 at java.lang.Thread.start(Thread.java:719) 430 at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:957) 431 at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:1025) 432 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167) 433 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) è¿›å…¥ Pod å†…ï¼Œå°è¯•æ‰§è¡Œä»»ä½•æ“ä½œï¼Œåˆä¼šå‡ºç° unable to start container process é”™è¯¯ã€‚\nä¸€å¼€å§‹æ€€ç–‘æ˜¯å†…å­˜ä¸è¶³ï¼Œè°ƒå¤§äº†å†…å­˜ï¼ŒåŒæ—¶ä¹Ÿç¼©å°äº† Java çš„ xssï¼Œéƒ½ä¸èµ·ä½œç”¨ã€‚\nçœŸå®åŸå› ï¼š K8S å®¹å™¨é™åˆ¶äº† PID æ•°ï¼Œæ— æ³•åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚å…³äº K8S PID limitï¼Œ å¯å‚è€ƒæ­¤èµ„æ–™ï¼šhttps://kubernetes.io/zh-cn/docs/concepts/policy/pid-limiting/ .\nåœ¨ Pod å†…æŸ¥çœ‹å½“å‰ PID é™åˆ¶æ–¹å¼ï¼š\n# cgroup v1 ç‰ˆæœ¬ï¼ŒæŸ¥çœ‹æœ€å¤§å€¼å’Œå½“å‰å€¼ cat /sys/fs/cgroup/pids/pids.max cat /sys/fs/cgroup/pids/pids.current # cgroup v2 ç‰ˆæœ¬ cat /sys/fs/cgroup/$(cat /proc/self/cgroup | grep -o \u0026#39;[^:]*$\u0026#39;)/pids.max cat /sys/fs/cgroup/$(cat /proc/self/cgroup | grep -o \u0026#39;[^:]*$\u0026#39;)/pids.current\rä½†æ˜¯ï¼ŒPID ä¸ºä»€ä¹ˆä¼šè¶…å‘¢ï¼ŒPod å†…åªæœ‰ä¸€ä¸ª Java è¿›ç¨‹ï¼ŒPID æ•°ä¸åº”è¯¥æ˜¯ 1 ä¸ªå—ï¼Œè¿™ä¸ª PID é™åˆ¶ä¸ºä»€ä¹ˆå½±å“äº†çº¿ç¨‹ã€‚\nç®€å•æ¥è®²ï¼Œåœ¨ Linux ä¸­çº¿ç¨‹å…¶å®æ˜¯é€šè¿‡è½»é‡çº§è¿›ç¨‹å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ LWP(light weight process)ï¼Œå› æ­¤åœ¨ Linux ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ª PIDï¼Œæ¢å¥è¯è¯´ï¼Œæ“ä½œç³»ç»ŸåŸç†ä¸­çš„çº¿ç¨‹ï¼Œå¯¹åº”çš„å…¶å®æ˜¯ Linux ä¸­çš„è¿›ç¨‹ï¼ˆå³ LWPï¼‰ï¼Œå› æ­¤ Linux å†…æ ¸ä¸­çš„ PID å¯¹åº”çš„å…¶å®æ˜¯åŸç†ä¸­çš„ TIDã€‚\nåœ¨ Pod å†…é€šè¿‡ top -p pid -H æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€åˆ—æ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…äº†ä¸€ä¸ª PIDã€‚\nPID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 101 root 20 0 8622220 5.1g 15640 S 0.3 8.1 0:16.29 VM Thread 112 root 20 0 8622220 5.1g 15640 S 0.3 8.1 0:46.13 C2 CompilerThre 113 root 20 0 8622220 5.1g 15640 S 0.3 8.1 0:39.62 C1 CompilerThre 846 root 20 0 8622220 5.1g 15640 S 0.3 8.1 0:00.64 NettyClientSele 850 root 20 0 8622220 5.1g 15640 S 0.3 8.1 0:00.54 NettyClientWork 1 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.27 java 89 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.99 java 90 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:03.29 java 91 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:03.27 java 92 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:03.26 java 93 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:03.30 java 94 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:01.43 java 95 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.11 java 96 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.12 java 97 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.16 java 98 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.31 java 99 root 20 0 8622220 5.1g 15640 S 0.0 8.1 0:00.32 java ä¸ºä»€ä¹ˆè¦é™åˆ¶ POD PID æ•°ã€‚ç±»ä¼¼ CPU å’Œå†…å­˜ï¼Œè¿›ç¨‹ IDï¼ˆPIDï¼‰ä¹Ÿæ˜¯èŠ‚ç‚¹ä¸Šçš„ä¸€ç§åŸºç¡€èµ„æºï¼Œå¾ˆå®¹æ˜“å°±ä¼šåœ¨å°šæœªè¶…å‡ºå…¶å®ƒèµ„æºçº¦æŸçš„æ—¶å€™å°±å·²ç»è§¦åŠä»»åŠ¡ä¸ªæ•°ä¸Šé™ï¼Œè¿›è€Œå¯¼è‡´å®¿ä¸»æœºä¸ç¨³å®šã€‚æŸæ—¥æŸä¸ªä¸èµ·çœ¼çš„æœåŠ¡å› ä¸ºæ— èŠ‚åˆ¶åˆ›å»ºäº† N å¤šçº¿ç¨‹ï¼ŒæŠŠæ•´ä¸ªå®¿ä¸»æœºæ‰“æŒ‚äº†ï¼Œè°ç—›è°çŸ¥é“å•Šã€‚\n","date":"2023-09-07","id":31,"permalink":"/blog/k8s-pid-limiting-oom/","summary":"\u003cp\u003eé—®é¢˜æè¿°ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ª Java åº”ç”¨è·‘åœ¨ K8S å®¹å™¨å†…ï¼ŒPod å†…åªæœ‰ Java è¿™ä¸€ä¸ªè¿›ç¨‹ã€‚åº”ç”¨è·‘äº†ä¸€æ®µæ—¶é—´åï¼ŒCPUã€å†…å­˜å ç”¨éƒ½ä¸é«˜ï¼Œä½†æ˜¯å´å‡ºç°ä»¥ä¸‹ OutOfMemoryError é”™è¯¯ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003eException in thread \u0026#34;slow-fetch-15\u0026#34; java.lang.OutOfMemoryError: unable to create new native thread\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e428  at java.lang.Thread.start0(Native Method)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e429  at java.lang.Thread.start(Thread.java:719)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e430  at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:957)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e431  at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:1025)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e432  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e433  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eè¿›å…¥ Pod å†…ï¼Œå°è¯•æ‰§è¡Œä»»ä½•æ“ä½œï¼Œåˆä¼šå‡ºç° \u003ccode\u003eunable to start container process\u003c/code\u003e é”™è¯¯ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€å¼€å§‹æ€€ç–‘æ˜¯å†…å­˜ä¸è¶³ï¼Œè°ƒå¤§äº†å†…å­˜ï¼ŒåŒæ—¶ä¹Ÿç¼©å°äº† Java çš„ \u003ccode\u003exss\u003c/code\u003eï¼Œéƒ½ä¸èµ·ä½œç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eçœŸå®åŸå› ï¼š K8S å®¹å™¨é™åˆ¶äº† PID æ•°ï¼Œæ— æ³•åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚å…³äº K8S PID limitï¼Œ å¯å‚è€ƒæ­¤èµ„æ–™ï¼š\u003ca href=\"https://kubernetes.io/zh-cn/docs/concepts/policy/pid-limiting/\" target=\"_blank\" rel=\"noopener\"\u003ehttps://kubernetes.io/zh-cn/docs/concepts/policy/pid-limiting/\u003c/a\u003e\n.\u003c/p\u003e\n\u003cp\u003eåœ¨ Pod å†…æŸ¥çœ‹å½“å‰ PID é™åˆ¶æ–¹å¼ï¼š\u003c/p\u003e","tags":["k8s","Java"],"title":"K8S å®¹å™¨ PID é™åˆ¶å¼•èµ·çš„ Java OutOfMemoryError"},{"content":"æ•…äº‹èƒŒæ™¯ï¼š\nä¸€ä¸ª K8S Podï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª Java è¿›ç¨‹ï¼ŒK8S request å’Œ limit memory éƒ½æ˜¯ 2Gï¼ŒJava è¿›ç¨‹æ ¸å¿ƒå‚æ•°åŒ…æ‹¬ï¼š-XX:+UseZGC -Xmx1024m -Xms768mã€‚\næœåŠ¡å¯åŠ¨ä¸€æ®µæ—¶é—´åï¼ŒæŸ¥çœ‹ Grafana ç›‘æ§æ•°æ®ï¼ŒPod å†…å­˜ä½¿ç”¨é‡çº¦ 1.5Gï¼ŒJVM å†…å­˜ä½¿ç”¨é‡çº¦ 500Mï¼Œé€šè¿‡ jvm dump åˆ†ææ²¡æœ‰ä»»ä½•å¤§å¯¹è±¡ï¼Œè¿è¡Œä¸‰äº”å¤©åå‡ºç° K8S Container OOMã€‚\né¦–å…ˆåŒºåˆ†ä¸‹ Container OOM å’Œ Jvm OOMï¼ŒContainer OOM æ˜¯ Pod å†…è¿›ç¨‹ç”³è¯·å†…å­˜å¤§çº¦ K8S Limit æ‰€è‡´ã€‚\né—®é¢˜æ¥äº†ï¼š\nPod 2G å†…å­˜ï¼ŒJVM è®¾ç½®äº† Xmx 1Gï¼Œå·²ç»é¢„ç•™äº† 1G å†…å­˜ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼š Container OOMï¼Œè¿™é¢„ç•™çš„ 1G å†…å­˜è¢«è°åƒäº†ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼ˆæ—  Container OOMï¼‰ï¼ŒGrafana çœ‹åˆ°çš„ç›‘æ§æ•°æ®ï¼ŒPod å†…å­˜ä½¿ç”¨é‡ 1.5Gï¼Œ JVM å†…å­˜ä½¿ç”¨é‡ 500Mï¼Œå·®åˆ«ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤§ã€‚ Pod å†…å­˜ä½¿ç”¨é‡ä¸ºä»€ä¹ˆè¶…è¿‡ Xmx é™åˆ¶ã€‚ Grafana ç›‘æ§å›¾ã€‚\nç»Ÿè®¡æŒ‡æ ‡ Pod å†…å­˜ä½¿ç”¨é‡ç»Ÿè®¡çš„æŒ‡æ ‡æ˜¯ container_memory_working_set_bytesï¼š\ncontainer_memory_usage_bytes = container_memory_rss + container_memory_cache + kernel memory container_memory_working_set_bytes = container_memory_usage_bytes - total_inactive_fileï¼ˆæœªæ¿€æ´»çš„åŒ¿åç¼“å­˜é¡µï¼‰ container_memory_working_set_bytes æ˜¯å®¹å™¨çœŸå®ä½¿ç”¨çš„å†…å­˜é‡ï¼Œä¹Ÿæ˜¯èµ„æºé™åˆ¶ limit æ—¶çš„ OOM åˆ¤æ–­ä¾æ®ã€‚\nå¦å¤–æ³¨æ„ cgroup ç‰ˆæœ¬å·®å¼‚ï¼š container_memory_cache reflects cache (cgroup v1) or file (cgroup v2) entry in memory.stat.\nJVM å†…å­˜ä½¿ç”¨é‡ç»Ÿè®¡çš„æŒ‡æ ‡æ˜¯ jvm_memory_bytes_usedï¼š heapã€non-heap ä»¥åŠå…¶ä»– çœŸå®ç”¨é‡æ€»å’Œã€‚ä¸‹é¢è§£é‡Šå…¶ä»–ã€‚\né¦–å…ˆè¯´ç»“è®ºï¼šåœ¨ POD å†…ï¼Œé€šè¿‡ topã€free çœ‹åˆ°çš„æŒ‡æ ‡éƒ½æ˜¯ä¸å‡†ç¡®çš„ï¼Œä¸ç”¨çœ‹äº†ï¼Œå¦‚æœè¦çœ‹çœŸå®çš„æ•°æ®ä»¥ cgroup ä¸ºå‡†ã€‚\ncontainer_memory_working_set_bytes æŒ‡æ ‡æ¥è‡ª cadvisorï¼Œcadvisor æ•°æ®æ¥æº cgroupï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹æ–‡ä»¶è·å–çœŸå®çš„å†…å­˜æƒ…å†µã€‚\n# cgroup v2 æ–‡ä»¶åœ°å€ ll /sys/fs/cgroup/memory.* -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.current -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.events -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.events.local -rw-r--r-- 1 root root 0 Jan 7 11:50 /sys/fs/cgroup/memory.high -rw-r--r-- 1 root root 0 Jan 7 11:50 /sys/fs/cgroup/memory.low -rw-r--r-- 1 root root 0 Jan 7 11:50 /sys/fs/cgroup/memory.max -rw-r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.min -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.numa_stat -rw-r--r-- 1 root root 0 Jan 7 11:50 /sys/fs/cgroup/memory.oom.group -rw-r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.pressure -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.stat -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.swap.current -r--r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.swap.events -rw-r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.swap.high -rw-r--r-- 1 root root 0 Jan 6 16:25 /sys/fs/cgroup/memory.swap.max JVM å…³äºä½¿ç”¨é‡å’Œæäº¤é‡çš„è§£é‡Šã€‚\nUsed Sizeï¼šThe used space is the amount of memory that is currently occupied by Java objects. å½“å‰å®é™…çœŸçš„ç”¨ç€çš„å†…å­˜ï¼Œæ¯ä¸ª bit éƒ½å¯¹åº”äº†æœ‰å€¼çš„ã€‚\nCommitted Sizeï¼šThe committed size is the amount of memory guaranteed to be available for use by the Java virtual machine. æ“ä½œç³»ç»Ÿå‘ JVM ä¿è¯å¯ç”¨çš„å†…å­˜å¤§å°ï¼Œæˆ–è€…è¯´ JVM å‘æ“ä½œç³»ç»Ÿå·²ç»è¦çš„å†…å­˜ã€‚ç«™åœ¨æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œå°±æ˜¯å·²ç»åˆ†å‡ºå»ï¼ˆå ç”¨ï¼‰çš„å†…å­˜ï¼Œä¿è¯ç»™ JVM ç”¨äº†ï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½ç”¨äº†ã€‚ ç”±äºæ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ˜¯æƒ°æ€§çš„ï¼Œå¯¹äºå·²ç”³è¯·çš„å†…å­˜è™½ç„¶ä¼šåˆ†é…åœ°å€ç©ºé—´ï¼Œä½†å¹¶ä¸ä¼šç›´æ¥å ç”¨ç‰©ç†å†…å­˜ï¼ŒçœŸæ­£ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šæ˜ å°„åˆ°å®é™…çš„ç‰©ç†å†…å­˜ï¼Œæ‰€ä»¥ committed \u0026gt; res ä¹Ÿæ˜¯å¾ˆå¯èƒ½çš„ã€‚\nJava è¿›ç¨‹å†…å­˜åˆ†æ Pod çš„å†…å­˜ä½¿ç”¨é‡ 1.5Gï¼Œéƒ½åŒ…å«å“ªäº›ã€‚\nkernel memory ä¸º 0ï¼ŒCache çº¦ 1100Mï¼Œrss çº¦ 650Mï¼Œinactive_file çº¦ 200Mã€‚å¯ä»¥çœ‹åˆ° Cache æ¯”è¾ƒå¤§ï¼Œå› ä¸ºè¿™ä¸ªæœåŠ¡æ¯”è¾ƒç‰¹æ®Šæœ‰å¾ˆå¤šæ–‡ä»¶æ“ä½œã€‚\n# cgroup v2 å˜é‡å˜äº† cat /sys/fs/cgroup/memory.stat anon 846118912 file 2321530880 kernel_stack 10895360 pagetables 15523840 percpu 0 sock 1212416 shmem 1933574144 file_mapped 1870290944 file_dirty 12288 file_writeback 0 swapcached 0 anon_thp 0 file_thp 0 shmem_thp 0 inactive_anon 2602876928 active_anon 176771072 inactive_file 188608512 active_file 199348224 unevictable 0 slab_reclaimable 11839688 slab_unreclaimable 7409400 slab 19249088 workingset_refault_anon 0 workingset_refault_file 318 workingset_activate_anon 0 workingset_activate_file 95 workingset_restore_anon 0 workingset_restore_file 0 workingset_nodereclaim 0 pgfault 2563565 pgmajfault 15 pgrefill 14672 pgscan 25468 pgsteal 25468 pgactivate 106436 pgdeactivate 14672 pglazyfree 0 pglazyfreed 0 thp_fault_alloc 0 thp_collapse_alloc 0 é€šè¿‡ Java è‡ªå¸¦çš„ Native Memory Tracking çœ‹ä¸‹å†…å­˜æäº¤é‡ã€‚\n# Java å¯åŠ¨æ—¶å…ˆæ‰“å¼€ NativeMemoryTrackingï¼Œé»˜è®¤æ˜¯å…³é—­çš„ã€‚æ³¨æ„ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒé•¿æœŸå¼€å¯ï¼Œæœ‰æ€§èƒ½æŸå¤± java -XX:NativeMemoryTracking=detail -jar # æŸ¥çœ‹è¯¦æƒ… jcmd $(pgrep java) VM.native_memory detail scale=MB # æŸ¥çœ‹ summary jcmd $(pgrep java) VM.native_memory summary scale=MB # åˆ›å»ºåŸºçº¿ï¼Œç„¶ååˆ†ä¸åŒæ—¶é—´è¿›è¡Œ diff æŸ¥çœ‹å˜åŒ– jcmd $(pgrep java) VM.native_memory baseline jcmd $(pgrep java) VM.native_memory detail.diff scale=MB jcmd $(pgrep java) VM.native_memory summary.diff scale=MB\ré€šè¿‡ Native Memory Tracking è¿½è¸ªåˆ°çš„è¯¦æƒ…å¤§è‡´å¦‚ä¸‹ï¼Œå…³æ³¨å…¶ä¸­æ¯ä¸€é¡¹ committed å€¼ã€‚\nNative Memory Tracking: (Omitting categories weighting less than 1MB) Total: reserved=68975MB, committed=1040MB - Java Heap (reserved=58944MB, committed=646MB) (mmap: reserved=58944MB, committed=646MB) - Class (reserved=1027MB, committed=15MB) (classes #19551) #åŠ è½½ç±»çš„ä¸ªæ•° ( instance classes #18354, array classes #1197) (malloc=3MB #63653) (mmap: reserved=1024MB, committed=12MB) ( Metadata: ) ( reserved=96MB, committed=94MB) ( used=93MB) ( waste=0MB =0.40%) ( Class space:) ( reserved=1024MB, committed=12MB) ( used=11MB) ( waste=1MB =4.63%) - Thread (reserved=337MB, committed=37MB) (thread #335) #çº¿ç¨‹çš„ä¸ªæ•° (stack: reserved=336MB, committed=36MB) (malloc=1MB #2018) - Code (reserved=248MB, committed=86MB) (malloc=6MB #24750) (mmap: reserved=242MB, committed=80MB) - GC (reserved=8243MB, committed=83MB) (malloc=19MB #45814) (mmap: reserved=8224MB, committed=64MB) - Compiler (reserved=3MB, committed=3MB) (malloc=3MB #2212) - Internal (reserved=7MB, committed=7MB) (malloc=7MB #31683) - Other (reserved=18MB, committed=18MB) (malloc=18MB #663) - Symbol (reserved=19MB, committed=19MB) (malloc=17MB #502325) (arena=2MB #1) - Native Memory Tracking (reserved=12MB, committed=12MB) (malloc=1MB #8073) (tracking overhead=11MB) - Shared class space (reserved=12MB, committed=12MB) (mmap: reserved=12MB, committed=12MB) - Module (reserved=1MB, committed=1MB) (malloc=1MB #4996) - Synchronization (reserved=1MB, committed=1MB) (malloc=1MB #2482) - Metaspace (reserved=97MB, committed=94MB) (malloc=1MB #662) (mmap: reserved=96MB, committed=94MB) - Object Monitors (reserved=8MB, committed=8MB) (malloc=8MB #39137) å…ˆè§£é‡Šä¸‹å†…å­˜å‚æ•°æ„ä¹‰ï¼š\nreservedï¼šJVM å‘æ“ä½œç³»ç»Ÿé¢„çº¦çš„è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´ï¼Œä»…æ˜¯åœ°å€ç©ºé—´é¢„ç•™ï¼Œä¸æ¶ˆè€—ç‰©ç†èµ„æºï¼Œé˜²æ­¢å…¶ä»–è¿›ç¨‹ä½¿ç”¨è¿™æ®µåœ°å€èŒƒå›´ï¼Œç±»ä¼¼\u0026#34;åœŸåœ°è§„åˆ’è®¸å¯\u0026#34;ï¼Œä½†å°šæœªå»ºæˆ¿ã€‚ committedï¼šJVM å®é™…åˆ†é…çš„ç‰©ç†å†…å­˜ï¼ˆRAM + Swapï¼‰ï¼ŒçœŸå®æ¶ˆè€—ç³»ç»Ÿå†…å­˜èµ„æºã€‚ è™šæ‹Ÿåœ°å€ç©ºé—´ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ reserved=16MB â”‚ â† æ•´ä¸ªé¢„çº¦åŒºåŸŸ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ committed=13MBâ”‚ æœªä½¿ç”¨ 3MB â”‚ â† å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Heap Heap æ˜¯ Java è¿›ç¨‹ä¸­ä½¿ç”¨é‡æœ€å¤§çš„ä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ˜¯æœ€å¸¸é‡åˆ°å†…å­˜é—®é¢˜çš„éƒ¨åˆ†ï¼ŒJava ä¹Ÿæä¾›äº†å¾ˆå¤šç›¸å…³å·¥å…·æ¥æ’æŸ¥å †å†…å­˜æ³„éœ²é—®é¢˜ï¼Œè¿™é‡Œä¸è¯¦ç»†å±•å¼€ã€‚Heap ä¸ RSS ç›¸å…³çš„å‡ ä¸ªé‡è¦ JVM å‚æ•°å¦‚ä¸‹ï¼š Xmsï¼šJava Heap åˆå§‹å†…å­˜å¤§å°ã€‚ï¼ˆç›®å‰æˆ‘ä»¬ç”¨çš„ç™¾åˆ†æ¯”æ§åˆ¶ï¼ŒMaxRAMPercentage) Xmxï¼šJava Heap çš„æœ€å¤§å¤§å°ã€‚(InitialRAMPercentage) XX:+UseAdaptiveSizePolicyï¼šæ˜¯å¦å¼€å¯è‡ªé€‚åº”å¤§å°ç­–ç•¥ã€‚å¼€å¯åï¼ŒJVM å°†åŠ¨æ€åˆ¤æ–­æ˜¯å¦è°ƒæ•´ Heap sizeï¼Œæ¥é™ä½ç³»ç»Ÿè´Ÿè½½ã€‚\nMetaspace Metaspace ä¸»è¦åŒ…å«æ–¹æ³•çš„å­—èŠ‚ç ï¼ŒClass å¯¹è±¡ï¼Œå¸¸é‡æ± ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè®°è½½çš„ç±»è¶Šå¤šï¼ŒMetaspace ä½¿ç”¨çš„å†…å­˜è¶Šå¤šã€‚ä¸ Metaspace ç›¸å…³çš„ JVM å‚æ•°æœ‰ï¼š XX:MaxMetaspaceSize: æœ€å¤§çš„ Metaspace å¤§å°é™åˆ¶ã€é»˜è®¤æ— é™åˆ¶ã€‘ XX:MetaspaceSize=64M: åˆå§‹çš„ Metaspace å¤§å°ã€‚å¦‚æœ Metaspace ç©ºé—´ä¸è¶³ï¼Œå°†ä¼šè§¦å‘ Full GCã€‚ ç±»ç©ºé—´å ç”¨è¯„ä¼°ï¼Œç»™ä¸¤ä¸ªæ•°å­—å¯ä¾›å‚è€ƒï¼š10K ä¸ªç±»çº¦ 90Mï¼Œ15K ä¸ªç±»çº¦ 100Mã€‚ ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼šåˆ†é…ç»™ä¸€ä¸ªç±»çš„ç©ºé—´ï¼Œæ˜¯å½’å±äºè¿™ä¸ªç±»çš„ç±»åŠ è½½å™¨çš„ï¼Œåªæœ‰å½“è¿™ä¸ªç±»åŠ è½½å™¨å¸è½½çš„æ—¶å€™ï¼Œè¿™ä¸ªç©ºé—´æ‰ä¼šè¢«é‡Šæ”¾ã€‚é‡Šæ”¾ Metaspace çš„ç©ºé—´ï¼Œå¹¶ä¸æ„å‘³ç€å°†è¿™éƒ¨åˆ†ç©ºé—´è¿˜ç»™ç³»ç»Ÿå†…å­˜ï¼Œè¿™éƒ¨åˆ†ç©ºé—´é€šå¸¸ä¼šè¢« JVM ä¿ç•™ä¸‹æ¥ã€‚ æ‰©å±•ï¼šå‚è€ƒèµ„æ–™ä¸­çš„Java Metaspace è¯¦è§£ï¼Œè¿™é‡Œå®Œç¾è§£é‡Š Metaspaceã€Compressed Class Space ç­‰ã€‚\nThread NMT ä¸­æ˜¾ç¤ºçš„ Thread éƒ¨åˆ†å†…å­˜ä¸çº¿ç¨‹æ•°ä¸ -Xss å‚æ•°æˆæ­£æ¯”ï¼Œä¸€èˆ¬æ¥è¯´ committed å†…å­˜ç­‰äº Xss *çº¿ç¨‹æ•° ã€‚\nCode JIT åŠ¨æ€ç¼–è¯‘äº§ç”Ÿçš„ Code å ç”¨çš„å†…å­˜ã€‚è¿™éƒ¨åˆ†å†…å­˜ä¸»è¦ç”±-XX:ReservedCodeCacheSize å‚æ•°è¿›è¡Œæ§åˆ¶ã€‚\nInternal Internal åŒ…å«å‘½ä»¤è¡Œè§£æå™¨ä½¿ç”¨çš„å†…å­˜ã€JVMTIã€PerfData ä»¥åŠ Unsafe åˆ†é…çš„å†…å­˜ç­‰ç­‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUnsafe_AllocateMemory åˆ†é…çš„å†…å­˜åœ¨ JDK11 ä¹‹å‰ï¼Œåœ¨ NMT ä¸­éƒ½å±äº Internalï¼Œä½†æ˜¯åœ¨ JDK11 ä¹‹åè¢« NMT å½’å±åˆ° Other ä¸­ã€‚\nSymbol Symbol ä¸º JVM ä¸­çš„ç¬¦å·è¡¨æ‰€ä½¿ç”¨çš„å†…å­˜ï¼ŒHotSpot ä¸­ç¬¦å·è¡¨ä¸»è¦æœ‰ä¸¤ç§ï¼šSymbolTable ä¸ StringTableã€‚ å¤§å®¶éƒ½çŸ¥é“ Java çš„ç±»åœ¨ç¼–è¯‘ä¹‹åä¼šç”Ÿæˆ Constant pool å¸¸é‡æ± ï¼Œå¸¸é‡æ± ä¸­ä¼šæœ‰å¾ˆå¤šçš„å­—ç¬¦ä¸²å¸¸é‡ï¼ŒHotSpot å‡ºäºèŠ‚çœå†…å­˜çš„è€ƒè™‘ï¼Œå¾€å¾€ä¼šå°†è¿™äº›å­—ç¬¦ä¸²å¸¸é‡ä½œä¸ºä¸€ä¸ª Symbol å¯¹è±¡å­˜å…¥ä¸€ä¸ª HashTable çš„è¡¨ç»“æ„ä¸­å³ SymbolTableï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²å¯ä»¥åœ¨ SymbolTable ä¸­ lookupï¼ˆSymbolTable::lookupï¼‰åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šé‡ç”¨è¯¥å­—ç¬¦ä¸²ï¼Œå¦‚æœæ‰¾ä¸åˆ°æ‰ä¼šåˆ›å»ºæ–°çš„ Symbolï¼ˆSymbolTable::new_symbolï¼‰ã€‚ å½“ç„¶é™¤äº† SymbolTableï¼Œè¿˜æœ‰å®ƒçš„åŒèƒèƒå…„å¼Ÿ StringTableï¼ˆStringTable ç»“æ„ä¸ SymbolTable åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯ HashTable çš„ç»“æ„ï¼‰ï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚å¹³æ—¶åšä¸šåŠ¡å¼€å‘å’Œ StringTable æ‰“äº¤é“ä¼šæ›´å¤šä¸€äº›ï¼ŒHotSpot ä¹Ÿæ˜¯åŸºäºèŠ‚çœå†…å­˜çš„è€ƒè™‘ä¸ºæˆ‘ä»¬æä¾›äº† StringTableï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ String.intern çš„æ–¹å¼å°†å­—ç¬¦ä¸²æ”¾å…¥ StringTable ä¸­æ¥é‡ç”¨å­—ç¬¦ä¸²ã€‚\nNative Memory Tracking Native Memory Tracking ä½¿ç”¨çš„å†…å­˜å°±æ˜¯ JVM è¿›ç¨‹å¼€å¯ NMT åŠŸèƒ½åï¼ŒNMT åŠŸèƒ½è‡ªèº«æ‰€ç”³è¯·çš„å†…å­˜ã€‚\nè§‚å¯Ÿä¸Šé¢å‡ ä¸ªåŒºåŸŸçš„åˆ†é…ï¼Œæ²¡æœ‰æ˜æ˜¾çš„å¼‚å¸¸ã€‚\nNMT è¿½è¸ªåˆ°çš„ æ˜¯ Committedï¼Œä¸ä¸€å®šæ˜¯ Usedï¼ŒNMT å’Œ cadvisor æ²¡æœ‰æ‰¾åˆ°å¿…ç„¶çš„å¯¹åº”çš„å…³ç³»ã€‚å¯ä»¥å‚è€ƒ RSSï¼Œcadvisor è¿½è¸ªåˆ° RSS æ˜¯ 650Mï¼ŒJVM Used æ˜¯ 500Mï¼Œè¿˜æœ‰å¤§çº¦ 150M æµ®åŠ¨åˆ°å“ªé‡Œå»äº†ã€‚\nå› ä¸º NMT åªèƒ½ Track JVM è‡ªèº«çš„å†…å­˜åˆ†é…æƒ…å†µï¼Œæ¯”å¦‚ï¼šHeap å†…å­˜åˆ†é…ï¼Œdirect byte buffer ç­‰ã€‚æ— æ³•è¿½è¸ªçš„æƒ…å†µä¸»è¦åŒ…æ‹¬ï¼š\nä½¿ç”¨ JNI è°ƒç”¨çš„ä¸€äº›ç¬¬ä¸‰æ–¹ native code ç”³è¯·çš„å†…å­˜ï¼Œæ¯”å¦‚ä½¿ç”¨ System.Loadlibrary åŠ è½½çš„ä¸€äº›åº“ã€‚ æ ‡å‡†çš„ Java Class Libraryï¼Œå…¸å‹çš„ï¼Œå¦‚æ–‡ä»¶æµç­‰ç›¸å…³æ“ä½œï¼ˆå¦‚ï¼šFiles.listã€ZipInputStream å’Œ DirectoryStream ç­‰ï¼‰ã€‚ä¸»è¦æ¶‰åŠåˆ°çš„è°ƒç”¨æ˜¯ Unsafe.allocateMemory å’Œ java.util.zip.Inflater.init(Native Method)ã€‚ æ€ä¹ˆè¿½è¸ª NMT è¿½è¸ªä¸åˆ°çš„å…¶ä»–å†…å­˜ï¼Œç›®å‰æ˜¯å®‰è£…äº† jemalloc å†…å­˜åˆ†æå·¥å…·ï¼Œä»–èƒ½è¿½è¸ªåº•å±‚å†…å­˜çš„åˆ†é…æƒ…å†µè¾“å‡ºæŠ¥å‘Šã€‚\né€šè¿‡ jemalloc å†…å­˜åˆ†æå·¥å…·ä½è¯äº†ä¸Šé¢çš„ç»“è®ºï¼ŒUnsafe.allocateMemory å’Œ java.util.zip.Inflater.init å äº† 30%ï¼ŒåŸºæœ¬å»åˆã€‚\nå¯åŠ¨ arthas æŸ¥çœ‹ä¸‹ç±»è°ƒç”¨æ ˆï¼Œåœ¨ arthas é‡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n# å…ˆè®¾ç½® unsafe true options unsafe true # è¿™ä¸ªæ²¡æœ‰ stack sun.misc.Unsafe allocateMemory # è¿™ä¸ªæœ‰ stack jdk.internal.misc.Unsafe allocateMemory stack java.util.zip.Inflater inflate # stack ç»å¸¸è¿½è¸ªä¸åˆ°ï¼Œæ”¹ç”¨ profiler è¾“å‡ºå†…å­˜åˆ†é…ç«ç„°å›¾ profiler start --event alloc --duration 600 profiler start --event Unsafe_AllocateMemory0 --duration 600\ré€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œèƒ½çœ‹åˆ° MongoDB å’Œ netty ä¸€ç›´åœ¨ç”³è¯·ä½¿ç”¨å†…å­˜ã€‚æ³¨æ„ï¼šæ—©æœŸçš„ mongodb client ç¡®å®æœ‰æ— æ³•é‡Šæ”¾å†…å­˜çš„ bugï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬åœºæ™¯ï¼Œé•¿æœŸè§‚å¯Ÿä¼šå‘ç°å†…å­˜ç”³è¯·äº†é€æ¸é‡Šæ”¾äº†ï¼Œæ²¡æœ‰æŒç»­å¢é•¿ã€‚å›åˆ°å¼€å¤´çš„ ContainerOOM é—®é¢˜ï¼Œå¯èƒ½ä¸€ä¸ªåŸå› æ˜¯æµé‡çªå¢ï¼ŒMongoDB ç”³è¯·äº†æ›´å¤šçš„å†…å­˜å¯¼è‡´ OOMï¼Œè€Œä¸æ˜¯å› ä¸ºå†…å­˜ä¸é‡Šæ”¾ã€‚\nts=2022-12-29 21:20:01;thread_name=ForkJoinPool.commonPool-worker-1;id=22;is_daemon=true;priority=1;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@1d44bcfa @jdk.internal.misc.Unsafe.allocateMemory() at java.nio.DirectByteBuffer.\u0026lt;init\u0026gt;(DirectByteBuffer.java:125) at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:332) at sun.nio.ch.Util.getTemporaryDirectBuffer(Util.java:243) at java.net.Socket$SocketOutputStream.write(Socket.java:1035) at com.mongodb.internal.connection.SocketStream.write(SocketStream.java:99) at com.mongodb.internal.connection.InternalStreamConnection.sendMessage(InternalStreamConnection.java:426) at com.mongodb.internal.connection.UsageTrackingInternalConnection.sendAndReceive(UsageTrackingInternalConnection.java:99) at com.mongodb.internal.connection.DefaultConnectionPool$PooledConnection.sendAndReceive(DefaultConnectionPool.java:444) â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ at com.mongodb.MongoClientExt$1.execute(MongoClientExt.java:42) â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ å¦å¤–ï¼Œarthas è‡ªå¸¦çš„ profiler æœ‰æ—¶å€™ç»å¸¸è¿½è¸ªå¤±è´¥ï¼Œå¯ä»¥åˆ‡æ¢åˆ°åŸå§‹çš„ async-profiler ï¼Œç”¨ä»–æ¥è¿½è¸ªâ€œå…¶ä»–â€å†…å­˜åˆ†é…æ¯”è¾ƒæœ‰æ•ˆã€‚\næ€»ç»“ Java è¿›ç¨‹å†…å­˜å ç”¨ï¼šTotal=heap + non-heap + ä¸Šé¢è¯´çš„è¿™ä¸ªå…¶ä»–ã€‚\njemalloc jemalloc æ˜¯ä¸€ä¸ªæ¯” glibc malloc æ›´é«˜æ•ˆçš„å†…å­˜æ± æŠ€æœ¯ï¼Œåœ¨ Facebook å…¬å¸è¢«å¤§é‡ä½¿ç”¨ï¼Œåœ¨ FreeBSD å’Œ FireFox é¡¹ç›®ä¸­ä½¿ç”¨äº† jemalloc ä½œä¸ºé»˜è®¤çš„å†…å­˜ç®¡ç†å™¨ã€‚ä½¿ç”¨ jemalloc å¯ä»¥ä½¿ç¨‹åºçš„å†…å­˜ç®¡ç†æ€§èƒ½æå‡ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€‚\næ¯”å¦‚ Redis å†…å­˜åˆ†é…é»˜è®¤ä½¿ç”¨çš„ jemallocï¼Œæ—©æœŸç‰ˆæœ¬å®‰è£… redis æ˜¯éœ€è¦æ‰‹åŠ¨å®‰è£… jemalloc çš„ï¼Œç°åœ¨ redis åº”è¯¥æ˜¯åœ¨ç¼–è¯‘æœŸå†…ç½®å¥½äº†ã€‚\nåŸæ¥ä½¿ç”¨ jemalloc æ˜¯ä¸ºäº†åˆ†æå†…å­˜å ç”¨ï¼Œé€šè¿‡ jemalloc è¾“å‡ºå½“å‰å†…å­˜åˆ†é…æƒ…å†µï¼Œæˆ–è€…é€šè¿‡ diff åˆ†æå‰åå†…å­˜å·®ï¼Œå¤§æ¦‚èƒ½çœ‹å‡ºå†…å­˜éƒ½åˆ†ç»™ç¡äº†ï¼Œå äº†å¤šå°‘ï¼Œæ˜¯å¦æœ‰å†…å­˜æ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚\nåæ¥å‚è€ƒäº†è¿™ä¸ªæ–‡ç« ï¼ŒæŠŠ glibc æ¢æˆ jemalloc å¸¦æ¥æ€§èƒ½æå‡ï¼Œé™ä½å†…å­˜ä½¿ç”¨ï¼Œå†³å®šä¸€è¯•ã€‚\nhow weâ€™ve reduced memory usage without changing any codeï¼šhttps://blog.malt.engineering/java-in-k8s-how-weve-reduced-memory-usage-without-changing-any-code-cbef5d740ad Decreasing RAM Usage by 40% Using jemalloc with Python \u0026amp; Celery: https://zapier.com/engineering/celery-python-jemalloc/ ä¸€ä¸ªæœåŠ¡ï¼Œè¿è¡Œä¸€å‘¨ï¼Œè§‚å¯Ÿæ•ˆæœã€‚\nä½¿ç”¨ Jemalloc ä¹‹å‰ï¼š ä½¿ç”¨ Jemalloc ä¹‹åï¼ˆåŒæ—¶è°ƒä½äº† Pod å†…å­˜ï¼‰ï¼š æ³¨ï¼šä»¥ä¸Šç»“æœæœªç»ç”Ÿäº§é•¿æœŸæ£€éªŒã€‚\nå†…å­˜äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿ æ³¨æ„ï¼šä¸‹é¢çš„æ“ä½œï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®è¿™ä¹ˆå¹²ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenJDK ä¸ä¼šä¸»åŠ¨å‘æ“ä½œç³»ç»Ÿé€€è¿˜æœªç”¨çš„å†…å­˜ï¼ˆä¸ä¸¥è°¨ï¼‰ã€‚çœ‹ç¬¬ä¸€å¼ ç›‘æ§çš„å›¾ï¼Œä¼šå‘ç°è¿è¡Œä¸€æ®µæ—¶é—´åï¼ŒPod çš„å†…å­˜ä½¿ç”¨é‡ä¸€ç›´ç¨³å®šåœ¨ 80%\u0026ndash;90%ä¸å†æ³¢åŠ¨ã€‚\nå…¶å®å¯¹äº Java ç¨‹åºï¼Œæµ®åŠ¨æ¯”è¾ƒå¤§çš„å°±æ˜¯ heap å†…å­˜ã€‚å…¶ä»–åŒºåŸŸ Codeã€Metaspace åŸºæœ¬ç¨³å®š\n# æ‰§è¡Œå‘½ä»¤è·å–å½“å‰ heap æƒ…å†µ jhsdb jmap --heap --pid $(pgrep java) #ä»¥ä¸‹ä¸ºè¾“å‡º Attaching to process ID 7, please wait... Debugger attached successfully. Server compiler detected. JVM version is 17.0.5+8-LTS using thread-local object allocation. ZGC with 4 thread(s) Heap Configuration: MinHeapFreeRatio = 40 MaxHeapFreeRatio = 70 MaxHeapSize = 1287651328 (1228.0MB) NewSize = 1363144 (1.2999954223632812MB) MaxNewSize = 17592186044415 MB OldSize = 5452592 (5.1999969482421875MB) NewRatio = 2 SurvivorRatio = 8 MetaspaceSize = 22020096 (21.0MB) CompressedClassSpaceSize = 1073741824 (1024.0MB) MaxMetaspaceSize = 17592186044415 MB G1HeapRegionSize = 0 (0.0MB) Heap Usage: ZHeap used 310M, capacity 710M, max capacity 1228M Java å†…å­˜ä¸äº¤è¿˜ï¼Œå‡ ç§æƒ…å†µï¼š\nXms å¤§äºå®é™…éœ€è¦çš„å†…å­˜ï¼Œæ¯”å¦‚æˆ‘ä»¬æœåŠ¡è®¾ç½®äº† Xms768Mï¼Œä½†æ˜¯å®é™…ä¸Šåªéœ€è¦ 256ï¼Œé«˜å³°æœŸä¹Ÿå°± 512ï¼Œåˆ°ä¸äº† Xms çš„å€¼ä¹Ÿå°±æ— æ‰€è°“å½’è¿˜ã€‚ ä¸Šé¢ jmap çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ° Java é»˜è®¤çš„é…ç½® MaxHeapFreeRatio=70ï¼Œè¿™ä¸ª 70% Free å‡ ä¹å¾ˆéš¾è¾¾åˆ°ã€‚ï¼ˆå¦å¤–æ³¨æ„ Xmx==Xms çš„æƒ…å†µä¸‹è¿™ä¸¤ä¸ªå‚æ•°æ— æ•ˆï¼Œå› ä¸ºä»–æ€ä¹ˆæ‰©ç¼©éƒ½ä¸ä¼šçªç ´ Xms å’Œ Xmx çš„é™åˆ¶ï¼‰\nMinHeapFreeRatio = 40 ç©ºé—²å †ç©ºé—´çš„æœ€å°ç™¾åˆ†æ¯”ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼šHeapFreeRatio =(CurrentFreeHeapSize/CurrentTotalHeapSize) * 100ï¼Œå€¼çš„åŒºé—´ä¸º 0 åˆ° 100ï¼Œé»˜è®¤å€¼ä¸º 40ã€‚å¦‚æœ HeapFreeRatio \u0026lt; MinHeapFreeRatioï¼Œåˆ™éœ€è¦è¿›è¡Œå †æ‰©å®¹ï¼Œæ‰©å®¹çš„æ—¶æœºåº”è¯¥åœ¨æ¯æ¬¡åƒåœ¾å›æ”¶ä¹‹åã€‚ MaxHeapFreeRatio = 70 ç©ºé—²å †ç©ºé—´çš„æœ€å¤§ç™¾åˆ†æ¯”ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼šHeapFreeRatio =(CurrentFreeHeapSize/CurrentTotalHeapSize) * 100ï¼Œå€¼çš„åŒºé—´ä¸º 0 åˆ° 100ï¼Œé»˜è®¤å€¼ä¸º 70ã€‚å¦‚æœ HeapFreeRatio \u0026gt; MaxHeapFreeRatioï¼Œåˆ™éœ€è¦è¿›è¡Œå †ç¼©å®¹ï¼Œç¼©å®¹çš„æ—¶æœºåº”è¯¥åœ¨æ¯æ¬¡åƒåœ¾å›æ”¶ä¹‹åã€‚ å¯¹äº ZGCï¼Œé»˜è®¤æ˜¯äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿçš„ã€‚å¯é€šè¿‡ -XX:+ZUncommit -XX:ZUncommitDelay=300 è¿™ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼ˆä¸å†ä½¿ç”¨çš„å†…å­˜æœ€å¤šå»¶è¿Ÿ 300s å½’è¿˜ç»™ OSï¼Œçº¿ä¸‹ç¯å¢ƒå¯ä»¥æ”¹å°ç‚¹ï¼‰ã€‚\nç»è¿‡è°ƒæ•´åçš„æœåŠ¡ï¼Œå†…å­˜æäº¤åœ¨ 500\u0026ndash;800M ä¹‹é—´æµ®åŠ¨ï¼Œä¸å†æ˜¯ä¸€æ¡ç›´çº¿ã€‚\nå†…å­˜åˆ†æå·¥å…·é€Ÿè§ˆ ä½¿ç”¨ Java è‡ªå¸¦å·¥å…· dump å†…å­˜ã€‚\njcmd \u0026lt;pid\u0026gt; GC.heap_dump \u0026lt;file-path\u0026gt; # è¿™ä¸ªå‘½ä»¤æ‰§è¡Œï¼ŒJVM ä¼šå…ˆè§¦å‘ gcï¼Œç„¶åå†ç»Ÿè®¡ä¿¡æ¯ã€‚ jmap -dump:live,format=b,file=/opt/tomcat/logs/dump.hprof \u0026lt;pid\u0026gt; # dump all jmap -dump:format=b,file=/opt/tomcat/logs/dump.hprof \u0026lt;pid\u0026gt;\rä½¿ç”¨ jmap è¾“å‡ºå†…å­˜å ç”¨æ¦‚è§ˆã€‚\njmap -histo 1 | head -n 500\rä½¿ç”¨ async-profiler è¿½è¸ª native å†…å­˜åˆ†é…ï¼Œè¾“å‡ºç«ç„°å›¾ã€‚\nasync-profiler/bin/asprof -d 600 -e Unsafe_AllocateMemory0 -f /opt/tomcat/logs/unsafe_allocate.html \u0026lt;pid\u0026gt;\rä½¿ç”¨ vmtouch æŸ¥çœ‹å’Œæ¸…ç† Linux ç³»ç»Ÿæ–‡ä»¶ç¼“å­˜ã€‚\n# æŸ¥çœ‹æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å äº†å¤šå°‘ç¼“å­˜ vmtouch /files vmtouch /dir # éå†æ–‡ä»¶å¤¹è¾“å‡ºè¯¦ç»†å ç”¨ vmtouch -v /dir # æ¸…ç©ºç¼“å­˜ vmtouch -e /dir\rpmap æŸ¥çœ‹å†…å­˜å†…å®¹ ä½¿ç”¨ pmap æŸ¥çœ‹å½“å‰å†…å­˜åˆ†é…ï¼Œå¦‚æœæ‰¾åˆ°äº†å¯ç–‘çš„å†…å­˜å—ï¼Œå¯ä»¥é€šè¿‡ gdb å°è¯•è§£æå‡ºå†…å­˜å—ä¸­çš„å†…å®¹ã€‚\n# pmap æŸ¥çœ‹å†…å­˜ï¼Œå…ˆä¸è¦æ’åºï¼Œä¾¿äºæ‰¾å‡ºè¿ç»­çš„å†…å­˜å—ï¼ˆä¸€èˆ¬æ˜¯ 2 ä¸ªä¸€ç»„ï¼‰ # pmap -x \u0026lt;pid\u0026gt; | sort -n -k3 pmap -x $(pgrep java) # ä¸¾ä¾‹è¯´æ˜åœ¨ä¸Šé¢å‘ç°æœ‰ 7f6737dff000 å¼€å¤´çš„å†…å­˜å—å¯èƒ½å¼‚å¸¸ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªä¸€ç»„ï¼Œæ˜¯è¿ç»­çš„å†…å­˜ cat /proc/$(pgrep java)/smaps \u0026gt; logs/smaps.txt gdb attach $(pgrep java) # dump çš„èµ·å§‹åœ°å€ï¼ŒåŸºäºä¸Šé¢ smaps.txt æ‰¾åˆ°çš„å†…å®¹ï¼Œåœ°å€åŠ ä¸Š 0x å‰ç¼€ dump memory /opt/tomcat/logs/gdb-test.dump 0x7f6737dff000 0x7f6737e03000 # å°è¯•å°† dump æ–‡ä»¶å†…å®¹è½¬æˆå¯è¯»çš„ stringï¼Œå…¶ä¸­ -10 æ˜¯è¿‡æ»¤é•¿åº¦å¤§äº 10 çš„ï¼Œä¹Ÿå¯ä»¥ä¸è¿‡æ»¤ strings -10 /opt/tomcat/logs/gdb-test.dump # å¦‚æœå¹¸è¿ï¼Œèƒ½åœ¨ä¸Šé¢çš„ strings ä¸­æ‰¾åˆ°ä½ çš„ Java ç±»æˆ– Bean å†…å®¹ï¼Œå¦‚æœä¸å¹¸éƒ½æ˜¯ä¸€å †ä¹±ç ï¼Œå¯ä»¥å°è¯•æ‰©å¤§ dump å†…å­˜å—ï¼Œå¤šæ‰¾å‡ ä¸ªè¿ç»­çš„å—è¯•è¯• # pmap æŒ‰å¤§å°é™åºæ’åºå¹¶è¿‡æ»¤å¤§äº 1000 KB çš„é¡¹ pmap -x $(pgrep java) | awk \u0026#39;NR\u0026gt;2 \u0026amp;\u0026amp; !/total/ {print $2, $0}\u0026#39; | sort -k1,1nr | cut -d\u0026#39; \u0026#39; -f2- | awk \u0026#39;$2 \u0026gt; 1000\u0026#39;\rè¯†åˆ« Linux èŠ‚ç‚¹ä¸Šçš„ cgroup ç‰ˆæœ¬ cgroup ç‰ˆæœ¬å–å†³äºæ­£åœ¨ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆå’Œæ“ä½œç³»ç»Ÿä¸Šé…ç½®çš„é»˜è®¤ cgroup ç‰ˆæœ¬ã€‚ è¦æ£€æŸ¥ä½ çš„å‘è¡Œç‰ˆä½¿ç”¨çš„æ˜¯å“ªä¸ª cgroup ç‰ˆæœ¬ï¼Œè¯·åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œ stat -fc %T /sys/fs/cgroup/ å‘½ä»¤ï¼š\nstat -fc %T /sys/fs/cgroup/\rå¯¹äº cgroup v2ï¼Œè¾“å‡ºä¸º cgroup2fsã€‚\nå¯¹äº cgroup v1ï¼Œè¾“å‡ºä¸º tmpfsã€‚\né—®é¢˜åŸå› åˆ†æå’Œè°ƒæ•´ å›åˆ°å¼€å¤´é—®é¢˜ï¼Œé€šè¿‡ä¸Šé¢åˆ†æï¼Œ2G å†…å­˜ï¼ŒRSS å…¶å®å ç”¨ 600Mï¼Œä¸ºä»€ä¹ˆæœ€ç»ˆè¿˜æ˜¯ ContainerOOM äº†ã€‚\nkernel memory ä¸º 0ï¼Œæ’é™¤ kernel æ³„æ¼çš„åŸå› ã€‚ä¸‹é¢çš„å‚è€ƒèµ„æ–™é‡Œä»‹ç»äº† kernel æ³„éœ²çš„ä¸¤ç§åœºæ™¯ã€‚ Cache å¾ˆå¤§ï¼Œè¯´æ˜æ–‡ä»¶æ“ä½œå¤šã€‚æœäº†ä¸€ä¸‹ä»£ç ï¼Œç¡®å®æœ‰å¾ˆå¤š InputStream è°ƒç”¨æ²¡æœ‰æ˜¾å¼å…³é—­ï¼Œè€Œä¸”æœ‰çš„ InputSteam Root å¼•ç”¨åœ¨ ThreadLocal é‡Œï¼ŒThreadLocal åª init æœª removeã€‚ ä½†æ˜¯ï¼ŒThreadLocal çš„å¼•ç”¨å¯¹è±¡æ˜¯çº¿ç¨‹æ± ï¼Œæ± ä¸å›æ”¶ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å¯èƒ½ä¼šæ— æ³•å…³é—­ï¼Œä½†æ˜¯ä¸ä¼šé€’å¢ï¼Œä½†æ˜¯ cache ä¹Ÿä¸èƒ½å›æ”¶ã€‚ ä¼˜åŒ–åŠæ³•ï¼šThreadLocal ä¸­å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— æ•°æ®ä¼ é€’ï¼Œç›´æ¥å¹²æ‰ ThreadLocalï¼›æ˜¾å¼å…³é—­ InputStreamã€‚è¿è¡Œä¸€å‘¨å‘ç° cache å¤§çº¦æ¯”ä¼˜åŒ–å‰ä½ 200\u0026ndash;500Mã€‚ ThreadLocal å¼•èµ·å†…å­˜æ³„éœ²æ˜¯ Java ä¸­å¾ˆç»å…¸çš„ä¸€ä¸ªåœºæ™¯ï¼Œä¸€å®šè¦ç‰¹åˆ«æ³¨æ„ã€‚ ä¸€èˆ¬åœºæ™¯ä¸‹ï¼ŒJava ç¨‹åºéƒ½æ˜¯å †å†…å­˜å ç”¨é«˜ï¼Œä½†æ˜¯è¿™ä¸ªæœåŠ¡å †å†…å­˜å…¶å®åœ¨ 200-500M ä¹‹é—´æµ®åŠ¨ï¼Œæˆ‘ä»¬ç»™ä»–åˆ†äº† 768Mï¼Œä»æ¥æ²¡æœ‰åˆ°è¿‡è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥è°ƒä½ Xmsã€‚ç•™å‡ºæ›´å¤šå†…å­˜ç»™ JNI ä½¿ç”¨ã€‚ çº¿ä¸‹ç¯å¢ƒå†…å­˜åˆ†é…åˆ‡æ¢åˆ° jemallocï¼Œé•¿æœŸè§‚å¯Ÿå¤§éƒ¨åˆ†æ•ˆæœå¯ä»¥ï¼Œä½†æ˜¯å¯¹éƒ¨åˆ†åº”ç”¨åŸºæœ¬æ²¡æœ‰æ•ˆæœã€‚ ç»è¿‡ä¸Šè¿°è°ƒæ•´ä»¥åï¼Œçº¿ä¸‹ç¯å¢ƒ Pod å†…å­˜ä½¿ç”¨é‡ç”± 1G é™åˆ° 600M ä½œç”¨ã€‚çº¿ä¸Šç¯å¢ƒå†…å­˜ä½¿ç”¨é‡åœ¨ 50%\u0026ndash;80%ä¹‹é—´æ ¹æ®æµé‡å¤§å°æµ®åŠ¨ï¼ŒåŸæ¥æ˜¯ 85% å±…é«˜ä¸å°ã€‚\nä¸åŒ JVM å‚æ•°å†…å­˜å ç”¨å¯¹æ¯” ä»¥ä¸‹ä¸ºå°‘é‡åº”ç”¨å®ä¾‹æ€»ç»“å‡ºæ¥çš„ç»“æœï¼Œåº”ç”¨çš„æ¨¡å‹ä¸åŒå ç”¨æƒ…å†µä¼šæœ‰æ¯”è¾ƒå¤§å·®å¼‚ï¼Œä»…ä¾›å¯¹æ¯”å‚è€ƒã€‚\nåŸºç¡€å‚æ•° ä¸­ä½æµé‡æ—¶å†…å­˜å ç”¨ï¼ˆXmx 6Gï¼‰ é«˜æµé‡æ—¶å†…å­˜å ç”¨ Java 8 + G1 65% 85% Java 17 + G1 60% 75% Java 17 + ZGC 90% 95% Java 21 + G1 40% 60% Java 21 + ZGC 80% 90% Java 21 + ZGC + UseStringDeduplication 85% 90% Java 21 + ZGC + ZGenerational + UseStringDeduplication 75% 80% æ€»ç»“ï¼š\nG1 æ¯” ZGC å ç”¨å†…å­˜æ˜æ˜¾å‡å°‘ã€‚ Java 21 æ¯” Java 8ã€17 å ç”¨å†…å­˜æ˜æ˜¾åå°‘ã€‚ Java 21 ZGC åˆ†ä»£åç¡®å®èƒ½é™ä½å†…å­˜ã€‚ é€šè¿‡ -XX:+UseStringDeduplication å¯ç”¨ String å»é‡åï¼Œæœ‰çš„åº”ç”¨èƒ½é™ä½ 10% å†…å­˜ï¼Œæœ‰çš„å‡ ä¹æ— å˜åŒ–ã€‚ åˆ†äº«æˆ‘ä»¬æ‰€ä½¿ç”¨çš„ Java 21 ç”Ÿäº§ç¯å¢ƒå‚æ•°é…ç½®ï¼Œä»…ä¾›å‚è€ƒè¯·æ ¹æ®è‡ªå·±åº”ç”¨æƒ…å†µé€‰æ‹©æ€§ä½¿ç”¨ï¼š\n-XX:InitialRAMPercentage=40.0 -XX:MaxRAMPercentage=70.0ï¼šæŒ‰ç…§ç™¾åˆ†æ¯”è®¾ç½®åˆå§‹åŒ–å’Œæœ€å¤§å †å†…å­˜ã€‚å†…å­˜å……è¶³çš„æƒ…å†µä¸‹å»ºè®®è®¾ç½®ä¸ºä¸€æ ·å¤§ã€‚ -XX:+UseZGC -XX:+ZUncommit -XX:ZUncommitDelay=300 -XX:MinHeapFreeRatio=10 -XX:MaxHeapFreeRatio=30ï¼šä¿ƒè¿› Java å†…å­˜æ›´å¿«äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œä½†åŒæ—¶ CPU å¯èƒ½åé«˜ã€‚ -XX:+ZGenerationalï¼šå¯ç”¨åˆ†ä»£ ZGCï¼Œèƒ½é™ä½å†…å­˜å ç”¨ã€‚ -XX:+UseStringDeduplicationï¼šå¯ç”¨ String å»é‡ï¼Œå¯èƒ½é™ä½å†…å­˜å ç”¨ã€‚ -Xss512kï¼šé™ä½çº¿ç¨‹å†…å­˜å ç”¨ï¼Œé»˜è®¤ 1Mbï¼Œçº¿ç¨‹æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹è¿™ä¸ªå ç”¨è¿˜æ˜¯å¾ˆå¤šçš„ã€‚è°¨æ…è®¾ç½®ã€‚ -XX:+ParallelRefProcEnabledï¼šå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç† Referenceï¼Œå‡å°‘ GC çš„ Reference æ•°é‡ï¼Œå‡å°‘ Young GC æ—¶é—´ã€‚ å…³äº Java 8ã€17 å’Œ 21 ä¸åŒ GC æ›´å¤šç»´åº¦çš„å¯¹æ¯”æ•ˆæœå¯å‚è€ƒï¼š JDK 21: The GCs keep getting better ã€‚\nJava åˆ†æå·¥å…· [æ¨è] åœ¨çº¿ GC åˆ†æå·¥å…· GCeasy.io [æ¨è] åœ¨çº¿ Thread åˆ†æå·¥å…· FastThread.io [æ¨è] åœ¨çº¿ Heap åˆ†æå·¥å…· HeapHero.io [æ¨è] åœ¨çº¿ jstack åˆ†æå·¥å…· jstack.review [Beta] å¯ç§æœ‰åŒ–éƒ¨ç½² Online GCã€Heap Dumpã€Threadã€JFR åˆ†æå·¥å…· eclipse/jifa å‚è€ƒèµ„æ–™ IOTDB çº¿ä¸Šå †å¤–å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥ï¼šhttps://cwiki.apache.org/confluence/pages/viewpage.action?pageId=195728187 JVM å †å¤–å†…å­˜é—®é¢˜å®šä½ï¼š https://juejin.cn/post/6844904168549777421 java å †å¤–å†…å­˜æ³„æ¼æ’æŸ¥ï¼š https://javakk.com/1158.html ","date":"2023-01-07","id":32,"permalink":"/blog/java-memory/","summary":"\u003cp\u003eæ•…äº‹èƒŒæ™¯ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ª K8S Podï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª Java è¿›ç¨‹ï¼ŒK8S request å’Œ limit memory éƒ½æ˜¯ 2Gï¼ŒJava è¿›ç¨‹æ ¸å¿ƒå‚æ•°åŒ…æ‹¬ï¼š\u003ccode\u003e-XX:+UseZGC -Xmx1024m -Xms768m\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å¯åŠ¨ä¸€æ®µæ—¶é—´åï¼ŒæŸ¥çœ‹ Grafana ç›‘æ§æ•°æ®ï¼ŒPod å†…å­˜ä½¿ç”¨é‡çº¦ 1.5Gï¼ŒJVM å†…å­˜ä½¿ç”¨é‡çº¦ 500Mï¼Œé€šè¿‡ jvm dump åˆ†ææ²¡æœ‰ä»»ä½•å¤§å¯¹è±¡ï¼Œè¿è¡Œä¸‰äº”å¤©åå‡ºç° K8S Container OOMã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆåŒºåˆ†ä¸‹ Container OOM å’Œ Jvm OOMï¼ŒContainer OOM æ˜¯ Pod å†…è¿›ç¨‹ç”³è¯·å†…å­˜å¤§çº¦ K8S Limit æ‰€è‡´ã€‚\u003c/p\u003e\n\u003cp\u003eé—®é¢˜æ¥äº†ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ePod 2G å†…å­˜ï¼ŒJVM è®¾ç½®äº† \u003ccode\u003eXmx 1G\u003c/code\u003eï¼Œå·²ç»é¢„ç•™äº† 1G å†…å­˜ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼š Container OOMï¼Œè¿™é¢„ç•™çš„ 1G å†…å­˜è¢«è°åƒäº†ã€‚\u003c/li\u003e\n\u003cli\u003eæ­£å¸¸æƒ…å†µä¸‹ï¼ˆæ—  Container OOMï¼‰ï¼ŒGrafana çœ‹åˆ°çš„ç›‘æ§æ•°æ®ï¼ŒPod å†…å­˜ä½¿ç”¨é‡ 1.5Gï¼Œ JVM å†…å­˜ä½¿ç”¨é‡ 500Mï¼Œå·®åˆ«ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤§ã€‚\u003c/li\u003e\n\u003cli\u003ePod å†…å­˜ä½¿ç”¨é‡ä¸ºä»€ä¹ˆè¶…è¿‡ Xmx é™åˆ¶ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eGrafana ç›‘æ§å›¾ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"./grafana-pod-jvm.png\"\u003e\r\n\r\n\u003cimg\r\n  src=\"/blog/java-memory/grafana-pod-jvm_hu_f3e003bf88afca3a.webp\"\r\n  width=\"1920\"\r\n  height=\"3600\"\r\n  decoding=\"async\"\r\n  fetchpriority=\"auto\"\r\n  loading=\"lazy\"\r\n  alt=\"Grafana ç›‘æ§å›¾\"\r\n  id=\"h-rh-i-0\"\r\n\u003e\u003c/a\u003e\n\u003c/p\u003e","tags":["k8s","Java"],"title":"K8S Pod å®¹å™¨å†… Java è¿›ç¨‹å†…å­˜åˆ†æï¼Œå†…å­˜è™šé«˜ä»¥åŠå®¹å™¨ OOM æˆ– Jave OOM é—®é¢˜å®šä½"},{"content":"ä¸º VS Code Web ç‰ˆ code-server å¢åŠ å¤–éƒ¨è®¤è¯ï¼Œå¹¶æ”¯æŒå¤šç”¨æˆ·ï¼Œä¸åŒç”¨æˆ·çš„ code-server å®ä¾‹å®Œå…¨éš”ç¦»ã€‚\nä¸»è¦ä¸ºäº†è§£å†³é—®é¢˜ï¼š\ncode-server æœ¬èº«åªæ”¯æŒé…ç½®æ–‡ä»¶å½¢å¼çš„ç”¨æˆ·åå¯†ç è®¤è¯ï¼ˆæˆªæ­¢ç›®å‰ï¼Œä»¥åä¹Ÿè®¸ä¼šæ”¹è¿›ï¼‰ã€‚æ‰€ä»¥å¼•å…¥äº†å¤–éƒ¨è®¤è¯ç³»ç»Ÿï¼ŒGoogleã€GitHubã€ oktaã€CASã€Keycloak ç­‰ç†è®ºä¸Šéƒ½æ˜¯æ”¯æŒçš„ã€‚\ncode-server é»˜è®¤æ²¡æœ‰æ•°æ®éš”ç¦»ï¼Œæ‰€ä»¥åˆåŠ äº†ä¸€å±‚ auth proxyï¼Œä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰code-server å®ä¾‹ï¼Œé€šè¿‡ proxy ä»£ç†åˆ°å„è‡ªçš„å®ä¾‹ï¼Œä»¥å®ç°ç”¨æˆ·é—´çš„æ•°æ®éš”ç¦»ã€‚\nä½¿ç”¨å¼€æº Auth Proxyï¼Œæ— éœ€è‡ªå·±ç¼–ç å³å¯å®ç°è®¤è¯æˆæƒæµç¨‹ï¼Œæ¯”å¦‚ code flow with pkce å¯¹å¤§éƒ¨åˆ†äººæ¥è¯´è¯»æ‡‚è¿™ä¸ªåè®®éƒ½å¾ˆå›°éš¾ã€‚\næ­¤æ–‡æ¡£æºç è¯·å‚è€ƒï¼šarchitecture-diagram ä½¿ç”¨ç»„ä»¶ keycloak Redhat å¼€æº IAM ç³»ç»Ÿï¼Œç›®å‰ä¹Ÿæ˜¯ CNCF é¡¹ç›®ï¼Œæä¾›ç”¨æˆ·ã€ç»„ç»‡æœåŠ¡ï¼Œæä¾›æ ‡å‡† OIDCã€‚\noauth2-proxy è®¤è¯ä»£ç†ï¼Œé…åˆ keycloak æä¾›å®Œæ•´ OAuth2 Code Flow è®¤è¯æµç¨‹ã€‚ä¹Ÿå¯ä»¥è¯•è¯• pomerium ï¼Œçœ‹æ ·å­ä¹Ÿä¸é”™ã€‚\næ¶æ„å›¾å¦‚ä¸‹ã€‚\næ ¸å¿ƒé€»è¾‘ æ¶æ„å›¾ç®€å•è§£è¯»ï¼Œæ‰€æœ‰è¿‡ç¨‹å®˜æ–¹æ–‡æ¡£éƒ½æœ‰è¯¦ç»†è¯´æ˜ï¼Œéƒ½æ˜¯é…ç½®ï¼Œä»¥å®˜æ–¹é…ç½®ä¸ºå‡†ã€‚\nkeycloak åˆ›å»º clientï¼Œä½¿ç”¨ OIDC åè®®ï¼Œä½œä¸º oauth2-proxy çš„ providerã€‚\ningress(nginx) ä½¿ç”¨ auth_request æŒ‡ä»¤æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œä» oauth2-proxy è¿›è¡Œä»£ç†è®¤è¯ï¼Œé…ç½®å¯å‚è€ƒ oauth2-proxy auth_request æŒ‡å¯¼ã€‚\nnginx.ingress.kubernetes.io/auth-signin: https://$host/oauth2/start?rd=$escaped_request_uri nginx.ingress.kubernetes.io/auth-url: https://$host/oauth2/auth\rè®¤è¯é€šè¿‡åï¼Œå°†ç”¨æˆ·å/ID ä½œä¸ºæ ‡è¯†ï¼Œé€šè¿‡ Http Header ï¼ˆä¸¾ä¾‹å¦‚ X-Forwarded-Preferred-Username) ä¼ å…¥ upstreamã€‚\ngateway(nginx) ä» Header ä¸­è·å–ç”¨æˆ·æ ‡è¯†ï¼Œä»£ç†åˆ°æ­¤ç”¨æˆ·å¯¹åº”çš„ code-server å®ä¾‹ã€‚\nlocation / { â€¦â€¦ proxy_pass http://code-server-$http_x_forwarded_for_preferred_username; }\rcode-server å„ä¸ªå®ä¾‹éƒ¨ç½²æ—¶ï¼Œä»¥å…è®¤è¯æ–¹å¼éƒ¨ç½²ã€‚\næ¯ä¸ª code-server å®ä¾‹æŒ‚è½½ä¸åŒçš„å­˜å‚¨ï¼Œå®ç°å®Œå…¨éš”ç¦»ã€‚\n","date":"2022-09-07","id":33,"permalink":"/blog/code-server/","summary":"\u003cp\u003eä¸º VS Code Web ç‰ˆ \u003ca href=\"https://github.com/coder/code-server\" target=\"_blank\" rel=\"noopener\"\u003ecode-server\u003c/a\u003e\n å¢åŠ å¤–éƒ¨è®¤è¯ï¼Œå¹¶æ”¯æŒå¤šç”¨æˆ·ï¼Œä¸åŒç”¨æˆ·çš„ code-server å®ä¾‹å®Œå…¨éš”ç¦»ã€‚\u003c/p\u003e\n\u003cp\u003eä¸»è¦ä¸ºäº†è§£å†³é—®é¢˜ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003ecode-server æœ¬èº«åªæ”¯æŒé…ç½®æ–‡ä»¶å½¢å¼çš„ç”¨æˆ·åå¯†ç è®¤è¯ï¼ˆæˆªæ­¢ç›®å‰ï¼Œä»¥åä¹Ÿè®¸ä¼šæ”¹è¿›ï¼‰ã€‚æ‰€ä»¥å¼•å…¥äº†å¤–éƒ¨è®¤è¯ç³»ç»Ÿï¼ŒGoogleã€GitHubã€ oktaã€CASã€Keycloak ç­‰ç†è®ºä¸Šéƒ½æ˜¯æ”¯æŒçš„ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ecode-server é»˜è®¤æ²¡æœ‰æ•°æ®éš”ç¦»ï¼Œæ‰€ä»¥åˆåŠ äº†ä¸€å±‚ auth proxyï¼Œä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰code-server å®ä¾‹ï¼Œé€šè¿‡ proxy ä»£ç†åˆ°å„è‡ªçš„å®ä¾‹ï¼Œä»¥å®ç°ç”¨æˆ·é—´çš„æ•°æ®éš”ç¦»ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä½¿ç”¨å¼€æº Auth Proxyï¼Œæ— éœ€è‡ªå·±ç¼–ç å³å¯å®ç°è®¤è¯æˆæƒæµç¨‹ï¼Œæ¯”å¦‚ \u003ccode\u003ecode flow with pkce\u003c/code\u003e å¯¹å¤§éƒ¨åˆ†äººæ¥è¯´è¯»æ‡‚è¿™ä¸ªåè®®éƒ½å¾ˆå›°éš¾ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eæ­¤æ–‡æ¡£æºç è¯·å‚è€ƒï¼š\u003ca href=\"https://github.com/xlabs-club/architecture-diagram\" target=\"_blank\" rel=\"noopener\"\u003earchitecture-diagram\u003c/a\u003e\n\u003c/p\u003e\n\u003ch2 id=\"ä½¿ç”¨ç»„ä»¶\"\u003eä½¿ç”¨ç»„ä»¶\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/keycloak/keycloak\" target=\"_blank\" rel=\"noopener\"\u003ekeycloak\u003c/a\u003e\n\u003c/p\u003e\n\u003cp\u003eRedhat å¼€æº IAM ç³»ç»Ÿï¼Œç›®å‰ä¹Ÿæ˜¯ CNCF é¡¹ç›®ï¼Œæä¾›ç”¨æˆ·ã€ç»„ç»‡æœåŠ¡ï¼Œæä¾›æ ‡å‡† OIDCã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/oauth2-proxy/oauth2-proxy\" target=\"_blank\" rel=\"noopener\"\u003eoauth2-proxy\u003c/a\u003e\n\u003c/p\u003e\n\u003cp\u003eè®¤è¯ä»£ç†ï¼Œé…åˆ keycloak æä¾›å®Œæ•´ OAuth2 Code Flow è®¤è¯æµç¨‹ã€‚ä¹Ÿå¯ä»¥è¯•è¯• \u003ca href=\"https://github.com/pomerium/pomerium\" target=\"_blank\" rel=\"noopener\"\u003epomerium\u003c/a\u003e\nï¼Œçœ‹æ ·å­ä¹Ÿä¸é”™ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ¶æ„å›¾å¦‚ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003e\r\n\r\n\u003cimg\r\n  src=\"/blog/code-server/code-server-auth-proxy_hu_9d21f682080840b4.webp\"\r\n  width=\"752\"\r\n  height=\"922\"\r\n  decoding=\"async\"\r\n  fetchpriority=\"auto\"\r\n  loading=\"lazy\"\r\n  alt=\"code-server-auth-proxy\"\r\n  id=\"h-rh-i-0\"\r\n\u003e\u003c/p\u003e\n\u003ch2 id=\"æ ¸å¿ƒé€»è¾‘\"\u003eæ ¸å¿ƒé€»è¾‘\u003c/h2\u003e\n\u003cp\u003eæ¶æ„å›¾ç®€å•è§£è¯»ï¼Œæ‰€æœ‰è¿‡ç¨‹å®˜æ–¹æ–‡æ¡£éƒ½æœ‰è¯¦ç»†è¯´æ˜ï¼Œéƒ½æ˜¯é…ç½®ï¼Œä»¥å®˜æ–¹é…ç½®ä¸ºå‡†ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003ekeycloak åˆ›å»º clientï¼Œä½¿ç”¨ OIDC åè®®ï¼Œä½œä¸º oauth2-proxy çš„ providerã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eingress(nginx) ä½¿ç”¨ auth_request æŒ‡ä»¤æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œä» oauth2-proxy è¿›è¡Œä»£ç†è®¤è¯ï¼Œé…ç½®å¯å‚è€ƒ \u003ca href=\"https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview/#configuring-for-use-with-the-nginx-auth_request-directive\" target=\"_blank\" rel=\"noopener\"\u003eoauth2-proxy auth_request\u003c/a\u003e\n æŒ‡å¯¼ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003enginx.ingress.kubernetes.io/auth-signin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://$host/oauth2/start?rd=$escaped_request_uri\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003enginx.ingress.kubernetes.io/auth-url\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://$host/oauth2/auth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè®¤è¯é€šè¿‡åï¼Œå°†ç”¨æˆ·å/ID ä½œä¸ºæ ‡è¯†ï¼Œé€šè¿‡ Http Header ï¼ˆä¸¾ä¾‹å¦‚ X-Forwarded-Preferred-Username) ä¼ å…¥ upstreamã€‚\u003c/p\u003e","tags":["devops"],"title":"ä½¿ç”¨ Visual Studio Code æ­å»ºå¤šç”¨æˆ·è¿œç¨‹ IDE"},{"content":"å¤‡è€ƒ CKA ï¼ˆCertified Kubernetes Administratorï¼‰è¿‡ç¨‹ï¼Œå¿ƒå¾—ï¼Œé‡è§é—®é¢˜ï¼ŒCKA çœŸé¢˜ã€‚\nä¸€å¥è¯æ€»ç»“ï¼šæŒ‰ç…§æ•™ç¨‹å¤šç»ƒä¹ ï¼ŒæŠŠæ§å¥½æ—¶é—´å°±èƒ½é€šè¿‡ï¼ŒæœŸæœ›é€šè¿‡åˆ·é¢˜é€šè¿‡è€ƒè¯•çš„å¹´ä»£å·²ç»è¿‡å»äº†ï¼Œè€Œä¸”å¤šç»ƒä¹ å¯¹å¹³æ—¶å·¥ä½œçœŸçš„æœ‰ç”¨ã€‚\nå¤‡è€ƒç¯å¢ƒ å¤‡è€ƒä½¿ç”¨çš„ç³»ç»Ÿå’Œè½¯ä»¶ç‰ˆæœ¬å¦‚ä¸‹ã€‚\nUbuntuï¼š20.04 Focal Fossa Kubernetesï¼š1.20.7 kubeadmï¼š1.20.7 å®‰è£…å’Œä½¿ç”¨é—®é¢˜è®°å½• kubeadm å®‰è£…é—®é¢˜ å®‰è£… kubeadmï¼Œå›½å†…å®‰è£…ä½¿ç”¨é˜¿é‡Œé•œåƒæºã€‚\n$ cat /etc/apt/sources.list.d/kubernetes.list deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main è¸©å‘ï¼šå› ä¸ºä½¿ç”¨çš„æ˜¯ ubuntu 20.04ï¼Œä»£å· focalï¼Œä¸“é—¨å»å„ä¸ªä»£ç†é•œåƒæºæ‰¾kubernetes-focaléƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œåæ¥å‘ç° google å®˜æ–¹æ ¹æœ¬æ²¡å‘å¸ƒå¯¹åº”çš„ç‰ˆæœ¬ï¼Œåªæœ‰kubernetes-xenialï¼Œ k8s å®˜æ–¹æ–‡æ¡£é‡Œ ubuntu ä¹Ÿæ˜¯ç”¨çš„è¿™ä¸€ä¸ªç‰ˆæœ¬ã€‚å¯ä»¥ç”¨ï¼Œå°±ç”¨ä»–å§ã€‚\nkubeadm init æ—¶æŒ‡å®šä½¿ç”¨é˜¿é‡Œé•œåƒæºï¼ˆè§£å†³å›½å†…è¿ä¸ä¸Š k8s.gcr.io çš„é—®é¢˜ï¼‰ã€æŒ‡å®šç‰ˆæœ¬å·ï¼ˆå®‰è£…è€ƒè¯•å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä¸ä¸€å®šæ˜¯æœ€æ–°ç‰ˆæœ¬ï¼‰ã€‚ é€šè¿‡æŒ‡å®š--image-repositoryï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¸‹è½½é•œåƒé‡æ–°æ‰“ tagï¼Œkubeadm è‡ªåŠ¨ä½¿ç”¨æŒ‡å®šçš„ repositoryã€‚\nkubeadm init --image-repository=registry.aliyuncs.com/google_containers \\ --pod-network-cidr=10.244.0.0/16 \\ --kubernetes-version=v1.20.7\rè§£å†³ scheduler Unhealthyï¼Œcontroller-manager Unhealthy ç¬¬ä¸€æ¬¡å®‰è£…å®Œæˆåé€šè¿‡ kubectl get cså‘½ä»¤ï¼Œå‘ç° scheduler Unhealthyï¼Œcontroller-manager Unhealthyã€‚\n$ kubectl get cs NAME STATUS MESSAGE scheduler Unhealthy Get \u0026#34;http://127.0.0.1:10251/healthz\u0026#34;: dial tcp 127.0.0.1:10 controller-manager Unhealthy Get \u0026#34;http://127.0.0.1:10252/healthz\u0026#34;: dial tcp 127.0.0.1:10 æŸ¥çœ‹æœ¬æœºç«¯å£ï¼Œ10251 å’Œ 10252 éƒ½æ²¡æœ‰å¯åŠ¨ã€‚\nç¡®è®¤ schedule å’Œ controller-manager ç»„ä»¶é…ç½®æ˜¯å¦ç¦ç”¨äº†éå®‰å…¨ç«¯å£ã€‚\næŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œè·¯å¾„åˆ†åˆ«ä¸ºï¼š/etc/kubernetes/manifests/kube-scheduler.yaml å’Œ /etc/kubernetes/manifests/kube-controller-manager.yaml å°†ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­ --port=0 æ³¨é‡Šæ‰ï¼ˆæ³¨é‡Šæ‰æ˜¯å¦åˆé€‚å¾…å•†é‡ï¼‰ã€‚\nspec: containers: - command: - kube-scheduler - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf - --bind-address=127.0.0.1 # æ³¨é‡Šæ‰ portï¼Œå…¶ä»–è¡ŒåŸæ ·ä¸è¦åŠ¨ - --port=0\rè§£å†³ master æ— æ³•è°ƒåº¦ æˆ‘çš„ç¯å¢ƒæ˜¯å•èŠ‚ç‚¹ï¼Œæ—¢å½“ master åˆå½“ workerï¼Œkubeadm å®‰è£…å®Œæˆåé»˜è®¤ master èŠ‚ç‚¹æ˜¯ä¸å‚ä¸è°ƒåº¦çš„ï¼Œpod ä¼šä¸€ç›´ pendingã€‚\nkubectl describe node å‘ç° node çš„ Taints é‡Œæœ‰ node-role.kubernetes.io/master:NoScheduleã€‚\nè®¾ç½® k8s master èŠ‚ç‚¹å‚ä¸ POD è°ƒåº¦ã€‚\nkubectl taint nodes your-node-name node-role.kubernetes.io/master-\rè€ƒè¯•å¿ƒå¾— åˆ·æ–°æµè§ˆå™¨ä¼šå¯¼è‡´è€ƒè¯•è¢«ç»ˆæ­¢ã€‚\næå‰æ¼”ç»ƒæ•²ä¸€éï¼Œæ—¶é—´å…¶å®æŒºç´§å¼ ã€‚\nå®˜æ–¹kubectl Cheat Sheetç« èŠ‚éå¸¸æœ‰ç”¨ï¼Œå¿…è€ƒã€‚\nå‘½ä»¤è‡ªåŠ¨è¡¥å…¨ source \u0026lt;(kubectl completion bash)ã€‚\nå°½é‡ä½¿ç”¨å‘½ä»¤åˆ›å»º Podã€deploymentã€serviceã€‚\nkubectl run podname --image=imagename --restart=Never -n namespace kubectl run \u0026lt;deploymentname\u0026gt; --image=\u0026lt;imagename\u0026gt; -n \u0026lt;namespace\u0026gt; kubectl expose \u0026lt;deploymentname\u0026gt; --port=\u0026lt;portNo.\u0026gt; --name=\u0026lt;svcname\u0026gt; ä½¿ç”¨ dry-runã€‚\nkubectl run \u0026lt;podname\u0026gt; --image=\u0026lt;imagename\u0026gt; --restart=Never --dry-run -o yaml \u0026gt; title.yaml ä½¿ç”¨ kubectl -h æŸ¥çœ‹å„ä¸ªå‘½ä»¤çš„å¸®åŠ©ï¼Œå¾ˆå¤šéƒ½åœ¨ Examples é‡Œã€‚æ¯”å¦‚ kubectl expose -hã€‚\nCKA çœŸé¢˜ç»ƒä¹  çœŸé¢˜ä¼šè¿‡æ—¶ï¼Œåˆ«æŒ‡æœ›ç€åˆ·åˆ·é¢˜å°±é€šè¿‡è€ƒè¯•ï¼Œè€è€å®å®å­¦ä¸€éã€‚\nå°†æ‰€æœ‰ pv æŒ‰ç…§ name/capacity æ’åºã€‚\n# sort by name kubectl get pv --sort-by=.metadata.name # sort by capacity kubectl get pv --sort-by=.spec.capacity.storage deployment æ‰©å®¹ã€‚\nkubectl scale deployment test --replicas=3 Set the node named ek8s-node-1 as unavaliable and reschedule all the pods running on it.\nkubectl cordon ek8s-node-1 # drain node çš„æ—¶å€™å¯èƒ½å‡ºé”™ï¼Œæ ¹æ®é”™è¯¯æç¤ºåŠ å‚æ•° kubectl drain ek8s-node-1 --delete-local-data --ignore-daemonsets --force Form the pod label name-cpu-loader,find pods running high CPU workloads and write the name of the pod consuming most CPU to the file /opt/KUTR00401/KURT00401.txt(which alredy exists).\n# æ³¨æ„é¢˜ç›®ä¸­å¹¶æ²¡æœ‰æ namespaceï¼Œå¯ä»¥å…ˆçœ‹ä¸‹è¿™ä¸ª label çš„ pod åœ¨å“ªä¸ª namespaceï¼Œç¡®å®šå‘½ä»¤ä¸­è¦ä¸è¦åŠ  namespace kubectl top pods -l name=name-cpu-loader --sort-by=cpu echo \u0026#39;æ’åç¬¬ä¸€çš„ pod åç§°\u0026#39; \u0026gt;\u0026gt;/opt/KUTR00401/KUTR00401.txt ","date":"2022-02-26","id":34,"permalink":"/blog/kubernetes-cka/","summary":"\u003cp\u003eå¤‡è€ƒ CKA ï¼ˆCertified Kubernetes Administratorï¼‰è¿‡ç¨‹ï¼Œå¿ƒå¾—ï¼Œé‡è§é—®é¢˜ï¼ŒCKA çœŸé¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€å¥è¯æ€»ç»“ï¼šæŒ‰ç…§æ•™ç¨‹å¤šç»ƒä¹ ï¼ŒæŠŠæ§å¥½æ—¶é—´å°±èƒ½é€šè¿‡ï¼ŒæœŸæœ›é€šè¿‡åˆ·é¢˜é€šè¿‡è€ƒè¯•çš„å¹´ä»£å·²ç»è¿‡å»äº†ï¼Œè€Œä¸”å¤šç»ƒä¹ å¯¹å¹³æ—¶å·¥ä½œçœŸçš„æœ‰ç”¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"å¤‡è€ƒç¯å¢ƒ\"\u003eå¤‡è€ƒç¯å¢ƒ\u003c/h2\u003e\n\u003cp\u003eå¤‡è€ƒä½¿ç”¨çš„ç³»ç»Ÿå’Œè½¯ä»¶ç‰ˆæœ¬å¦‚ä¸‹ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntuï¼š20.04 Focal Fossa\u003c/li\u003e\n\u003cli\u003eKubernetesï¼š1.20.7\u003c/li\u003e\n\u003cli\u003ekubeadmï¼š1.20.7\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å®‰è£…å’Œä½¿ç”¨é—®é¢˜è®°å½•\"\u003eå®‰è£…å’Œä½¿ç”¨é—®é¢˜è®°å½•\u003c/h2\u003e\n\u003ch3 id=\"kubeadm-å®‰è£…é—®é¢˜\"\u003ekubeadm å®‰è£…é—®é¢˜\u003c/h3\u003e\n\u003cp\u003eå®‰è£… kubeadmï¼Œå›½å†…å®‰è£…ä½¿ç”¨é˜¿é‡Œé•œåƒæºã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"gp\"\u003e$\u003c/span\u003e cat /etc/apt/sources.list.d/kubernetes.list\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003edeb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eè¸©å‘ï¼šå› ä¸ºä½¿ç”¨çš„æ˜¯ ubuntu 20.04ï¼Œä»£å· \u003ccode\u003efocal\u003c/code\u003eï¼Œä¸“é—¨å»å„ä¸ªä»£ç†é•œåƒæºæ‰¾\u003ccode\u003ekubernetes-focal\u003c/code\u003eéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œåæ¥å‘ç° google å®˜æ–¹æ ¹æœ¬æ²¡å‘å¸ƒå¯¹åº”çš„ç‰ˆæœ¬ï¼Œåªæœ‰\u003ccode\u003ekubernetes-xenial\u003c/code\u003eï¼Œ k8s å®˜æ–¹æ–‡æ¡£é‡Œ ubuntu ä¹Ÿæ˜¯ç”¨çš„è¿™ä¸€ä¸ªç‰ˆæœ¬ã€‚å¯ä»¥ç”¨ï¼Œå°±ç”¨ä»–å§ã€‚\u003c/p\u003e\n\u003cp\u003ekubeadm init æ—¶æŒ‡å®šä½¿ç”¨é˜¿é‡Œé•œåƒæºï¼ˆè§£å†³å›½å†…è¿ä¸ä¸Š k8s.gcr.io çš„é—®é¢˜ï¼‰ã€æŒ‡å®šç‰ˆæœ¬å·ï¼ˆå®‰è£…è€ƒè¯•å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä¸ä¸€å®šæ˜¯æœ€æ–°ç‰ˆæœ¬ï¼‰ã€‚\né€šè¿‡æŒ‡å®š\u003ccode\u003e--image-repository\u003c/code\u003eï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¸‹è½½é•œåƒé‡æ–°æ‰“ tagï¼Œkubeadm è‡ªåŠ¨ä½¿ç”¨æŒ‡å®šçš„ repositoryã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubeadm init --image-repository\u003cspan class=\"o\"\u003e=\u003c/span\u003eregistry.aliyuncs.com/google_containers \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --pod-network-cidr\u003cspan class=\"o\"\u003e=\u003c/span\u003e10.244.0.0/16 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --kubernetes-version\u003cspan class=\"o\"\u003e=\u003c/span\u003ev1.20.7\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003ch3 id=\"è§£å†³-scheduler-unhealthycontroller-manager-unhealthy\"\u003eè§£å†³ scheduler Unhealthyï¼Œcontroller-manager Unhealthy\u003c/h3\u003e\n\u003cp\u003eç¬¬ä¸€æ¬¡å®‰è£…å®Œæˆåé€šè¿‡ \u003ccode\u003ekubectl get cs\u003c/code\u003eå‘½ä»¤ï¼Œå‘ç° scheduler Unhealthyï¼Œcontroller-manager Unhealthyã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"gp\"\u003e$\u003c/span\u003e kubectl get cs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003eNAME                 STATUS      MESSAGE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003escheduler            Unhealthy   Get \u0026#34;http://127.0.0.1:10251/healthz\u0026#34;: dial tcp 127.0.0.1:10\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003econtroller-manager   Unhealthy   Get \u0026#34;http://127.0.0.1:10252/healthz\u0026#34;: dial tcp 127.0.0.1:10\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003eæŸ¥çœ‹æœ¬æœºç«¯å£ï¼Œ10251 å’Œ 10252 éƒ½æ²¡æœ‰å¯åŠ¨ã€‚\u003c/p\u003e","tags":[],"title":"å¤‡è€ƒ CKA è¿‡ç¨‹ï¼ŒCKA çœŸé¢˜åˆ†äº«"},{"content":"æ—¥å¸¸å¼€å‘é€ŸæŸ¥æ‰‹å†Œï¼Œç¨‹åºå‘˜çš„ç‘å£«å†›åˆ€ï¼Œå¸¸ç”¨ä¼˜ç§€å‘½ä»¤è¡Œå·¥å…·å’Œç¼–ç¨‹è¯­å¥æ±‡æ€»ã€‚\n","date":"2023-09-07","id":35,"permalink":"/docs/tldr/","summary":"æ—¥å¸¸å¼€å‘é€ŸæŸ¥æ‰‹å†Œï¼Œç¨‹åºå‘˜çš„ç‘å£«å†›åˆ€ï¼Œå¸¸ç”¨ä¼˜ç§€å‘½ä»¤è¡Œå·¥å…·","tags":[],"title":"TL;DR"},{"content":"Install KEDA ","date":"2024-06-26","id":36,"permalink":"/docs/cloud/k8s-hpa-with-keda/","summary":"\u003ch2 id=\"install-keda\"\u003eInstall KEDA\u003c/h2\u003e","tags":[],"title":"åŸºäº KEDA å®ç°é«˜æ•ˆæ‰©ç¼©å®¹"},{"content":"Spring Boot ä½¿ç”¨ Micrometer é›†æˆ Prometheus ç›‘æ§ï¼Œ5 åˆ†é’Ÿæ¥å…¥è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ï¼Œä¸»è¦å†…å®¹ï¼š\nMicrometer ä»‹ç»ã€‚ ä¸šåŠ¡å¦‚ä½•è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œå¦‚ä½•æ¥å…¥ Prometheusï¼Œå®ç°æ–¹å¼å’Œè§„èŒƒã€‚ Micrometer ä»‹ç» Micrometer ä¸º Java å¹³å°ä¸Šçš„æ€§èƒ½æ•°æ®æ”¶é›†æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ APIï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ä½¿ç”¨ Micrometer çš„é€šç”¨ API æ¥æ”¶é›†æ€§èƒ½æŒ‡æ ‡ï¼ŒMicrometer ä¼šè´Ÿè´£å®Œæˆä¸ä¸åŒç›‘æ§ç³»ç»Ÿçš„é€‚é…å·¥ä½œã€‚\nMicrometer æä¾›äº†å¤šç§åº¦é‡æŒ‡æ ‡ç±»å‹ï¼ˆTimersã€Guaugesã€Counters ç­‰ï¼‰ï¼ŒåŒæ—¶æ”¯æŒæ¥å…¥ä¸åŒçš„ç›‘æ§ç³»ç»Ÿï¼Œä¾‹å¦‚ Influxdbã€Graphiteã€Prometheusã€OTLP ç­‰ã€‚\nä» Spring Boot 2.x å¼€å§‹ä½¿ç”¨ Micrometer ä½œä¸ºé»˜è®¤çš„ç›‘æ§é—¨é¢æ¥å£ï¼Œ Think SLF4J, but for observability ã€‚\nMicrometer æ ¸å¿ƒæ¦‚å¿µ Micrometer ä¸­ä¸¤ä¸ªæœ€æ ¸å¿ƒçš„æ¦‚å¿µï¼šè®¡é‡å™¨æ³¨å†Œè¡¨ (MeterRegistry)ï¼Œè®¡é‡å™¨ (Meter)ã€‚\nMeterRegistry\nå†…å­˜æ³¨å†Œè¡¨ (SimpleMeterRegistry): åœ¨å†…å­˜ä¸­ä¿å­˜æ¯ä¸€ä¸ª Meterï¼ˆæŒ‡æ ‡ï¼‰çš„æœ€æ–°å€¼ï¼Œå¹¶ä¸”ä¸ä¼šå°†æ•°æ®å¯¼å‡ºåˆ°ä»»ä½•åœ°æ–¹ã€‚ ç»„åˆæ³¨å†Œè¡¨ (CompositeMeterRegistry): å¯ä»¥æ·»åŠ å¤šä¸ªæ³¨å†Œè¡¨ï¼Œç”¨äºå°†å„ä¸ªæ³¨å†Œè¡¨ç»„åˆèµ·æ¥ï¼Œå¯ä»¥åŒæ—¶å°†æŒ‡æ ‡å‘å¸ƒåˆ°å¤šä¸ªç›‘æ§ç³»ç»Ÿã€‚Micrometer æä¾›äº†ä¸€ä¸ªå…¨å±€çš„ MeterRegistryï¼Œio.micrometer.core.instrument.Metrics ä¸­æŒæœ‰ä¸€ä¸ªé™æ€ final çš„ CompositeMeterRegistry å®ä¾‹ globalRegistryã€‚ æ™®ç½—ç±³ä¿®æ–¯æ³¨å†Œè¡¨ (PrometheusMeterRegistry): å½“ä½¿ç”¨æ™®ç½—ç±³ä¿®æ–¯ç›‘æ§æ—¶ï¼Œå¼•å…¥ micrometer-registry-prometheus ä¾èµ–æ—¶ä¼šæä¾›æ­¤ç§æ”¶é›†å™¨ï¼Œç”¨äºå°†æŒ‡æ ‡æ•°æ®è½¬æ¢ä¸ºæ™®ç½—ç±³ä¿®æ–¯è¯†åˆ«çš„æ ¼å¼å’Œå¯¼å‡ºæ•°æ®ç­‰åŠŸèƒ½ã€‚ Meterï¼ˆæŒ‡æ ‡ï¼‰\nç›‘æ§æ•°æ®çš„æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯å›´ç»•ç€ Meterï¼ˆæŒ‡æ ‡ï¼‰, é€šè¿‡ä¸€ä¸ªä¸€ä¸ªçš„ Meterï¼ˆæŒ‡æ ‡ï¼‰æ•°æ®æ¥è¿›è¡Œè§‚å¯Ÿåº”ç”¨çš„çŠ¶æ€ã€‚å¸¸ç”¨çš„æŒ‡æ ‡å¦‚ï¼š\nCounterï¼ˆè®¡æ•°å™¨ï¼‰: å•ä¸€è®¡æ•°æŒ‡æ ‡ï¼Œå…è®¸æŒ‰å›ºå®šæ•°é‡é€’å¢ï¼Œç”¨æ¥ç»Ÿè®¡æ— ä¸Šé™æ•°æ®ã€‚åªå…è®¸é€’å¢ã€‚ Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰: è¡¨ç¤ºå•ä¸ªçš„å˜åŒ–çš„å€¼ï¼Œä¾‹å¦‚æ¸©åº¦ï¼Œæ°”å‹ã€‚ç”¨äºç»Ÿè®¡æœ‰ä¸Šé™å¯å¢å¯å‡çš„æ•°æ®ã€‚åœ¨æ¯æ¬¡å–æ ·æ—¶ï¼ŒGauge ä¼šè¿”å›å½“å‰å€¼ã€‚ Timerï¼ˆè®¡æ—¶å™¨ï¼‰: é€šå¸¸ç”¨æ¥è®°å½•äº‹ä»¶çš„æŒç»­æ—¶é—´ã€‚Timer ä¼šè®°å½•ä¸¤ç±»çš„æ•°æ®ï¼Œäº‹ä»¶çš„æ•°é‡å’Œæ€»çš„æŒç»­æ—¶é—´ã€‚ Tagï¼ˆæ ‡ç­¾ï¼‰\nMircrometer é€šè¿‡ Tagï¼ˆæ ‡ç­¾ï¼‰å®ç°äº†å¤šç»´åº¦çš„åº¦é‡æ•°æ®æ”¶é›†ï¼Œé€šè¿‡ Tag çš„å‘½åå¯ä»¥æ¨æ–­å‡ºå…¶æŒ‡å‘çš„æ•°æ®ä»£è¡¨ä»€ä¹ˆç»´åº¦æˆ–æ˜¯ä»€ä¹ˆç±»å‹çš„åº¦é‡æŒ‡æ ‡ã€‚\næˆ‘ä»¬çš„å®ç°æ–¹å¼å’Œè¦æ±‚ æ€»ä½“æ¶æ„ï¼šSpring Boot Actuator + Micrometer + Prometheus + Granfanaã€‚\nSpring Boot Micrometerï¼šæä¾›ç›‘æ§é—¨é¢ Apiã€‚ Spring Boot Actuatorï¼šæä¾›ç›‘æ§æŒ‡æ ‡é‡‡é›†æœåŠ¡ï¼Œé€šè¿‡ /actuator/prometheus è·å–æ•°æ®ã€‚ Prometheus + Granfanaï¼šé‡‡é›†å’Œå­˜å‚¨æ•°æ®ï¼Œæä¾›å›¾è¡¨å±•ç¤ºï¼Œå¦å¤– Granfana å¯æ ¹æ®æŒ‡æ ‡é…ç½®å‘Šè­¦è§„åˆ™å‘å‡ºå‘Šè­¦ã€‚ æ€»ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š\nSpring Boot Actuator æ”¾å¼€ prometheus http è®¿é—®ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹é…ç½®ã€‚\nmanagement.endpoint.prometheus.enabled=true management.endpoints.web.exposure.include=info,health,metrics,prometheus management.metrics.export.prometheus.enabled=true\råˆ›å»º Prometheus ServiceMonitor æˆ– PodMonitorï¼Œä» /actuator/prometheus path é‡‡é›†æŒ‡æ ‡ï¼Œå¦‚æœæ¶‰åŠå¤šä¸ª war åˆå¹¶éƒ¨ç½²åˆ°ä¸€ä¸ª tomcat çš„ï¼Œä»å¤šä¸ª path é‡‡é›†ã€‚\napiVersion: monitoring.coreos.com/v1 kind: ServiceMonitor metadata: labels: app.kubernetes.io/component: metrics release: your-prometheus-instance-name name: eye-consumer namespace: test spec: endpoints: - interval: 30s honorLabels: true # /client-biz æ˜¯æˆ‘çš„æœåŠ¡ ContextPath path: /client-biz/actuator/prometheus port: metrics - interval: 30s honorLabels: true path: /gateway-biz/actuator/prometheus port: metrics jobLabel: eye-consumer selector: matchLabels: app: eye-consumer\rä¸šåŠ¡å¯é€šè¿‡ http://localhost:8080/actuator/metrics æŸ¥çœ‹æŒ‡æ ‡æ˜¯å¦å·²ä¸ŠæŠ¥ï¼Œé€šè¿‡ http://localhost:8080/actuator/prometheus æŸ¥çœ‹æŒ‡æ ‡çš„å½“å‰å€¼ã€‚\nè‡ªå®šä¹‰ Metrics æŒ‡æ ‡ åœ¨ Spring Boot ä¸­å®ç°è‡ªå®šä¹‰æŒ‡æ ‡éå¸¸ç®€å•ï¼Œå‡ ç§æ–¹å¼ä¸¾ä¾‹å¦‚ä¸‹ã€‚\nåƒä½¿ç”¨ slf4j ä¸€æ ·ï¼Œä½¿ç”¨ io.micrometer.core.instrument.Metrics é™æ€æ–¹å¼åˆå§‹åŒ–ä¸€ä¸ªæŒ‡æ ‡ï¼Œç„¶åä½¿ç”¨æ­¤æŒ‡æ ‡ç›´æ¥æ“ä½œã€‚ ä½¿ç”¨ @Timed @Counted æ³¨è§£ã€‚æ³¨æ„æ³¨è§£æ–¹å¼å¿…é¡»ç­‰æ–¹æ³•è°ƒç”¨åæ‰èƒ½ç”ŸæˆæŒ‡æ ‡ã€‚è€Œé™æ€æ–¹æ³•å½¢å¼ io.micrometer.core.instrument.Metrics.counterç«‹å³å°±ç”ŸæˆæŒ‡æ ‡åªæ˜¯å€¼ä¸º 0ã€‚å¦å¤–æ³¨æ„ Spring æ³¨è§£ä¸æ”¯æŒ privateã€default çº§åˆ«æ–¹æ³•ã€‚ ä½¿ç”¨ Autowired MeterRegistry åˆ›å»ºè‡ªå·±çš„æŒ‡æ ‡ç±»å‹ï¼Œé€‚åˆä¸€äº›åŠ¨æ€ Tag ç­‰é«˜çº§å®šåˆ¶åœºæ™¯ã€‚ import io.micrometer.core.annotation.Counted; import io.micrometer.core.instrument.Counter; import io.micrometer.core.instrument.Metrics; import org.springframework.stereotype.Service; @Service public class MicrometerSampleService { /** * æ–¹å¼ 1ï¼šåƒä½¿ç”¨ slf4j ä¸€æ ·ï¼Œä½¿ç”¨ `io.micrometer.core.instrument.Metrics`é™æ€æ–¹å¼åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨ï¼Œé€‚ç”¨äºåå­—å’Œ Tag å›ºå®šçš„åœºæ™¯ */ private static final Counter failure = Metrics.counter(\u0026#34;fs.sms.send\u0026#34;, \u0026#34;result\u0026#34;, \u0026#34;failure\u0026#34;); @Autowired private MeterRegistry registry; private void sendSms() { try { // do something } catch (Exception e) { failure.increment(); } } /** * æ–¹å¼ 2ï¼šä½¿ç”¨æ³¨è§£çš„æ–¹å¼ï¼Œæ³¨æ„éœ€è¦å¼•å…¥ spring-boot-starter-aop ä¾èµ– */ @Counted(value = \u0026#34;fs.sms.send\u0026#34;, extraTags = {\u0026#34;provider\u0026#34;, \u0026#34;huawei\u0026#34;}) public void sendByHuawei() { this.sendSms(); } @Counted(value = \u0026#34;fs.sms.send\u0026#34;, extraTags = {\u0026#34;provider\u0026#34;, \u0026#34;ali\u0026#34;}) public void sendByAli() { this.sendSms(); } /** * æ–¹å¼ 3ï¼šä½¿ç”¨ MeterRegistryï¼Œé€‚åˆä¸€äº›åŠ¨æ€ Tag ç­‰é«˜çº§å®šåˆ¶åœºæ™¯ * * @param result result */ public void countByResult(String result) { registry.counter(\u0026#34;fs.sms.send\u0026#34;, \u0026#34;result\u0026#34;, result).increment(); // or Counter.builder(\u0026#34;fs.sms.send\u0026#34;) .description(\u0026#34;send sms\u0026#34;) .tags(\u0026#34;result\u0026#34;, result) .register(registry) .increment(); } }\rSpring Boot æ— æ³•ç›´æ¥ä½¿ç”¨ @Timed @Counted æ³¨è§£ï¼Œéœ€è¦å¼•å…¥åˆ‡é¢æ”¯æŒï¼Œéœ€è¦å¼•å…¥ spring-boot-starter-aop ä¾èµ–ã€‚\n@Configuration public class MicrometerAspectConfiguration { @Bean public CountedAspect countedAspect(MeterRegistry registry) { return new CountedAspect(registry); } @Bean public TimedAspect timedAspect(MeterRegistry registry) { return new TimedAspect(registry); } }\rå¦å¤–è¿™é‡Œå¤§å®¶å¯èƒ½æœ‰ä¸ªç–‘æƒ‘ï¼Œæˆ‘çš„è¯·æ±‚é‡å¾ˆå¤§ï¼ŒMetrics.counter å¯¹è±¡æ˜¯ä¸æ˜¯æ¯æ¬¡éƒ½ new å‡ºæ¥çš„ï¼Œè¦ä¸è¦ç¼“å­˜èµ·æ¥ï¼Œå‡å°‘è·å– counter å¯¹è±¡çš„å‹åŠ›ã€‚\nå…¶å®ä¸ç”¨ï¼ŒMeterRegistry å·²ç»åšäº†ç¼“å­˜ï¼Œå‚è€ƒ io.micrometer.core.instrument.MeterRegistry#registerMeterIfNecessary ä»¥ä¸‹ä»£ç ç‰‡æ®µã€‚\nprivate \u0026lt;M extends Meter\u0026gt; M registerMeterIfNecessary(Class\u0026lt;M\u0026gt; meterClass, Meter.Id id, @Nullable DistributionStatisticConfig config, BiFunction\u0026lt;Meter.Id, DistributionStatisticConfig, M\u0026gt; builder, Function\u0026lt;Meter.Id, M\u0026gt; noopBuilder) { Meter.Id mappedId = this.getMappedId(id); Meter m = this.getOrCreateMeter(config, builder, id, mappedId, noopBuilder); if (!meterClass.isInstance(m)) { throw new IllegalArgumentException(String.format(\u0026#34;There is already a registered meter of a different type (%s vs. %s) with the same name: %s\u0026#34;, m.getClass().getSimpleName(), meterClass.getSimpleName(), id.getName())); } else { return (Meter)meterClass.cast(m); } }\rè‡ªå®šä¹‰æŒ‡æ ‡é«˜çº§é…ç½® Spring é»˜è®¤æ³¨å…¥çš„ MeterRegistry æ˜¯ä¸€ä¸ª CompositeMeterRegistryï¼Œå¦‚æœæƒ³å®šåˆ¶å¯æ³¨å…¥è‡ªå®šä¹‰ MeterRegistryCustomizer Beanã€‚\n@Configuration public class MicrometerConfiguration { @Bean MeterRegistryCustomizer\u0026lt;MeterRegistry\u0026gt; configurer() { return (registry) -\u0026gt; registry.config() .commonTags(\u0026#34;group\u0026#34;, \u0026#34;sample\u0026#34;) .commonTags(\u0026#34;application\u0026#34;, \u0026#34;sample\u0026#34;); } }\rå¦‚æœåªæ˜¯æƒ³ä¸ºå½“å‰åº”ç”¨å¢åŠ  Tagï¼Œå¯ç›´æ¥é€šè¿‡é…ç½®æ–‡ä»¶å¢åŠ ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚\nmanagement.metrics.tags.biz=sample management.metrics.tags.application=${spring.application.name}\rè‡ªå®šä¹‰æŒ‡æ ‡è§„èŒƒ æŒ‡æ ‡å’Œ Tag å‘½åçº¦å®šä½¿ç”¨è‹±è¯­å¥å·åˆ†éš”ï¼Œå…¨å°å†™ï¼ŒTag å¯æ ¹æ®å®é™…æƒ…å†µä½¿ç”¨ç¼©å†™ã€‚æŒ‡æ ‡ååœ¨ä¸åŒçš„ MeterRegistry é‡Œä¼šè‡ªåŠ¨è½¬æ¢ï¼Œæ¯”å¦‚åœ¨ Prometheus ä¼šæŠŠ fs.sms.send è½¬æ¢ä¸º fs_sms_sendã€‚\næŒ‡æ ‡å‘½åå»ºè®®ä»¥ fs.application.action ä¸ºæ¨¡æ¿ï¼Œé¿å…ä¸å¼€æºæˆ–å…¶ä»–é¡¹ç›®ç»„å†²çªã€‚\næ³¨æ„ Tag values ä¸èƒ½ä¸º Nullï¼Œ ä¸”å¿…é¡»æ˜¯å¯æšä¸¾çš„æŸäº›å›ºå®šç±»å‹ä¾¿äºç»Ÿè®¡ã€‚\nä½¿ç”¨æ³¨è§£ @Timed @Counted ä¼šé»˜è®¤å¢åŠ  methodã€classã€resultã€exception è¿™å‡ ä¸ª Tagï¼Œæ³¨æ„ä¸è¦ä¸ä¹‹å†²çªã€‚\nåœ¨ K8S é›†ç¾¤å†…ï¼Œå…¬å¸å’Œå¼€æºé»˜è®¤ Tag å¦‚ä¸‹ï¼Œè¿™äº›ä¼šè¢« ServiceMonitor å¼ºåˆ¶è¦†ç›–ï¼Œä¸šåŠ¡ä¸è¦è‡ªå·±å®šä¹‰ã€‚\nnamespaceã€applicationã€serviceã€containerã€podã€instanceã€jobã€endpointã€id ç¼–ç ä¸­å¦‚æœéœ€è¦ MeterRegistryï¼Œä¸å…è®¸å¼•ç”¨å…·ä½“å®ç°ï¼ˆæ¯”å¦‚ Prometheus çš„ io.prometheus.client.CollectorRegistryï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨ Micrometer æä¾›çš„ç»Ÿä¸€æ¥å£ MeterRegistryã€‚ç±»æ¯”ï¼Œåœ¨æ‰“å°æ—¥å¿—æ—¶ä¸å…è®¸ç›´æ¥ä½¿ç”¨ logback æˆ– log4j apiï¼Œè€Œæ˜¯ä½¿ç”¨ slf4j api.\nä¸è¦è‡ªå·± new MeterRegistryï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªåŠ¨æ³¨å…¥çš„æˆ–é™æ€æ–¹æ³•ã€‚\nå»ºè®®ä¸ºæŒ‡æ ‡åŠ ä¸Š description å­—æ®µã€‚\næœ€ä½³å®è·µ åˆç†è§„åˆ’ Tagï¼Œä¸€ä¸ª Meter å…·ä½“ç±»å‹éœ€è¦é€šè¿‡åå­—å’Œ Tag ä½œä¸ºå®ƒçš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨åå­—è¿›è¡Œæ ‡è®°ï¼Œé€šè¿‡ä¸åŒçš„ Tag å»åŒºåˆ†å¤šç§ç»´åº¦è¿›è¡Œæ•°æ®ç»Ÿè®¡ã€‚\nåä¾‹ 1ï¼ˆå…¨éƒ¨ç”¨ name åŒºåˆ†ï¼Œæ—  Tagï¼Œé‡å¤è®¡é‡ï¼Œæ— æ³•å¤šç»´åº¦åˆ†ææ±‡èšï¼‰ï¼š Metrics.counter(\u0026#34;fs.sms.all\u0026#34;); Metrics.counter(\u0026#34;fs.sms.aliyun\u0026#34;); Metrics.counter(\u0026#34;fs.sms.huaweiyun\u0026#34;); æ­£ä¾‹ï¼š Metrics.counter(\u0026#34;fs.sms.send\u0026#34;,\u0026#34;provider\u0026#34;,\u0026#34;ali\u0026#34;); Metrics.counter(\u0026#34;fs.sms.send\u0026#34;,\u0026#34;provider\u0026#34;,\u0026#34;huawei\u0026#34;,\u0026#34;result\u0026#34;,\u0026#34;success\u0026#34;); é¿å…æ— æ„ä¹‰ä¸å¯æšä¸¾çš„ Tagï¼Œæ··ä¹±çš„ Tag æ¯”æ—  Tag æ›´éš¾ç®¡ç†ã€‚\n","date":"2023-08-07","id":37,"permalink":"/blog/spring-boot-micrometer/","summary":"\u003cp\u003eSpring Boot ä½¿ç”¨ Micrometer é›†æˆ Prometheus ç›‘æ§ï¼Œ5 åˆ†é’Ÿæ¥å…¥è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ï¼Œä¸»è¦å†…å®¹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eMicrometer ä»‹ç»ã€‚\u003c/li\u003e\n\u003cli\u003eä¸šåŠ¡å¦‚ä½•è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œå¦‚ä½•æ¥å…¥ Prometheusï¼Œå®ç°æ–¹å¼å’Œè§„èŒƒã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"micrometer-ä»‹ç»\"\u003eMicrometer ä»‹ç»\u003c/h2\u003e\n\u003cp\u003eMicrometer ä¸º Java å¹³å°ä¸Šçš„æ€§èƒ½æ•°æ®æ”¶é›†æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ APIï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ä½¿ç”¨ Micrometer çš„é€šç”¨ API æ¥æ”¶é›†æ€§èƒ½æŒ‡æ ‡ï¼ŒMicrometer ä¼šè´Ÿè´£å®Œæˆä¸ä¸åŒç›‘æ§ç³»ç»Ÿçš„é€‚é…å·¥ä½œã€‚\u003c/p\u003e\n\u003cp\u003eMicrometer æä¾›äº†å¤šç§åº¦é‡æŒ‡æ ‡ç±»å‹ï¼ˆTimersã€Guaugesã€Counters ç­‰ï¼‰ï¼ŒåŒæ—¶æ”¯æŒæ¥å…¥ä¸åŒçš„ç›‘æ§ç³»ç»Ÿï¼Œä¾‹å¦‚ Influxdbã€Graphiteã€Prometheusã€OTLP ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eä» Spring Boot 2.x å¼€å§‹ä½¿ç”¨ Micrometer ä½œä¸ºé»˜è®¤çš„ç›‘æ§é—¨é¢æ¥å£ï¼Œ \u003ccode\u003eThink SLF4J, but for observability\u003c/code\u003e ã€‚\u003c/p\u003e\n\u003ch3 id=\"micrometer-æ ¸å¿ƒæ¦‚å¿µ\"\u003eMicrometer æ ¸å¿ƒæ¦‚å¿µ\u003c/h3\u003e\n\u003cp\u003eMicrometer ä¸­ä¸¤ä¸ªæœ€æ ¸å¿ƒçš„æ¦‚å¿µï¼šè®¡é‡å™¨æ³¨å†Œè¡¨ (MeterRegistry)ï¼Œè®¡é‡å™¨ (Meter)ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMeterRegistry\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå†…å­˜æ³¨å†Œè¡¨ (SimpleMeterRegistry): åœ¨å†…å­˜ä¸­ä¿å­˜æ¯ä¸€ä¸ª Meterï¼ˆæŒ‡æ ‡ï¼‰çš„æœ€æ–°å€¼ï¼Œå¹¶ä¸”ä¸ä¼šå°†æ•°æ®å¯¼å‡ºåˆ°ä»»ä½•åœ°æ–¹ã€‚\u003c/li\u003e\n\u003cli\u003eç»„åˆæ³¨å†Œè¡¨ (CompositeMeterRegistry): å¯ä»¥æ·»åŠ å¤šä¸ªæ³¨å†Œè¡¨ï¼Œç”¨äºå°†å„ä¸ªæ³¨å†Œè¡¨ç»„åˆèµ·æ¥ï¼Œå¯ä»¥åŒæ—¶å°†æŒ‡æ ‡å‘å¸ƒåˆ°å¤šä¸ªç›‘æ§ç³»ç»Ÿã€‚Micrometer æä¾›äº†ä¸€ä¸ªå…¨å±€çš„ MeterRegistryï¼Œ\u003ccode\u003eio.micrometer.core.instrument.Metrics\u003c/code\u003e ä¸­æŒæœ‰ä¸€ä¸ªé™æ€ final çš„ CompositeMeterRegistry å®ä¾‹ globalRegistryã€‚\u003c/li\u003e\n\u003cli\u003eæ™®ç½—ç±³ä¿®æ–¯æ³¨å†Œè¡¨ (PrometheusMeterRegistry): å½“ä½¿ç”¨æ™®ç½—ç±³ä¿®æ–¯ç›‘æ§æ—¶ï¼Œå¼•å…¥ micrometer-registry-prometheus ä¾èµ–æ—¶ä¼šæä¾›æ­¤ç§æ”¶é›†å™¨ï¼Œç”¨äºå°†æŒ‡æ ‡æ•°æ®è½¬æ¢ä¸ºæ™®ç½—ç±³ä¿®æ–¯è¯†åˆ«çš„æ ¼å¼å’Œå¯¼å‡ºæ•°æ®ç­‰åŠŸèƒ½ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMeterï¼ˆæŒ‡æ ‡ï¼‰\u003c/p\u003e\n\u003cp\u003eç›‘æ§æ•°æ®çš„æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯å›´ç»•ç€ Meterï¼ˆæŒ‡æ ‡ï¼‰, é€šè¿‡ä¸€ä¸ªä¸€ä¸ªçš„ Meterï¼ˆæŒ‡æ ‡ï¼‰æ•°æ®æ¥è¿›è¡Œè§‚å¯Ÿåº”ç”¨çš„çŠ¶æ€ã€‚å¸¸ç”¨çš„æŒ‡æ ‡å¦‚ï¼š\u003c/p\u003e","tags":["Spring Boot","Java"],"title":"Spring Boot ä½¿ç”¨ Micrometer é›†æˆ Prometheus ç›‘æ§ï¼Œ5 åˆ†é’Ÿæ¥å…¥è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡"},{"content":"ç¨‹åºå‘˜çš„ç‘å£«å†›åˆ€ï¼Œå¸¸ç”¨ä¼˜ç§€å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸Šæ¦œéƒ½æ˜¯æœ‰ç†ç”±çš„ã€‚\nprocs æ¯” ps å¥½ç”¨çš„å·¥å…·ï¼ŒæŸ¥çœ‹è·¯å¾„å’Œç«¯å£ä¸€æ­¥åˆ°ä½ï¼Œæ”¯æŒè¿‡æ»¤ã€‚\nripgrep ripgrep ç®€ç§° rgï¼Œæ˜¯ä¸€ä¸ªé¢å‘è¡Œçš„æœç´¢å·¥å…·ï¼ŒRust ç¼–å†™ï¼Œå…¨å¹³å°æ”¯æŒï¼Œä¹Ÿæ˜¯ VS Code çš„é»˜è®¤æœç´¢å·¥å…·ã€‚å®ƒçš„æœç´¢æ€§èƒ½æé«˜ï¼Œåœ¨å¤§é¡¹ç›®ä¸­ä¹Ÿæœ‰ç€å‡ºè‰²çš„è¡¨ç°ï¼Œå¹¶ä¸”é»˜è®¤å¯ä»¥å¿½ç•¥ .gitignore æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œéå¸¸å®ç”¨ã€‚\né™¤äº†ä½œä¸ºä¸€ä¸ªé«˜æ•ˆçš„å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨å¤–ï¼Œæ•´ä¸ªé¡¹ç›®çš„è®¾è®¡ä¹Ÿä¸é”™ï¼Œå¦å¤–è¿˜æ˜¯ä¸€ä¸ªå­¦ä¹  Rust çš„å¥½é¡¹ç›®ã€‚\nrg -h å¼€å¯æ¢ç´¢ä¹‹æ—…å§ã€‚\nTL;DR Too Long; Didnâ€™t Read.\ntldr æ ¹æ®äºŒå…«åŸåˆ™ï¼Œç®€åŒ–äº†çƒ¦ççš„ man æŒ‡ä»¤å¸®åŠ©æ–‡æ¡£ï¼Œä»…åˆ—å‡ºå¸¸ç”¨çš„è¯¥æŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œè®©äººä¸€çœ‹å°±æ‡‚ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»™å‡ºå‡ ä¸ªæŒ‡ä»¤çš„ä½¿ç”¨ demo å¯èƒ½æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚\nä¸¾ä¸ªä¾‹å­çœ‹ä¸‹å®é™…è¿è¡Œæ•ˆæœï¼Œå¦‚ä¸‹ï¼ˆå¤ªé•¿ï¼ŒèŠ‚é€‰ï¼‰ã€‚\nâœ ~ tldr docker List all docker containers (running and stopped): docker ps -a Start a container from an image, with a custom name: docker run --name container_name image Start or stop an existing container: docker start|stop container_name tldr å‘½ä»¤è¡Œæœ‰å¤šç§å®ç°ï¼Œæ¯”å¦‚å®˜æ–¹æ¨èçš„æœ‰ npm å’Œ pythonã€‚\nä¸ªäººæ›´å–œæ¬¢ Rust ç‰ˆæœ¬çš„å®ç° tealdeer ï¼Œæ”¯æŒå„ç³»ç»ŸåŒ…ç®¡ç†å™¨å’ŒäºŒè¿›åˆ¶å®‰è£…ï¼Œæ¯”å¦‚ homebrewã€‚\nbrew install tealdeer\rfd fd ï¼Œfind çš„æ›¿ä»£å“ã€‚\nbottom bottom ï¼Œç±»ä¼¼ Top çš„é…·ç‚«ç³»ç»Ÿç›‘æ§å·¥å…·ï¼ŒInspired by gtop, gotop, and htopã€‚\nbat bat ï¼Œä¸€åªå¸¦ç¿…è†€çš„ catï¼Œä»£æ›¿ cat å‘½ä»¤ã€‚\n","date":"2024-03-09","id":38,"permalink":"/docs/tldr/knife/","summary":"\u003cp\u003eç¨‹åºå‘˜çš„ç‘å£«å†›åˆ€ï¼Œå¸¸ç”¨ä¼˜ç§€å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸Šæ¦œéƒ½æ˜¯æœ‰ç†ç”±çš„ã€‚\u003c/p\u003e\n\u003ch2 id=\"procs\"\u003eprocs\u003c/h2\u003e\n\u003cp\u003eæ¯” ps å¥½ç”¨çš„å·¥å…·ï¼ŒæŸ¥çœ‹è·¯å¾„å’Œç«¯å£ä¸€æ­¥åˆ°ä½ï¼Œæ”¯æŒè¿‡æ»¤ã€‚\u003c/p\u003e\n\u003ch2 id=\"ripgrep\"\u003eripgrep\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/BurntSushi/ripgrep\" target=\"_blank\" rel=\"noopener\"\u003eripgrep\u003c/a\u003e\n ç®€ç§° rgï¼Œæ˜¯ä¸€ä¸ªé¢å‘è¡Œçš„æœç´¢å·¥å…·ï¼ŒRust ç¼–å†™ï¼Œå…¨å¹³å°æ”¯æŒï¼Œä¹Ÿæ˜¯ VS Code çš„é»˜è®¤æœç´¢å·¥å…·ã€‚å®ƒçš„æœç´¢æ€§èƒ½æé«˜ï¼Œåœ¨å¤§é¡¹ç›®ä¸­ä¹Ÿæœ‰ç€å‡ºè‰²çš„è¡¨ç°ï¼Œå¹¶ä¸”é»˜è®¤å¯ä»¥å¿½ç•¥ .gitignore æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œéå¸¸å®ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eé™¤äº†ä½œä¸ºä¸€ä¸ªé«˜æ•ˆçš„å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨å¤–ï¼Œæ•´ä¸ªé¡¹ç›®çš„è®¾è®¡ä¹Ÿä¸é”™ï¼Œå¦å¤–è¿˜æ˜¯ä¸€ä¸ªå­¦ä¹  Rust çš„å¥½é¡¹ç›®ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003erg -h\u003c/code\u003e å¼€å¯æ¢ç´¢ä¹‹æ—…å§ã€‚\u003c/p\u003e\n\u003ch2 id=\"tldr\"\u003eTL;DR\u003c/h2\u003e\n\u003cp\u003eToo Long; Didnâ€™t Read.\u003c/p\u003e\n\u003cp\u003etldr æ ¹æ®äºŒå…«åŸåˆ™ï¼Œç®€åŒ–äº†çƒ¦ççš„ man æŒ‡ä»¤å¸®åŠ©æ–‡æ¡£ï¼Œä»…åˆ—å‡ºå¸¸ç”¨çš„è¯¥æŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œè®©äººä¸€çœ‹å°±æ‡‚ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»™å‡ºå‡ ä¸ªæŒ‡ä»¤çš„ä½¿ç”¨ demo å¯èƒ½æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªä¾‹å­çœ‹ä¸‹å®é™…è¿è¡Œæ•ˆæœï¼Œå¦‚ä¸‹ï¼ˆå¤ªé•¿ï¼ŒèŠ‚é€‰ï¼‰ã€‚\u003c/p\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-console\" data-lang=\"console\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003eâœ  ~ tldr docker\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e  List all docker containers (running and stopped):\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e      docker ps -a\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e  Start a container from an image, with a custom name:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e      docker run --name container_name image\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e  Start or stop an existing container:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"go\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e      docker start|stop container_name\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cp\u003e\u003ca href=\"https://github.com/tldr-pages/tldr\" target=\"_blank\" rel=\"noopener\"\u003etldr\u003c/a\u003e\n å‘½ä»¤è¡Œæœ‰å¤šç§å®ç°ï¼Œæ¯”å¦‚å®˜æ–¹æ¨èçš„æœ‰ npm å’Œ pythonã€‚\u003c/p\u003e","tags":[],"title":"Knife"},{"content":"Linux Shell æ—¥å¸¸ç¼–ç¨‹å®ç”¨å¥å¼é€ŸæŸ¥ï¼Œæ³¨æ„ä»¥ä¸‹ä¾‹å­å¦‚æ— ç‰¹æ®Šè¯´æ˜éƒ½æ˜¯ bash è¯­æ³•ã€‚\né€‰æ‹©æ‰§è¡Œç¯å¢ƒã€‚ #!/usr/bin/env bash #!/usr/bin/bash\ræŒ‡å®šå˜é‡é»˜è®¤å€¼ï¼Œå–ç¯å¢ƒå˜é‡ï¼Œå–ä¸åˆ°ç”¨é»˜è®¤å€¼ã€‚ rep=${ENV_YOUR_KEY:-\u0026#34;my-default-value\u0026#34;}\rè·å–å½“å‰æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼Œæ³¨æ„ç›´æ¥ç”¨ $0 æˆ– pwd è·å–çš„å¯èƒ½éƒ½ä¸è¦ä½ æƒ³è¦çš„ã€‚ current_dir=$(cd `dirname $0`;pwd)\rä¸ºå½“å‰ç›®å½•åŒ…å«å­ç›®å½•ä¸‹æ‰€æœ‰ .sh æ–‡ä»¶å¢åŠ å¯æ‰§è¡Œæƒé™ã€‚ chmod +x `find . -name \u0026#39;*.sh\u0026#39;`\ré€šè¿‡ tee å°†æç¤ºä¿¡æ¯æ˜¾ç¤ºåˆ°ç»ˆç«¯ï¼Œå¹¶åŒæ—¶å†™å…¥åˆ°æ–‡ä»¶ã€‚ log_file=/var/log/test.log echo \u0026#34;This line will echo to console and also write to log file.\u0026#34; | tee -a ${log_file}\rç±»ä¼¼äº Java properties ä¸­ key=value å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œå– key å’Œ value çš„å€¼ã€‚ username_line=\u0026#34;username=test\u0026#34; #key is username key=${username_line%=*} #val is test val=${username_line#*=}\rå®ç° String trim æ•ˆæœã€‚ #trim string by echo val_trim=$(echo -n ${val})\rå£°æ˜å’Œå¾ªç¯æ•°ç»„ã€‚ apps=(foo bar) for app in ${apps[@]} do echo \u0026#34;$app\u0026#34; done\ræ–‡ä»¶ ls è½¬æ•°ç»„ # ls è½¬æ•°ç»„ï¼Œæ ¹æ®éœ€è¦ grep arrs=($(ls helmfiles/apps | grep -v .yaml))\ræŒ‡å®šæ•°ç»„åˆ†å‰²ç¬¦ï¼Œå­—ç¬¦ä¸²è½¬æ•°ç»„ã€‚ # è·å–å½“å‰ helm list å‘½ä»¤è¾“å‡ºç»“æœï¼Œé€šè¿‡æ¢è¡Œåˆ†å‰²æˆæ•°ç»„ IFS=$\u0026#39;\\n\u0026#39; helm_list=($(helm list --no-headers)) for hm in ${helm_list[@]} do # å¯¹æ¯ä¸€è¡Œè¿›è¡Œè§£ææŒ‰ Tab å†åˆ†å‰²æˆæ•°ç»„ IFS=$\u0026#39;\\t\u0026#39; hma=($hm) echo \u0026#34;helm upgrade --install ${hma[0]} ${hma[0]} --version ${hma[6]} --reset-values 2\u0026gt;\u0026amp;1\u0026#34; done\ræ–‡ä»¶æŒ‰å†…å®¹æ’åºã€‚ log=my-log-file # åŸåœ°æ’åºè¦†ç›–åŸæ–‡ä»¶ sort -o ${log} ${log}\råˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸä¸²å¼€å¤´ï¼Œå¹¶å»é™¤æŒ‡å®šå‰ç¼€ã€‚ img=docker.io/nginx:1.20 repo=docker.io # if åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥ repo å¼€å¤´ if [[ $img == $repo* ]]; then # æ³¨æ„è¿™é‡Œ +2 suffix=$(echo $img | cut -c$((${#repo}+2))-) # è¾“å‡º nginx:1.20 echo \u0026#34;$suffix\u0026#34; fi\ræŒ‰å¤šä¸ªå…³é”®è¯ æˆ– è¿‡æ»¤ã€‚ echo \u0026#34;nginx\u0026#34; | grep -E \u0026#34;nginx|tomcat\u0026#34; echo \u0026#34;tomcat\u0026#34; | grep -E \u0026#34;nginx|tomcat\u0026#34; echo \u0026#34;envoy\u0026#34; | grep -E \u0026#34;nginx|tomcat\u0026#34;\rè·å–å½“å‰æ—¶é—´ï¼ŒåŠ å‡æ—¶åŒºã€‚ ct=$(TZ=UTC+8 date \u0026#34;+%Y%m%d%H%M\u0026#34;)\ræ£€æŸ¥æ˜¯å¦ä»¥ root ç”¨æˆ·æ‰§è¡Œã€‚ # check if run as root user if [[ `id -u` -ne 0 ]]; then echo \u0026#34;You need root privileges to run this script.\u0026#34; fi\r","date":"2024-03-09","id":39,"permalink":"/docs/tldr/shell-coding/","summary":"\u003cp\u003eLinux Shell æ—¥å¸¸ç¼–ç¨‹å®ç”¨å¥å¼é€ŸæŸ¥ï¼Œæ³¨æ„ä»¥ä¸‹ä¾‹å­å¦‚æ— ç‰¹æ®Šè¯´æ˜éƒ½æ˜¯ bash è¯­æ³•ã€‚\u003c/p\u003e\n\u003chr\u003e\n\u003cul\u003e\n\u003cli\u003eé€‰æ‹©æ‰§è¡Œç¯å¢ƒã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/usr/bin/env bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/usr/bin/bash\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæŒ‡å®šå˜é‡é»˜è®¤å€¼ï¼Œå–ç¯å¢ƒå˜é‡ï¼Œå–ä¸åˆ°ç”¨é»˜è®¤å€¼ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erep\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eENV_YOUR_KEY\u003c/span\u003e\u003cspan class=\"k\"\u003e:-\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;my-default-value\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eè·å–å½“å‰æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼Œæ³¨æ„ç›´æ¥ç”¨ $0 æˆ– pwd è·å–çš„å¯èƒ½éƒ½ä¸è¦ä½ æƒ³è¦çš„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecurrent_dir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e \u003cspan class=\"sb\"\u003e`\u003c/span\u003edirname \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nb\"\u003epwd\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eä¸ºå½“å‰ç›®å½•åŒ…å«å­ç›®å½•ä¸‹æ‰€æœ‰ .sh æ–‡ä»¶å¢åŠ å¯æ‰§è¡Œæƒé™ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod +x \u003cspan class=\"sb\"\u003e`\u003c/span\u003efind . -name \u003cspan class=\"s1\"\u003e\u0026#39;*.sh\u0026#39;\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eé€šè¿‡ tee å°†æç¤ºä¿¡æ¯æ˜¾ç¤ºåˆ°ç»ˆç«¯ï¼Œå¹¶åŒæ—¶å†™å…¥åˆ°æ–‡ä»¶ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elog_file\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var/log/test.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;This line will echo to console and also write to log file.\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e tee -a \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003elog_file\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eç±»ä¼¼äº Java properties ä¸­ key=value å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œå– key å’Œ value çš„å€¼ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eusername_line\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;username=test\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#key is username\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ekey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eusername_line\u003c/span\u003e\u003cspan class=\"p\"\u003e%=*\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#val is test\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eval\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eusername_line\u003c/span\u003e\u003cspan class=\"p\"\u003e#*=\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eå®ç° String trim æ•ˆæœã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#trim string by echo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eval_trim\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e -n \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eval\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eå£°æ˜å’Œå¾ªç¯æ•°ç»„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eapps\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003efoo bar\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e app in \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eapps\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$app\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæ–‡ä»¶ ls è½¬æ•°ç»„\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ls è½¬æ•°ç»„ï¼Œæ ¹æ®éœ€è¦ grep\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003earrs\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003els helmfiles/apps \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -v .yaml\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæŒ‡å®šæ•°ç»„åˆ†å‰²ç¬¦ï¼Œå­—ç¬¦ä¸²è½¬æ•°ç»„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è·å–å½“å‰ helm list å‘½ä»¤è¾“å‡ºç»“æœï¼Œé€šè¿‡æ¢è¡Œåˆ†å‰²æˆæ•°ç»„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eIFS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e$\u0026#39;\\n\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ehelm_list\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ehelm list --no-headers\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e hm in \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ehelm_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# å¯¹æ¯ä¸€è¡Œè¿›è¡Œè§£ææŒ‰ Tab å†åˆ†å‰²æˆæ•°ç»„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eIFS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e$\u0026#39;\\t\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ehma\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$hm\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;helm upgrade --install \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ehma\u003c/span\u003e\u003cspan class=\"p\"\u003e[0]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ehma\u003c/span\u003e\u003cspan class=\"p\"\u003e[0]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e --version \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ehma\u003c/span\u003e\u003cspan class=\"p\"\u003e[6]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e --reset-values 2\u0026gt;\u0026amp;1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæ–‡ä»¶æŒ‰å†…å®¹æ’åºã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elog\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emy-log-file\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åŸåœ°æ’åºè¦†ç›–åŸæ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esort -o \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003elog\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003elog\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸä¸²å¼€å¤´ï¼Œå¹¶å»é™¤æŒ‡å®šå‰ç¼€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edocker.io/nginx:1.20\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erepo\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edocker.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥ repo å¼€å¤´\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$img\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nv\"\u003e$repo\u003c/span\u003e* \u003cspan class=\"o\"\u003e]]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# æ³¨æ„è¿™é‡Œ +2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003esuffix\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$img\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e cut -c\u003cspan class=\"k\"\u003e$((\u003c/span\u003e\u003cspan class=\"si\"\u003e${#\u003c/span\u003e\u003cspan class=\"nv\"\u003erepo\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"k\"\u003e))\u003c/span\u003e-\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# è¾“å‡º  nginx:1.20\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$suffix\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæŒ‰å¤šä¸ªå…³é”®è¯ \u003ccode\u003eæˆ–\u003c/code\u003e è¿‡æ»¤ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;nginx\u0026#34;\u003c/span\u003e  \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -E \u003cspan class=\"s2\"\u003e\u0026#34;nginx|tomcat\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tomcat\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -E \u003cspan class=\"s2\"\u003e\u0026#34;nginx|tomcat\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;envoy\u0026#34;\u003c/span\u003e  \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -E \u003cspan class=\"s2\"\u003e\u0026#34;nginx|tomcat\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eè·å–å½“å‰æ—¶é—´ï¼ŒåŠ å‡æ—¶åŒºã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ect\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nv\"\u003eTZ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUTC+8 date \u003cspan class=\"s2\"\u003e\u0026#34;+%Y%m%d%H%M\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cul\u003e\n\u003cli\u003eæ£€æŸ¥æ˜¯å¦ä»¥ root ç”¨æˆ·æ‰§è¡Œã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\r\n\r\n\r\n\u003cdiv class=\"expressive-code\"\u003e\r\n  \u003cfigure class=\"frame is-terminal not-content\"\u003e\r\n  \u003cfigcaption class=\"header\"\u003e\r\n    \u003cspan class=\"title\"\u003e\u003c/span\u003e\r\n  \u003c/figcaption\u003e\r\n  \u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# check if run as root user\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[[\u003c/span\u003e \u003cspan class=\"sb\"\u003e`\u003c/span\u003eid -u\u003cspan class=\"sb\"\u003e`\u003c/span\u003e -ne \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e]]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;You need root privileges to run this script.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e","tags":[],"title":"Shell Coding"},{"content":"ä½¿ç”¨ backstage åˆ›å»ºå¼€å‘è€…é—¨æˆ·ã€‚\nBackstage æ’ä»¶èµ„æº Backstage å®˜æ–¹æ’ä»¶ï¼šhttps://backstage.io/plugins Backstage ç¤¾åŒºæ’ä»¶ï¼šhttps://github.com/backstage/community-plugins Red Hat è´¡çŒ®çš„ç¤¾åŒºæ’ä»¶ï¼šhttps://github.com/janus-idp/backstage-plugins Roadie è´¡çŒ®çš„æ’ä»¶ï¼šhttps://github.com/RoadieHQ/roadie-backstage-plugins ","date":"2024-01-27","id":40,"permalink":"/docs/platform/backstage/","summary":"\u003cp\u003eä½¿ç”¨ backstage åˆ›å»ºå¼€å‘è€…é—¨æˆ·ã€‚\u003c/p\u003e\n\u003ch2 id=\"backstage-æ’ä»¶èµ„æº\"\u003eBackstage æ’ä»¶èµ„æº\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eBackstage å®˜æ–¹æ’ä»¶ï¼š\u003ca href=\"https://backstage.io/plugins\" target=\"_blank\" rel=\"noopener\"\u003ehttps://backstage.io/plugins\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eBackstage ç¤¾åŒºæ’ä»¶ï¼š\u003ca href=\"https://github.com/backstage/community-plugins\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/backstage/community-plugins\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eRed Hat è´¡çŒ®çš„ç¤¾åŒºæ’ä»¶ï¼š\u003ca href=\"https://github.com/janus-idp/backstage-plugins\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/janus-idp/backstage-plugins\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://roadie.io/\" target=\"_blank\" rel=\"noopener\"\u003eRoadie\u003c/a\u003e\n è´¡çŒ®çš„æ’ä»¶ï¼š\u003ca href=\"https://github.com/RoadieHQ/roadie-backstage-plugins\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/RoadieHQ/roadie-backstage-plugins\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","tags":[],"title":"å¼€å‘è€…é—¨æˆ·"},{"content":"ä½œä¸ºä¸€ä¸ªä»¥ Java å’Œ Spring ä¸ºä¸»è¦æŠ€æœ¯æ ˆçš„å›¢é˜Ÿï¼Œåœ¨æ—¥å¸¸çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€ç³»åˆ—çš„ç»„ä»¶å‡çº§å’Œä»£ç é‡æ„éœ€æ±‚ï¼Œåœ¨æ­¤è¿‡ç¨‹æˆ‘ä»¬æœŸæœ›èƒ½åšåˆ°å‡ ä¸ªæ•ˆæœï¼š\né¡¹ç›®çº§å‡çº§ï¼šæ•´ä¸ªé¡¹ç›®ï¼ˆæ³¨æ­¤é¡¹ç›®æŒ‡ Maven Projectï¼‰å‡çº§ï¼Œè€Œä¸æ˜¯åŸºäºæŸä¸ª Java ç±»æˆ–ç‰‡æ®µã€‚ ä¸åŒç‰ˆæœ¬è·¨åº¦å˜æ›´ï¼šæ¯”å¦‚ä» Spring é¡¹ç›®è¿ç§»åˆ° Spring Bootï¼Œä» Spring Boot 2.x å‡çº§åˆ° 3.xï¼Œä» Java 8 å‡çº§åˆ° Java 21ã€‚ ä»£ç å®‰å…¨å¯é ï¼šå˜æ›´çš„ä»£ç ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œè‡³å°‘æ˜¯é€»è¾‘æ­£ç¡®çš„ï¼Œè‡³å°‘ä¸èƒ½åƒæŸ AI åŠ©æ‰‹ä¸€æ ·è®¾ç½®ä¸€äº›æ ¹æœ¬ä¸å­˜åœ¨çš„å±æ€§ã€‚ ç»éªŒäº§å“åŒ–ï¼šæœ€ä½³å®è·µå°±æ˜¯äº§å“ï¼Œæ¯”å¦‚æˆ‘å¹¶ä¸ï¼ˆæƒ³ï¼‰äº†è§£ Spring Boot 3.2 å…·ä½“æœ‰å“ªäº›å˜æ›´ï¼Œä½†å¸Œæœ›èƒ½ä¸€é”®ä» 3.0 è‡ªåŠ¨å‡çº§åˆ° 3.2ï¼Œç›´æ¥å‘Šè¯‰æœ‰å“ªäº›å˜æ›´ã€‚ è‡ªå®šä¹‰é‡æ„ï¼šå¯¹äºæŸäº›è‡ªç ”ä»£ç ï¼Œå¸Œæœ›èƒ½è‡ªå®šä¹‰é‡æ„é€»è¾‘ï¼Œä¸€é”®è‡ªåŠ¨é‡æ„ã€‚ åŸºäºä»¥ä¸ŠèƒŒæ™¯ï¼Œæˆ‘ä»¬æ¢ç´¢äº† OpenRewrite ã€Spring Boot Migrator ã€Redhat Windup ã€emt4j å’Œä¸€ä¼—ä¸ä¾¿å…·åçš„ AI ä»£ç åŠ©æ‰‹ï¼Œæœ¬æ–‡å°†åˆ†äº«æˆ‘ä»¬ä½¿ç”¨ OpenRewriteã€Spring Boot Migrator è¿›è¡Œä»£ç é‡æ„å’Œå‡çº§çš„ä¸€äº›ä½¿ç”¨ç»éªŒå’Œä½“éªŒã€‚\nOpenRewrite OpenRewrite æ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç é‡å†™å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨åŒ–å¤§è§„æ¨¡é‡æ„ä»£ç ã€‚\nå®ƒæä¾›äº†ä¸€å¥—å¼ºå¤§çš„ API å’Œæ’ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡é™æ€åˆ†æå’Œä»£ç è½¬æ¢æŠ€æœ¯æ¥è§£æã€ä¿®æ”¹å’Œç”Ÿæˆä»£ç ã€‚OpenRewrite æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Javaã€C#ã€ TypeScriptã€Pythonã€Kubernetes ç­‰ã€‚é€šè¿‡ä½¿ç”¨ OpenRewriteï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°è¿›è¡Œä»£ç é‡æ„ã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç é£æ ¼è°ƒæ•´å’Œä»£ç è¿ç§»ç­‰æ“ä½œï¼Œä»è€Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚OpenRewrite çš„å¼€æºæ€§è´¨ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥è‡ªç”±åœ°å®šåˆ¶å’Œæ‰©å±•å…¶åŠŸèƒ½ï¼Œä»¥æ»¡è¶³ç‰¹å®šé¡¹ç›®çš„éœ€æ±‚ã€‚\næ¯”å¦‚ Java é¢†åŸŸä¸€äº›çƒ­é—¨çš„åº”ç”¨åœºæ™¯ï¼š\nJava ç‰ˆæœ¬å‡çº§ï¼šä» Java 8 åˆ° Java 21ï¼Œä» Java EE åˆ° Jakarta EE ã€‚ Spring æ¡†æ¶è¿ç§»ï¼šä» Spring 5 åˆ° Spring 6ï¼Œä» Spring Boot 2 åˆ° Spring Boot 3ã€‚ æµ‹è¯•æ¡†æ¶è¿ç§»ï¼š ä» Junit 4 åˆ° Junit 5ã€‚ ä¾èµ–ç®¡ç†ï¼šè‡ªåŠ¨æ›´æ–° Java é¡¹ç›®çš„ Maven æˆ– Gradle ä¾èµ–ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°å’Œæœ€å®‰å…¨çš„åº“ç‰ˆæœ¬ã€‚ ä»£ç æ¸…ç†å’Œæ ¼å¼åŒ–ï¼šè‡ªåŠ¨æ¸…ç†å’Œæ ¼å¼åŒ– Java ä»£ç ï¼Œç¡®ä¿ç¬¦åˆé¡¹ç›®æˆ–ç»„ç»‡çš„ç¼–ç æ ‡å‡†å’Œé£æ ¼æŒ‡å—ã€‚ ä¿®å¤å®‰å…¨æ¼æ´ï¼šè‡ªåŠ¨è¯†åˆ«å’Œä¿®å¤ Java ä»£ç ä¸­çš„å·²çŸ¥å®‰å…¨æ¼æ´ï¼Œå¦‚ä½¿ç”¨äº†æœ‰å®‰å…¨é—®é¢˜çš„åº“æˆ–æ–¹æ³•ã€‚ ä»£ç å¼‚å‘³æ£€æµ‹å’Œä¿®å¤ï¼šè¯†åˆ«å¹¶è‡ªåŠ¨é‡æ„ Java ä»£ç ä¸­çš„â€œä»£ç å¼‚å‘³â€ï¼Œä»¥æé«˜ä»£ç å¯ç»´æŠ¤æ€§ã€‚ ç›¸æ¯”äºæ—¶ä¸‹ç«çƒ­çš„ AI ä»£ç å·¥å…·ï¼Œæ¯”å¦‚ GitHub Copilotã€Amazon CodeWhispererï¼Œæˆ‘è®¤ä¸º OpenRewrite çš„ä¼˜åŠ¿ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\nå¯ä»¥ç›´æ¥å¤„ç†å¤§å‹é¡¹ç›®ï¼Œæˆªæ­¢æˆ‘å†™æ­¤æ–‡çš„ä»Šå¤©è¿˜æ²¡ä¸€ä¸ªæˆç†Ÿçš„ AI åŠ©æ‰‹èƒ½å°†æ•´ä¸ªé¡¹ç›®ä¸€æ¬¡æ€§è¿ç§»æˆ–é‡æ„ã€‚ å‡†ç¡®åº¦è¾ƒé«˜ï¼Œå®ƒé€šè¿‡é¢„å®šä¹‰çš„è§„åˆ™æ¥å®ç°ä»£ç çš„ç²¾ç¡®ä¿®æ”¹ï¼Œç›®å‰å¾ˆå¤š AI ä»£ç åŠ©æ‰‹è¿˜åœ¨ä¸€æœ¬æ­£ç»çš„çæ‰¯ï¼Œå°¤å…¶æ˜¯å‡­ç©ºåˆ›é€ è®©äººé˜²ä¸èƒœé˜²ã€‚ å¯è‡ªå®šä¹‰æ‰©å±•ï¼Œå¯¹äºè‡ªç ”ä»£ç ä¸å¯èƒ½ç»è¿‡è‡ªåŠ¨å­¦ä¹ è¾¾åˆ°ç²¾ç¡®çš„æ•ˆæœï¼Œæ­¤æ—¶å¯è‡ªå®šä¹‰å®ç°ã€‚ å…è´¹ï¼Œå¯ç¦»çº¿ä½¿ç”¨ï¼Œä¾¿äº CI é›†æˆã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒAWS æœ€è¿‘æ¨å‡ºäº† Amazon Q Code Transformation ä¸“é—¨åšä»£ç è¿ç§»å’Œé‡æ„ï¼Œéœ€è¦å¼€é€š Amazon CodeWhisperer ä¼ä¸šç‰ˆæ‰èƒ½ä½¿ç”¨ï¼Œå¯æƒœæˆ‘æ²¡æœ‰é’±å»è¯•ç”¨ã€‚\nå¿«é€Ÿå…¥é—¨ OpenRewrite ä¸€ä¸ªæœ€æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯ Recipeï¼Œç”±äºæˆ‘æ˜¯å›½å†…é¦–ä¸ªç¿»è¯‘è¿™ä¸ªå•è¯çš„äººï¼Œä»¥ä¸‹å°†ç›´è¯‘ä¸ºé£Ÿè°±ã€‚ä¸€ä¸ª Recipe å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€å¥—å£°æ˜å¥½çš„è§„åˆ™ï¼ŒOpenRewrite æŒ‰ç…§å›ºå®šè§„åˆ™è¿›è¡Œé‡æ„ã€‚\nä¸€ä¸ª Recipe å¯ä»¥åŒ…å«å¤šä¸ª Recipeï¼Œå¯ä»¥å±‚çº§ç´¯åŠ ï¼Œæ¯”å¦‚ UpgradeSpringBoot_3_2å¯èƒ½åŒ…å«å¯¹ pom.xmlã€application.propertiesã€java main sourceã€java test source çš„å‡çº§æ”¹åŠ¨ã€‚\nåˆæ¬¡ä½¿ç”¨ OpenRewriteï¼Œå¯é€šè¿‡å®˜æ–¹æä¾›çš„ çƒ­é—¨æŒ‡å¯¼ æ‰¾åˆ°è‡ªå·±æ„Ÿå…´è¶£çš„æŒ‰æ­¥éª¤æ“ä½œã€‚\nå¦å¤–å°±æ˜¯é£Ÿè°±å¾ˆå¤šï¼Œä¸€ä¸ªä¸€ä¸ªç”¨å¾ˆéº»çƒ¦ï¼Œå¯ä¼˜å…ˆè€ƒè™‘ best practices ç³»åˆ—ï¼Œé‡Œé¢èšåˆäº†å¤šä¸ªé£Ÿè°±ã€‚\næ›´å¤šåŠŸèƒ½å¯é€šè¿‡ é£Ÿè°±åˆ†ç±» æœç´¢ï¼Œä¹Ÿå¯é€šè¿‡å®˜ç½‘å³ä¸Šæ–¹çš„æœç´¢æŒ‰é’®æŒ‰ç…§å…³é”®å­—æœç´¢ï¼Œä¹Ÿå¯é€šè¿‡ mvn rewrite:discover åˆ—å‡ºå¯ç”¨çš„é£Ÿè°±ã€‚\nè¿è¡Œæ–¹å¼ å‹æƒ…æç¤ºï¼šè¿è¡Œå‰è¯·æŠŠä»£ç äº¤ç»™ Git ç®¡ç†ï¼Œå¹¶ checkout ä¸€ä¸ªå…¨æ–°çš„åˆ†æ”¯ï¼Œä¾¿äºæ¯”å¯¹è‡ªåŠ¨ä¿®æ”¹äº†å“ªäº›ä»£ç ã€‚\nOpenRewrite æ”¯æŒä½¿ç”¨ mavenã€gradle ä»¥åŠä½¿ç”¨ SaaS æœåŠ¡ Moderne cli mod è¿™ä¸‰ç§æ–¹æ³•ã€‚\nä½¿ç”¨ mavenã€gradle æ–‡ä»¶å®šåˆ¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œdependency ç®¡ç†ä¹Ÿæ¯”è¾ƒçµæ´»ï¼Œå¦å¤–æŸäº›é£Ÿè°±åªæœ‰ mavenã€gradle æ”¯æŒï¼Œç¼ºç‚¹åˆ™æ˜¯éœ€è¦ä¿®æ”¹ pomã€gradle æ–‡ä»¶ã€‚\nä½¿ç”¨ maven å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œæ’ä»¶ä»»åŠ¡å¹¶æŒ‡å®šå±æ€§ï¼Œä¸ç”¨æ”¹ pom.xml æ›´æ–¹ä¾¿ï¼Œç¼ºç‚¹æ˜¯ä¸æ–¹ä¾¿ç®¡ç† dependenciesã€‚\nmvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes=org.openrewrite.java.migrate.jakarta.JakartaEE10 -Drewrite.exportDatatables=true\rä½¿ç”¨ SaaS æœåŠ¡æä¾›çš„ Moderne CLI æœ€æ–¹ä¾¿ï¼Œæ¯”å¦‚ mod run . --recipe JakartaEE10, éœ€è¦æ³¨å†Œ licenseã€‚\næœ€ä½³å®è·µå’Œå®šåˆ¶ OpenRewrite å¯¹ä¸åŒç±»å‹åˆ†åˆ«å†…ç½®äº†ä¸€äº›æœ€ä½³å®è·µï¼Œå¯é€šè¿‡ best practices å…³é”®å­—æœç´¢ã€‚\næœ€ä½³å®è·µåŒ…å«äº†å“ªäº›è§„åˆ™å‘¢ï¼Œä»¥ Spring Boot 3.x best practices ä¸ºä¾‹ï¼Œåœ¨æ–‡æ¡£ä¸­èƒ½çœ‹åˆ°å¯¹åº”çš„é£Ÿè°±åˆ—è¡¨å¦‚ä¸‹ï¼š\n--- type: specs.openrewrite.org/v1beta/recipe name: org.openrewrite.java.spring.boot3.SpringBoot3BestPractices displayName: Spring Boot 3.x best practices description: Applies best practices to Spring Boot 3 applications. tags: - spring - boot recipeList: - org.openrewrite.java.spring.boot2.SpringBoot2BestPractices - org.openrewrite.java.migrate.UpgradeToJava21 - org.openrewrite.java.spring.boot3.UpgradeSpringBoot_3_2\rè€Œå…¶ä¸­æ¯ä¸ªé£Ÿè°±åˆå¯èƒ½åŒ…å«å¤šä¸ªï¼Œæ¯”å¦‚ä¸Šé¢çš„ org.openrewrite.java.spring.boot2.SpringBoot2BestPractices åˆåŒ…å«ä»¥ä¸‹åˆ—è¡¨ï¼š\n--- type: specs.openrewrite.org/v1beta/recipe name: org.openrewrite.java.spring.boot2.SpringBoot2BestPractices displayName: Spring Boot 2.x best practices description: Applies best practices to Spring Boot 2 applications. tags: - spring - boot recipeList: - org.openrewrite.java.spring.NoRequestMappingAnnotation - org.openrewrite.java.spring.ImplicitWebAnnotationNames - org.openrewrite.java.spring.boot2.UnnecessarySpringExtension - org.openrewrite.java.spring.NoAutowiredOnConstructor - org.openrewrite.java.spring.boot2.RestTemplateBuilderRequestFactory - org.openrewrite.java.spring.boot2.ReplaceDeprecatedEnvironmentTestUtils\rå¦‚æœå®˜æ–¹çš„æŸä¸ªé£Ÿè°±ä¸å’Œä½ çš„èƒƒå£ï¼Œæ¯”å¦‚æƒ³åœ¨æœ€ä½³å®è·µä¸­å»æ‰æˆ–æ–°å¢æŸä¸ªè‡ªå®šä¹‰é£Ÿè°±æ€ä¹ˆåŠï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ª rewrite.yml æ–‡ä»¶ï¼Œç±»ä¼¼ä¸Šé¢çš„ yaml æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­è‡ªè¡Œç»„åˆé£Ÿè°±ã€‚æ³¨æ„ rewrite.yml æ–‡ä»¶è¦æ”¾åˆ° maven é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ›´å¤šå…³äºæ–‡ä»¶çš„è¯´æ˜å‚è€ƒ Refactoring with declarative YAML recipes ã€‚\nCI é›†æˆ é€šè¿‡ mvn rewrite:run å‘½ä»¤æ‰§è¡Œåï¼Œä¼šç›´æ¥ä¿®æ”¹ä»£ç ã€‚ä½†æ˜¯å¤§éƒ¨åˆ† CI åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½åªæƒ³åšåˆ†æï¼Œä¸æƒ³çœŸæ­£æ”¹åŠ¨ä»£ç ã€‚é‚£ä¹ˆå°±å¯ä»¥æŠŠå‘½ä»¤æ¢æˆ mvn rewrite:dryRunï¼ŒdryRun ä¼šåœ¨æ§åˆ¶å°è¾“å‡º warning ç»“æœï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª rewrite.patch æ–‡ä»¶ã€‚\nå¦‚æœ dryRun å‘æ§åˆ¶å°æ—¥å¿—å‘å‡ºä»»ä½•è­¦å‘Šï¼Œæˆ–è€…ç”Ÿæˆäº† rewrite.patch æ–‡ä»¶ï¼Œè¯æ˜æ­¤æ¬¡æœ‰éœ€è¦å˜æ›´çš„åœ°æ–¹ï¼Œåˆ™å¯è§†ä¸º CI å¤±è´¥ã€‚\nSpring Boot Migrator OpenRewrite åŠŸèƒ½å¾ˆå¼ºæ‚ï¼Œä½†æ˜¯ä»ç¼ºå¤±ä¸€é¡¹åŠŸèƒ½ï¼šå°†ä¼ ç»Ÿ Spring é¡¹ç›®ä¸€é”®è¿ç§»åˆ° Spring Bootã€‚\nSpring Boot Migrator åŸºäº OpenRewriteï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºååŠ©å°†ä¼ ç»Ÿçš„ Spring åº”ç”¨è¿ç§»åˆ°åŸºäº Spring Boot çš„å·¥å…·ï¼ŒåŒæ—¶ä¹Ÿæä¾› Spring Boot çš„å‡çº§ã€‚\nSpring Boot Migrator ç¨‹åºè¿è¡Œèµ·æ¥åï¼Œé€šè¿‡ list å‘½ä»¤å¯ä»¥çœ‹åˆ°æä¾›çš„ OpenRewrite recipesï¼Œå…¶ä¸­ä¸»è¦å…³æ³¨çš„æœ‰ï¼š\ninitialize-spring-boot-migration: å°†é¡¹ç›®åˆå§‹åŒ–ä¸º Spring Boot åº”ç”¨ã€‚ migrate-spring-xml-to-java-configï¼šå°† Spring xml è½¬æ¢ä¸º Java æ³¨è§£ã€‚ spring-context-xml-importï¼šä½¿ç”¨ Import xml æ–‡ä»¶çš„å½¢å¼åˆå§‹åŒ– Beanã€‚ boot-2.7-3.0-dependency-version-updateï¼šSpring Boot 2 å‡çº§åˆ° Spring Boot 3ã€‚ migrator:\u0026gt; list Found these recipes: 1) remove-redundant-maven-compiler-plugin -\u0026gt; Remove standard maven-compiler plugin for applications with boot parent. 2) initialize-spring-boot-migration -\u0026gt; Initialize an application as Spring Boot application. 3) migrate-jndi-lookup -\u0026gt; Migrate JNDI lookup using InitialContext to Spring Boot 4) migrate-jpa-to-spring-boot -\u0026gt; Migrate JPA to Spring Boot 5) migrate-ejb-jar-deployment-descriptor -\u0026gt; Add or overrides @Stateless annotation as defined in ejb deployment descriptor 6) migrate-weblogic-ejb-deployment-descriptor -\u0026gt; Migrate weblogic-ejb-jar.xml deployment descriptor 7) mark-and-clean-remote-ejbs -\u0026gt; Search @Stateless EJBs implementing a @Remote interface 8) migrate-stateless-ejb -\u0026gt; Migration of stateless EJB to Spring components. 9) migrate-annotated-servlets -\u0026gt; Allow Spring Boot to deploy servlets annotated with @WebServlet 10) migrate-jax-ws -\u0026gt; Migrate Jax Web-Service implementation to Spring Boot bases Web-Service 11) migrate-jax-rs -\u0026gt; Any class has import starting with javax.ws.rs 12) migrate-mule-to-boot -\u0026gt; Migrate Mulesoft 3.9 to Spring Boot. 13) migrate-tx-to-spring-boot -\u0026gt; Migration of @TransactionAttribute to @Transactionsl 14) spring-context-xml-import -\u0026gt; Import Spring Framework xml bean configuration into Java configuration without converting them. 15) migrate-spring-xml-to-java-config -\u0026gt; Migrate Spring Framework xml bean configuration to Java configuration. 16) migrate-jms -\u0026gt; Convert JEE JMS app into Spring Boot JMS app 17) documentation-actions -\u0026gt; Create Documentation for Actions 18) migrate-jsf-2.x-to-spring-boot -\u0026gt; Use joinfaces to integrate JSF 2.x with Spring Boot. 19) cn-spring-cloud-config-server -\u0026gt; Externalize properties to Spring Cloud Config Server 20) boot-2.4-2.5-upgrade-report -\u0026gt; Create Upgrade Report for a Spring Boot 2.4 Application 21) boot-2.7-3.0-dependency-version-update -\u0026gt; Bump spring-boot-starter-parent from 2.7.x to 3.0.0 22) boot-autoconfiguration-update -\u0026gt; Create org.springframework.boot.autoconfigure.AutoConfiguration.imports file for new spring 2.7 23) boot-2.4-2.5-datasource-initializer -\u0026gt; Replace deprecated spring.datasource.* properties 24) boot-2.4-2.5-spring-data-jpa -\u0026gt; Rename JpaRepository methods getId() and calls to getOne() 25) boot-2.4-2.5-dependency-version-update -\u0026gt; Update Spring Boot dependencies from 2.4 to 2.5 26) boot-2.7-3.0-upgrade-report -\u0026gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.0-M3 27) boot-2.4-2.5-sql-init-properties -\u0026gt; Replace deprecated spring.datasource.* properties 28) sbu30-report -\u0026gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.x 29) sbu30-upgrade-dependencies -\u0026gt; Spring boot 3.0 Upgrade - Upgrade dependencies 30) sbu30-set-java-version -\u0026gt; Spring boot 3.0 Upgrade - Set java version property in build file 31) sbu30-add-milestone-repositories -\u0026gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins 32) sbu30-migrate-spring-data-properties -\u0026gt; Spring boot 3.0 Upgrade - Migrate \u0026#39;spring.data\u0026#39; properties to new property names 33) sbu30-remove-construtor-binding -\u0026gt; Spring boot 3.0 Upgrade - Remove redundant @ConstructorBinding annotations 34) sbu30-migrate-to-jakarta-packages -\u0026gt; Spring boot 3.0 Upgrade - Migrate javax packages to new jakarta packages 35) sbu30-johnzon-dependency-update -\u0026gt; Spring boot 3.0 Upgrade - Specify version number for johnzon-core 36) sbu30-225-logging-date-format -\u0026gt; Spring boot 3.0 Upgrade - Logging Date Format 37) sbu30-auto-configuration -\u0026gt; Move EnableAutoConfiguration Property from spring.factories to AutoConfiguration.imports 38) sbu30-upgrade-spring-cloud-dependency -\u0026gt; Upgrade Spring Cloud Dependencies 39) sbu30-upgrade-boot-version -\u0026gt; Spring boot 3.0 Upgrade - Upgrade Spring Boot version 40) sbu30-remove-image-banner -\u0026gt; Spring boot 3.0 Upgrade - Remove the image banner at src/main/resources 41) sbu30-paging-and-sorting-repository -\u0026gt; Spring boot 3.0 Upgrade - Add CrudRepository interface extension additionally to PagingAndSortingRepository 42) migrate-raml-to-spring-mvc -\u0026gt; Create Spring Boot @RestController from .raml files. 43) migrate-boot-2.3-2.4 -\u0026gt; Migrate from Spring Boot 2.3 to 2.4 44) upgrade-boot-1x-to-2x -\u0026gt; Migrate applications built on previous versions of Spring Boot to the latest Spring Boot 2.7 release. OpenRewrite ä½¿ç”¨ç¤ºä¾‹ ä¸‹é¢ä½¿ç”¨ maven æ–¹å¼æ¼”ç¤ºå‡ ä¸ªä¾‹å­ï¼Œæ³¨æ„å¦‚æœæ˜¯ maven å¤šæ¨¡å—é¡¹ç›®ï¼Œè¯·åœ¨çˆ¶æ¨¡å—ä¸‹æ‰§è¡Œï¼Œå¦åˆ™è¿è¡Œå¯èƒ½å‡ºé”™ï¼Œå‚è€ƒå®˜æ–¹è¯´æ˜ï¼šRunning Rewrite on a multi-module Maven project ã€‚\nå‹æƒ…æé†’ï¼šåˆæ¬¡ä½¿ç”¨ä¼šä¸‹è½½å¾ˆå¤šä¾èµ– jar åŒ…ï¼Œé€Ÿåº¦å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œåˆ‡æ¢åˆ°ä½ æœ€å¿«çš„ maven ä»“åº“ã€‚\nå‡çº§åˆ° Java 21 ä»ä»»æ„ç‰ˆæœ¬å‡çº§åˆ° Java 21ã€‚\nmvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes=org.openrewrite.java.migrate.UpgradeToJava21 # æˆ–è€…æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬ mvn -U org.openrewrite.maven:rewrite-maven-plugin:5.31.0:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:2.14.0 -Drewrite.activeRecipes=org.openrewrite.java.migrate.UpgradeToJava21\rOpenRewrite ä¼šè‡ªåŠ¨æ›¿æ¢ä¸€äº› Java 21 æ”¯æŒçš„æ–°ç‰¹æ€§ï¼Œå¦‚ï¼š\nå¤§æ–‡æœ¬å— JEP 378: Text Blocksï¼Œè‡ªåŠ¨ä¼˜åŒ–æ ¼å¼åŒ–ã€‚ æ¨¡å¼åŒ¹é…å¢å¼ºï¼šæ”¯æŒåœ¨æ‰§è¡Œ instanceof æ“ä½œæ—¶åŒæ—¶å®šä¹‰æŒ‡å®šç±»å‹çš„æ–°å˜é‡ï¼Œçœå´äº†ç±»å‹è½¬æ¢çš„è¿‡ç¨‹ã€‚ String ç±»å¢åŠ çš„æ–°æ ¼å¼åŒ–æ–¹æ³•ï¼š formatted(Objectâ€¦â€‹ args)ã€‚ æ’åºæ€§é›†åˆï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨ getFirst() å’Œ getLast() æ¥è·å–ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªé›†åˆå…ƒç´ äº†ã€‚å‚è€ƒï¼š JEP 431: Sequenced Collectionsã€‚ Base64 æ–¹æ³•æ›¿æ¢ Base64 å¸¸ç”¨çš„å®ç°æœ‰ï¼š\nApache Common Codecï¼Œä¾ç„¶å¯ç”¨ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦è½¬æ¢æˆ java.util.Base64ã€‚ sun.misc åŒ…ä¸‹æä¾›çš„å®ç°ç±»ï¼Œä» Java 9 å¼€å§‹ï¼Œå·²ç»ä¸å†å¯¹å¤–æä¾›ï¼Œéœ€è¦æ›¿æ¢ã€‚ ä» Java 1.8 å¼€å§‹æä¾›çš„æ ‡å‡†åº“ java.util.Base64ã€‚ # UseJavaUtilBase64 mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes=org.openrewrite.java.migrate.UseJavaUtilBase64 -Drewrite.exportDatatables=true # ApacheBase64ToJavaBase64 mvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-apache:RELEASE -Drewrite.activeRecipes=org.openrewrite.apache.commons.codec.ApacheBase64ToJavaBase64 -Drewrite.exportDatatables=true\rå¦å¤–æ›´å¤šå…³äº Apache åŒ…å‡çº§ã€ä½¿ç”¨ Java è‡ªå¸¦æ–¹æ³•ä»£æ›¿ Apache Utils çš„æ–¹æ³•ï¼Œè¯·å‚è€ƒ OpenRewrite å®˜ç½‘ apache ä¸‹çš„é£Ÿè°±ã€‚\nå‡çº§åˆ° JakartaEE ä» javax åˆ° jakartaï¼Œåœ¨ maven é¡¹ç›®çˆ¶ï¼ˆæ ¹ï¼‰æ¨¡å—ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼Œæ³¨æ„å‘½ä»¤å¯èƒ½éšç€ç‰ˆæœ¬å˜åŒ–ï¼Œè¯·å»å®˜ç½‘æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ç¤ºä¾‹ã€‚\nmvn -U org.openrewrite.maven:rewrite-maven-plugin:run -Drewrite.recipeArtifactCoordinates=org.openrewrite.recipe:rewrite-migrate-java:RELEASE -Drewrite.activeRecipes=org.openrewrite.java.migrate.jakarta.JakartaEE10 -Drewrite.exportDatatables=true\ræ‰§è¡Œå®Œæˆåå¯æ ¹æ® git diff æŸ¥çœ‹ä¿®æ”¹æ•ˆæœã€‚\nä»£ç æ¸…ç† å…ˆè¯•ä¸€ä¸‹ CodeCleanup æ•ˆæœã€‚\npom.xml æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹é…ç½®ï¼Œç„¶åæ‰§è¡Œ mvn rewrite:runã€‚\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.23.1\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;activeRecipes\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.staticanalysis.CodeCleanup\u0026lt;/recipe\u0026gt; \u0026lt;/activeRecipes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.recipe\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-static-analysis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt;\ræˆ‘çš„æŸä¸ªé¡¹ç›®æ‰§è¡Œæ•ˆæœï¼š\nåˆ é™¤äº†ä¸€äº›å¤šä½™çš„ç©ºæ ¼ã€ç©ºè¡Œã€å¤šæ‹¬å·ã€‚ ä»£ç æ ¼å¼åŒ–ï¼Œæ¯”å¦‚å¤šä¸ªå‚æ•°é—´ç¼ºå°‘ç©ºæ ¼çš„åŠ äº†ç©ºæ ¼ã€‚ é¢ å€’äº†ä¸€ä¸ª equals æ¯”è¾ƒï¼š method.equals(\u0026quot;CONNECT\u0026quot;) -\u0026gt; \u0026quot;CONNECT\u0026quot;.equals(method)ã€‚ é•¿ä»£ç æ¢è¡Œå½’æ•´ï¼Œä¸‰å…ƒè¿ç®—æ ¼å¼åŒ–ã€‚ é™æ€åˆ†æã€æŸ¥æ‰¾ã€é‡æ„ æ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nåˆ†æä¾èµ–å…³ç³»ã€‚ æŸ¥æ‰¾æŸä¸ªæ–¹æ³•æ˜¯å¦è¢«ä½¿ç”¨ã€‚ å°†æŸä¸ªæ–¹æ³•æ›¿æ¢ä¸ºæŸä¸ªæ–¹æ³•ã€‚ æ‰¹é‡ä¿®æ”¹æ–¹æ³•åå­—ï¼Œä¿®æ”¹å‚æ•°ç±»å‹ç­‰ã€‚ æ’åº imports ï¼Œåˆ é™¤æœªä½¿ç”¨çš„ importsã€‚ é€šç”¨ä»£ç æ ¼å¼åŒ– æ— ç”¨ç©ºè¡Œã€ç©ºç™½ç¬¦ã€å‰åç©ºç™½ç¬¦ã€æ–¹æ³•å‚æ•°å‰åç©ºç™½ç¬¦ã€Tab è½¬ space ç­‰ä¸€äº›å¸¸ç”¨æ ¼å¼åŒ–æ–¹å¼ã€‚\næ—¥å¿—ä¼˜åŒ– Parameterize logging statementsï¼šæŠŠå­—ç¬¦ä¸²æ‹¼æ¥è‡ªåŠ¨è½¬ä¸ºå‚æ•°ç±»å‹ã€‚ ç”¨ logger ä»£æ›¿ System.errã€System.outã€printStackTraceã€‚ æŠŠ JULã€log4jã€logback éƒ½è½¬ä¸º slf4j APIã€‚ Spring åˆ° Spring Boot ä¸‹é¢ä»‹ç»ä¸‹æˆ‘ä»¬å°† Spring é¡¹ç›®è¿ç§»åˆ° Spring Boot çš„è¿‡ç¨‹ï¼Œä»¥åŠä¸­é—´é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚\nå‡çº§é¡¹ è¿ç§»å‰ è¿ç§»å Runtime Spring + Tomcat Spring Boot 3.2 Spring Spring 4 Spring 6 Junit Junit 4 Junit 5 okhttp okhttp 3 okhttp 4 Java Java 8 Java 21 Java EE Java EE Jakarta EE åŸºæœ¬æ­¥éª¤ï¼š\nä½¿ç”¨ Spring Boot Migrator å°† Spring é¡¹ç›®è½¬æ¢æˆ Spring Bootï¼Œä½¿ç”¨ Java 17 å¯åŠ¨ spring-boot-migrator ç¨‹åºå¹¶æ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥æ“ä½œï¼Œå¦‚æœæŸä¸ªæ­¥éª¤å‡ºé”™ï¼Œæ ¹æ® stacktrace å‘½ä»¤æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œä¿®å¤åç»§ç»­ apply \u0026lt;recipe-number\u0026gt;ã€‚\n# æ³¨æ„åœ¨æ‰§è¡Œ spring-boot-migrator å‰ï¼Œå…ˆåœ¨ä½ è¦å‡çº§çš„é¡¹ç›®ä¸­æ‰§è¡Œ mvn clean package installï¼Œæ‹‰å–å’Œå®‰è£…ä¾èµ–åŒ…ï¼Œé¿å…ä¸‹é¢çš„ scan æ­¥éª¤ä¸­ä¸‹è½½ä¾èµ–åŒ…å¤±è´¥ # ä½¿ç”¨ Java 17 å¯åŠ¨ spring-boot-migrator ç¨‹åº $ java -jar spring-boot-migrator.jar Get Started: ------------ Type \u0026#34;help\u0026#34; - to display a list all of the available commands. \u0026#34;scan \u0026lt;dir\u0026gt;\u0026#34; - to scan an application -------------------------------------------------------------------------------------------------- migrator:\u0026gt; scan my-spring-project-dir [ok] Found pom.xml. [ok] \u0026#39;sbm.gitSupportEnabled\u0026#39; is \u0026#39;true\u0026#39;, changes will be committed to branch [springboot] after each recipe. [ok] Found required source dir \u0026#39;src/main/java\u0026#39;. Maven 100% â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚ 2/2 (0:00:00 / 0:00:00) Applicable recipes: 1) remove-redundant-maven-compiler-plugin -\u0026gt; Remove standard maven-compiler plugin for applications with boot parent. 2) initialize-spring-boot-migration -\u0026gt; Initialize an application as Spring Boot application. 3) spring-context-xml-import -\u0026gt; Import Spring Framework xml bean configuration into Java configuration without converting them. 4) migrate-spring-xml-to-java-config -\u0026gt; Migrate Spring Framework xml bean configuration to Java configuration. 5) cn-spring-cloud-config-server -\u0026gt; Externalize properties to Spring Cloud Config Server 6) sbu30-set-java-version -\u0026gt; Spring boot 3.0 Upgrade - Set java version property in build file 7) sbu30-add-milestone-repositories -\u0026gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins 8) sbu30-225-logging-date-format -\u0026gt; Spring boot 3.0 Upgrade - Logging Date Format Run command \u0026#39;\u0026gt; apply \u0026lt;recipe-number\u0026gt;\u0026#39; to apply a recipe. ibss-site-dc:\u0026gt; apply remove-redundant-maven-compiler-plugin Applying recipe \u0026#39;remove-redundant-maven-compiler-plugin\u0026#39; [ok] Clean up redundant properties for maven compiler plugin. [ok] Clean up redundant maven compiler plugin. remove-redundant-maven-compiler-plugin successfully applied the following actions: (x) Clean up redundant properties for maven compiler plugin. (x) Clean up redundant maven compiler plugin. Applicable recipes: 1) initialize-spring-boot-migration -\u0026gt; Initialize an application as Spring Boot application. 2) spring-context-xml-import -\u0026gt; Import Spring Framework xml bean configuration into Java configuration without converting them. 3) migrate-spring-xml-to-java-config -\u0026gt; Migrate Spring Framework xml bean configuration to Java configuration. 4) cn-spring-cloud-config-server -\u0026gt; Externalize properties to Spring Cloud Config Server 5) sbu30-set-java-version -\u0026gt; Spring boot 3.0 Upgrade - Set java version property in build file 6) sbu30-add-milestone-repositories -\u0026gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins 7) sbu30-225-logging-date-format -\u0026gt; Spring boot 3.0 Upgrade - Logging Date Format Run command \u0026#39;\u0026gt; apply \u0026lt;recipe-number\u0026gt;\u0026#39; to apply a recipe. ibss-site-dc:\u0026gt; apply initialize-spring-boot-migration Applying recipe \u0026#39;initialize-spring-boot-migration\u0026#39; [ok] Add Spring Boot dependency management section to buildfile. [ok] Add Spring Boot starter class. [ok] Add initial unit test class to test Spring Boot Application Context startup. [ok] Set packaging to \u0026#39;jar\u0026#39; type if different initialize-spring-boot-migration successfully applied the following actions: (x) Add Spring Boot dependency management section to buildfile. (x) Add spring dependencies \u0026#39;spring-boot-starter\u0026#39; and \u0026#39;spring-boot-starter-test\u0026#39;. (x) Delete dependencies to artifacts transitively managed by Spring Boot. (x) Add Spring Boot Maven plugin. (x) Add Spring Boot starter class. (x) Add initial unit test class to test Spring Boot Application Context startup. (x) Set packaging to \u0026#39;jar\u0026#39; type if different Applicable recipes: 1) spring-context-xml-import -\u0026gt; Import Spring Framework xml bean configuration into Java configuration without converting them. 2) migrate-spring-xml-to-java-config -\u0026gt; Migrate Spring Framework xml bean configuration to Java configuration. 3) cn-spring-cloud-config-server -\u0026gt; Externalize properties to Spring Cloud Config Server 4) boot-2.7-3.0-dependency-version-update -\u0026gt; Bump spring-boot-starter-parent from 2.7.x to 3.0.0 5) boot-2.7-3.0-upgrade-report -\u0026gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.0-M3 6) sbu30-report -\u0026gt; Create a report for Spring Boot Upgrade from 2.7.x to 3.0.x 7) sbu30-upgrade-dependencies -\u0026gt; Spring boot 3.0 Upgrade - Upgrade dependencies 8) sbu30-set-java-version -\u0026gt; Spring boot 3.0 Upgrade - Set java version property in build file 9) sbu30-add-milestone-repositories -\u0026gt; Spring boot 3.0 Upgrade - Add milestone repository for dependencies and plugins 10) sbu30-remove-construtor-binding -\u0026gt; Spring boot 3.0 Upgrade - Remove redundant @ConstructorBinding annotations 11) sbu30-225-logging-date-format -\u0026gt; Spring boot 3.0 Upgrade - Logging Date Format 12) sbu30-upgrade-spring-cloud-dependency -\u0026gt; Upgrade Spring Cloud Dependencies 13) sbu30-upgrade-boot-version -\u0026gt; Spring boot 3.0 Upgrade - Upgrade Spring Boot version Spring Boot Migrator ç›®å‰è¿˜å¹¶ä¸æˆç†Ÿï¼Œä»¥ä¸Šæ­¥éª¤ä¸­å¾ˆå¤š recipe å¯èƒ½å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘åªç”¨ Spring Boot Migrator åšä¸€äº›åŸºç¡€åˆå§‹åŒ–ï¼Œå…¶ä»–ä»»åŠ¡ä½¿ç”¨ rewrite-maven-pluginï¼Œäº¤ç»™ openrewrite æ‰§è¡Œã€‚åœ¨ maven pom.xml ä¸­å¢åŠ ä»¥ä¸‹é…ç½®åï¼Œæ‰§è¡Œ mvn rewrite:runã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.19.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;activeRecipes\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7\u0026lt;/recipe\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.java.testing.junit5.JUnit4to5Migration\u0026lt;/recipe\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.okhttp.UpgradeOkHttp4\u0026lt;/recipe\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.okhttp.ReorderRequestBodyCreateArguments\u0026lt;/recipe\u0026gt; \u0026lt;recipe\u0026gt;org.openrewrite.java.migrate.UpgradeToJava17\u0026lt;/recipe\u0026gt; \u0026lt;/activeRecipes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.recipe\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-spring\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.recipe\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-testing-frameworks\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.recipe\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-okhttp\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.1.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openrewrite.recipe\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rewrite-migrate-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/plugin\u0026gt;\r[INFO] Using active recipe(s) [org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7, org.openrewrite.java.testing.junit5.JUnit4to5Migration] [INFO] Using active styles(s) [] [INFO] Validating active recipes... [INFO] Project [ibss-site-dc] Resolving Poms... [INFO] Project [ibss-site-dc] Parsing source files [INFO] Running recipe(s)... [WARNING] Changes have been made to pom.xml by: [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_6 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_5 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_4 [WARNING] org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration [WARNING] org.openrewrite.java.testing.junit5.JUnit4to5Migration [WARNING] org.openrewrite.maven.ExcludeDependency: {groupId=junit, artifactId=junit} [WARNING] org.openrewrite.java.dependencies.UpgradeDependencyVersion: {groupId=org.springframework.boot, artifactId=*, newVersion=2.7.x, overrideManagedVersion=false} [WARNING] Changes have been made to src/main/java/com/fsde/ibss/dc/controller/ClientController.java by: [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_6 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_5 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_4 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_3 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_2 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_1 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_0 [WARNING] org.openrewrite.java.spring.boot2.SpringBoot2BestPractices [WARNING] org.openrewrite.java.spring.NoRequestMappingAnnotation [WARNING] org.openrewrite.java.spring.ImplicitWebAnnotationNames [WARNING] Changes have been made to src/test/java/com/fsde/ibss/dc/service/FileSaveTest.java by: [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_7 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_6 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_5 [WARNING] org.openrewrite.java.spring.boot2.UpgradeSpringBoot_2_4 [WARNING] org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration [WARNING] org.openrewrite.java.testing.junit5.JUnit4to5Migration [WARNING] org.openrewrite.java.testing.junit5.UpdateTestAnnotation [WARNING] org.openrewrite.java.spring.boot2.RemoveObsoleteSpringRunners [WARNING] org.openrewrite.java.testing.junit5.JUnit5BestPractices [WARNING] org.openrewrite.java.testing.cleanup.RemoveTestPrefix [WARNING] org.openrewrite.java.testing.cleanup.TestsShouldNotBePublic [WARNING] Please review and commit the results. [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ åœ¨ä¸Šé¢æ­¥éª¤æˆ‘æ˜¯å…ˆå‡çº§åˆ°äº† Spring Boot 2ï¼Œç„¶åå†æ‰§è¡Œå‡çº§ Spring Boot 3 å’Œ Jakarta EEã€‚å®é™…ä¸Šç›´æ¥å‡çº§åˆ° Spring Boot 3 ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\næ‰§è¡Œå®Œæˆåå¯ä» maven ä¸­åˆ é™¤ rewrite-maven-pluginï¼Œä¹Ÿå¯ç•™ç€ä¸‹æ¬¡åšå…¶ä»–å˜æ›´ã€‚\nè¯•ç”¨æ€»ç»“ æ³¨æ„äº‹é¡¹ï¼š\næˆ‘ä»¬é¡¹ç›®é…ç½®éƒ½æ˜¯é€šè¿‡è¿œç¨‹é…ç½®ä¸­å¿ƒç®¡ç†çš„ï¼Œæ‰€ä»¥å‡çº§è¿‡ç¨‹ä¸­é…ç½®æ–‡ä»¶æ— æ³•å“åº”å˜æ›´ï¼Œè§£å†³åŠæ³•æ˜¯å°†é…ç½®ä»è¿œç«¯æ‹·è´åˆ°æœ¬åœ° applicaiton.properties ä¸­ï¼Œæ‰§è¡Œå®Œä»»åŠ¡åæ ¹æ®å˜åŒ–å†æ›´æ–°è¿œç¨‹é…ç½®ä¸­å¿ƒã€‚ æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ maven æ’ä»¶å‡çº§åæŸäº›å±æ€§å¯èƒ½å˜æ›´æˆ–å¤±æ•ˆï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³é”™è¯¯åï¼Œå†æ‰§è¡Œ mvn rewrite:runï¼Œ å¯é‡å¤æ‰§è¡Œ mvn rewrite:run å‘½ä»¤ï¼Œå¯éšæ—¶åŠ å…¥æ–°çš„ recipe å†æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ºäº†è§‚å¯Ÿå˜æ›´å’Œä¿è¯æ‰§è¡ŒæˆåŠŸï¼Œå¯åˆ†æ‰¹æ¬¡åŠ å…¥ recipe å¤šæ¬¡æ‰§è¡Œã€‚ OpenRewrite ä¸è§£æä¾èµ–çš„ç¬¬ä¸‰æ–¹ jar åŒ…å†…å®¹ï¼Œæ‰€ä»¥ç¬¬ä¸‰æ–¹ jar çš„é—®é¢˜éœ€è¦è‡ªè¡Œè¯†åˆ«ï¼Œæ¯”å¦‚ä» Java EE åˆ° Jakarta EEï¼Œåªæ˜¯æ›¿æ¢è§„åˆ™ä¸­çŸ¥é“çš„ jar åŒ…ç‰ˆæœ¬å’Œå½“å‰é¡¹ç›®çš„æºä»£ç ï¼Œä¸ä¼šè‡ªåŠ¨æŠŠ jar åŒ…å†…çš„ javax. æ›¿æ¢ä¸º jakarta.ã€‚ é‡è§é—®é¢˜å’Œè§£å†³åŠæ³• ","date":"2024-01-09","id":41,"permalink":"/docs/platform/smart-code/","summary":"\u003cp\u003eä½œä¸ºä¸€ä¸ªä»¥ Java å’Œ Spring ä¸ºä¸»è¦æŠ€æœ¯æ ˆçš„å›¢é˜Ÿï¼Œåœ¨æ—¥å¸¸çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€ç³»åˆ—çš„ç»„ä»¶å‡çº§å’Œä»£ç é‡æ„éœ€æ±‚ï¼Œåœ¨æ­¤è¿‡ç¨‹æˆ‘ä»¬æœŸæœ›èƒ½åšåˆ°å‡ ä¸ªæ•ˆæœï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé¡¹ç›®çº§å‡çº§ï¼šæ•´ä¸ªé¡¹ç›®ï¼ˆæ³¨æ­¤é¡¹ç›®æŒ‡ Maven Projectï¼‰å‡çº§ï¼Œè€Œä¸æ˜¯åŸºäºæŸä¸ª Java ç±»æˆ–ç‰‡æ®µã€‚\u003c/li\u003e\n\u003cli\u003eä¸åŒç‰ˆæœ¬è·¨åº¦å˜æ›´ï¼šæ¯”å¦‚ä» Spring é¡¹ç›®è¿ç§»åˆ° Spring Bootï¼Œä» Spring Boot 2.x å‡çº§åˆ° 3.xï¼Œä» Java 8 å‡çº§åˆ° Java 21ã€‚\u003c/li\u003e\n\u003cli\u003eä»£ç å®‰å…¨å¯é ï¼šå˜æ›´çš„ä»£ç ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œè‡³å°‘æ˜¯é€»è¾‘æ­£ç¡®çš„ï¼Œè‡³å°‘ä¸èƒ½åƒæŸ AI åŠ©æ‰‹ä¸€æ ·è®¾ç½®ä¸€äº›æ ¹æœ¬ä¸å­˜åœ¨çš„å±æ€§ã€‚\u003c/li\u003e\n\u003cli\u003eç»éªŒäº§å“åŒ–ï¼šæœ€ä½³å®è·µå°±æ˜¯äº§å“ï¼Œæ¯”å¦‚æˆ‘å¹¶ä¸ï¼ˆæƒ³ï¼‰äº†è§£ Spring Boot 3.2 å…·ä½“æœ‰å“ªäº›å˜æ›´ï¼Œä½†å¸Œæœ›èƒ½ä¸€é”®ä» 3.0 è‡ªåŠ¨å‡çº§åˆ° 3.2ï¼Œç›´æ¥å‘Šè¯‰æœ‰å“ªäº›å˜æ›´ã€‚\u003c/li\u003e\n\u003cli\u003eè‡ªå®šä¹‰é‡æ„ï¼šå¯¹äºæŸäº›è‡ªç ”ä»£ç ï¼Œå¸Œæœ›èƒ½è‡ªå®šä¹‰é‡æ„é€»è¾‘ï¼Œä¸€é”®è‡ªåŠ¨é‡æ„ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåŸºäºä»¥ä¸ŠèƒŒæ™¯ï¼Œæˆ‘ä»¬æ¢ç´¢äº† \u003ca href=\"https://docs.openrewrite.org/\" target=\"_blank\" rel=\"noopener\"\u003eOpenRewrite\u003c/a\u003e\nã€\u003ca href=\"https://github.com/spring-projects-experimental/spring-boot-migrator\" target=\"_blank\" rel=\"noopener\"\u003eSpring Boot Migrator\u003c/a\u003e\nã€\u003ca href=\"https://github.com/windup\" target=\"_blank\" rel=\"noopener\"\u003eRedhat Windup\u003c/a\u003e\nã€\u003ca href=\"https://github.com/adoptium/emt4j\" target=\"_blank\" rel=\"noopener\"\u003eemt4j\u003c/a\u003e\n å’Œä¸€ä¼—ä¸ä¾¿å…·åçš„ AI ä»£ç åŠ©æ‰‹ï¼Œæœ¬æ–‡å°†åˆ†äº«æˆ‘ä»¬ä½¿ç”¨ OpenRewriteã€Spring Boot Migrator è¿›è¡Œä»£ç é‡æ„å’Œå‡çº§çš„ä¸€äº›ä½¿ç”¨ç»éªŒå’Œä½“éªŒã€‚\u003c/p\u003e\n\u003ch2 id=\"openrewrite\"\u003eOpenRewrite\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://docs.openrewrite.org/\" target=\"_blank\" rel=\"noopener\"\u003eOpenRewrite\u003c/a\u003e\n æ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç é‡å†™å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨åŒ–å¤§è§„æ¨¡é‡æ„ä»£ç ã€‚\u003c/p\u003e\n\u003cp\u003eå®ƒæä¾›äº†ä¸€å¥—å¼ºå¤§çš„ API å’Œæ’ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡é™æ€åˆ†æå’Œä»£ç è½¬æ¢æŠ€æœ¯æ¥è§£æã€ä¿®æ”¹å’Œç”Ÿæˆä»£ç ã€‚OpenRewrite æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Javaã€C#ã€ TypeScriptã€Pythonã€Kubernetes ç­‰ã€‚é€šè¿‡ä½¿ç”¨ OpenRewriteï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°è¿›è¡Œä»£ç é‡æ„ã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç é£æ ¼è°ƒæ•´å’Œä»£ç è¿ç§»ç­‰æ“ä½œï¼Œä»è€Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚OpenRewrite çš„å¼€æºæ€§è´¨ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥è‡ªç”±åœ°å®šåˆ¶å’Œæ‰©å±•å…¶åŠŸèƒ½ï¼Œä»¥æ»¡è¶³ç‰¹å®šé¡¹ç›®çš„éœ€æ±‚ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚ Java é¢†åŸŸä¸€äº›çƒ­é—¨çš„åº”ç”¨åœºæ™¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eJava ç‰ˆæœ¬å‡çº§ï¼šä» Java 8 åˆ° Java 21ï¼Œä» Java EE åˆ° Jakarta EE ã€‚\u003c/li\u003e\n\u003cli\u003eSpring æ¡†æ¶è¿ç§»ï¼šä» Spring 5 åˆ° Spring 6ï¼Œä» Spring Boot 2 åˆ° Spring Boot 3ã€‚\u003c/li\u003e\n\u003cli\u003eæµ‹è¯•æ¡†æ¶è¿ç§»ï¼š ä» Junit 4 åˆ° Junit 5ã€‚\u003c/li\u003e\n\u003cli\u003eä¾èµ–ç®¡ç†ï¼šè‡ªåŠ¨æ›´æ–° Java é¡¹ç›®çš„ Maven æˆ– Gradle ä¾èµ–ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°å’Œæœ€å®‰å…¨çš„åº“ç‰ˆæœ¬ã€‚\u003c/li\u003e\n\u003cli\u003eä»£ç æ¸…ç†å’Œæ ¼å¼åŒ–ï¼šè‡ªåŠ¨æ¸…ç†å’Œæ ¼å¼åŒ– Java ä»£ç ï¼Œç¡®ä¿ç¬¦åˆé¡¹ç›®æˆ–ç»„ç»‡çš„ç¼–ç æ ‡å‡†å’Œé£æ ¼æŒ‡å—ã€‚\u003c/li\u003e\n\u003cli\u003eä¿®å¤å®‰å…¨æ¼æ´ï¼šè‡ªåŠ¨è¯†åˆ«å’Œä¿®å¤ Java ä»£ç ä¸­çš„å·²çŸ¥å®‰å…¨æ¼æ´ï¼Œå¦‚ä½¿ç”¨äº†æœ‰å®‰å…¨é—®é¢˜çš„åº“æˆ–æ–¹æ³•ã€‚\u003c/li\u003e\n\u003cli\u003eä»£ç å¼‚å‘³æ£€æµ‹å’Œä¿®å¤ï¼šè¯†åˆ«å¹¶è‡ªåŠ¨é‡æ„ Java ä»£ç ä¸­çš„â€œä»£ç å¼‚å‘³â€ï¼Œä»¥æé«˜ä»£ç å¯ç»´æŠ¤æ€§ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç›¸æ¯”äºæ—¶ä¸‹ç«çƒ­çš„ AI ä»£ç å·¥å…·ï¼Œæ¯”å¦‚ GitHub Copilotã€Amazon CodeWhispererï¼Œæˆ‘è®¤ä¸º OpenRewrite çš„ä¼˜åŠ¿ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\u003c/p\u003e","tags":[],"title":"æ™ºèƒ½ä»£ç é‡æ„"},{"content":"","date":"2023-09-07","id":42,"permalink":"/docs/","summary":"","tags":[],"title":"Docs"},{"content":"","date":"2025-11-25","id":43,"permalink":"/categories/","summary":"","tags":[],"title":"Categories"},{"content":"","date":"2025-11-25","id":44,"permalink":"/contributors/","summary":"","tags":[],"title":"Contributors"},{"content":"","date":"2025-11-25","id":45,"permalink":"/tags/jakarta-ee/","summary":"","tags":[],"title":"Jakarta EE"},{"content":"","date":"2025-11-25","id":46,"permalink":"/categories/java/","summary":"","tags":[],"title":"Java"},{"content":"","date":"2025-11-25","id":47,"permalink":"/contributors/l10178/","summary":"","tags":[],"title":"L10178"},{"content":"","date":"2025-11-25","id":48,"permalink":"/categories/spring-boot/","summary":"","tags":[],"title":"Spring Boot"},{"content":"","date":"2025-11-25","id":49,"permalink":"/tags/spring-boot/","summary":"","tags":[],"title":"Spring Boot"},{"content":"","date":"2025-11-25","id":50,"permalink":"/tags/spring-boot-4/","summary":"","tags":[],"title":"Spring Boot 4"},{"content":"","date":"2025-11-25","id":51,"permalink":"/tags/spring-framework-7/","summary":"","tags":[],"title":"Spring Framework 7"},{"content":"","date":"2025-11-25","id":52,"permalink":"/tags/","summary":"","tags":[],"title":"Tags"},{"content":"","date":"2025-11-25","id":53,"permalink":"/tags/tomcat-11/","summary":"","tags":[],"title":"Tomcat 11"},{"content":"","date":"2025-11-25","id":54,"permalink":"/tags/virtual-threads/","summary":"","tags":[],"title":"Virtual Threads"},{"content":"","date":"2025-11-25","id":55,"permalink":"/tags/%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97openrewrite/","summary":"","tags":[],"title":"è¿ç§»æŒ‡å—ï¼ŒOpenRewrite"},{"content":"","date":"2025-09-14","id":56,"permalink":"/tags/java/","summary":"","tags":[],"title":"Java"},{"content":"","date":"2025-09-09","id":57,"permalink":"/tags/cicd/","summary":"","tags":[],"title":"CICD"},{"content":"","date":"2024-11-24","id":58,"permalink":"/categories/idaas/","summary":"","tags":[],"title":"Idaas"},{"content":"","date":"2024-11-24","id":59,"permalink":"/tags/idaas/","summary":"","tags":[],"title":"Idaas"},{"content":"","date":"2024-11-24","id":60,"permalink":"/tags/keycloak/","summary":"","tags":[],"title":"Keycloak"},{"content":"","date":"2024-11-24","id":61,"permalink":"/tags/oauth2/","summary":"","tags":[],"title":"Oauth2"},{"content":"","date":"2024-11-24","id":62,"permalink":"/categories/spring/","summary":"","tags":[],"title":"Spring"},{"content":"","date":"2024-11-24","id":63,"permalink":"/tags/spring/","summary":"","tags":[],"title":"Spring"},{"content":"","date":"2024-11-16","id":64,"permalink":"/categories/k8s/","summary":"","tags":[],"title":"K8s"},{"content":"","date":"2024-11-16","id":65,"permalink":"/tags/k8s/","summary":"","tags":[],"title":"K8s"},{"content":"å«æ˜Ÿå®éªŒå®¤ï¼Œä¸€ä¸ªä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°çš„å¼€æºç»„ç»‡ï¼Œæ­¤é¡¹ç›®ä¸ºå«æ˜Ÿå®éªŒå®¤ä¸»é¡µ xlabs.club çš„æºç ï¼Œåˆä½œäº¤æµè¯·åˆ°æˆ‘ä»¬çš„ GitHub ä¸»é¡µã€‚\nå«æ˜Ÿå®éªŒå®¤è´¦å· GitHub: https://github.com/xlabs-club Medium: https://xlabs-club.medium.com ç¨€åœŸæ˜é‡‘ï¼šhttps://juejin.cn/user/169800120680251 ä¸»é¡µå†…å®¹ å¹³å°å·¥ç¨‹ï¼šæˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ï¼Œå…³äº DevOps, DataOps, FinOps ä»¥åŠ AIOps çš„å·¥ç¨‹å®è·µã€‚ äº‘åŸç”Ÿï¼šäº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ï¼Œå¦‚ä½•ä»¥äº‘åŸç”ŸæŠ€æœ¯æ”¯æ’‘èµ·ä¸æ–­å˜åŒ–çš„å¤æ‚ä¸šåŠ¡ã€‚ æŠ€æœ¯åšå®¢ï¼šç ”å‘è¸©å‘è®°å½•ï¼Œç¿»ä¸€ç¿»æ€»æœ‰æƒŠå–œã€‚ awesome-x-opsï¼šä¸€äº›å…³äº AIOpsã€DataOpsã€DevOpsã€GitOpsã€FinOps çš„ä¼˜ç§€è½¯ä»¶ã€åšå®¢ã€é…å¥—å·¥å…·ã€‚ xlabs-opsï¼šä¸€äº› IaC è¿ç»´è„šæœ¬å’Œé€šç”¨æ¨¡æ¿ï¼Œå¦‚ Argo Workflows æ¨¡æ¿ä»“åº“ï¼Œæ˜¯å¯¹å®˜æ–¹ Examples çš„ç»„åˆã€æ‰©å±•ã€‚ xlabs-developer-platformï¼šä¸€ä¸ªåŸºäº Backstage è‡ªå»ºçš„å¼€å‘è€…å¹³å°ã€‚ backstage-pluginsï¼šå«æ˜Ÿå®éªŒå®¤çš„å¼€æº backstage pluginsï¼Œæ¬¢è¿æäº¤ PRã€‚ ","date":"2024-09-28","id":66,"permalink":"/about/","summary":"\u003cp\u003eå«æ˜Ÿå®éªŒå®¤ï¼Œä¸€ä¸ªä¸“æ³¨äºæŠ€æœ¯åˆ›æ–°çš„å¼€æºç»„ç»‡ï¼Œæ­¤é¡¹ç›®ä¸ºå«æ˜Ÿå®éªŒå®¤ä¸»é¡µ \u003ca href=\"https://www.xlabs.club\" target=\"_blank\" rel=\"noopener\"\u003exlabs.club\u003c/a\u003e\n çš„æºç ï¼Œåˆä½œäº¤æµè¯·åˆ°æˆ‘ä»¬çš„ \u003ca href=\"https://github.com/xlabs-club\" target=\"_blank\" rel=\"noopener\"\u003eGitHub\u003c/a\u003e\n ä¸»é¡µã€‚\u003c/p\u003e\n\u003ch2 id=\"å«æ˜Ÿå®éªŒå®¤è´¦å·\"\u003eå«æ˜Ÿå®éªŒå®¤è´¦å·\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eGitHub: \u003ca href=\"https://github.com/xlabs-club\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/xlabs-club\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eMedium: \u003ca href=\"https://xlabs-club.medium.com\" target=\"_blank\" rel=\"noopener\"\u003ehttps://xlabs-club.medium.com\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eç¨€åœŸæ˜é‡‘ï¼š\u003ca href=\"https://juejin.cn/user/169800120680251\" target=\"_blank\" rel=\"noopener\"\u003ehttps://juejin.cn/user/169800120680251\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ä¸»é¡µå†…å®¹\"\u003eä¸»é¡µå†…å®¹\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eå¹³å°å·¥ç¨‹ï¼šæˆ‘ä»¬çš„å¹³å°å·¥ç¨‹å»ºè®¾ä¹‹è·¯ï¼Œå…³äº DevOps, DataOps, FinOps ä»¥åŠ AIOps çš„å·¥ç¨‹å®è·µã€‚\u003c/li\u003e\n\u003cli\u003eäº‘åŸç”Ÿï¼šäº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢ï¼Œå¦‚ä½•ä»¥äº‘åŸç”ŸæŠ€æœ¯æ”¯æ’‘èµ·ä¸æ–­å˜åŒ–çš„å¤æ‚ä¸šåŠ¡ã€‚\u003c/li\u003e\n\u003cli\u003eæŠ€æœ¯åšå®¢ï¼šç ”å‘è¸©å‘è®°å½•ï¼Œç¿»ä¸€ç¿»æ€»æœ‰æƒŠå–œã€‚\u003c/li\u003e\n\u003cli\u003eawesome-x-opsï¼šä¸€äº›å…³äº AIOpsã€DataOpsã€DevOpsã€GitOpsã€FinOps çš„ä¼˜ç§€è½¯ä»¶ã€åšå®¢ã€é…å¥—å·¥å…·ã€‚\u003c/li\u003e\n\u003cli\u003exlabs-opsï¼šä¸€äº› IaC è¿ç»´è„šæœ¬å’Œé€šç”¨æ¨¡æ¿ï¼Œå¦‚ Argo Workflows æ¨¡æ¿ä»“åº“ï¼Œæ˜¯å¯¹å®˜æ–¹ Examples çš„ç»„åˆã€æ‰©å±•ã€‚\u003c/li\u003e\n\u003cli\u003exlabs-developer-platformï¼šä¸€ä¸ªåŸºäº Backstage è‡ªå»ºçš„å¼€å‘è€…å¹³å°ã€‚\u003c/li\u003e\n\u003cli\u003ebackstage-pluginsï¼šå«æ˜Ÿå®éªŒå®¤çš„å¼€æº backstage pluginsï¼Œæ¬¢è¿æäº¤ PRã€‚\u003c/li\u003e\n\u003c/ul\u003e","tags":[],"title":"About"},{"content":"","date":"2024-05-23","id":67,"permalink":"/tags/g1-gc/","summary":"","tags":[],"title":"G1 GC"},{"content":"","date":"2024-05-23","id":68,"permalink":"/tags/java-25/","summary":"","tags":[],"title":"Java 25"},{"content":"","date":"2024-05-23","id":69,"permalink":"/tags/java-%E5%8D%87%E7%BA%A7/","summary":"","tags":[],"title":"Java å‡çº§"},{"content":"","date":"2024-05-23","id":70,"permalink":"/tags/java25/","summary":"","tags":[],"title":"Java25"},{"content":"","date":"2024-05-23","id":71,"permalink":"/tags/jdk-25/","summary":"","tags":[],"title":"JDK 25"},{"content":"","date":"2024-05-23","id":72,"permalink":"/categories/jvm/","summary":"","tags":[],"title":"JVM"},{"content":"","date":"2024-05-23","id":73,"permalink":"/tags/jvm-%E8%B0%83%E4%BC%98/","summary":"","tags":[],"title":"JVM è°ƒä¼˜"},{"content":"","date":"2024-05-23","id":74,"permalink":"/tags/zgc/","summary":"","tags":[],"title":"ZGC"},{"content":"","date":"2024-05-23","id":75,"permalink":"/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/","summary":"","tags":[],"title":"æ€§èƒ½ä¼˜åŒ–"},{"content":"","date":"2024-05-23","id":76,"permalink":"/tags/%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B/","summary":"","tags":[],"title":"è™šæ‹Ÿçº¿ç¨‹"},{"content":"","date":"2024-04-29","id":77,"permalink":"/tags/pulumi/","summary":"","tags":[],"title":"Pulumi"},{"content":"","date":"2024-03-19","id":78,"permalink":"/tags/tools/","summary":"","tags":[],"title":"Tools"},{"content":"","date":"2023-09-07","id":79,"permalink":"/privacy/","summary":"","tags":[],"title":"Privacy Policy"},{"content":"","date":"2023-09-07","id":80,"permalink":"/","summary":"","tags":[],"title":"å«æ˜Ÿå®éªŒå®¤"},{"content":"","date":"2022-09-07","id":81,"permalink":"/tags/devops/","summary":"","tags":[],"title":"Devops"}]