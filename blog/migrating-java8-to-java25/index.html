<!doctype html><html lang=zh data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.974962bbf902e2bb09d5f947751229907fea343148efc12fbb1ca3b61b799d102d62009b941a5835deabeee0a1d832801e2e7e8ffc5c4f77f2632d7d669f2736.css" integrity="sha512-l0liu/kC4rsJ1flHdRIpkH/qNDFI78Evuxyjtht5nRAtYgCblBpYNd6r7uCh2DKAHi5+j/xcT3fyYy19Zp8nNg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/blog/migrating-java8-to-java25/><link rel=canonical href=https://www.xlabs.club/blog/migrating-java8-to-java25/><title>从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍</title><meta name=description content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://www.xlabs.club/blog/migrating-java8-to-java25/"><meta property="og:site_name" content="XLabs"><meta property="og:title" content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍"><meta property="og:description" content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-05-23T21:03:11+08:00"><meta property="article:modified_time" content="2025-09-22T18:50:05+08:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="Spring Boot"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍"><meta name=twitter:description content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍"><meta name=twitter:site content="@xlabs-club"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"卫星实验室","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍","description":"从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍","isPartOf":{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/"},"mainEntityOfPage":{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/"},"datePublished":"2024-05-23T21:03:11+08:00","dateModified":"2025-09-22T18:50:05+08:00","image":[{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/java-jep.png"},{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/java-report.jpeg"},{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/java25.png"},{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/java8vs21.png"}],"author":{"@type":"Organization","name":"XLabs Club 卫星实验室","url":"https://www.xlabs.club/"},"publisher":{"@type":"Organization","name":"XLabs Club 卫星实验室"}}]}</script><meta http-equiv=content-language content='zh-cn'></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/>XLabs</a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>XLabs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://www.xlabs.club/docs/guides/introduction/>Docs</a></li><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/blog/ aria-current=true>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/xlabs-link-exchange>Links</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/about/>About</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/xlabs-club/xlabs-club.github.io><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>目录</h3><nav id=toc><ul><li><a href=#令人心动的特性>令人心动的特性</a><ul><li><a href=#语法糖>语法糖</a></li><li><a href=#性能优化>性能优化</a></li><li><a href=#技术变革>技术变革</a></li></ul></li><li><a href=#破坏性变更评估工具>破坏性变更评估工具</a><ul><li><a href=#jdeps>jdeps</a></li><li><a href=#jdeprscan>jdeprscan</a></li><li><a href=#emt4j>emt4j</a></li><li><a href=#forbiddenapis>forbiddenapis</a></li></ul></li><li><a href=#升级兼容方法措施>升级兼容方法措施</a><ul><li><a href=#maven-的-profile-机制>Maven 的 profile 机制</a></li><li><a href=#java-multi-release-jar>Java Multi-Release JAR</a></li><li><a href=#java-模块化兼容>Java 模块化兼容</a></li></ul></li><li><a href=#辅助迁移工具>辅助迁移工具</a><ul><li><a href=#maven-依赖包更新>Maven 依赖包更新</a></li><li><a href=#emt4j-1>EMT4J</a></li><li><a href=#openrewrite>OpenRewrite</a></li><li><a href=#jacoline>JaCoLine</a></li><li><a href=#java-参数查询工具>Java 参数查询工具</a></li><li><a href=#sdkman>SDKMAN</a></li></ul></li><li><a href=#生产环境-gc-推荐配置>生产环境 GC 推荐配置</a></li><li><a href=#遇见问题和解决办法>遇见问题和解决办法</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍、新特性介绍</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>目录</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#令人心动的特性>令人心动的特性</a><ul><li><a href=#语法糖>语法糖</a></li><li><a href=#性能优化>性能优化</a></li><li><a href=#技术变革>技术变革</a></li></ul></li><li><a href=#破坏性变更评估工具>破坏性变更评估工具</a><ul><li><a href=#jdeps>jdeps</a></li><li><a href=#jdeprscan>jdeprscan</a></li><li><a href=#emt4j>emt4j</a></li><li><a href=#forbiddenapis>forbiddenapis</a></li></ul></li><li><a href=#升级兼容方法措施>升级兼容方法措施</a><ul><li><a href=#maven-的-profile-机制>Maven 的 profile 机制</a></li><li><a href=#java-multi-release-jar>Java Multi-Release JAR</a></li><li><a href=#java-模块化兼容>Java 模块化兼容</a></li></ul></li><li><a href=#辅助迁移工具>辅助迁移工具</a><ul><li><a href=#maven-依赖包更新>Maven 依赖包更新</a></li><li><a href=#emt4j-1>EMT4J</a></li><li><a href=#openrewrite>OpenRewrite</a></li><li><a href=#jacoline>JaCoLine</a></li><li><a href=#java-参数查询工具>Java 参数查询工具</a></li><li><a href=#sdkman>SDKMAN</a></li></ul></li><li><a href=#生产环境-gc-推荐配置>生产环境 GC 推荐配置</a></li><li><a href=#遇见问题和解决办法>遇见问题和解决办法</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></details></nav><p><img src=/blog/migrating-java8-to-java25/java25_hu_42c3cb3c5a24a2c.webp width=770 height=403 decoding=async fetchpriority=auto loading=lazy alt=java25-release title=java25-release id=h-rh-i-0></p><p>虽然 Java 界流行 <strong>你发任你发，我用 Java 8</strong>。但根据 Azul 组织发布的 <a href=https://www.azul.com/newsroom/azul-2025-state-of-java-survey-report/ target=_blank rel=noopener>2025 Java 最新使用报告</a>
显示，Java 17 悄悄登上了使用率最高的宝座，Java 21 也紧随其后。
至于新发布的 Java 25， 能不能承担起 <code>Make Java Great Again</code> 的艰巨任务，还需要时间的考验，让子弹再飞一会。</p><p><img src=/blog/migrating-java8-to-java25/java-report_hu_cf024fc5f59d1d32.webp width=1080 height=609 decoding=async fetchpriority=auto loading=lazy alt=java-report title=java-report id=h-rh-i-1></p><h2 id=令人心动的特性>令人心动的特性<a href=#令人心动的特性 class=anchor aria-hidden=true>#</a></h2><p>下图展示了自 Java 8 以来每个 Java 版本中的 JEP 数量，下面将摘出几个比较令人心动且使用频率较高的特性进行介绍。</p><p><img src=/blog/migrating-java8-to-java25/java-jep_hu_4ab27b0d4e441598.webp width=1724 height=970 decoding=async fetchpriority=auto loading=lazy alt=java-jep title=java-jep id=h-rh-i-2></p><h3 id=语法糖>语法糖<a href=#语法糖 class=anchor aria-hidden=true>#</a></h3><p>语法糖特性让代码编写更加简洁优雅，提升开发体验。</p><ul><li><p><strong>集合 && Stream API 增强</strong> - Java 8/9/12/16/21</p><ul><li><p>Java 8 引入 Stream API，支持函数式数据处理</p></li><li><p>Java 9 新增 <code>dropWhile()</code>、<code>takeWhile()</code>、<code>iterate()</code> 增强、<code>ofNullable()</code></p></li><li><p>Java 12 新增 <code>Collectors.teeing()</code> 方法</p></li><li><p>Java 16 新增 <code>Stream.toList()</code> 和 <code>mapMulti()</code> 方法</p></li><li><p>Java 21 顺序集合语法糖，比如 <code>List.getFirst()</code> 和 <code>List.getLast()</code> 方法，再也不用小心如何计算 index 了</p></li><li><p>简洁的集合创建方式，创建不可变集合</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 工厂方法简化，注意：这些集合是不可变的，调用修改方法会抛出异常</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;b&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;c&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>set</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;x&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;y&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;z&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;key1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;key2&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 16+ 简化列表收集</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>list</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>toList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 9 条件过滤</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>numbers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>taken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>numbers</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>takeWhile</span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>4</span><span class=p>)</span><span class=w>  </span><span class=c1>// [1, 2, 3]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>toList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 9 有限迭代</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Stream</span><span class=p>.</span><span class=na>iterate</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>100</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w> </span><span class=c1>// 1, 2, 4, 8, 16, 32, 64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 16 一对多映射</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>mapMulti</span><span class=p>((</span><span class=n>number</span><span class=p>,</span><span class=w> </span><span class=n>consumer</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>consumer</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>number</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>consumer</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>number</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w> </span><span class=c1>// 1, 2, 2, 4, 3, 6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 21 List 新方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;第一个&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;第二个&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;第三个&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;最后一个&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>list</span><span class=p>.</span><span class=na>getFirst</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>last</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>list</span><span class=p>.</span><span class=na>getLast</span><span class=p>();</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>Objects 方法增强</strong> - Java 9</p><ul><li><p>新增多个实用的对象操作方法，简化 null 检查和索引验证</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>inputName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;b&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;c&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;d&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;e&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 空值处理</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>name1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Objects</span><span class=p>.</span><span class=na>requireNonNullElse</span><span class=p>(</span><span class=n>inputName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;默认名称&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>name2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Objects</span><span class=p>.</span><span class=na>requireNonNullElseGet</span><span class=p>(</span><span class=n>inputName</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;动态生成名称&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// toString 空值安全处理</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>toStringResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Objects</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>inputName</span><span class=p>,</span><span class=w> </span><span class=s>&#34;nullDefault value&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 索引检查</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Objects</span><span class=p>.</span><span class=na>checkIndex</span><span class=p>(</span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>list</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>  </span><span class=c1>// 检查索引是否有效</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Objects</span><span class=p>.</span><span class=na>checkFromToIndex</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>list</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>     </span><span class=c1>// 检查范围 [1, 4)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Objects</span><span class=p>.</span><span class=na>checkFromIndexSize</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>list</span><span class=p>.</span><span class=na>size</span><span class=p>());</span><span class=w>   </span><span class=o>//</span><span class=w> </span><span class=n>检查从索引</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=n>开始长度为</span><span class=w> </span><span class=n>3</span><span class=w> </span><span class=n>的范围</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>String 增强方法</strong> - Java 11</p><ul><li><p>新增多个实用的字符串处理方法</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>text</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;  Hello World  &#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 新增方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>boolean</span><span class=w> </span><span class=n>isBlank</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>.</span><span class=na>isBlank</span><span class=p>();</span><span class=w>        </span><span class=c1>// 检查是否为空或只包含空白字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>stripped</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>.</span><span class=na>strip</span><span class=p>();</span><span class=w>          </span><span class=c1>// 去除首尾空白字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>repeated</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>.</span><span class=na>repeat</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>        </span><span class=c1>// 重复字符串</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>lines</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>.</span><span class=na>lines</span><span class=p>();</span><span class=w>     </span><span class=c1>// 按行分割成流</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>indented</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>.</span><span class=na>stripIndent</span><span class=p>();</span><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>去除缩进</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>文本块 && 字符串模板</strong> - Java 15/21</p><ul><li><p>支持多行字符串字面量，无需转义字符</p></li><li><p>Java 21 预览特性：字符串模板（String Templates）支持 <code>STR.</code> 嵌入表达式</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 基础文本块</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;name&#34;: &#34;张三&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;age&#34;: 25
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>    &#34;&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 21 字符串模板（预览特性）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;张三&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>25</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>STR</span><span class=p>.</span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>    {
</span></span></span><span class=line><span class=cl><span class=s>      &#34;name&#34;: &#34;\{name}&#34;,
</span></span></span><span class=line><span class=cl><span class=s>      &#34;age&#34;: \{age}
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>    &#34;&#34;&#34;</span><span class=p>;</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>Record 类型（JEP 395）</strong> - Java 16</p><ul><li><p>简洁的数据类定义，自动生成构造函数、访问器等</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>record</span> <span class=nc>Person</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 使用示例</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Person</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Person</span><span class=p>(</span><span class=s>&#34;张三&#34;</span><span class=p>,</span><span class=w> </span><span class=n>25</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>person</span><span class=p>.</span><span class=na>name</span><span class=p>());</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>Switch 表达式（JEP 361）</strong> - Java 14</p><ul><li><p>Switch 可以作为表达式返回值，支持箭头语法，更加简洁，再也不用担心忘了 return 了</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>DayOfWeek</span><span class=w> </span><span class=n>day</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DayOfWeek</span><span class=p>.</span><span class=na>MONDAY</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>switch</span><span class=p>(</span><span class=n>day</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>MONDAY</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;周一&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>TUESDAY</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;周二&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>WEDNESDAY</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;周三&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;其他&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>result</span><span class=p>);</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>模式匹配（JEP 394, 433, 441）</strong> - Java 16/17/21/25</p><ul><li><p>增强 instanceof 操作符，支持模式匹配，匹配后直接转换</p></li><li><p>Java 25 新增：支持基本类型（int、byte、char、boolean）的模式匹配</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 16+ 模式匹配</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>obj</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>5</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;长字符串：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=na>toUpperCase</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Switch 模式匹配</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>switch</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=n>when</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>5</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;长字符串：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;短字符串：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;数字：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=s>&#34;未知类型&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 25 基本类型模式匹配，基本类型间的安全转换检查</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>42</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>num</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;是 int 类型：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>简化 main 方法（JEP 463）</strong> - Java 25</p><ul><li><p>支持无类声明的 void main() 方法，无需 public static 修饰符</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 传统写法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HelloWorld</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Hello, World!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 25 简化写法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Hello, World!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 支持带参数的主方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;参数个数：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>args</span><span class=p>.</span><span class=na>length</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>直接运行 Java 文件（JEP 330、JEP 458）</strong> - Java 11</p><ul><li><p>支持直接运行单个源文件，无需先编译</p></li><li><p>支持 Shebang 脚本运行方式，启动多文件源代码程序，一个文件里定义多 classs</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 方式一：直接运行 Java 文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 创建文件 HelloWorld.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 运行命令：java HelloWorld.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 输出：Hello, World!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HelloWorld</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Hello, World!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 方式二：Shebang 脚本运行</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 赋予执行权限：chmod +x hello</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 直接运行：./hello</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 输出：Hello from script!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 结合 Java 25 简化 main 方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=o>!/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>java</span><span class=w> </span><span class=o>--</span><span class=n>source</span><span class=w> </span><span class=n>25</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;简化的脚本入口！&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div></li></ul></li><li><p><strong>灵活构造函数体（JEP 447）</strong> - Java 25</p><ul><li><p>允许在 super() 或 this() 调用前执行初始化逻辑，如参数校验，提升代码可读性和灵活性，避免将校验逻辑提取到静态方法的模板代码，增强对象构建时的安全性。</p></li><li><p>代码示例：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Person</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Java 25 灵活构造函数体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Person</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 可以在 super() 调用前执行初始化逻辑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=na>trim</span><span class=p>().</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;姓名不能为空&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;年龄不能为负数&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 现在可以调用 super() 或 this()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=na>trim</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 调用其他构造函数前的参数校验</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Person</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=na>trim</span><span class=p>().</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;姓名不能为空&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w> </span><span class=c1>// 调用上面的构造函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div></li></ul></li></ul><h3 id=性能优化>性能优化<a href=#性能优化 class=anchor aria-hidden=true>#</a></h3><p>性能优化特性大幅提升了 Java 应用的运行效率，其中垃圾收集器的演进是最重要的改进之一。</p><h4 id=g1-垃圾收集器演进>G1 垃圾收集器演进<a href=#g1-垃圾收集器演进 class=anchor aria-hidden=true>#</a></h4><p>G1 自 Java 7 引入，Java 9 成为默认收集器，<strong>持续进化的 G1</strong> 仍是目前最全面最均衡的收集器。</p><p>核心特性：</p><ul><li>分区管理：将堆内存划分为多个独立区域（Region），动态调整年轻代和老年代比例</li><li>并发标记：在应用线程运行的同时进行垃圾回收标记，减少停顿时间</li><li>可预测停顿时间：通过 <code>-XX:MaxGCPauseMillis</code> 参数控制最大停顿时间</li></ul><p>Java 8 到 Java 25，<strong>6 个专门针对 G1 的 JEP</strong>， 主要改进：</p><ul><li>Java 9：成为默认垃圾收集器，优化了混合回收算法</li><li>Java 10：并行 Full GC（JEP 307），提升 Full GC 性能</li><li>Java 12：可中断混合集合（JEP 344）+ 及时返回未使用内存（JEP 346）</li><li>Java 14：NUMA 感知内存分配（JEP 345），优化 NUMA 系统性能</li><li>Java 16：并发线程栈扫描（JEP 376），减少并发标记时间</li><li>Java 17：动态线程栈扫描，进一步优化并发性能</li><li>Java 21：分代 G1 优化，提升年轻代回收效率</li><li>Java 22：可配置卡表大小，支持更大堆区域（最大 512MB）</li><li>Java 23：写入屏障优化，减少吞吐量损失</li><li>Java 24：并发标记周期优化，改进位图使用 + 后期屏障扩展（JEP 475）</li><li>Java 25：进一步优化写入屏障和并发性能</li></ul><p><strong>G1 性能优化 JEP 详解</strong>：</p><p><strong>并行 Full GC（JEP 307）</strong> - Java 10</p><p>传统 Full GC 是单线程的，导致长时间停顿。JEP 307 引入并行 Full GC：</p><ul><li>多线程并行处理 Full GC，停顿时间减少 <strong>60-80%</strong></li><li>特别适用于大堆内存应用的紧急回收场景</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># G1 并行 Full GC 参数</span>
</span></span><span class=line><span class=cl>-XX:+UseG1GC
</span></span><span class=line><span class=cl>-XX:MaxGCPauseMillis<span class=o>=</span><span class=m>200</span>    <span class=c1># 目标停顿时间</span>
</span></span><span class=line><span class=cl>-XX:G1HeapRegionSize<span class=o>=</span>16m    <span class=c1># 堆区域大小</span></span></span></code></pre></div></figure></div><p><strong>可中断混合集合（JEP 344）</strong> - Java 12</p><p>解决混合集合可能导致的长时间停顿问题：</p><ul><li>允许在混合回收过程中中断，停顿时间控制在 <strong>200ms 以内</strong></li><li>提高应用响应性，减少用户体验影响</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># G1 可中断混合集合参数</span>
</span></span><span class=line><span class=cl>-XX:+UseG1GC
</span></span><span class=line><span class=cl>-XX:G1MixedGCCountTarget<span class=o>=</span><span class=m>8</span>    <span class=c1># 混合回收目标次数</span>
</span></span><span class=line><span class=cl>-XX:G1OldCSetRegionThreshold<span class=o>=</span>10%  <span class=c1># 老年代回收比例</span></span></span></code></pre></div></figure></div><p><strong>及时返回未使用内存（JEP 346）</strong> - Java 12</p><p>G1 能够主动归还未使用的堆内存给操作系统：</p><ul><li>减少内存占用，提高资源利用率</li><li>间接减少 GC 频率和停顿时间</li><li>内存使用效率提升 <strong>20-30%</strong></li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># G1 内存归还参数</span>
</span></span><span class=line><span class=cl>-XX:+UseG1GC
</span></span><span class=line><span class=cl>-XX:+G1UncommitDelay<span class=o>=</span><span class=m>300</span>      <span class=c1># 延迟归还时间（秒）</span>
</span></span><span class=line><span class=cl>-XX:G1MinHeapFreeRatio<span class=o>=</span><span class=m>20</span>     <span class=c1># 最小空闲堆比例</span></span></span></code></pre></div></figure></div><p><strong>NUMA 感知内存分配（JEP 345）</strong> - Java 14</p><p>针对 NUMA 架构优化内存分配策略：</p><ul><li>就近分配原则，减少跨 NUMA 节点访问</li><li>在 NUMA 系统上性能提升 <strong>10-20%</strong></li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># NUMA 优化参数</span>
</span></span><span class=line><span class=cl>-XX:+UseG1GC
</span></span><span class=line><span class=cl>-XX:+UseNUMA                  <span class=c1># 启用 NUMA 优化</span>
</span></span><span class=line><span class=cl>-XX:+UseNUMAInterleaving      <span class=c1># 启用内存交错分配</span></span></span></code></pre></div></figure></div><p><strong>并发线程栈扫描（JEP 376）</strong> - Java 16</p><p>传统 GC 需要暂停应用线程扫描栈，JEP 376 实现并发扫描：</p><ul><li>并发扫描线程栈，减少 STW（Stop-The-World）时间</li><li>吞吐量提升 <strong>15-25%</strong></li></ul><p><strong>后期屏障扩展（JEP 475）</strong> - Java 24</p><p>优化 G1 的写入屏障机制：</p><ul><li>重新设计垃圾收集器与应用程序的同步机制</li><li>解决 G1 吞吐量比其他收集器低 20% 的问题</li><li>显著减少对吞吐量的影响</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># G1 后期屏障优化参数</span>
</span></span><span class=line><span class=cl>-XX:+UseG1GC
</span></span><span class=line><span class=cl>-XX:+G1UseAdaptiveIHOP        <span class=c1># 自适应 IHOP</span>
</span></span><span class=line><span class=cl>-XX:G1MixedGCLiveThresholdPercent<span class=o>=</span><span class=m>85</span></span></span></code></pre></div></figure></div><p><strong>写入屏障优化（Java 23）</strong>：</p><ul><li>重新设计垃圾收集器与应用程序的同步机制</li><li>显著减少对吞吐量的影响，解决 G1 吞吐量比其他收集器低 20% 的问题</li><li>通过 JDK-8340827 实现根本性的同步机制改进</li></ul><p><strong>卡表大小配置（Java 22）</strong>：</p><ul><li>引入可配置的卡表大小（JDK-8272773）</li><li>支持更大的堆区域，从原来的 32MB 提升到 512MB（JDK-8275056）</li><li>提供更灵活的内存管理策略</li></ul><p><strong>并发标记优化（Java 24）</strong>：</p><ul><li>改进位图使用方式，从双位图改为单位图设计</li><li>减少 G1 原生内存消耗，节省 1.5% 的 Java 堆大小</li><li>优化并发标记周期的性能</li></ul><p><strong>记忆集优化</strong>：</p><ul><li>实现记忆集候选集合的早期修剪</li><li>减少 20% 的记忆集内存使用</li><li>改进收集集候选对象的管理效率</li></ul><h4 id=zgc-垃圾收集器演进>ZGC 垃圾收集器演进<a href=#zgc-垃圾收集器演进 class=anchor aria-hidden=true>#</a></h4><p>ZGC 专为低延迟设计，适合对响应时间要求极高的场景。</p><p>核心特性：</p><ul><li>超低停顿时间：目标停顿时间 &lt; 10ms，且不随堆大小增长</li><li>并发处理：几乎所有 GC 工作都并发进行</li><li>大堆内存支持：支持 8MB 到 16TB 的堆内存</li></ul><p>Java 11 到 Java 25 主要改进：</p><ul><li>Java 11：ZGC 首次引入，支持 Linux x64</li><li>Java 13：支持 Windows 和 macOS</li><li>Java 14：支持 macOS 和 Windows</li><li>Java 15：ZGC 正式发布（JEP 377），生产环境可用</li><li>Java 16：支持并发线程栈扫描</li><li>Java 17：支持超大堆（16TB）</li><li>Java 21：开始支持分代 ZGC（JEP 439），大幅提升性能</li><li>Java 22：分代 ZGC 性能进一步优化</li><li>Java 23：默认启用分代 ZGC</li><li>Java 24：JEP 490 移除 ZGC 非世代模式</li></ul><p>分代 ZGC 的重大改进（Java 21）：</p><ul><li>分离年轻代和老年代：针对不同生命周期对象采用不同回收策略</li><li>性能提升：相比非分代版本，吞吐量提升 20-40%</li><li>延迟优化：停顿时间进一步降低</li><li>内存效率：减少内存分配开销，实测至少降低 5%，部分场景降低 20%</li></ul><p>ZGC 性能优化 JEP 详解：</p><p><strong>ZGC 正式发布（JEP 377）</strong> - Java 15</p><p>可扩展的低延迟垃圾收集器：</p><ul><li>停顿时间 <strong>&lt; 10ms</strong>，支持 8MB 到 16TB 堆内存</li><li>并发处理几乎所有 GC 工作</li><li>特别适合大内存、低延迟要求的应用</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ZGC 参数配置</span>
</span></span><span class=line><span class=cl>-XX:+UnlockExperimentalVMOptions
</span></span><span class=line><span class=cl>-XX:+UseZGC
</span></span><span class=line><span class=cl>-XX:+ZUncommit                <span class=c1># 及时归还内存</span>
</span></span><span class=line><span class=cl>-XX:ZUncommitDelay<span class=o>=</span><span class=m>300</span>        <span class=c1># 归还延迟时间</span></span></span></code></pre></div></figure></div><p><strong>分代 ZGC（JEP 439）</strong> - Java 21</p><p>ZGC 的分代版本，进一步提升性能：</p><ul><li>分离年轻代和老年代管理策略</li><li>吞吐量相比非分代版本提升 <strong>20-40%</strong></li><li>停顿时间进一步优化</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 分代 ZGC 参数</span>
</span></span><span class=line><span class=cl>-XX:+UseZGC
</span></span><span class=line><span class=cl>-XX:+ZGenerational            <span class=c1># 启用分代 ZGC</span>
</span></span><span class=line><span class=cl>-XX:+UseStringDeduplication   <span class=c1># 字符串去重</span></span></span></code></pre></div></figure></div><h4 id=性能内存优化专项>性能内存优化专项<a href=#性能内存优化专项 class=anchor aria-hidden=true>#</a></h4><p>除了垃圾收集器优化外，还有多个通用的性能和内存优化 JEP。</p><p><strong>G1 内存归还（JEP 346）</strong> - Java 12</p><p>G1 垃圾收集器的内存归还机制：</p><ul><li>主动归还未使用的堆内存给操作系统</li><li>内存使用效率提升 <strong>20-30%</strong>，减少内存占用</li></ul><p><strong>ZGC 内存归还（JEP 377）</strong> - Java 15</p><p>ZGC 的主动内存归还功能：</p><ul><li>默认启用内存归还，及时释放未使用的堆内存</li><li>通过 <code>-XX:+ZUncommit</code> 和 <code>-XX:ZUncommitDelay</code> 参数控制</li><li>特别适合内存使用波动较大的应用</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ZGC 内存归还参数</span>
</span></span><span class=line><span class=cl>-XX:+UseZGC
</span></span><span class=line><span class=cl>-XX:+ZUncommit                <span class=c1># 启用内存归还（默认启用）</span>
</span></span><span class=line><span class=cl>-XX:ZUncommitDelay<span class=o>=</span><span class=m>300</span>        <span class=c1># 归还延迟时间（秒）</span>
</span></span><span class=line><span class=cl>-XX:MinHeapFreeRatio<span class=o>=</span><span class=m>20</span>       <span class=c1># 最小空闲堆比例</span></span></span></code></pre></div></figure></div><p><strong>弹性元空间内存归还（JEP 387）</strong> - Java 16</p><p>元空间的内存归还优化：</p><ul><li>动态调整元空间大小，及时释放未使用的类元数据内存</li><li>减少内存碎片化，提高内存归还效率</li><li>内存节省 <strong>20-40%</strong>，特别适合动态类加载场景</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 弹性元空间参数</span>
</span></span><span class=line><span class=cl>-XX:MetaspaceSize<span class=o>=</span>64m          <span class=c1># 初始大小</span>
</span></span><span class=line><span class=cl>-XX:MaxMetaspaceSize<span class=o>=</span>256m      <span class=c1># 最大大小</span>
</span></span><span class=line><span class=cl>-XX:+UseCompressedClassPointers <span class=c1># 启用类指针压缩</span>
</span></span><span class=line><span class=cl>-XX:MetaspaceReclaimPolicy<span class=o>=</span>aggressive  <span class=c1># 积极回收策略</span></span></span></code></pre></div></figure></div><p><strong>紧凑字符串（JEP 254）</strong> - Java 9</p><p>传统 Java String 使用 UTF-16 编码，每个字符占用 2 字节。JEP 254 引入智能编码选择：</p><ul><li>Latin-1 字符（如英文、数字）使用 1 字节存储</li><li>其他字符仍使用 2 字节存储</li><li>内存节省：纯 ASCII/Latin-1 字符串可节省 <strong>50% 内存</strong></li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java 8: 每个字符 2 字节</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>english</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World&#34;</span><span class=p>;</span><span class=w>  </span><span class=c1>// 22 字节</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 9+: 智能选择编码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>english</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World&#34;</span><span class=p>;</span><span class=w>  </span><span class=c1>// 11 字节（节省 50%）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>chinese</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;你好世界&#34;</span><span class=p>;</span><span class=w>      </span><span class=o>//</span><span class=w> </span><span class=n>8</span><span class=w> </span><span class=n>字节</span><span class=err>（</span><span class=n>仍为</span><span class=w> </span><span class=n>UTF</span><span class=o>-</span><span class=n>16</span><span class=err>）</span></span></span></code></pre></div></figure></div><p><strong>字符串去重（JEP 192）</strong> - Java 8u20</p><p>G1 垃圾收集器中的字符串去重功能：</p><ul><li>自动识别堆中内容相同的字符串对象</li><li>合并重复字符串，减少内存占用</li><li>特别适用于大量重复字符串的应用</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 启用字符串去重（G1 默认启用）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>-</span><span class=n>XX</span><span class=p>:</span><span class=o>+</span><span class=n>UseStringDeduplication</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 适用场景：配置文件解析、日志处理、数据导入等</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>configs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=s>&#34;server.port=8080&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;server.port=8080&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;server.port=8080&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>三个字符串对象合并为一个</span><span class=err>，</span><span class=n>节省</span><span class=w> </span><span class=n>2</span><span class=o>/</span><span class=n>3</span><span class=w> </span><span class=n>内存</span></span></span></code></pre></div></figure></div><p><strong>字符串连接优化（JEP 280）</strong> - Java 9</p><p>使用 <code>invokedynamic</code> 动态选择最优字符串连接策略：</p><ul><li>减少临时 StringBuilder 对象创建</li><li>降低内存分配压力</li><li>提升字符串连接性能</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java 8: 可能创建多个临时对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;World&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;!&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Java 9+: 动态优化，减少临时对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;World&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;!&#34;</span><span class=p>;</span></span></span></code></pre></div></figure></div><p><strong>紧凑对象头（JEP 519）</strong> - Java 24/25</p><p>作为 Java 24/25 <strong>最具性价比</strong>特性，仅需一个 JVM 启动参数，即可开启，应用无需改代码，无任何 API 变更。</p><p>减少对象头大小，降低每个对象的内存开销：</p><ul><li>将对象头从原来的 12 字节压缩成 8 字节</li><li>将类指针从 32-bit 压缩为 22-bit</li><li>整体内存使用可降低 <strong>3-5%</strong>，最多 22% 堆内存节省</li><li>最高 30% CPU 减少（Amazon 线上实测）</li><li>GC 频率降低 15%</li><li>Jackson JSON 解析，执行时间减少 10%， <a href=https://www.reddit.com/r/scala/comments/1jptiv3/xxusecompactobjectheaders_is_your_new_turbo/ target=_blank rel=noopener>reddit 文档</a></li><li>特别有利于大量小对象的应用，微服务、Spring Boot、JSON 解析、Map/Set 密集使用等场景</li></ul><p><strong>移除 32 位 x86 移植版本（JEP 503）</strong> - Java 25</p><p>移除对 32 位 x86 架构的支持，专注现代 64 位优化：</p><ul><li><strong>简化代码库</strong>：移除 32 位相关的内存对齐和优化代码</li><li><strong>专注 64 位优化</strong>：JVM 可以更好地利用现代 64 位架构特性</li><li><strong>减少维护负担</strong>：开发团队可以专注于 64 位平台的性能优化</li><li><strong>内存效率提升</strong>：移除 32 位兼容性代码，减少 JVM 内存占用</li><li><strong>指针优化</strong>：64 位架构下的压缩 OOP 优化更高效</li><li><strong>SIMD 指令集</strong>：更好地利用现代 CPU 的向量化指令</li><li><strong>垃圾收集器优化</strong>：G1、ZGC 等收集器针对 64 位架构深度优化</li></ul><p><strong>内存优化效果总结</strong>：</p><table><thead><tr><th>优化项目</th><th>内存节省</th><th>适用场景</th></tr></thead><tbody><tr><td>G1 内存归还</td><td>20-30%</td><td>所有 G1 应用</td></tr><tr><td>ZGC 内存归还</td><td>15-25%</td><td>大内存波动应用</td></tr><tr><td>弹性元空间</td><td>20-40%</td><td>动态类加载</td></tr><tr><td>紧凑字符串</td><td>50%（纯 ASCII）</td><td>文本处理、配置文件</td></tr><tr><td>字符串去重</td><td>10-30%</td><td>大量重复字符串</td></tr><tr><td>紧凑对象头</td><td>3-5%</td><td>大量小对象</td></tr><tr><td>移除 32 位支持</td><td>5-10%</td><td>所有 64 位应用</td></tr></tbody></table><h3 id=技术变革>技术变革<a href=#技术变革 class=anchor aria-hidden=true>#</a></h3><p>30 岁的 Java 还能打吗，未来又能陪我们走多远。</p><p>Java 过去被诟病“啰嗦、入门门槛高、内存占用大”，但社区与生态的持续改进，已经大幅改善了这些问题。近年的 OpenJDK 重点项目尤为亮眼：</p><ul><li>Project Loom：引入虚拟线程，让百万级并发连接开发变得简单高效。</li><li>Project Valhalla：增加值类型，减少内存开销，提高数据密集型任务性能。</li><li>Project Panama：让 Java 与 C/C++ 等语言的互操作更安全高效，尤其适配 AI 工作负载。</li></ul><p>再加上 Quarkus、Micronaut、Spring Boot 以及 GraalVM 的原生编译，Java 在启动速度、延迟控制等方面的短板正在被迅速补齐。</p><p>我们来介绍几个能称得上技术变革的特性。</p><p><strong>架构设计革命：模块系统（JEP 261）</strong> - Java 9</p><p>模块系统是 Java 架构设计的根本性变革：</p><ul><li><strong>强封装</strong>：真正的访问控制，防止内部 API 被误用</li><li><strong>依赖管理现代化</strong>：显式声明模块依赖，解决 JAR Hell 问题</li><li><strong>应用架构优化</strong>：支持模块化应用设计，提高可维护性</li><li><strong>JVM 启动优化</strong>：只加载必要的模块，提升启动性能</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// module-info.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>module</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>myapp</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requires</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>base</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requires</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>logging</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>requires</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>net</span><span class=p>.</span><span class=na>http</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>exports</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>api</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>exports</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>internal</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>provides</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ServiceProvider</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>with</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>DefaultServiceProvider</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p><strong>并发编程革命：虚拟线程（JEP 444）</strong> - Java 21</p><p>虚拟线程是 Java 并发编程的革命性变革，彻底改变了传统的线程模型：</p><ul><li><strong>百万级并发支持</strong>：从传统的数千个平台线程扩展到百万级虚拟线程</li><li><strong>简化异步编程</strong>：消除复杂的回调地狱，让异步代码看起来像同步代码</li><li><strong>资源效率革命</strong>：虚拟线程消耗极少内存（KB 级别 vs MB 级别）</li><li><strong>编程模型变革</strong>：从"线程池管理"转向"任务直接提交"</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 传统线程池方式（复杂且资源消耗大）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ExecutorService</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Executors</span><span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=n>100</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>10000</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 处理任务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 虚拟线程方式（简洁且高效）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>executor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Executors</span><span class=p>.</span><span class=na>newVirtualThreadPerTaskExecutor</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>10000</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 处理任务，每个任务都有自己的虚拟线程</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>然而，虚拟线程引入后，开发者发现了一个重要问题：<strong>synchronized 导致的 Pinning</strong>。</p><p>当虚拟线程在 <code>synchronized</code> 块内发生阻塞操作时，虚拟线程会被"固定"（pinned）到载体线程上，无法释放载体线程供其他虚拟线程使用：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 问题代码：synchronized 导致 pinning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PinningExample</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>lock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>problematicMethod</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>lock</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果在同步块内发生阻塞，虚拟线程会被固定</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1000</span><span class=p>);</span><span class=w>  </span><span class=c1>// 阻塞操作！</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 或者：Files.readString(path);  // IO 阻塞</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>interrupt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>Java 24 通过优化对象监视器的实现，解决了 synchronized 导致的 pinning 问题：</p><ul><li><strong>智能 Pinning</strong>：JVM 现在能够智能判断是否需要固定虚拟线程</li><li><strong>延迟 Pinning</strong>：只在真正需要时才固定虚拟线程到载体线程</li><li><strong>性能提升</strong>：大幅减少了虚拟线程被固定的情况，提高并发性能</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java 24+ 优化后的代码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OptimizedExample</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>lock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>optimizedMethod</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>lock</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// Java 24 中，即使有阻塞操作，虚拟线程也能正确释放</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1000</span><span class=p>);</span><span class=w>  </span><span class=c1>// 不再导致 pinning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 或者：Files.readString(path);  // IO 阻塞也能正确处理</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>interrupt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 推荐做法：使用 ReentrantLock 替代 synchronized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>BestPracticeExample</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ReentrantLock</span><span class=w> </span><span class=n>lock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReentrantLock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>bestPracticeMethod</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>lock</span><span class=p>.</span><span class=na>lock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 使用 ReentrantLock，虚拟线程永远不会被固定</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>interrupt</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>lock</span><span class=p>.</span><span class=na>unlock</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p><strong>内存管理革新：外部存储器访问 API（JEP 393, 412, 442, 454）</strong> - Java 16/17/19/20</p><p>外部存储器访问 API 是 Java 内存管理的重大变革：</p><ul><li><strong>安全堆外内存访问</strong>：替代危险的 Unsafe API，提供类型安全的内存操作</li><li><strong>零拷贝优化</strong>：直接操作堆外内存，避免 JVM 堆与系统内存间的数据拷贝</li><li><strong>高性能应用支持</strong>：为大数据、机器学习、游戏引擎等高性能场景提供支持</li><li><strong>资源管理现代化</strong>：基于作用域的资源管理，确保内存安全</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 传统方式：使用 Unsafe（危险且不推荐）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Unsafe unsafe = Unsafe.getUnsafe();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// long address = unsafe.allocateMemory(size);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 现代方式：使用外部存储器访问 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>MemorySession</span><span class=w> </span><span class=n>session</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MemorySession</span><span class=p>.</span><span class=na>openConfined</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemorySegment</span><span class=w> </span><span class=n>segment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MemorySegment</span><span class=p>.</span><span class=na>allocateNative</span><span class=p>(</span><span class=n>1024</span><span class=p>,</span><span class=w> </span><span class=n>session</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 类型安全的内存访问</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>VarHandle</span><span class=w> </span><span class=n>handle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MemoryLayout</span><span class=p>.</span><span class=na>sequenceLayout</span><span class=p>(</span><span class=n>1024</span><span class=p>,</span><span class=w> </span><span class=n>ValueLayout</span><span class=p>.</span><span class=na>JAVA_INT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>varHandle</span><span class=p>(</span><span class=n>MemoryLayout</span><span class=p>.</span><span class=na>PathElement</span><span class=p>.</span><span class=na>sequenceElement</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handle</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>segment</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>42</span><span class=p>);</span><span class=w>  </span><span class=c1>// 设置第一个整数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=n>handle</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>segment</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>  </span><span class=c1>// 读取第一个整数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p><strong>平台现代化：GraalVM 原生镜像（JEP 391, 457）</strong> - Java 16/21</p><p>GraalVM 原生镜像代表了 Java 平台的现代化方向：</p><ul><li><strong>AOT 编译</strong>：编译时优化，运行时无需 JIT 编译</li><li><strong>极致启动速度</strong>：毫秒级启动时间，适合 Serverless 和容器化</li><li><strong>内存占用优化</strong>：只包含应用需要的代码，显著减少内存占用</li><li><strong>云原生友好</strong>：完美适配容器和微服务架构</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 生成原生镜像</span>
</span></span><span class=line><span class=cl>native-image --no-fallback <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>             --enable-preview <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>             -jar myapp.jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>             myapp-native
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 运行原生镜像（无需 JVM）</span>
</span></span><span class=line><span class=cl>./myapp-native</span></span></code></pre></div></figure></div><p><strong>Java Flight Recorder（JFR）性能监控革命</strong> - Java 8 到 25</p><p>Java Flight Recorder（JFR）是 Java 平台的性能监控革命，提供了生产级低开销的事件收集和分析能力。它在生产环境中的开销通常低于 1%，可以长期运行而不影响应用性能，覆盖操作系统、JVM、应用程序级别的详细监控，与 Java Mission Control 集成提供可视化分析，实现内存泄漏、性能瓶颈、GC 问题的一站式诊断。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 启动 JFR 记录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=w> </span><span class=o>-</span><span class=n>XX</span><span class=p>:</span><span class=o>+</span><span class=n>FlightRecorder</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=o>-</span><span class=n>XX</span><span class=p>:</span><span class=n>StartFlightRecording</span><span class=o>=</span><span class=n>duration</span><span class=o>=</span><span class=n>60s</span><span class=p>,</span><span class=n>filename</span><span class=o>=</span><span class=n>app</span><span class=p>.</span><span class=na>jfr</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=o>-</span><span class=n>jar</span><span class=w> </span><span class=n>MyApp</span><span class=p>.</span><span class=na>jar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 自定义 JFR 事件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Name</span><span class=p>(</span><span class=s>&#34;com.example.CustomEvent&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Custom Business Event&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Category</span><span class=p>(</span><span class=s>&#34;Business&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CustomEvent</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Event</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;User ID&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Operation Duration&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>duration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Success&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>success</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 记录自定义事件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>BusinessService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processUser</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>userId</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomEvent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>begin</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 执行业务逻辑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>doBusinessLogic</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>event</span><span class=p>.</span><span class=na>success</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 异常情况下也会记录事件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>JFR 的发展历程经历了多个重要阶段。</p><p>Java 8 首次引入 JFR 作为商业功能，但仅限 Oracle JDK 使用。直到 Java 11 的 JEP 328，JFR 才被集成到 OpenJDK 成为开源功能，提供完整的 JFR API 和事件框架，支持自定义事件和配置。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Java 11+ 启动 JFR</span>
</span></span><span class=line><span class=cl>java -XX:+FlightRecorder <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -XX:StartFlightRecording<span class=o>=</span><span class=nv>settings</span><span class=o>=</span>profile <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -jar MyApp.jar</span></span></code></pre></div></figure></div><p>Java 14 的 JEP 349 引入了事件流 API，支持实时事件处理，允许程序化访问 JFR 事件数据，支持自定义事件处理器。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 事件流 API 示例</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>es</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FlightRecorder</span><span class=p>.</span><span class=na>getFlightRecorder</span><span class=p>().</span><span class=na>getEventStream</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>es</span><span class=p>.</span><span class=na>onEvent</span><span class=p>(</span><span class=s>&#34;jdk.GarbageCollection&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;GC: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                          </span><span class=s>&#34;, duration: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getDuration</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>es</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>Java 17 的 JEP 380 完善了事件流 API 的稳定性，提供更好的错误处理和资源管理，支持更复杂的事件过滤和处理。</p><p>Java 25 带来了三个重要的 JFR 增强。</p><p>JEP 509 在 Linux 上提供高精度 CPU 时间采样，支持更详细的 CPU 使用分析，帮助识别 CPU 密集型操作。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Java 25 CPU 剖析增强</span>
</span></span><span class=line><span class=cl>java -XX:+FlightRecorder <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -XX:+FlightRecorderOption<span class=o>=</span>EnableCPUProfiling <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -jar MyApp.jar</span></span></code></pre></div></figure></div><p>JEP 518 改进了采样机制，减少对应用性能的影响，支持与其他监控工具的协作，提供更准确的性能数据。</p><p>JEP 520 添加了方法级别的执行时间跟踪，支持方法调用链分析，帮助识别性能热点方法。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Java 25 方法跟踪增强</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@JfrEvent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MethodExecutionEvent</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Event</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Method Name&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Class Name&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>className</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Execution Time&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>executionTime</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>通过 Java 启动命令行监控方法级别的执行：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 针对特定包的方法监控</span>
</span></span><span class=line><span class=cl>java -XX:+FlightRecorder <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -XX:StartFlightRecording<span class=o>=</span><span class=nv>settings</span><span class=o>=</span>profile <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -XX:FlightRecorderOption<span class=o>=</span><span class=nv>EnableMethodProfiling</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -XX:FlightRecorderOption<span class=o>=</span><span class=nv>MethodProfilingInclude</span><span class=o>=</span>com.example.business.* <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -XX:FlightRecorderOption<span class=o>=</span><span class=nv>MethodProfilingExclude</span><span class=o>=</span>com.example.util.* <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     -jar MyApp.jar</span></span></code></pre></div></figure></div><p>对于业务关键事件，可以设计自定义事件来跟踪重要的业务操作：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 业务关键事件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Name</span><span class=p>(</span><span class=s>&#34;com.company.OrderProcessing&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Order Processing Event&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderProcessingEvent</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Event</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Order ID&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>orderId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Processing Stage&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>stage</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Label</span><span class=p>(</span><span class=s>&#34;Customer ID&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>customerId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>事件流监控可以实时处理 JFR 事件，实现动态的监控和告警：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 实时监控示例</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JFRMonitor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>startMonitoring</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>es</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FlightRecorder</span><span class=p>.</span><span class=na>getFlightRecorder</span><span class=p>().</span><span class=na>getEventStream</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>es</span><span class=p>.</span><span class=na>onEvent</span><span class=p>(</span><span class=s>&#34;jdk.ThreadStart&#34;</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>::</span><span class=n>handleThreadStart</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>es</span><span class=p>.</span><span class=na>onEvent</span><span class=p>(</span><span class=s>&#34;jdk.GarbageCollection&#34;</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>::</span><span class=n>handleGC</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>es</span><span class=p>.</span><span class=na>onEvent</span><span class=p>(</span><span class=s>&#34;com.company.OrderProcessing&#34;</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>::</span><span class=n>handleOrder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>es</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>JFR 的技术价值体现在多个方面：无需停机即可获取详细的性能数据，快速定位内存泄漏、GC 问题、性能瓶颈，基于真实数据做出扩容和优化决策，通过数据驱动的优化提升应用性能。</p><p>JFR 代表了 Java 平台监控能力的根本性提升，从传统的日志分析转向了事件驱动的性能分析，为现代 Java 应用提供了强大的可观测性支持。</p><p><strong>AI 计算革命：向量 API（JEP 338, 414, 417, 426, 438, 460, 489）</strong> - Java 16 到 25</p><p>向量 API 是 Java 在 AI 时代的重要技术革命，通过 SIMD（单指令多数据）技术实现高性能并行计算：</p><ul><li><strong>SIMD 并行计算</strong>：单条指令处理多个数据元素，充分利用现代 CPU 的向量处理单元</li><li><strong>AI 性能提升</strong>：机器学习推理速度提升 30-50%，卷积神经网络训练速度提升约 50%</li><li><strong>跨平台兼容</strong>：自动适配不同硬件架构，无需深入了解底层实现</li><li><strong>科学计算优化</strong>：矩阵运算、图像处理等计算密集型任务性能大幅提升</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 向量 API 基础使用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jdk.incubator.vector.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>VectorAPIExample</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建向量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>VectorSpecies</span><span class=o>&lt;</span><span class=n>Float</span><span class=o>&gt;</span><span class=w> </span><span class=n>species</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>SPECIES_256</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>1</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>6</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>7</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>8</span><span class=p>.</span><span class=na>0f</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>2</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>6</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>7</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>8</span><span class=p>.</span><span class=na>0f</span><span class=p>,</span><span class=w> </span><span class=n>9</span><span class=p>.</span><span class=na>0f</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>float</span><span class=o>[</span><span class=n>a</span><span class=p>.</span><span class=na>length</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 向量化计算</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>species</span><span class=p>.</span><span class=na>length</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>va</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>fromArray</span><span class=p>(</span><span class=n>species</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>vb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>fromArray</span><span class=p>(</span><span class=n>species</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>vc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>va</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>vb</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>vc</span><span class=p>.</span><span class=na>intoArray</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// AI 推理中的向量计算</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AIInference</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>matrixMultiply</span><span class=p>(</span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>result</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                     </span><span class=kt>int</span><span class=w> </span><span class=n>rows</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>cols</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>VectorSpecies</span><span class=o>&lt;</span><span class=n>Float</span><span class=o>&gt;</span><span class=w> </span><span class=n>species</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>SPECIES_256</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>rows</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>cols</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>species</span><span class=p>.</span><span class=na>length</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>va</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>fromArray</span><span class=p>(</span><span class=n>species</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>cols</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>j</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>vb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>fromArray</span><span class=p>(</span><span class=n>species</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=n>j</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>vc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>va</span><span class=p>.</span><span class=na>mul</span><span class=p>(</span><span class=n>vb</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>vc</span><span class=p>.</span><span class=na>intoArray</span><span class=p>(</span><span class=n>result</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>cols</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>j</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 图像处理中的向量操作</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ImageProcessing</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>applyFilter</span><span class=p>(</span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>pixels</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>filter</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                  </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>output</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>width</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>height</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>VectorSpecies</span><span class=o>&lt;</span><span class=n>Float</span><span class=o>&gt;</span><span class=w> </span><span class=n>species</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>SPECIES_256</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>height</span><span class=p>;</span><span class=w> </span><span class=n>y</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>width</span><span class=p>;</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>species</span><span class=p>.</span><span class=na>length</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>vpixels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>fromArray</span><span class=p>(</span><span class=n>species</span><span class=p>,</span><span class=w> </span><span class=n>pixels</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>width</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>vfilter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FloatVector</span><span class=p>.</span><span class=na>fromArray</span><span class=p>(</span><span class=n>species</span><span class=p>,</span><span class=w> </span><span class=n>filter</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>vresult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vpixels</span><span class=p>.</span><span class=na>mul</span><span class=p>(</span><span class=n>vfilter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>vresult</span><span class=p>.</span><span class=na>intoArray</span><span class=p>(</span><span class=n>output</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>width</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>向量 API 的发展历程体现了 Java 在 AI 时代的持续演进：</p><p>Java 16 首次引入向量 API 作为孵化器功能（JEP 338），提供了基础的向量操作能力。Java 17 的 JEP 414 进一步完善了 API 设计，增强了类型安全性和性能。</p><p>Java 18 的 JEP 417 和 Java 19 的 JEP 426 持续优化了向量 API 的性能和易用性，支持更多数据类型和操作。Java 20 的 JEP 438 引入了向量掩码和更复杂的向量操作。</p><p>Java 21 的 JEP 460 进一步提升了向量 API 的稳定性，Java 22 的 JEP 489 标志着向量 API 从孵化器状态转为正式功能，成为 Java 平台的标准 API。</p><p>向量 API 的技术价值在于为 Java 在 AI 和科学计算领域提供了强大的性能支持，通过硬件级别的并行计算，让 Java 应用能够在机器学习、图像处理、科学仿真等高性能计算场景中保持竞争力。</p><p><strong>安全革新：抗量子密码学支持（JEP 496, 497）</strong> - Java 24</p><p>随着量子计算技术的快速发展，传统的加密算法面临前所未有的安全威胁。Java 24 引入了抗量子密码学支持，为未来量子计算时代的安全防护做好准备：</p><ul><li><strong>抗量子攻击</strong>：采用基于格的密码学算法，抵御量子计算机的攻击威胁</li><li><strong>前瞻性安全</strong>：提前应对量子计算可能带来的加密体系颠覆</li><li><strong>标准化支持</strong>：遵循 NIST 抗量子密码学标准，确保算法可靠性</li><li><strong>平滑过渡</strong>：新算法与现有安全框架兼容，便于系统升级</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 抗量子密钥封装机制（KEM）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.security.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.crypto.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.crypto.spec.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PostQuantumCrypto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 生成基于格的密钥对</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPairGenerator</span><span class=w> </span><span class=n>kpg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KeyPairGenerator</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;LatticeKEM&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>kpg</span><span class=p>.</span><span class=na>initialize</span><span class=p>(</span><span class=n>2048</span><span class=p>);</span><span class=w> </span><span class=c1>// 抗量子安全强度</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPair</span><span class=w> </span><span class=n>kp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kpg</span><span class=p>.</span><span class=na>generateKeyPair</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PublicKey</span><span class=w> </span><span class=n>publicKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kp</span><span class=p>.</span><span class=na>getPublic</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PrivateKey</span><span class=w> </span><span class=n>privateKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kp</span><span class=p>.</span><span class=na>getPrivate</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 密钥封装（Key Encapsulation）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyAgreement</span><span class=w> </span><span class=n>ka</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KeyAgreement</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;LatticeKEM&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ka</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>privateKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ka</span><span class=p>.</span><span class=na>doPhase</span><span class=p>(</span><span class=n>publicKey</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>sharedSecret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ka</span><span class=p>.</span><span class=na>generateSecret</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 使用共享密钥进行加密</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SecretKeySpec</span><span class=w> </span><span class=n>secretKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SecretKeySpec</span><span class=p>(</span><span class=n>sharedSecret</span><span class=p>,</span><span class=w> </span><span class=s>&#34;AES&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Cipher</span><span class=w> </span><span class=n>cipher</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cipher</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;AES/GCM/NoPadding&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cipher</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>Cipher</span><span class=p>.</span><span class=na>ENCRYPT_MODE</span><span class=p>,</span><span class=w> </span><span class=n>secretKey</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>plaintext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;抗量子加密数据&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>encryptedData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cipher</span><span class=p>.</span><span class=na>doFinal</span><span class=p>(</span><span class=n>plaintext</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;加密成功，数据长度：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>encryptedData</span><span class=p>.</span><span class=na>length</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 抗量子数字签名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PostQuantumSignature</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>digitalSignature</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 生成基于格的签名密钥对</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPairGenerator</span><span class=w> </span><span class=n>kpg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KeyPairGenerator</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;LatticeDSA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>kpg</span><span class=p>.</span><span class=na>initialize</span><span class=p>(</span><span class=n>256</span><span class=p>);</span><span class=w> </span><span class=c1>// 抗量子安全参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPair</span><span class=w> </span><span class=n>kp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kpg</span><span class=p>.</span><span class=na>generateKeyPair</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建数字签名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Signature</span><span class=w> </span><span class=n>signature</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Signature</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;LatticeDSA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>signature</span><span class=p>.</span><span class=na>initSign</span><span class=p>(</span><span class=n>kp</span><span class=p>.</span><span class=na>getPrivate</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;重要文档内容&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>signature</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>digitalSignature</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>signature</span><span class=p>.</span><span class=na>sign</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 验证签名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>signature</span><span class=p>.</span><span class=na>initVerify</span><span class=p>(</span><span class=n>kp</span><span class=p>.</span><span class=na>getPublic</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>signature</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>message</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>isValid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>signature</span><span class=p>.</span><span class=na>verify</span><span class=p>(</span><span class=n>digitalSignature</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;签名验证结果：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>isValid</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 混合加密方案（传统 + 抗量子）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HybridCrypto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>hybridEncryption</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 使用传统 RSA 加密抗量子的会话密钥</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPairGenerator</span><span class=w> </span><span class=n>rsaKpg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KeyPairGenerator</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;RSA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rsaKpg</span><span class=p>.</span><span class=na>initialize</span><span class=p>(</span><span class=n>2048</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPair</span><span class=w> </span><span class=n>rsaKp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rsaKpg</span><span class=p>.</span><span class=na>generateKeyPair</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 使用抗量子算法生成会话密钥</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPairGenerator</span><span class=w> </span><span class=n>latticeKpg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KeyPairGenerator</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;LatticeKEM&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>latticeKpg</span><span class=p>.</span><span class=na>initialize</span><span class=p>(</span><span class=n>256</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>KeyPair</span><span class=w> </span><span class=n>latticeKp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>latticeKpg</span><span class=p>.</span><span class=na>generateKeyPair</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 混合加密流程</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Cipher</span><span class=w> </span><span class=n>rsaCipher</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cipher</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;RSA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rsaCipher</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>Cipher</span><span class=p>.</span><span class=na>ENCRYPT_MODE</span><span class=p>,</span><span class=w> </span><span class=n>rsaKp</span><span class=p>.</span><span class=na>getPublic</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 用 RSA 加密抗量子密钥</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>encryptedLatticeKey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rsaCipher</span><span class=p>.</span><span class=na>doFinal</span><span class=p>(</span><span class=n>latticeKp</span><span class=p>.</span><span class=na>getPublic</span><span class=p>().</span><span class=na>getEncoded</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;混合加密完成，确保向后兼容性&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>Java 24 的抗量子密码学支持标志着 Java 安全体系的重大升级：</p><p><strong>JEP 496：基于格的密钥封装机制</strong>引入了抗量子攻击的密钥协商协议，确保在量子计算环境下密钥交换的安全性。该机制采用基于格的数学结构，即使在量子计算机面前也能保持强大的安全性。</p><p><strong>JEP 497：基于格的数字签名算法</strong>提供了抗量子攻击的数字签名方案，保障数据的完整性和身份验证。新的签名算法在保持高性能的同时，提供了面向未来的安全保障。</p><p>抗量子密码学的技术价值体现在多个方面：为 Java 应用提供面向未来的安全防护，确保在量子计算时代的数据安全，通过标准化算法降低安全风险，为关键基础设施提供长期安全保障。</p><p>这些安全革新确保了 Java 平台能够在量子计算威胁面前保持强大的安全防护能力，为开发者在未来构建安全可靠的应用系统提供了坚实的技术基础。</p><h2 id=破坏性变更评估工具>破坏性变更评估工具<a href=#破坏性变更评估工具 class=anchor aria-hidden=true>#</a></h2><p>从 Java 8 升级到 25，总体风险还是很大，总结起来可能有几个比较关键的节点：</p><ul><li><p>Java 8 → Java 9（模块系统强制封装）</p><ul><li>内部 API 访问限制：<code>sun.*</code>、<code>com.sun.*</code> 包访问受限</li><li>反射访问受限：<code>setAccessible()</code> 对模块私有成员失效</li></ul></li><li><p>Java 9 → Java 11（组件移除）</p><ul><li>Java EE 模块移除：<code>java.ee.*</code> 模块被移除</li><li>JavaFX 移除：桌面应用需要单独安装，有些使用 <code>javafx.utils</code> 的代码需要寻找替代品</li><li>JAXB 移除：<code>javax.xml.bind.*</code> 包被移除，需要单独添加依赖</li><li>JAX-WS 移除：<code>javax.xml.ws.*</code> 包被移除，需要单独添加依赖</li><li>JAX-RS 移除：<code>javax.ws.rs.*</code> 包被移除，需要单独添加依赖</li></ul></li><li><p>Java 11 → Java 17（更多组件移除）</p><ul><li>Nashorn JavaScript 引擎移除：<code>ScriptEngine</code> 执行 JavaScript 会报错</li><li>Pack200 工具移除：使用 Pack200 压缩的应用无法运行</li><li>CORBA 模块移除：<code>java.corba.*</code> 模块被完全移除</li><li>AWT Utilities 移除：<code>sun.awt.util.*</code> 工具类被移除</li></ul></li><li><p>Java 17 → Java 21（兼容性问题）</p><ul><li>安全管理器废弃警告：Java 17 开始标记为废弃，Java 21 警告增强</li><li>部分反射、Agent 相关 API 变更，需要仔细测试</li></ul></li><li><p>Java 21 → Java 25（安全管理器永久禁用）</p><ul><li>JEP 486：安全管理器被永久禁用，无法再启用和安装，使用 SecurityManager 的应用将无法启动</li><li>JEP 498：使用 sun.misc.Unsafe 内存访问方法时发出运行时警告，建议迁移到 VarHandle 或外部函数与内存 API</li></ul></li></ul><p>除了被移除的模块，部分 API 方法级别也有小范围的变更。</p><p>推荐最安全的方式：<strong>开发、编译、运行始终使用相同的版本</strong>。</p><p>在升级之前，可通过以下工具对总体有一个概览，心里有谱才能安全升级。</p><h3 id=jdeps>jdeps<a href=#jdeps class=anchor aria-hidden=true>#</a></h3><p>jdeps 是 Java 自带的命令行工具，可以用来分析依赖关系和生成模块信息文件，这里我们只借用他的其中一项功能。</p><p>通过 <code>jdeps --jdk-internals</code> 检查是否有使用内部 API，以下例子显示使用了 <code>sun.net.util.IPAddressUtil</code> 这个 Java 内部工具类，会显示详细的源码类和 jar 包位置。</p><p>可以继续使用 Java 中的内部 API，另外 OpenJDK Wiki 页面 <a href=https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool target=_blank rel=noopener>Java Dependency Analysis Tool</a>
推荐了某些常用 JDK 内部 API 的替换项，可参考这些建议替换掉。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeps -dotoutput &lt;dot-file-dir&gt; -jdkinternals &lt;one-or-more-jar-files....&gt;
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeps --jdk-internals --multi-release <span class=m>21</span> --class-path . target/xxx.jar
</span></span><span class=line><span class=cl><span class=go>. -&gt; java.base
</span></span></span><span class=line><span class=cl><span class=go>   com.my.SecurityChecker -&gt; sun.net.util.IPAddressUtil  JDK internal API (java.base)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: JDK internal APIs are unsupported and private to JDK implementation that are
</span></span></span><span class=line><span class=cl><span class=go>subject to be removed or changed incompatibly and could break your application.
</span></span></span><span class=line><span class=cl><span class=go>Please modify your code to eliminate dependence on any JDK internal APIs.
</span></span></span><span class=line><span class=cl><span class=go>For the most recent update on JDK internal API replacements, please check:
</span></span></span><span class=line><span class=cl><span class=go>https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool
</span></span></span></code></pre></div></figure></div><h3 id=jdeprscan>jdeprscan<a href=#jdeprscan class=anchor aria-hidden=true>#</a></h3><p>jdeprscan 也是 Java 自带分析工具，可查看是否使用了已弃用或已删除的 API。使用已弃用的 API 不是阻塞性问题，还能接着跑，但是建议替换掉。使用已删除的 API，那就彻底跑不起来了。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 了解自 Java <span class=m>8</span> 到 <span class=m>25</span> 废弃的具体 API
</span></span><span class=line><span class=cl><span class=gp>$</span> jdeprscan --release <span class=m>25</span> --list
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 如果只想看一删除的，加上 --for-removal ，列出已删除的 API
</span></span><span class=line><span class=cl><span class=gp>$</span> jdeprscan --release <span class=m>25</span> --list --for-removal
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;9&#34;, forRemoval=true) class javax.security.cert.Certificate
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;9&#34;, forRemoval=true) class javax.security.cert.CertificateEncodingException
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>……
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;18&#34;, forRemoval=true) void java.lang.Enum.finalize()
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;17&#34;, forRemoval=true) void java.lang.System.setSecurityManager(java.lang.SecurityManager)
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;17&#34;, forRemoval=true) java.lang.SecurityManager java.lang.System.getSecurityManager()
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;21&#34;, forRemoval=true) javax.management.MBeanServerConnection javax.management.remote.JMXConnector.getMBeanServerConnection(javax.security.auth.Subject)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;25&#34;, forRemoval=true) class java.net.URLPermission
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;25&#34;, forRemoval=true) class java.net.NetPermission
</span></span></span></code></pre></div></figure></div><p>扫描自己的代码中是否有使用废弃 API：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意通过 --class-path 增加依赖的 jar 包
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --class-path log4j-api-2.13.0.jar my-application.jar
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>error: cannot find class sun/misc/BASE64Encoder
</span></span></span><span class=line><span class=cl><span class=go>class com/company/Util uses deprecated method java/lang/Double::&lt;init&gt;(D)V
</span></span></span></code></pre></div></figure></div><p>以上例子，com.company.Util 类在调用 java.lang.Double 类的已弃用构造函数。 javadoc 会建议用来代替已弃用 API 的 API。 但是无法解决“error: cannot find class sun/misc/BASE64Encoder”问题，因为它是已删除的 API， 自 Java 8 发布以来，应使用 java.util.Base64。</p><p>注意使用 jdeprscan 需要通过 &ndash;class-path 指定依赖项，可先执行 <code>mvn dependency:copy-dependencies</code> 命令，此时会 copy 依赖项到 <code>target/dependency</code> 目录。</p><p>如果你加了 &ndash;class-path 依赖，大概率还是报错误 <code>error: cannot find class</code>，目测寻找依赖项是根据 <code>target/dependency</code> 中的名字顺序找的，不是常规的 java 进程一次性加载完，不知道这算不算 jdeprscan 的设计 Bug，具体解决办法可参考 <a href=https://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error target=_blank rel=noopener>jdeprscan-throws-cannot-find-class-error</a>
。</p><p>我采用的解决方式是把所有依赖 jar 文件都接到某个文件夹，解压成 classes，然后 class-path 使用此文件。这样还有个好处，扫描报告里只有我真正要扫描的当前项目的报告，不包含第三方 jar 的。</p><p>以上过程命令行参考：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn dependency:copy-dependencies  -Dsilent<span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir -p target/dependency-classes
</span></span><span class=line><span class=cl><span class=k>for</span> jar in target/dependency/*.jar<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    unzip -o <span class=s2>&#34;</span><span class=nv>$jar</span><span class=s2>&#34;</span> -d target/dependency-classes
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>jdeprscan --class-path target/dependency-classes  target/really-project.jar</span></span></code></pre></div></figure></div><p>除了使用 jdeprscan 命令行以外，也可在你项目的 maven pom 文件中引入 <code>maven-jdeps-plugin</code>，如下示例，引入后如果有使用废弃 API，将在 <code>mvn package</code> 的时候直接失败报错，避免有人无意引入废弃 API。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;project&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-jdeps-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.1.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=c>&lt;!-- verify main classes --&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>jdkinternals<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>              <span class=c>&lt;!-- verify test classes --&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>test-jdkinternals<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;multiRelease&gt;</span>21<span class=nt>&lt;/multiRelease&gt;</span>
</span></span><span class=line><span class=cl>          <span class=c>&lt;!-- 其他参数按需配置 --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span></span></span></code></pre></div></figure></div><h3 id=emt4j>emt4j<a href=#emt4j class=anchor aria-hidden=true>#</a></h3><p>emt4j 是 Eclipse 推出的一个静态分析工具，下面会详细介绍用法，展示效果。</p><h3 id=forbiddenapis>forbiddenapis<a href=#forbiddenapis class=anchor aria-hidden=true>#</a></h3><p>maven forbiddenapis 除了提供自定义 API 检查以外，其实还内置了一些 jdk-unsafe、jdk-deprecated、jdk-internal 检查规则。</p><p>另外与以上 jdeps、jdeprscan 的主要区别是，forbiddenapis 能做到在编译期就直接禁止报错，确保只要编译成功就能安全运行。</p><p>更详细使用参考 <a href=/blog/ci-maven-forbidden-api/>Maven 如何在编译时禁止调用某些特定 API</a>
。</p><h2 id=升级兼容方法措施>升级兼容方法措施<a href=#升级兼容方法措施 class=anchor aria-hidden=true>#</a></h2><p>下面介绍几种在升级过程中非常有用的方法措施。</p><h3 id=maven-的-profile-机制>Maven 的 profile 机制<a href=#maven-的-profile-机制 class=anchor aria-hidden=true>#</a></h3><p>利用 Maven 的 <code>profile</code> 机制，配合 JDK 版本号，自动激活不同的配置。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;profiles&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>Java1.8<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;activation&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 在 JDK 1.8 时自动激活--&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;jdk&gt;</span>1.8<span class=nt>&lt;/jdk&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/activation&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 设置不同的 properties 和  dependencies --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;spring.version&gt;</span>5.3.33<span class=nt>&lt;/spring.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在父 POM 中使用 dependencyManagement 生命 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在需要的子模块中可以直接使用 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>javax.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>javax.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>4.0.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;scope&gt;</span>provided<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-surefire-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>3.2.5<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;includes&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;include&gt;</span>**/*Test.java<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/includes&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>3.13.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;showWarnings&gt;</span>true<span class=nt>&lt;/showWarnings&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;fork&gt;</span>true<span class=nt>&lt;/fork&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>Java21<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;activation&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 在 Java 21 以上激活        --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;jdk&gt;</span>[21,)<span class=nt>&lt;/jdk&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/activation&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;spring.version&gt;</span>6.0.19<span class=nt>&lt;/spring.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在父 POM 中使用 dependencyManagement 生命 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在需要的子模块中可以直接使用 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>jakarta.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>jakarta.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>6.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;scope&gt;</span>provided<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.openjdk.nashorn<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>nashorn-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>15.4<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.glassfish.jaxb<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>jaxb-runtime<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>2.3.9<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>javax.annotation<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>javax.annotation-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.3.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-surefire-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>3.2.5<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;includes&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;include&gt;</span>**/*Test.java<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/includes&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;argLine&gt;</span>
</span></span><span class=line><span class=cl>              --add-opens java.base/java.lang=ALL-UNNAMED
</span></span><span class=line><span class=cl>              --add-opens java.base/java.util=ALL-UNNAMED
</span></span><span class=line><span class=cl>              --add-opens java.base/java.math=ALL-UNNAMED
</span></span><span class=line><span class=cl>              --add-opens java.base/java.time=ALL-UNNAMED
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/argLine&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;showWarnings&gt;</span>true<span class=nt>&lt;/showWarnings&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;fork&gt;</span>true<span class=nt>&lt;/fork&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;compilerArgs&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;arg&gt;</span>-J--add-opens=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED<span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/compilerArgs&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/profiles&gt;</span></span></span></code></pre></div></figure></div><h3 id=java-multi-release-jar>Java Multi-Release JAR<a href=#java-multi-release-jar class=anchor aria-hidden=true>#</a></h3><p>Java Multi-Release JAR（多版本 JAR）是 Java 9 引入的重要特性，允许在同一个 JAR 文件中包含针对不同 Java 版本的类文件。</p><p>特点：</p><ul><li>运行时 JVM 会根据当前 Java 版本自动选择对应的类文件</li><li>如果指定版本不存在，会回退到默认版本</li><li>需要确保所有版本的公共 API 保持一致</li><li>编译时需要指定正确的 Java 版本</li></ul><p>Multi-Release JAR 通过在 JAR 的<code>META-INF/versions/</code>目录下组织不同版本的类文件：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>myapp.jar
</span></span></span><span class=line><span class=cl><span class=go>├── META-INF/
</span></span></span><span class=line><span class=cl><span class=go>│   ├── MANIFEST.MF
</span></span></span><span class=line><span class=cl><span class=go>│   └── versions/
</span></span></span><span class=line><span class=cl><span class=go>│       ├── 9/
</span></span></span><span class=line><span class=cl><span class=go>│       │   └── com/example/Utils.class
</span></span></span><span class=line><span class=cl><span class=go>│       ├── 11/
</span></span></span><span class=line><span class=cl><span class=go>│       │   └── com/example/Utils.class
</span></span></span><span class=line><span class=cl><span class=go>│       └── 17/
</span></span></span><span class=line><span class=cl><span class=go>│           └── com/example/Utils.class
</span></span></span><span class=line><span class=cl><span class=go>├── com/example/
</span></span></span><span class=line><span class=cl><span class=go>│   └── Utils.class  # 默认版本（Java 8）
</span></span></span><span class=line><span class=cl><span class=go>└── com/example/
</span></span></span><span class=line><span class=cl><span class=go>    └── Main.class
</span></span></span></code></pre></div></figure></div><h4 id=maven-配置>Maven 配置<a href=#maven-配置 class=anchor aria-hidden=true>#</a></h4><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;release&gt;</span>8<span class=nt>&lt;/release&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>maven-jar-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>3.3.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;archive&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;manifestEntries&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;Multi-Release&gt;</span>true<span class=nt>&lt;/Multi-Release&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/manifestEntries&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/archive&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 为不同 Java 版本编译 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;profiles&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>java9<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;activation&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;jdk&gt;</span>9<span class=nt>&lt;/jdk&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/activation&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;release&gt;</span>9<span class=nt>&lt;/release&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;compileSourceRoots&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;compileSourceRoot&gt;</span>src/main/java9<span class=nt>&lt;/compileSourceRoot&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/compileSourceRoots&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/profiles&gt;</span></span></span></code></pre></div></figure></div><h4 id=优势与适用场景>优势与适用场景<a href=#优势与适用场景 class=anchor aria-hidden=true>#</a></h4><ul><li><strong>向后兼容</strong>：同一个 JAR 可以在不同 Java 版本上运行</li><li><strong>性能优化</strong>：在支持的版本上使用更高效的实现</li><li><strong>渐进升级</strong>：允许库作者逐步迁移到新特性</li><li><strong>减少维护</strong>：避免维护多个版本的 JAR 文件</li></ul><h3 id=java-模块化兼容>Java 模块化兼容<a href=#java-模块化兼容 class=anchor aria-hidden=true>#</a></h3><p>初次升级时一定会遇到这种错误。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Caused by: java.lang.reflect.InaccessibleObjectException: Unable to make field protected int[] java.util.Calendar.fields accessible: module java.base does not &#34;opens java.util&#34; to unnamed module @21282ed8
</span></span></span></code></pre></div></figure></div><p>也一定知道怎么解决了，将没开放的模块强制对外开放，有两个参数选项：</p><ul><li><code>--add-exports</code> 导出包，意味着其中的所有公共类型和成员都可以在编译和运行时访问。</li><li><code>--add-opens</code> 打开包，意味着其中的所有类型和成员（不仅是公共类型）都可以在运行时访问。</li></ul><p>两者的区别在于 <code>--add-opens</code> 开放的更加彻底，不仅 public 类型、变量及方法可以访问，就连非 public 元素，也可以通过调用 setAccessible(true) 后也可以访问。简单起见，直接使用 <code>--add-opens</code> 即可。</p><p>使用 Maven 命令时，配置 maven-surefire-plugin 插件，参考如下：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>maven-surefire-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;argLine&gt;</span>
</span></span><span class=line><span class=cl>      --add-opens=java.base/java.lang.reflect=ALL-UNNAMED
</span></span><span class=line><span class=cl>      --add-opens=java.base/java.math=ALL-UNNAMED
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/argLine&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/plugin&gt;</span></span></span></code></pre></div></figure></div><p>在 IntelliJ IDEA 运行程序如果报错，可以通过在 “VM Option” 配置项中，增加 Java 模块化 <code>--add-opens</code> 相关启动参数即可正常启动。</p><p>完整 <code>--add-opens</code> 列表：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.lang.reflect<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.lang<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.io<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.util<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.util.concurrent<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.rmi/sun.rmi.transport<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.math<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.net<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.nio<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.security<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.text<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.time<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/jdk.internal.access<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/jdk.internal.misc<span class=o>=</span>ALL-UNNAMED</span></span></code></pre></div></figure></div><h2 id=辅助迁移工具>辅助迁移工具<a href=#辅助迁移工具 class=anchor aria-hidden=true>#</a></h2><p>一些辅助迁移到新版本的工具，仅供参考。</p><h3 id=maven-依赖包更新>Maven 依赖包更新<a href=#maven-依赖包更新 class=anchor aria-hidden=true>#</a></h3><p>使用 maven 检查是否有最新的依赖包和插件，对整体项目有一个全局的了解。注意，这里给的建议仅供参考，不要一下子应用上，需要综合考虑当前的项目依赖关系。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn versions:display-dependency-updates
</span></span><span class=line><span class=cl>mvn versions:display-plugin-updates</span></span></code></pre></div></figure></div><h3 id=emt4j-1>EMT4J<a href=#emt4j-1 class=anchor aria-hidden=true>#</a></h3><p><a href=https://github.com/adoptium/emt4j target=_blank rel=noopener>Eclipse Migration Toolkit for Java (EMT4J)</a>
也是一个静态分析工具，可输出分析报告，也可直接 apply 到 git，支持通过 maven 插件、cli 命令行、Java Agent 3 种方式分析。</p><p>目前发布比较慢，已 Realease 版本只分析到 Java 17，只有 master 分支支持 Java 21，可以基于 master 分支自己编译构建。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 以下示例自己编译构建，master 分支还不太稳定，可能出错
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> git clone git@github.com:adoptium/emt4j.git
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> emt4j
</span></span><span class=line><span class=cl><span class=gp>$</span> mvn clean package -Prelease
</span></span><span class=line><span class=cl><span class=gp>#</span> 以上步骤生成 emt4j-<span class=si>${</span><span class=nv>version</span><span class=si>}</span>.zip 在 emt4j-assembly/target 目录下。
</span></span><span class=line><span class=cl><span class=gp>#</span> 解压以上 zip 后，得到
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>emt4j tree -L 2
</span></span></span><span class=line><span class=cl><span class=go>.
</span></span></span><span class=line><span class=cl><span class=go>├── bin
</span></span></span><span class=line><span class=cl><span class=go>│   ├── analysis.bat
</span></span></span><span class=line><span class=cl><span class=go>│   └── analysis.sh
</span></span></span><span class=line><span class=cl><span class=go>└── lib
</span></span></span><span class=line><span class=cl><span class=go>    ├── agent
</span></span></span><span class=line><span class=cl><span class=go>    ├── analysis
</span></span></span><span class=line><span class=cl><span class=go>    └── maven-plugin
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意 emt4j 需要使用 Java <span class=m>8</span> 运行，所以先把自己的 Java 环境切换到 Java <span class=m>8</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> sh bin/analysis.sh -f <span class=m>8</span> -t <span class=m>17</span> -o report.html my-java-project-dir
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 在 report.html 能看到分析内容和建议，如
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Issues Context
</span></span></span><span class=line><span class=cl><span class=go>Location: refclass:file:my-java-project-dir/target/classes/com/mypackage/spring/BaseAbstractDataSource.class!/com.mypackage.spring.BaseAbstractDataSource!/, Target: java.lang.Class.newInstance()Ljava/lang/Object;
</span></span></span></code></pre></div></figure></div><p>可通过 emt4j-maven-plugin 进行检查。增加以下 plugin，执行 <code>mvn emt4j:check</code> 成功后查看报告。</p><p>注意 emt4j-maven-plugin 目前版本 0.8.0 比较老，请使用 Java 8 或 Java 17 跑 mvn 命令，版本太高会失败。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.eclipse.emt4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>emt4j-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>0.8.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 当前版本 --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fromVersion&gt;</span>8<span class=nt>&lt;/fromVersion&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 期望升级版本，0.8.0 还不支持 Java 21 --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;toVersion&gt;</span>17<span class=nt>&lt;/toVersion&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;outputFile&gt;</span>target/report.html<span class=nt>&lt;/outputFile&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span></span></span></code></pre></div></figure></div><p>不想使用 xml 配置的，可参考以下命令行直接 run plugin。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 官方当前发布的版本</span>
</span></span><span class=line><span class=cl>mvn process-test-classes org.eclipse.emt4j:emt4j-maven-plugin:0.8.0:check -DfromVersion<span class=o>=</span><span class=m>8</span> -DtoVersion<span class=o>=</span><span class=m>17</span> -DoutputFile<span class=o>=</span>emt4j-report.html
</span></span><span class=line><span class=cl><span class=c1># 这个是我自己基于 master 分支编译的 0.91 版本，支持 Java21</span>
</span></span><span class=line><span class=cl>mvn process-test-classes org.eclipse.emt4j:emt4j-maven-plugin:0.91:process -DfromVersion<span class=o>=</span><span class=m>8</span> -DtoVersion<span class=o>=</span><span class=m>21</span> -DoutputFile<span class=o>=</span>emt4j-report.html</span></span></code></pre></div></figure></div><p>检查结果错误可能很多，根据优先级修改，比如以下我的检查结果，检查结果支持中英文展示。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Non-heap memory footprint increasing
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Description
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Priority: p1 Issue Count: 1
</span></span></span><span class=line><span class=cl><span class=go>Netty uses the direct byte buffer internally. There 2 ways to manage the direct buffer lifecycle, the first it&#39;s managed by Netty self, and the second is managed by JVM. In JDK 8, netty uses the first way, but in JDK 11, netty uses the second. The first cannot be monitored through MXBean, but the second can be monitored.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>How to fix
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>If you want keep the first way,add the option to JVM:&#34;-Dio.netty.tryReflectionSetAccessible=true --add-opens=java.base/jdk.internal.misc=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED&#34; when running on JDK 11.But if use the second way,the netty should upgrade to a version at least 4.1.33. Because the older netty use a remove API tht release byte buffer.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Issues Context
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Target: file:/Users/l10178/.m2/repository/io/netty/netty/3.10.0.Final/netty-3.10.0.Final.jar
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>优先级：p1
</span></span></span><span class=line><span class=cl><span class=go>有一些 class 已经被删除了需要修改代码替换成为新的 API
</span></span></span><span class=line><span class=cl><span class=go>位置：file:xxx/Base64Util.class, 目标：sun.misc.BASE64Decoder
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>优先级：p3
</span></span></span><span class=line><span class=cl><span class=go>通过测试已知的一些不兼容的 jar
</span></span></span><span class=line><span class=cl><span class=go>如何修复：
</span></span></span><span class=line><span class=cl><span class=go>file:/root/.m2/repository/dom4j/dom4j/1.6.1/dom4j-1.6.1.jar 不匹配规则 &#34;Version should &gt;= &#39;2.0&#39; &#34;
</span></span></span></code></pre></div></figure></div><h3 id=openrewrite>OpenRewrite<a href=#openrewrite class=anchor aria-hidden=true>#</a></h3><p><a href=https://docs.openrewrite.org/ target=_blank rel=noopener>OpenRewrite</a>
一键升级依赖包，重构源码。</p><p>比如 BigDecimal 部分 API 标记为废弃，如 <code>java.math.BigDecimal.divide(Ljava/math/BigDecimal;II)</code>，需要替换为明确枚举类型的 <code>RoundingMode</code>, 就可使用 <a href=https://docs.openrewrite.org/recipes/staticanalysis/bigdecimalroundingconstantstoenums target=_blank rel=noopener>OpenRewrite bigdecimalroundingconstantstoenums</a>
一键替换。</p><p>OpenRewrite 除了作为一个强大的工具使用外，还有一个我特别喜欢的地方，就是它实际上是一个丰富的经验总结输出。</p><p>比如通过查看 <code>Migrate to Java 25</code> 的列表定义，就能知道 Java 25 有哪些主要的变更。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>specs.openrewrite.org/v1beta/recipe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>org.openrewrite.java.migrate.UpgradeToJava25</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Migrate to Java 25</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>  This recipe will apply changes commonly needed when migrating to Java 25. This recipe will also replace deprecated API with equivalents when there is a clear migration strategy. Build files will also be updated to use Java 25 as the target/source and plugins will be also be upgraded to versions that are compatible with Java 25.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>java25</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>recipeList</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.UpgradeToJava21</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>org.openrewrite.java.migrate.UpgradeJavaVersion</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>25</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.lang.MigrateProcessWaitForDuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.lang.ReplaceUnusedVariablesWithUnderscore</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.util.MigrateInflaterDeflaterToClose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.AccessController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.RemoveSecurityPolicy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.RemoveSecurityManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.SystemGetSecurityManagerToNull</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>org.openrewrite.java.migrate.MigrateZipErrorToZipException</span></span></span></code></pre></div></figure></div><p>入门指导可参考我的另一篇博客：<a href=https://www.xlabs.club/docs/platform/smart-code/ target=_blank rel=noopener>智能代码重构</a>
。</p><p>相比于以上几个工具，OpenRewrite 更成熟易用，与 IDEA 业已集成，使用起来相对友好。</p><h3 id=jacoline>JaCoLine<a href=#jacoline class=anchor aria-hidden=true>#</a></h3><p><a href=https://jacoline.dev/inspect target=_blank rel=noopener>JaCoLine</a>
检查 Java 命令行选项参数有没有问题，识别出已经过时不支持的参数。</p><h3 id=java-参数查询工具>Java 参数查询工具<a href=#java-参数查询工具 class=anchor aria-hidden=true>#</a></h3><p>Java 参数太多，到 <a href=https://chriswhocodes.com/corretto_jdk21_options.html target=_blank rel=noopener>VM Options Explorer - Corretto JDK21</a>
中参照，里面根据 JDK 的版本以及发行商，列出来所有的相关参数，选择好对应发行商的正确版本，就可以搜索或者查看 java 命令支持的所有参数了。</p><h3 id=sdkman>SDKMAN<a href=#sdkman class=anchor aria-hidden=true>#</a></h3><p>推荐使用 <a href=https://sdkman.io/ target=_blank rel=noopener>SDKMAN</a>
安装和管理 JDK，方便不同版本切换。除了 JDK，他还提供了 Java 生态里常用的 Maven、Gradle、Groovy、Spring Boot 等很多组件的安装管理。</p><h2 id=生产环境-gc-推荐配置>生产环境 GC 推荐配置<a href=#生产环境-gc-推荐配置 class=anchor aria-hidden=true>#</a></h2><p>升级到 Java 25 以后以下是根据我们公司常规经验推荐的配置，非普世可用，请根据自己的应用情况臻选。</p><ul><li>如果是 Java 21 在使用 ZGC，推荐启用分代 <code>-XX:+ZGenerational</code> ，对稳定性、吞吐量、内存占用都有很大优化。Java 23 默认启用分代 ZGC，Java 24 已废弃非分代 ZGC。</li><li>在很多场景下 G1 仍然是最稳的选择，内存占用比 ZGC 低，CPU 更稳定。大部分场景下小内存应用，并不需要 ZGC。</li><li>亲测大部分应用 Java 25 比 Java 21 内存占用约少 5%-10%，GC 更稳定。</li></ul><h2 id=遇见问题和解决办法>遇见问题和解决办法<a href=#遇见问题和解决办法 class=anchor aria-hidden=true>#</a></h2><ul><li><p>一定要升级依赖包吗，不升级能编译通过，直接用 Java 21 能不能跑起来，会不会有问题。</p><p>以我们实际经验来看，确实有很多应用不升级可直接运行，也没有问题，取决于有没有使用已删除 API。<strong>开发、编译、运行始终使用相同的版本</strong>能避免很多不必要的麻烦。</p></li><li><p>序列化：alibaba fastjson 1.x <strong>不支持 Java record</strong>, 将一个 record 对象转为 String 结果是 <code>{}</code>, 而且不报错！fastjson2 才支持。</p></li><li><p>字节码之类的工具包比如 javassist、asm、byte-buddy 一定要升级到配套的版本，否则可能出现编译期错误，设置是运行期错误比如 dubbo。</p></li><li><p>升级到 Java 21 以后，内存占用反而更高了，运行一段时间内存递增最后 OOM，后来定位是命中了 netty 的 Bug，详细介绍参考：<a href=https://www.cnblogs.com/jingdongkeji/p/17678977.html target=_blank rel=noopener>jdk17 下 netty 导致堆内存疯涨原因排查</a>
。</p></li><li><p>升级到 Java 21 以后，再次内存占用更高，从 dump 文件里，看到了有大约 800 个 ThreadLocal 和 BufferCache 对象，最终定位命中了 <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=195728187" target=_blank rel=noopener>JAVA NIO 这个问题</a>
，所以我们在启动命令行增加了 <code>-Djdk.nio.maxCachedBufferSize=1048576</code> 参数后不再 OOM。</p></li><li><p>内存占用高，与预期严重不符，最终定位是 glibc 内存不归还问题：从 trace 来看 JVM 进程本身释放了内存，但是 glibc 并没有归还操作系统，最后把 glibc 切换成 jemalloc，内存立马下降 30%。定位过程和解决办法参考：<a href=https://www.xlabs.club/blog/java-memory/ target=_blank rel=noopener>K8S Pod 容器内 Java 进程内存分析，内存虚高以及容器 OOM 或 Jave OOM 问题定位</a>
。</p></li><li><p>TLS 不兼容问题，很多老系统，比如老版本 MySQL、SQLServer，还是使用老版本 TLS，就会出现类似如下错误。JDK 17 是支持 TLS1.0 ~ TLS1.3 的，但是默认使用的 TLS 版本是 TLS 1.3, 老版本被禁用了，需要主动放开。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> 错误日志
</span></span><span class=line><span class=cl><span class=go>The server selected protocol version TLS10 is not accepted by client preferences [TLS13, TLS12]。
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 配置文件
</span></span><span class=line><span class=cl><span class=gp>$</span>JAVA_HOME/conf/security/java.security
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 找到里面的一行配置：
</span></span><span class=line><span class=cl><span class=go>jdk.tls.disabledAlgorithms=SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, \
</span></span></span><span class=line><span class=cl><span class=go>    DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 说明：JDK 中的 jdk.tls.disabledAlgorithms 参数用于禁用不安全或不需要的 TLS 密码算法，
</span></span><span class=line><span class=cl><span class=go>以提高系统的安全性。通过配置这个参数，可以指定 JDK 不支持的密码算法或协议，以降低它们的优先级，
</span></span></span><span class=line><span class=cl><span class=go>减少被攻击的风险。
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 我们把 TLSv1，TLSv1.1 这两个删除掉，变成如下：
</span></span><span class=line><span class=cl><span class=go>jdk.tls.disabledAlgorithms=SSLv3, RC4, DES, MD5withRSA, \
</span></span></span><span class=line><span class=cl><span class=go>    DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL
</span></span></span></code></pre></div></figure></div><p>原理如上，实际操作时，不建议直接去改原 java.security 文件，可按以下方式操作。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> 自定义一个新文件 custom.java.security，内容只包含 disabledAlgorithms 配置
</span></span><span class=line><span class=cl><span class=go>jdk.tls.disabledAlgorithms=RC4, DES, MD5withRSA, \
</span></span></span><span class=line><span class=cl><span class=go>   DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, \
</span></span></span><span class=line><span class=cl><span class=go>   include jdk.disabled.namedCurves
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>#</span> 然后启动的命令行增加以下参数配置，指定自定义的 java.security 文件覆盖文件里有的值
</span></span><span class=line><span class=cl><span class=go>-Djava.security.properties=$JAVA_HOME/conf/security/custom.java.security
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>#</span> 注意注意，用两个等号 <span class=o>==</span> 指定自定义的 java.security 文件，是覆盖整个 Java 默认的 java.security 文件，原文件全部失效，只用自定义文件里的配置
</span></span><span class=line><span class=cl><span class=go>-Djava.security.properties==$JAVA_HOME/conf/security/custom.java.security
</span></span></span></code></pre></div></figure></div></li><li><p>使用自定义 classloader 的请关注，在 JDK 8 中 system classloader 是 URLClassLoader 的子类，但是在 JDK 11 中则不再成立。实际上它已经变成了一个内部的 class loader 如果将 system classloader 转换为 URLClassLoader 会导致抛出异常。</p></li><li><p>从 JDK 8 到 JDK 9， Arrays.asList(x).toArray() 返回类型生发生变化。Arrays.asList(x).toArray().getClass() 根据 javadoc 应该返回的是 Object[], 但是在 JDK 8 中，如果 x 是 String[], 返回的类型也是 String[]. 下面的代码在 JDK 8 不会有异常，但是在 JDK 9 会抛出 ClassCastException 异常。解决办法：使用支持泛型的方法 T[] toArray(T[] a) 进行转换。</p></li><li><p>Java 21 虚拟线程 + synchronized 可能导致 block 的坑，在 Java 24 已解决，具体描述参考 <a href=https://www.bvmem.com/archives/1408 target=_blank rel=noopener>virtual thread synchronized</a>
。</p></li><li><p>在 Java 21 公共线程池的 ContextClassLoader 是 AppClassloader，而不是从调用线程继承的。这可能会导致类加载问题。当你在使用 <code>java.util.concurrent.CompletableFuture.runAsync、java.util.stream.Stream.parallel()、List.parallelStream()、Thread.currentThread().getContextClassLoader().getResource()</code> 时，请关注。 一个典型的可能带来的 Bug 参考 <a href=https://juejin.cn/post/6909445190642040846 target=_blank rel=noopener>使用 CompletableFuture 时，关于 ClassLoader 引起的问题</a>
。</p></li><li><p>module jdk.proxy3 does not &ldquo;opens jdk.proxy3&rdquo; to unnamed module.</p><p>网上包括人工智能推荐的答案都是 add-opens，这也是我想到的第一个方式，毕竟以前遇见 unnamed module 都是这么干的。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>-–add-opens=jdk.proxy3=ALL-UNNAMED
</span></span></span><span class=line><span class=cl><span class=go>--add-opens=java.base/java.lang.reflect=ALL-UNNAMED
</span></span></span><span class=line><span class=cl><span class=go>--add-opens=java.base/java.lang=ALL-UNNAMED
</span></span></span><span class=line><span class=cl><span class=go>--add-opens=java.base/java.lang.reflect=ALL-UNNAMED
</span></span></span></code></pre></div></figure></div><p>实际上都不生效。Java 里并没有一个真的叫 <code>jdk.proxy3</code> 的模块，这是由 Dynamic Proxy 动态生成的一个虚拟方法。最根本的解决办法还是升级代码，不要调用 Java 过时的方法。我这里是因为 Groovy 调用产生，升级了一下 Groovy，完美解决。</p></li></ul><h2 id=参考资料>参考资料<a href=#参考资料 class=anchor aria-hidden=true>#</a></h2><ul><li><p>从 Java 15 到 23 关于 G1 GC 的优化</p><p><a href=https://tschatzl.github.io/ target=_blank rel=noopener>https://tschatzl.github.io/</a></p></li><li><p>Oracle 出的 Java 21 迁移指南，包含新特性介绍、Removed APIs、Removed Tools and Components 等</p><p><a href=https://docs.oracle.com/en/java/javase/21/migrate/getting-started.html target=_blank rel=noopener>https://docs.oracle.com/en/java/javase/21/migrate/getting-started.html</a></p></li><li><p>Microsoft transition from java 8 to java 11</p><p><a href=https://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11 target=_blank rel=noopener>https://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11</a></p></li><li><p>Java Dependency Analysis Tool</p><p><a href=https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool target=_blank rel=noopener>https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool</a></p></li><li><p>什么是多版本 Jar（Multi Release Jar）</p><p><a href=https://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files target=_blank rel=noopener>https://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files</a></p></li><li><p>Java G1 重要参数设置参考</p><p><a href=https://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp target=_blank rel=noopener>https://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp</a></p></li><li><p>地瓜哥 JVM GC 性能测试（三）：真实流量</p><p><a href=https://www.diguage.com/post/gc-performance-real-qps/ target=_blank rel=noopener>https://www.diguage.com/post/gc-performance-real-qps/</a></p></li><li><p>地瓜哥 OpenJDK 21 升级指南</p><p><a href=https://www.diguage.com/post/upgrade-to-openjdk21/ target=_blank rel=noopener>https://www.diguage.com/post/upgrade-to-openjdk21/</a></p></li><li><p>jdeprscan can not find class 解决办法</p><p><a href=https://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error/ target=_blank rel=noopener>https://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error/</a></p></li><li><p>从 Java 8 升级到 Java 17 踩坑全过程</p><p><a href=https://cloud.tencent.com/developer/article/2257886 target=_blank rel=noopener>https://cloud.tencent.com/developer/article/2257886</a></p></li><li><p>阿里云开发者社区 Java 升级总结</p><p><a href="https://www.zhihu.com/tardis/zm/art/585377119?source_id=1003" target=_blank rel=noopener>https://www.zhihu.com/tardis/zm/art/585377119?source_id=1003</a></p></li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=last-modified><a href=https://github.com/xlabs-club/xlabs-club.github.io/commit/04a87b061b0af16608f7f3b0ebcb4567bd7cfab2><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Last updated on 2025年9月22日</a></div><div class=edit-page><a href=https://github.com/xlabs-club/xlabs-club.github.io/blob/main/content//blog/migrating-java8-to-java25/index.md><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
Edit this page on GitHub</a></div></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/blog/docker-best-practices/ class="stretched-link text-reset text-decoration-none">容器镜像制作最佳实践，多架构编译，Dockerfile 编写小技巧和踩坑记录，镜像维护辅助工具 ORAS、skopeo 等介绍</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/blog/trust-cert-manager-selfsigned-tls/ class="stretched-link text-reset text-decoration-none">使用 Pulumi 部署 cert-manager 创建 K8S 自签名证书并信任证书</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/>Powered by Hugo, and based on Doks</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Give Me a <a class=text-muted href=https://github.com/xlabs-club/>Star</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.8b717d53dae071196d91d0d0c63650fe240e84ffe50a76fdb433a914d6b216ec.js integrity="sha256-i3F9U9rgcRltkdDQxjZQ/iQOhP/lCnb9tDOpFNayFuw="></script><script async src=/js/app.592ddd2791734c581ee9465f923ca99817c6bcb2a5c2725df8c34f9def04b128.js integrity="sha256-WS3dJ5FzTFge6UZfkjypmBfGvLKlwnJd+MNPne8EsSg="></script><script async src=/js/docsearch.4c43898496d40210bc7d52e319d675a83a35016293221b53c5c2e544c50ab234.js integrity="sha256-TEOJhJbUAhC8fVLjGdZ1qDo1AWKTIhtTxcLlRMUKsjQ="></script></body></html>