<!doctype html><html lang=zh data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.974962bbf902e2bb09d5f947751229907fea343148efc12fbb1ca3b61b799d102d62009b941a5835deabeee0a1d832801e2e7e8ffc5c4f77f2632d7d669f2736.css" integrity="sha512-l0liu/kC4rsJ1flHdRIpkH/qNDFI78Evuxyjtht5nRAtYgCblBpYNd6r7uCh2DKAHi5+j/xcT3fyYy19Zp8nNg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/blog/migrating-java8-to-java25/><link rel=canonical href=https://www.xlabs.club/blog/migrating-java8-to-java25/><title>从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍</title><meta name=description content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://www.xlabs.club/blog/migrating-java8-to-java25/"><meta property="og:site_name" content="XLabs"><meta property="og:title" content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍"><meta property="og:description" content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-05-23T21:03:11+08:00"><meta property="article:modified_time" content="2025-09-16T19:27:34+08:00"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍"><meta name=twitter:description content="从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍"><meta name=twitter:site content="@xlabs-club"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"卫星实验室","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍","description":"从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍","isPartOf":{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/"},"mainEntityOfPage":{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java25/"},"datePublished":"2024-05-23T21:03:11+08:00","dateModified":"2025-09-16T19:27:34+08:00","author":{"@type":"Organization","name":"XLabs Club 卫星实验室","url":"https://www.xlabs.club/"},"publisher":{"@type":"Organization","name":"XLabs Club 卫星实验室"}}]}</script><meta http-equiv=content-language content='zh-cn'></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/>XLabs</a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>XLabs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://www.xlabs.club/docs/guides/introduction/>Docs</a></li><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/blog/ aria-current=true>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/xlabs-link-exchange>Links</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/about/>About</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/xlabs-club/xlabs-club.github.io><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>目录</h3><nav id=toc><ul><li><a href=#破坏性变更评估工具>破坏性变更评估工具</a><ul><li><a href=#jdeps>jdeps</a></li><li><a href=#jdeprscan>jdeprscan</a></li><li><a href=#emt4j>emt4j</a></li></ul></li><li><a href=#升级兼容方法>升级兼容方法</a></li><li><a href=#辅助迁移工具>辅助迁移工具</a><ul><li><a href=#maven-依赖包更新>Maven 依赖包更新</a></li><li><a href=#eclipse-migration-toolkit-for-java-emt4j>Eclipse Migration Toolkit for Java (EMT4J)</a></li><li><a href=#openrewrite>OpenRewrite</a></li><li><a href=#jacoline>JaCoLine</a></li><li><a href=#java-参数查询工具>Java 参数查询工具</a></li></ul></li><li><a href=#推荐配置>推荐配置</a></li><li><a href=#遇见问题和解决办法>遇见问题和解决办法</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>从 Java 8 升级到 Java 25，踩坑记录、变更评估方法、辅助工具介绍</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>目录</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#破坏性变更评估工具>破坏性变更评估工具</a><ul><li><a href=#jdeps>jdeps</a></li><li><a href=#jdeprscan>jdeprscan</a></li><li><a href=#emt4j>emt4j</a></li></ul></li><li><a href=#升级兼容方法>升级兼容方法</a></li><li><a href=#辅助迁移工具>辅助迁移工具</a><ul><li><a href=#maven-依赖包更新>Maven 依赖包更新</a></li><li><a href=#eclipse-migration-toolkit-for-java-emt4j>Eclipse Migration Toolkit for Java (EMT4J)</a></li><li><a href=#openrewrite>OpenRewrite</a></li><li><a href=#jacoline>JaCoLine</a></li><li><a href=#java-参数查询工具>Java 参数查询工具</a></li></ul></li><li><a href=#推荐配置>推荐配置</a></li><li><a href=#遇见问题和解决办法>遇见问题和解决办法</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></details></nav><h2 id=破坏性变更评估工具>破坏性变更评估工具<a href=#破坏性变更评估工具 class=anchor aria-hidden=true>#</a></h2><p>在升级之前，可通过 jdeps 和 jdeprscan 先评估下是否有使用内部类和废弃 API，有一个总的概览。</p><h3 id=jdeps>jdeps<a href=#jdeps class=anchor aria-hidden=true>#</a></h3><p>jdeps 是 Java 自带的命令行工具，可以用来分析依赖关系和生成模块信息文件，这里我们只借用他的其中一项功能。</p><p>通过 <code>jdeps --jdk-internals</code> 检查是否有使用内部 API，以下例子显示使用了 <code>sun.net.util.IPAddressUtil</code> 这个 Java 内部工具类，会显示详细的源码类和 jar 包位置。</p><p>可以继续使用 Java 中的内部 API，另外 OpenJDK Wiki 页面 <a href=https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool target=_blank rel=noopener>Java Dependency Analysis Tool</a>
推荐了某些常用 JDK 内部 API 的替换项，可参考这些建议替换掉。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeps -dotoutput &lt;dot-file-dir&gt; -jdkinternals &lt;one-or-more-jar-files....&gt;
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeps --jdk-internals --multi-release <span class=m>21</span> --class-path . target/xxx.jar
</span></span><span class=line><span class=cl><span class=go>. -&gt; java.base
</span></span></span><span class=line><span class=cl><span class=go>   com.my.SecurityChecker -&gt; sun.net.util.IPAddressUtil  JDK internal API (java.base)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: JDK internal APIs are unsupported and private to JDK implementation that are
</span></span></span><span class=line><span class=cl><span class=go>subject to be removed or changed incompatibly and could break your application.
</span></span></span><span class=line><span class=cl><span class=go>Please modify your code to eliminate dependence on any JDK internal APIs.
</span></span></span><span class=line><span class=cl><span class=go>For the most recent update on JDK internal API replacements, please check:
</span></span></span><span class=line><span class=cl><span class=go>https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool
</span></span></span></code></pre></div></figure></div><h3 id=jdeprscan>jdeprscan<a href=#jdeprscan class=anchor aria-hidden=true>#</a></h3><p>jdeprscan 也是 Java 自带分析工具，可查看是否使用了已弃用或已删除的 API。使用已弃用的 API 不是阻塞性问题，还能接着跑，但是建议替换掉。使用已删除的 API，那就彻底跑不起来了。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 了解自 Java <span class=m>8</span> 后弃用的具体 API
</span></span><span class=line><span class=cl><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --list
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 加上 --for-removal ，列出已删除的 API
</span></span><span class=line><span class=cl><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --list --for-removal
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;9&#34;, forRemoval=true) class javax.security.cert.Certificate
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;9&#34;, forRemoval=true) class javax.security.cert.CertificateEncodingException
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>……
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;18&#34;, forRemoval=true) void java.lang.Enum.finalize()
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;17&#34;, forRemoval=true) void java.lang.System.setSecurityManager(java.lang.SecurityManager)
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;17&#34;, forRemoval=true) java.lang.SecurityManager java.lang.System.getSecurityManager()
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;21&#34;, forRemoval=true) javax.management.MBeanServerConnection javax.management.remote.JMXConnector.getMBeanServerConnection(javax.security.auth.Subject)
</span></span></span></code></pre></div></figure></div><p>扫描自己的代码中是否有使用废弃 API：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意通过 --class-path 增加依赖的 jar 包
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --class-path log4j-api-2.13.0.jar my-application.jar
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>error: cannot find class sun/misc/BASE64Encoder
</span></span></span><span class=line><span class=cl><span class=go>class com/company/Util uses deprecated method java/lang/Double::&lt;init&gt;(D)V
</span></span></span></code></pre></div></figure></div><p>以上例子，com.company.Util 类在调用 java.lang.Double 类的已弃用构造函数。 javadoc 会建议用来代替已弃用 API 的 API。 但是无法解决“error: cannot find class sun/misc/BASE64Encoder”问题，因为它是已删除的 API， 自 Java 8 发布以来，应使用 java.util.Base64。</p><p>注意使用 jdeprscan 需要通过 &ndash;class-path 指定依赖项，可先执行 <code>mvn dependency:copy-dependencies</code> 命令，此时会 copy 依赖项到 <code>target/dependency</code> 目录。</p><p>如果你加了 &ndash;class-path 依赖，大概率还是报错误 <code>error: cannot find class</code>，目测寻找依赖项是根据 <code>target/dependency</code> 中的名字顺序找的，不是常规的 java 进程一次性加载完，不知道这算不算 jdeprscan 的设计 Bug，具体解决办法可参考 <a href=https://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error target=_blank rel=noopener>jdeprscan-throws-cannot-find-class-error</a>
。</p><p>我采用的解决方式是把所有依赖 jar 文件都接到某个文件夹，解压成 classes，然后 class-path 使用此文件。这样还有个好处，扫描报告里只有我真正要扫描的当前项目的报告，不包含第三方 jar 的。</p><p>以上过程命令行参考：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn dependency:copy-dependencies  -Dsilent<span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir -p target/dependency-classes
</span></span><span class=line><span class=cl><span class=k>for</span> jar in target/dependency/*.jar<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    unzip -o <span class=s2>&#34;</span><span class=nv>$jar</span><span class=s2>&#34;</span> -d target/dependency-classes
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>jdeprscan --class-path target/dependency-classes  target/really-project.jar</span></span></code></pre></div></figure></div><p>除了使用 jdeprscan 命令行以外，也可在你项目的 maven pom 文件中引入 <code>maven-jdeps-plugin</code>，如下示例，引入后如果有使用废弃 API，将在 <code>mvn package</code> 的时候直接失败报错，避免有人无意引入废弃 API。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;project&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-jdeps-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.1.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=c>&lt;!-- verify main classes --&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>jdkinternals<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>              <span class=c>&lt;!-- verify test classes --&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>test-jdkinternals<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;multiRelease&gt;</span>21<span class=nt>&lt;/multiRelease&gt;</span>
</span></span><span class=line><span class=cl>          <span class=c>&lt;!-- 其他参数按需配置 --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span></span></span></code></pre></div></figure></div><h3 id=emt4j>emt4j<a href=#emt4j class=anchor aria-hidden=true>#</a></h3><p>emt4j 是 Eclipse 推出的一个静态分析工具，下面会详细介绍用法，展示效果。</p><h2 id=升级兼容方法>升级兼容方法<a href=#升级兼容方法 class=anchor aria-hidden=true>#</a></h2><ol><li><p>利用 Maven 的 <code>profile</code> 机制，根据 JDK 版本号，自动激活不同的配置。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;profiles&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- 以下配置抄自地瓜哥博客，感谢地瓜哥    --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>Java1.8<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;activation&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 在 JDK 1.8 时自动激活--&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;jdk&gt;</span>1.8<span class=nt>&lt;/jdk&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/activation&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;spring.version&gt;</span>5.3.33<span class=nt>&lt;/spring.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在父 POM 中使用 dependencyManagement 生命 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在需要的子模块中可以直接使用 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>javax.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>javax.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>4.0.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;scope&gt;</span>provided<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-surefire-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>3.2.5<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;includes&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;include&gt;</span>**/*Test.java<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/includes&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>3.13.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;showWarnings&gt;</span>true<span class=nt>&lt;/showWarnings&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;fork&gt;</span>true<span class=nt>&lt;/fork&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>Java21<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;activation&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 在 Java 21 以上激活        --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;jdk&gt;</span>[21,)<span class=nt>&lt;/jdk&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/activation&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;spring.version&gt;</span>6.0.19<span class=nt>&lt;/spring.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在父 POM 中使用 dependencyManagement 生命 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 在需要的子模块中可以直接使用 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>jakarta.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>jakarta.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>6.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;scope&gt;</span>provided<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.openjdk.nashorn<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>nashorn-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>15.4<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.glassfish.jaxb<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>jaxb-runtime<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>2.3.9<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>javax.annotation<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>javax.annotation-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.3.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-surefire-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;version&gt;</span>3.2.5<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;includes&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;include&gt;</span>**/*Test.java<span class=nt>&lt;/include&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/includes&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;argLine&gt;</span>
</span></span><span class=line><span class=cl>              --add-opens java.base/java.lang=ALL-UNNAMED
</span></span><span class=line><span class=cl>              --add-opens java.base/java.util=ALL-UNNAMED
</span></span><span class=line><span class=cl>              --add-opens java.base/java.math=ALL-UNNAMED
</span></span><span class=line><span class=cl>              --add-opens java.base/java.time=ALL-UNNAMED
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/argLine&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;showWarnings&gt;</span>true<span class=nt>&lt;/showWarnings&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;fork&gt;</span>true<span class=nt>&lt;/fork&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;compilerArgs&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;arg&gt;</span>-J--add-opens=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED<span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/compilerArgs&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/profiles&gt;</span></span></span></code></pre></div></figure></div></li><li><p>Java 模块化兼容。</p><p>你一定见过这种错误。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Caused by: java.lang.reflect.InaccessibleObjectException: Unable to make field protected int[] java.util.Calendar.fields accessible: module java.base does not &#34;opens java.util&#34; to unnamed module @21282ed8
</span></span></span></code></pre></div></figure></div><p>也一定知道怎么解决了，将没开放的模块强制对外开放，有两个参数选项：
&ndash;add-exports 导出包，意味着其中的所有公共类型和成员都可以在编译和运行时访问。
&ndash;add-opens 打开包，意味着其中的所有类型和成员（不仅是公共类型）都可以在运行时访问。</p><p>两者的区别在于 &ndash;add-opens 开放的更加彻底，不仅 public 类型、变量及方法可以访问，就连非 public 元素，也可以通过调用 setAccessible(true) 后也可以访问。简单起见，直接使用 &ndash;add-opens 即可。</p><p>使用 Maven 命令时，配置 maven-surefire-plugin 插件，参考如下：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>maven-surefire-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;argLine&gt;</span>
</span></span><span class=line><span class=cl>      --add-opens=java.base/java.lang.reflect=ALL-UNNAMED
</span></span><span class=line><span class=cl>      --add-opens=java.base/java.math=ALL-UNNAMED
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/argLine&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/plugin&gt;</span></span></span></code></pre></div></figure></div><p>在 IntelliJ IDEA 运行程序如果报错，可以通过在 “VM Option” 配置项中，增加 Java 模块化 <code>--add-opens</code> 相关启动参数即可正常启动。</p><p>完整 <code>add-opens</code> 列表。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.lang.reflect<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.lang<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.io<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.util<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.util.concurrent<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.rmi/sun.rmi.transport<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.math<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.net<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.nio<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.security<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.text<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/java.time<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/jdk.internal.access<span class=o>=</span>ALL-UNNAMED
</span></span><span class=line><span class=cl>--add-opens<span class=o>=</span>java.base/jdk.internal.misc<span class=o>=</span>ALL-UNNAMED</span></span></code></pre></div></figure></div></li></ol><h2 id=辅助迁移工具>辅助迁移工具<a href=#辅助迁移工具 class=anchor aria-hidden=true>#</a></h2><p>一些辅助迁移到新版本的工具，仅供参考。</p><h3 id=maven-依赖包更新>Maven 依赖包更新<a href=#maven-依赖包更新 class=anchor aria-hidden=true>#</a></h3><p>使用 maven 检查是否有最新的依赖包和插件，对整体项目有一个全局的了解。注意，这里给的建议仅供参考，不要一下子应用上，需要综合考虑当前的项目依赖关系。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn versions:display-dependency-updates
</span></span><span class=line><span class=cl>mvn versions:display-plugin-updates</span></span></code></pre></div></figure></div><h3 id=eclipse-migration-toolkit-for-java-emt4j><a href=https://github.com/adoptium/emt4j target=_blank rel=noopener>Eclipse Migration Toolkit for Java (EMT4J)</a></h3><p>EMT4J 也是一个静态分析工具，可输出分析报告，也可直接 apply 到 git，支持通过 maven 插件、cli 命令行、Java Agent 3 种方式分析。</p><p>目前发布比较慢，只有 master 分支支持 Java 21，可以基于 master 分支自己编译构建，也可以使用已 Realease 版本只分析到 Java 17。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 以下示例自己编译构建，master 分支还不太稳定，可能出错
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> git clone git@github.com:adoptium/emt4j.git
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> emt4j
</span></span><span class=line><span class=cl><span class=gp>$</span> mvn clean package -Prelease
</span></span><span class=line><span class=cl><span class=gp>#</span> 以上步骤生成 emt4j-<span class=si>${</span><span class=nv>version</span><span class=si>}</span>.zip 在 emt4j-assembly/target 目录下。
</span></span><span class=line><span class=cl><span class=gp>#</span> 解压以上 zip 后，得到
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>emt4j tree -L 2
</span></span></span><span class=line><span class=cl><span class=go>.
</span></span></span><span class=line><span class=cl><span class=go>├── bin
</span></span></span><span class=line><span class=cl><span class=go>│   ├── analysis.bat
</span></span></span><span class=line><span class=cl><span class=go>│   └── analysis.sh
</span></span></span><span class=line><span class=cl><span class=go>└── lib
</span></span></span><span class=line><span class=cl><span class=go>    ├── agent
</span></span></span><span class=line><span class=cl><span class=go>    ├── analysis
</span></span></span><span class=line><span class=cl><span class=go>    └── maven-plugin
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意 emt4j 需要使用 Java <span class=m>8</span> 运行，所以先把自己的 Java 环境切换到 Java <span class=m>8</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> sh bin/analysis.sh -f <span class=m>8</span> -t <span class=m>17</span> -o report.html my-java-project-dir
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 在 report.html 能看到分析内容和建议，如
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Issues Context
</span></span></span><span class=line><span class=cl><span class=go>Location: refclass:file:my-java-project-dir/target/classes/com/mypackage/spring/BaseAbstractDataSource.class!/com.mypackage.spring.BaseAbstractDataSource!/, Target: java.lang.Class.newInstance()Ljava/lang/Object;
</span></span></span></code></pre></div></figure></div><p>可通过 emt4j-maven-plugin 进行检查。增加以下 plugin，执行 <code>mvn emt4j:check</code> 成功后查看报告。</p><p>注意 emt4j-maven-plugin 目前版本 0.8.0 比较老，请使用 Java 8 或 Java 17 跑 mvn 命令，版本太高会失败。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.eclipse.emt4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>emt4j-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>0.8.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 当前版本 --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fromVersion&gt;</span>8<span class=nt>&lt;/fromVersion&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!-- 期望升级版本，0.8.0 还不支持 Java 21 --&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;toVersion&gt;</span>17<span class=nt>&lt;/toVersion&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;outputFile&gt;</span>target/report.html<span class=nt>&lt;/outputFile&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span></span></span></code></pre></div></figure></div><p>不想使用 xml 配置的，可参考以下命令行直接 run plugin。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 官方当前发布的版本</span>
</span></span><span class=line><span class=cl>mvn process-test-classes org.eclipse.emt4j:emt4j-maven-plugin:0.8.0:check -DfromVersion<span class=o>=</span><span class=m>8</span> -DtoVersion<span class=o>=</span><span class=m>17</span> -DoutputFile<span class=o>=</span>emt4j-report.html
</span></span><span class=line><span class=cl><span class=c1># 这个是我自己基于 master 分支编译的 0.91 版本，支持 Java21</span>
</span></span><span class=line><span class=cl>mvn process-test-classes org.eclipse.emt4j:emt4j-maven-plugin:0.91:process -DfromVersion<span class=o>=</span><span class=m>8</span> -DtoVersion<span class=o>=</span><span class=m>21</span> -DoutputFile<span class=o>=</span>emt4j-report.html</span></span></code></pre></div></figure></div><p>检查结果错误可能很多，根据优先级修改，比如以下我的检查结果，检查结果支持中英文展示。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Non-heap memory footprint increasing
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Description
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Priority: p1 Issue Count: 1
</span></span></span><span class=line><span class=cl><span class=go>Netty uses the direct byte buffer internally. There 2 ways to manage the direct buffer lifecycle, the first it&#39;s managed by Netty self, and the second is managed by JVM. In JDK 8, netty uses the first way, but in JDK 11, netty uses the second. The first cannot be monitored through MXBean, but the second can be monitored.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>How to fix
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>If you want keep the first way,add the option to JVM:&#34;-Dio.netty.tryReflectionSetAccessible=true --add-opens=java.base/jdk.internal.misc=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED&#34; when running on JDK 11.But if use the second way,the netty should upgrade to a version at least 4.1.33. Because the older netty use a remove API tht release byte buffer.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Issues Context
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Target: file:/Users/l10178/.m2/repository/io/netty/netty/3.10.0.Final/netty-3.10.0.Final.jar
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>优先级：p1
</span></span></span><span class=line><span class=cl><span class=go>有一些 class 已经被删除了需要修改代码替换成为新的 API
</span></span></span><span class=line><span class=cl><span class=go>位置：file:xxx/Base64Util.class, 目标：sun.misc.BASE64Decoder
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>优先级：p3
</span></span></span><span class=line><span class=cl><span class=go>通过测试已知的一些不兼容的 jar
</span></span></span><span class=line><span class=cl><span class=go>如何修复：
</span></span></span><span class=line><span class=cl><span class=go>file:/root/.m2/repository/dom4j/dom4j/1.6.1/dom4j-1.6.1.jar 不匹配规则 &#34;Version should &gt;= &#39;2.0&#39; &#34;
</span></span></span></code></pre></div></figure></div><h3 id=openrewrite><a href=https://docs.openrewrite.org/ target=_blank rel=noopener>OpenRewrite</a></h3><p>一键升级依赖包，重构源码，入门指导可参考我的另一篇博客：<a href=https://www.xlabs.club/docs/platform/smart-code/ target=_blank rel=noopener>智能代码重构</a>
。 OpenRewrite 更成熟易用。</p><h3 id=jacoline><a href=https://jacoline.dev/inspect target=_blank rel=noopener>JaCoLine</a></h3><p>检查 Java 命令行选项参数有没有问题，识别出已经过时不支持的参数。</p><h3 id=java-参数查询工具><a href=https://chriswhocodes.com/corretto_jdk21_options.html target=_blank rel=noopener>Java 参数查询工具</a></h3><p>Java 参数太多，到 <a href=https://chriswhocodes.com/corretto_jdk21_options.html target=_blank rel=noopener>VM Options Explorer - Corretto JDK21</a>
中参照，里面根据 JDK 的版本以及发行商，列出来所有的相关参数，选择好对应发行商的正确版本，就可以搜索或者查看 java 命令支持的所有参数了。</p><h2 id=推荐配置>推荐配置<a href=#推荐配置 class=anchor aria-hidden=true>#</a></h2><p>升级到 Java 21 以后以下是根据我们公司常规经验推荐的配置，非普世可用，请根据自己的应用情况臻选。</p><ul><li>如果在使用 ZGC，推荐启用分代 <code>-XX:+ZGenerational</code> ，对稳定性、吞吐量、内存占用都有很大优化。Java 23 默认已启用分代 ZGC。</li><li>在很多场景下 G1 仍然是最稳的选择，内存占用比 ZGC 低，CPU 更稳定。大部分场景下小内存应用，并不需要 ZGC。</li><li>亲测大部分应用 Java 23 比 Java 21 内存占用约少 5%-10%，GC 更稳定。</li></ul><h2 id=遇见问题和解决办法>遇见问题和解决办法<a href=#遇见问题和解决办法 class=anchor aria-hidden=true>#</a></h2><ul><li><p>一定要升级依赖包吗，不升级能编译通过，直接用 Java 21 能不能跑起来，会不会有问题。</p><p>以我们实际经验来看，确实有很多应该不升级可直接运行，也没有问题。但是遇到了一些应用，跑着跑着 OOM 了，切换回 Java 8 就没有问题，还不知道是哪个包不兼容。</p></li><li><p>TLS 不兼容问题，类似如下错误。JDK 17 是支持 TLS1.0 ~ TLS1.3 的，但是默认使用的 TLS 版本是 TLS 1.3, 老版本被禁用了，需要主动放开。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> 错误日志
</span></span><span class=line><span class=cl><span class=go>The server selected protocol version TLS10 is not accepted by client preferences [TLS13, TLS12]。
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 配置文件
</span></span><span class=line><span class=cl><span class=gp>$</span>JAVA_HOME/conf/security/java.security
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 找到里面的一行配置：
</span></span><span class=line><span class=cl><span class=go>jdk.tls.disabledAlgorithms=SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, \
</span></span></span><span class=line><span class=cl><span class=go>    DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 说明：JDK 中的 jdk.tls.disabledAlgorithms 参数用于禁用不安全或不需要的 TLS 密码算法，
</span></span><span class=line><span class=cl><span class=go>以提高系统的安全性。通过配置这个参数，可以指定 JDK 不支持的密码算法或协议，以降低它们的优先级，
</span></span></span><span class=line><span class=cl><span class=go>减少被攻击的风险。
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 我们把 TLSv1，TLSv1.1 这两个删除掉，变成如下：
</span></span><span class=line><span class=cl><span class=go>jdk.tls.disabledAlgorithms=SSLv3, RC4, DES, MD5withRSA, \
</span></span></span><span class=line><span class=cl><span class=go>    DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL
</span></span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> 不建议直接去改原 java.security 文件，可自定义一个新文件 custom.java.security，内容只包含 disabledAlgorithms 配置
</span></span><span class=line><span class=cl><span class=go>jdk.tls.disabledAlgorithms=RC4, DES, MD5withRSA, \
</span></span></span><span class=line><span class=cl><span class=go>   DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, \
</span></span></span><span class=line><span class=cl><span class=go>   include jdk.disabled.namedCurves
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>#</span> 然后启动的命令行增加以下参数配置，指定自定义的 java.security 文件覆盖文件里有的值
</span></span><span class=line><span class=cl><span class=go>-Djava.security.properties=$JAVA_HOME/conf/security/custom.java.security
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>#</span> 注意注意，用两个等号 <span class=o>==</span> 指定自定义的 java.security 文件，是覆盖整个 Java 默认的 java.security 文件，原文件全部失效，只用自定义文件里的配置
</span></span><span class=line><span class=cl><span class=go>-Djava.security.properties==$JAVA_HOME/conf/security/custom.java.security
</span></span></span></code></pre></div></figure></div></li><li><p>module jdk.proxy3 does not &ldquo;opens jdk.proxy3&rdquo; to unnamed module.</p><p>网上包括人工智能推荐的答案都是 add-opens，这也是我想到的第一个方式，毕竟以前遇见 unnamed module 都是这么干的。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>-–add-opens=jdk.proxy3=ALL-UNNAMED
</span></span></span><span class=line><span class=cl><span class=go>--add-opens=java.base/java.lang.reflect=ALL-UNNAMED
</span></span></span><span class=line><span class=cl><span class=go>--add-opens=java.base/java.lang=ALL-UNNAMED
</span></span></span><span class=line><span class=cl><span class=go>--add-opens=java.base/java.lang.reflect=ALL-UNNAMED
</span></span></span></code></pre></div></figure></div><p>实际上都不生效。Java 里并没有一个真的叫 <code>jdk.proxy3</code> 的模块，这是由 Dynamic Proxy 动态生成的一个虚拟方法。最根本的解决办法还是升级代码，不要调用 Java 过时的方法。我这里是因为 Groovy 调用产生，升级了一下 Groovy，完美解决。</p></li></ul><h2 id=参考资料>参考资料<a href=#参考资料 class=anchor aria-hidden=true>#</a></h2><ul><li><p>从 Java 15 到 23 关于 G1 GC 的优化</p><p><a href=https://tschatzl.github.io/ target=_blank rel=noopener>https://tschatzl.github.io/</a></p></li><li><p>Oracle 出的 Java 21 迁移指南，包含新特性介绍、Removed APIs、Removed Tools and Components 等</p><p><a href=https://docs.oracle.com/en/java/javase/21/migrate/getting-started.html target=_blank rel=noopener>https://docs.oracle.com/en/java/javase/21/migrate/getting-started.html</a></p></li><li><p>Microsoft transition from java 8 to java 11</p><p><a href=https://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11 target=_blank rel=noopener>https://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11</a></p></li><li><p>Java Dependency Analysis Tool</p><p><a href=https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool target=_blank rel=noopener>https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool</a></p></li><li><p>什么是多版本 Jar（Multi Release Jar）</p><p><a href=https://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files target=_blank rel=noopener>https://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files</a></p></li><li><p>Java G1 重要参数设置参考</p><p><a href=https://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp target=_blank rel=noopener>https://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp</a></p></li><li><p>地瓜哥 JVM GC 性能测试（三）：真实流量</p><p><a href=https://www.diguage.com/post/gc-performance-real-qps/ target=_blank rel=noopener>https://www.diguage.com/post/gc-performance-real-qps/</a></p></li><li><p>地瓜哥 OpenJDK 21 升级指南</p><p><a href=https://www.diguage.com/post/upgrade-to-openjdk21/ target=_blank rel=noopener>https://www.diguage.com/post/upgrade-to-openjdk21/</a></p></li><li><p>jdeprscan can not find class 解决办法</p><p><a href=https://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error/ target=_blank rel=noopener>https://stackoverflow.com/questions/49525496/jdeprscan-throws-cannot-find-class-error/</a></p></li><li><p>从 Java 8 升级到 Java 17 踩坑全过程</p><p><a href=https://cloud.tencent.com/developer/article/2257886 target=_blank rel=noopener>https://cloud.tencent.com/developer/article/2257886</a></p></li><li><p>阿里云开发者社区 Java 升级总结</p><p><a href="https://www.zhihu.com/tardis/zm/art/585377119?source_id=1003" target=_blank rel=noopener>https://www.zhihu.com/tardis/zm/art/585377119?source_id=1003</a></p></li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=last-modified><a href=https://github.com/xlabs-club/xlabs-club.github.io/commit/baf252815f269fe9b4e78785c1693d112b46b17c><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Last updated on 2025年9月16日</a></div><div class=edit-page><a href=https://github.com/xlabs-club/xlabs-club.github.io/blob/main/content//blog/migrating-java8-to-java25.md><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
Edit this page on GitHub</a></div></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/blog/docker-best-practices/ class="stretched-link text-reset text-decoration-none">容器镜像制作最佳实践，多架构编译，Dockerfile 编写小技巧和踩坑记录，镜像维护辅助工具 ORAS、skopeo 等介绍</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/blog/trust-cert-manager-selfsigned-tls/ class="stretched-link text-reset text-decoration-none">使用 Pulumi 部署 cert-manager 创建 K8S 自签名证书并信任证书</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/>Powered by Hugo, and based on Doks</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Give Me a <a class=text-muted href=https://github.com/xlabs-club/>Star</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.8b717d53dae071196d91d0d0c63650fe240e84ffe50a76fdb433a914d6b216ec.js integrity="sha256-i3F9U9rgcRltkdDQxjZQ/iQOhP/lCnb9tDOpFNayFuw="></script><script async src=/js/app.592ddd2791734c581ee9465f923ca99817c6bcb2a5c2725df8c34f9def04b128.js integrity="sha256-WS3dJ5FzTFge6UZfkjypmBfGvLKlwnJd+MNPne8EsSg="></script><script async src=/js/docsearch.4c43898496d40210bc7d52e319d675a83a35016293221b53c5c2e544c50ab234.js integrity="sha256-TEOJhJbUAhC8fVLjGdZ1qDo1AWKTIhtTxcLlRMUKsjQ="></script></body></html>