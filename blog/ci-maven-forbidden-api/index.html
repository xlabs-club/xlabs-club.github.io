<!doctype html><html lang=zh data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.974962bbf902e2bb09d5f947751229907fea343148efc12fbb1ca3b61b799d102d62009b941a5835deabeee0a1d832801e2e7e8ffc5c4f77f2632d7d669f2736.css" integrity="sha512-l0liu/kC4rsJ1flHdRIpkH/qNDFI78Evuxyjtht5nRAtYgCblBpYNd6r7uCh2DKAHi5+j/xcT3fyYy19Zp8nNg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/blog/ci-maven-forbidden-api/><link rel=canonical href=https://www.xlabs.club/blog/ci-maven-forbidden-api/><title>CI: Maven 如何在编译时禁止调用某些特定 API</title><meta name=description content="CI: Maven 如何在编译时禁止调用某些特定 API"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://www.xlabs.club/blog/ci-maven-forbidden-api/"><meta property="og:site_name" content="XLabs"><meta property="og:title" content="CI: Maven 如何在编译时禁止调用某些特定 API"><meta property="og:description" content="CI: Maven 如何在编译时禁止调用某些特定 API"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-09-09T22:18:59+08:00"><meta property="article:modified_time" content="2025-09-14T15:47:07+08:00"><meta property="article:tag" content="CICD"><meta property="article:tag" content="Java"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="CI: Maven 如何在编译时禁止调用某些特定 API"><meta name=twitter:description content="CI: Maven 如何在编译时禁止调用某些特定 API"><meta name=twitter:site content="@xlabs-club"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"卫星实验室","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"Ci Maven 如何在编译时禁止调用某些特定 API","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"CI: Maven 如何在编译时禁止调用某些特定 API","description":"CI: Maven 如何在编译时禁止调用某些特定 API","isPartOf":{"@id":"https://www.xlabs.club/blog/ci-maven-forbidden-api/"},"mainEntityOfPage":{"@id":"https://www.xlabs.club/blog/ci-maven-forbidden-api/"},"datePublished":"2025-09-09T22:18:59+08:00","dateModified":"2025-09-14T15:47:07+08:00","author":{"@type":"Organization","name":"XLabs Club 卫星实验室","url":"https://www.xlabs.club/"},"publisher":{"@type":"Organization","name":"XLabs Club 卫星实验室"}}]}</script><meta http-equiv=content-language content='zh-cn'></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/>XLabs</a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>XLabs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://www.xlabs.club/docs/guides/introduction/>Docs</a></li><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/blog/ aria-current=true>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/xlabs-link-exchange>Links</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/about/>About</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/xlabs-club/xlabs-club.github.io><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="container p-0"><article><div class="row justify-content-center"><div class="col-md-12 col-lg-11"><div class=blog-header><h1>CI: Maven 如何在编译时禁止调用某些特定 API</h1><p><small>2025年9月9日&nbsp;&nbsp;<a class="stretched-link position-relative link-muted" href=/categories/java/>Java</a>&nbsp;&nbsp;<a class="stretched-link position-relative" href=/contributors/l10178/>l10178</a><span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>4&nbsp;minutes</span></small></p></div></div><div class="col-md-12 col-lg-11"><p>在日常开发中，我们经常遇到类似如下需求：</p><ul><li>项目组提供了 SDK，某个 API 已经被标记为废弃，但是大家迟迟不升级，项目组还需要花费时间维护已经废弃的 API。</li><li>有些项目在使用 JDK 已经废弃的 API，这些废弃 API 在更高版本 JDK 中已经删除，导致推动升级 JDK 比较困难。</li><li>有些项目会跨版本混合编译，比如用 Java 8 编译运行在 Java 21 上，常见的错误比如 <code>javafx.util</code> 在 Java 21 默认已经去掉了，就会出现编译成功却运行时失败。</li></ul><p>所以我们想提供一种方案，能不能在编译期就强制禁用某些 API，主动阻止让编译不通过，提前报错及早发现及早处理。</p><h2 id=实现方案>实现方案</h2><p>当前我们使用 maven <a href=https://github.com/policeman-tools/forbidden-apis target=_blank rel=noopener>forbiddenapis</a>
插件，结合 CI 流程来实现。</p><p>执行效果，如果有使用禁用的 API，能看到类似如下错误提示，编译失败并给出原因。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>12:40:30.647 [INFO]
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.648 [INFO] --- forbiddenapis:3.9:check (check-forbidden-apis) @ app-biz ---
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.657 [INFO] Scanning for classes to check...
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.661 [INFO] Reading bundled API signatures: jdk-deprecated-1.8
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.694 [INFO] Reading API signatures: /usr/share/maven/conf/forbidden-apis.txt
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.694 [INFO] Loading classes to check...
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.695 [INFO] Scanning classes for violations...
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.849 [ERROR] Forbidden class/interface use: javafx.util.Pair [禁止使用 JavaFX 相关类]
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.850 [ERROR]   in com.tester.HomeController (HomeController.java:11)
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.865 [ERROR] Scanned 13 class file(s) for forbidden API invocations (in 0.21s), 1 error(s).
</span></span></span><span class=line><span class=cl><span class=go>12:40:30.872 [INFO] ------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>24784 [INFO] --- forbiddenapis:3.9:check (check-forbidden-apis) @ app-api ---
</span></span></span><span class=line><span class=cl><span class=go>24812 [INFO] Scanning for classes to check...
</span></span></span><span class=line><span class=cl><span class=go>24884 [INFO] Reading bundled API signatures: jdk-deprecated-1.8
</span></span></span><span class=line><span class=cl><span class=go>25016 [INFO] Reading API signatures: /usr/share/maven/conf/forbidden-apis.txt
</span></span></span><span class=line><span class=cl><span class=go>25017 [INFO] Loading classes to check...
</span></span></span><span class=line><span class=cl><span class=go>25106 [INFO] Scanning classes for violations...
</span></span></span><span class=line><span class=cl><span class=go>25984 [ERROR] Forbidden method invocation: java.net.URLEncoder#encode(java.lang.String) [Deprecated in Java 1.8]
</span></span></span><span class=line><span class=cl><span class=go>25984 [ERROR]   in com.tester.FormBody$FormBodyBuilder (FormBody.java:60)
</span></span></span><span class=line><span class=cl><span class=go>26110 [ERROR] Scanned 660 class file(s) for forbidden API invocations (in 1.31s), 2 error(s).
</span></span></span><span class=line><span class=cl><span class=go>26113 [INFO]
</span></span></span></code></pre></div></figure></div><h3 id=maven-核心配置>Maven 核心配置</h3><p>首先，在父 pom 里增加了以下片段，此内容主要含义：</p><ul><li>在存在 ${env.MAVEN_HOME}/conf/forbidden-apis.txt 文件时激活此 profile，以便确保缺少 txt 文件时不会报错。</li><li>默认激活了 forbiddenapis 插件的 jdk-deprecated 规则。</li><li>增加了我们定制的 forbidden-apis.txt 规则，此文件放在 maven 的基础镜像里。</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;id&gt;</span>forbidden<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;activation&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;file&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;exists&gt;</span>${env.MAVEN_HOME}/conf/forbidden-apis.txt<span class=nt>&lt;/exists&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/file&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/activation&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>de.thetaphi<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>forbiddenapis<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>3.9<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;detail&gt;</span>true<span class=nt>&lt;/detail&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;failOnUnsupportedJava&gt;</span>false<span class=nt>&lt;/failOnUnsupportedJava&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;ignoreSignaturesOfMissingClasses&gt;</span>true<span class=nt>&lt;/ignoreSignaturesOfMissingClasses&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;bundledSignatures&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;bundledSignature&gt;</span>jdk-deprecated<span class=nt>&lt;/bundledSignature&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/bundledSignatures&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;signaturesFiles&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;signaturesFile&gt;</span>${env.MAVEN_HOME}/conf/forbidden-apis.txt<span class=nt>&lt;/signaturesFile&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/signaturesFiles&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;id&gt;</span>check-forbidden-apis<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;phase&gt;</span>process-classes<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&lt;goal&gt;</span>check<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;id&gt;</span>test-check-forbidden-apis<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;phase&gt;</span>process-test-classes<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&lt;goal&gt;</span>testCheck<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/profile&gt;</span></span></span></code></pre></div></figure></div><p>我的项目需要紧急发版，来不及改代码，如何禁用以上插件，在 pom.xml 中增加以下属性，或通过 mvn 命令行 <code>-Dforbiddenapis.skip=true</code> 传递此参数：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;forbiddenapis.skip&gt;</span>true<span class=nt>&lt;/forbiddenapis.skip&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span></span></span></code></pre></div></figure></div><h3 id=forbiddenapis-规则详解>forbiddenapis 规则详解</h3><p>forbiddenapis 插件有内置规则和自定义规则，规则名字叫 signatures。</p><p>forbiddenapis 插件默认已经内置了一些规则 signatures，参考：<a href=https://jenkins.thetaphi.de/job/Forbidden-APIs/javadoc/bundled-signatures.html target=_blank rel=noopener>bundled-signatures</a>
。</p><p>主要默认规则：</p><ul><li><code>jdk-unsafe-*</code>: Signatures of &ldquo;unsafe&rdquo; methods that use default charset, default locale, or default timezone. For server applications it is very stupid to call those methods, as the results will definitely not what the user wants (for Java* = 1.7, 1.8, 9,&mldr;, 24; Ant / Maven / Gradle automatically add the compile Java version).</li><li><code>jdk-deprecated-*</code>: This disallows all deprecated methods from the JDK (for Java*= 1.7, 1.8, 9,&mldr;, 24; Ant / Maven / Gradle automatically add the compile Java version).</li><li><code>jdk-internal-*</code>: Lists all internal packages of the JDK as of Security.getProperty(&ldquo;package.access&rdquo;). Calling those methods will always trigger security manager and is completely forbidden from Java 9 on (for Java*= 1.7, 1.8, 9,&mldr;, 24; Ant / Maven / Gradle automatically add the compile Java version, since forbiddenapis v2.1).</li><li><code>jdk-non-portable</code>: Signatures of all non-portable (like com.sun.management.HotSpotDiagnosticMXBean) or internal runtime APIs (like sun.misc.Unsafe). This is a superset of jdk-internal.
Internally this is implemented using heuristics: Any reference to an API that is part of the Java runtime (rt.jar, extensions, Java 9+ java.<em>/ jdk.</em> core modules) and is not part of the Java SE specification packages (mainly java, javax, but also org.ietf.jgss, org.omg, org.w3c.dom, and org.xml.sax) is forbidden (any java version, no specific JDK version, since forbiddenapis v2.1).</li><li><code>jdk-system-out</code>: On server-side applications or libraries used by other programs, printing to System.out or System.err is discouraged and should be avoided (any java version, no specific JDK version).</li><li><code>jdk-reflection</code>: Reflection usage to work around access flags fails with SecurityManagers and likely will not work anymore on runtime classes in Java 9 or later (any java version, no specific JDK version, since forbiddenapis v2.1).</li><li><code>commons-io-unsafe-*</code>: If your application uses the famous Apache Common-IO library, this adds signatures of all methods that depend on default charset (for versions* = 1.0, 1.1, 1.2, 1.3, 1.4, 2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8.0, 2.9.0, 2.10.0, 2.11.0, 2.12.0, 2.13.0, 2.14.0, 2.15.0, 2.15.1, 2.16.0, 2.16.1, 2.17.0, 2.18.0).</li></ul><p>通过 txt 文件自定义规则，规则语法：<a href=https://jenkins.thetaphi.de/job/Forbidden-APIs/javadoc/signatures-syntax.html target=_blank rel=noopener>signatures-syntax</a>
。</p><ul><li>Class reference: A binary/fully-qualified class name (including package). You may use the output of Class.getName(). Be sure to use correct name for inner classes! Example: <code>java.lang.String</code></li><li>A package/class glob pattern: To forbid all classes from a package, you may use glob patterns, like <code>sun.misc.**</code>(<code>**</code> matches against package boundaries).</li><li>A field of a class: package.Class#fieldName</li><li>A method signature: It consists of a binary class name, followed by # and a method name including method parameters: java.lang.String#concat(java.lang.String) – All method parameters need to use fully qualified class names! Instead of method parameters, the special wildcard string ** may be used to add all variants of a method, regardless of their parameter types. To refer to instance constructors, use the method name <code>&lt;init></code>, e.g. <code>java.lang.Integer#&lt;init>(int)</code>.</li></ul><p>The error message displayed when the signature matches can be given at the end of each signature line using &ldquo;@&rdquo; as separator:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>java.lang.String @ You are crazy that you disallow strings
</span></span></span></code></pre></div></figure></div><p>To not repeat the same message after each signature, you can prepend signatures with a default message. Use a line starting with &ldquo;@defaultMessage&rdquo;.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>@defaultMessage You are crazy that you disallow substrings
</span></span></span><span class=line><span class=cl><span class=go>java.lang.String#substring(int)
</span></span></span><span class=line><span class=cl><span class=go>java.lang.String#substring(int,int)
</span></span></span></code></pre></div></figure></div><p>这里着重需要注意：</p><ul><li>按方法名定义时，一定要定义好参数类型，否则不生效。</li><li>按包名定义时，一定要区分好一个 <code>*</code> 和两个 <code>**</code>，一个<code>*</code>只能匹配一级，两个<code>**</code>能匹配 N 级。</li></ul><div class=tag-list-single><a class="btn btn-light" href=/tags/cicd/ role=button>CICD</a>
<a class="btn btn-light" href=/tags/java/ role=button>Java</a></div></div></div></article></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/>Powered by Hugo, and based on Doks</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Give Me a <a class=text-muted href=https://github.com/xlabs-club/>Star</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.8b717d53dae071196d91d0d0c63650fe240e84ffe50a76fdb433a914d6b216ec.js integrity="sha256-i3F9U9rgcRltkdDQxjZQ/iQOhP/lCnb9tDOpFNayFuw="></script><script async src=/js/app.592ddd2791734c581ee9465f923ca99817c6bcb2a5c2725df8c34f9def04b128.js integrity="sha256-WS3dJ5FzTFge6UZfkjypmBfGvLKlwnJd+MNPne8EsSg="></script><script async src=/js/docsearch.4c43898496d40210bc7d52e319d675a83a35016293221b53c5c2e544c50ab234.js integrity="sha256-TEOJhJbUAhC8fVLjGdZ1qDo1AWKTIhtTxcLlRMUKsjQ="></script></body></html>