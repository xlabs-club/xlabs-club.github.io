<!doctype html><html lang=zh data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.974962bbf902e2bb09d5f947751229907fea343148efc12fbb1ca3b61b799d102d62009b941a5835deabeee0a1d832801e2e7e8ffc5c4f77f2632d7d669f2736.css" integrity="sha512-l0liu/kC4rsJ1flHdRIpkH/qNDFI78Evuxyjtht5nRAtYgCblBpYNd6r7uCh2DKAHi5+j/xcT3fyYy19Zp8nNg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/blog/javax-jakarta-compatibility/><link rel=canonical href=https://www.xlabs.club/blog/javax-jakarta-compatibility/><title>Javax 和 Jakarta 过渡期兼容方案 - 企业级迁移指南</title><meta name=description content="详细介绍从 Javax 到 Jakarta EE 的迁移兼容方案，包括背景、工具选择和实施策略"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://www.xlabs.club/blog/javax-jakarta-compatibility/"><meta property="og:site_name" content="XLabs"><meta property="og:title" content="Javax 和 Jakarta 过渡期兼容方案"><meta property="og:description" content="详细介绍从 Javax 到 Jakarta EE 的迁移兼容方案，包括背景、工具选择和实施策略"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-09-14T14:33:23+08:00"><meta property="article:modified_time" content="2025-09-25T11:21:53+08:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="Spring Boot"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="Javax 和 Jakarta 过渡期兼容方案"><meta name=twitter:description content="详细介绍从 Javax 到 Jakarta EE 的迁移兼容方案，包括背景、工具选择和实施策略"><meta name=twitter:site content="@xlabs-club"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"卫星实验室","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"Javax 和 Jakarta 过渡期兼容方案","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"Javax 和 Jakarta 过渡期兼容方案 - 企业级迁移指南","description":"详细介绍从 Javax 到 Jakarta EE 的迁移兼容方案，包括背景、工具选择和实施策略","isPartOf":{"@id":"https://www.xlabs.club/blog/javax-jakarta-compatibility/"},"mainEntityOfPage":{"@id":"https://www.xlabs.club/blog/javax-jakarta-compatibility/"},"datePublished":"2025-09-14T14:33:23+08:00","dateModified":"2025-09-25T11:21:53+08:00","author":{"@type":"Organization","name":"XLabs Club 卫星实验室","url":"https://www.xlabs.club/"},"publisher":{"@type":"Organization","name":"XLabs Club 卫星实验室"}}]}</script><meta http-equiv=content-language content='zh-cn'></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/>XLabs</a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>XLabs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://www.xlabs.club/docs/guides/introduction/>Docs</a></li><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/blog/ aria-current=true>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/xlabs-link-exchange>Links</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/about/>About</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/xlabs-club/xlabs-club.github.io><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="container p-0"><article><div class="row justify-content-center"><div class="col-md-12 col-lg-11"><div class=blog-header><h1>Javax 和 Jakarta 过渡期兼容方案</h1><p><small>2025年9月14日&nbsp;&nbsp;<a class="stretched-link position-relative link-muted" href=/categories/java/>Java</a>, <a class="stretched-link position-relative link-muted" href=/categories/spring-boot/>Spring Boot</a>&nbsp;&nbsp;<a class="stretched-link position-relative" href=/contributors/l10178/>l10178</a><span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>5&nbsp;minutes</span></small></p></div></div><div class="col-md-12 col-lg-11"><h2 id=什么是-jakarta-ee为什么要切换>什么是 Jakarta EE，为什么要切换</h2><p>Jakarta EE 就是 Java EE 的新名词。这里的 EE 全称是 Enterprise Edition，它是专门为企业级 Java 应用定义的一套规范，与 Java SE (Java Platform, Standard Edition) 相对应。</p><p>Java EE 是从 Java 1.2 版本开始推出的 Java 企业级开发平台，最初的名称是 J2EE (Java 2 Platform, Enterprise Edition)。随着 Java 的发展，它的名称于 Java 1.5 版本时更改为 Java EE (Java Platform, Enterprise Edition)。2009 年 Oracle 收购了 Sun，Java EE 开始由 Oracle 通过 JCP (Java Community Process) 开发和维护。</p><p>直到 2017 年，Oracle 将 Java EE 提交给了 Eclipse 基金会，并命名为 Eclipse Enterprise for Java。然而，<strong>由于"Java"这个名字的商标归 Oracle 所有，Eclipse 基金会无法继续使用 <code>javax.*</code> 和 <code>java.*</code>，因此，项目名称改为 Jakarta EE</strong>。</p><p>Jakarta EE 包含了许多技术规范和 API，涵盖了 Web 应用、数据库访问、消息传递、事务处理、安全性等方面的功能，其中包括但不限于下列规范：</p><ul><li><p><strong>Jakarta Servlet</strong>：前身是 J2EE Servlet，定义了如何管理 HTTP 请求的规范。这应该是大部分 Java Web 开发者最熟悉的，同时也是许多其它规范的基础。</p></li><li><p><strong>Jakarta Server Page (JSP)</strong>：服务端动态生成网页的技术，可以看作 Java 版本的 PHP 和 ASP。</p></li><li><p><strong>Jakarta Websocket</strong>：定义了一套 WebSocket 连接相关的 API，用于实现全双工通信。</p></li><li><p><strong>Jakarta RESTful Web Services</strong>：开发符合 REST 原则的 Web 服务的一套规范。</p></li><li><p><strong>Jakarta JSON Binding</strong>：Java 类和 JSON 字符串互相转换的规范。</p></li><li><p><strong>Jakarta XML Binding</strong>：Java 类和 XML 的映射规范。</p></li><li><p><strong>Jakarta Enterprise Beans (EJB)</strong>：这个规范比较复杂，包括 EJB 容器，RMI（远程过程调用），并发控制，依赖注入等。</p></li><li><p><strong>Jakarta Persistent (JPA)</strong>：ORM 规范，定义了 Java 类和数据库表直接的映射规范。</p></li><li><p><strong>Jakarta Transactions (JTA)</strong>：包含了事务相关的接口和注解类，也用于管理分布式事务。</p></li><li><p><strong>Jakarta Messaging (JMS)</strong>：消息系统的规范，用于实现异步消息传递，比如 Apache 的 ActiveMQ 就实现了这套规范。</p></li></ul><h3 id=对研发的影响>对研发的影响</h3><h4 id=依赖包坐标和版本号变更>依赖包坐标和版本号变更</h4><p>比如常见的 servlet-api：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- 老版本 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>javax.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>javax.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>3.1.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 新版本 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>jakarta.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>jakarta.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>6.1.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span></span></span></code></pre></div></figure></div><h4 id=package-namespace-变更>package namespace 变更</h4><p>比如：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 老版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.Filter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 新版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.servlet.Filter</span><span class=p>;</span></span></span></code></pre></div></figure></div><h3 id=兼容性问题>兼容性问题</h3><p>如果不兼容会发生什么，比如：</p><h4 id=servlet-运行期错误>Servlet 运行期错误</h4><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>javax.servlet.ServletRequest can not cast to jakarta.servlet.ServletRequest</span></span></code></pre></div></figure></div><h4 id=数据库扫描失败映射错误>数据库扫描失败映射错误</h4><p>比如下面定义是 <code>javax.persistence.Table</code>，开源或者自定义的数据库中间件件一般习惯按注解 <code>jakarta.persistence.Table</code> 进行扫描：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>javax.persistence.Id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.persistence.Table</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;mt_field_extra&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>FieldExtra</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>scanTableName</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>clazz</span><span class=p>,</span><span class=w> </span><span class=n>PersistMeta</span><span class=w> </span><span class=n>meta</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>mapCamelCaseToUnderscore</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>jakarta</span><span class=p>.</span><span class=na>persistence</span><span class=p>.</span><span class=na>Table</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>clazz</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>jakarta</span><span class=p>.</span><span class=na>persistence</span><span class=p>.</span><span class=na>Table</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>tableName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=kc>null</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>table</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>tableName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>table</span><span class=p>.</span><span class=na>name</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>tableName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nameConvert</span><span class=p>(</span><span class=n>clazz</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>(),</span><span class=w> </span><span class=n>mapCamelCaseToUnderscore</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>如果项目能直接升级到最新版本当然更好，但是作为中间件团队提供的组件，往往需要在过渡期间提供一种兼容两种模式的方案，既能让原有老服务正常使用，又兼容 Spring Boot 3+ Jakarta EE 9+新服务。</p><p>Jakarta EE 兼容是一个复杂的课题，当前只记录 <code>package namespace</code> 差异解决方法。</p><h2 id=maven-本身特性说明>Maven 本身特性说明</h2><h3 id=父子-pom-依赖继承>父子 POM 依赖继承</h3><p>假设父 POM 使用 dependencyManagement 定义如下：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependencyManagement&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>1.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>2.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>3.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;classifier&gt;</span>jakarta<span class=nt>&lt;/classifier&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>3.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;classifier&gt;</span>jakarta-java21<span class=nt>&lt;/classifier&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>3.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;classifier&gt;</span>jakarta-java23<span class=nt>&lt;/classifier&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependencyManagement&gt;</span></span></span></code></pre></div></figure></div><p>Maven 官方文档说明：</p><blockquote><p><strong>NOTE:</strong> In two of these dependency references, we had to specify the <code>&lt;type/></code> element. This is because the minimal set of information for matching a dependency reference against a dependencyManagement section is actually <strong>{groupId, artifactId, type, classifier}</strong>. In many cases, these dependencies will refer to jar artifacts with no classifier. This allows us to shorthand the identity set to <strong>{groupId, artifactId}</strong>, since the default for the type field is jar, and the default classifier is null.</p></blockquote><p>基于以上说明，假设子模块，依次按以下方式填写 dependency，实际生效的是哪个：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 方式 1 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 方式 2 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>5.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 方式 3 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;classifier&gt;</span>jakarta<span class=nt>&lt;/classifier&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 方式 4，同时引入 2 个 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>com.tester<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>rocketmq-support<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;classifier&gt;</span>jakarta-java23<span class=nt>&lt;/classifier&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependencies&gt;</span></span></span></code></pre></div></figure></div><h3 id=profile-继承和传递>Profile 继承和传递</h3><p>假设有个第三方组件，比如 rocketmq-support，他定义了一个 profile 叫 jakarta，独立加了 dependencies，deploy 到中央仓库。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>jakarta<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>jakarta.servlet<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>jakarta.servlet-api<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>5.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/profile&gt;</span></span></span></code></pre></div></figure></div><p>有另外一个组件 B 依赖了 rocketmq-support，并且也定义了一个 jakarta profile 激活。那么这个组件 B 会自动依赖 jakarta.servlet-api 吗？</p><p><strong>不会</strong>。profile 为自身编译期服务，deploy 后失效。</p><p>如果 deploy 后还能依赖传递的话，那某些人定义写一些恶意代码和插件然后定义一堆通用的 profile，比如大家喜欢叫 dev，然后 deploy 就能变相投毒了。</p><p>如果父 pom 定义了 profile，子模块直接引用，是会继承生效的。</p><h2 id=主流的辅助工具>主流的辅助工具</h2><h3 id=tomcat-migration-tool>Tomcat Migration Tool</h3><p><a href=https://github.com/apache/tomcat-jakartaee-migration target=_blank rel=noopener>Tomcat Migration Tool</a>
是 Apache Tomcat 提供的迁移工具。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java -jar jakartaee-migration-*-shaded.jar &lt;source&gt; &lt;destination&gt;</span></span></code></pre></div></figure></div><p>The source should be a path to a compressed archive, a folder or an individual file. The destination will be created at the specified path as a resource of the same type as the source.</p><p><strong>用途：</strong></p><ul><li>字节码转换</li><li>已有项目，甚至无源码项目，直接转换。只负责转换制品，要想给别人用需自己手动 deploy</li><li>一个 javax war 转换后放到 Tomcat 10，理论上可运行</li></ul><p><strong>缺陷：</strong></p><ul><li>解决不了本地开发 Debug 期间编译、运行的问题，如果不兼容本地启动、Test 失败</li></ul><p>另外 Tomcat 10 提供了一种自动转换的方法，参考文档：<a href=https://tomcat.apache.org/migration-10.html target=_blank rel=noopener>https://tomcat.apache.org/migration-10.html</a>
将 war 放到 webapps-javaee 目录下，就会自动转换后放到 webapp 下运行。然而这种方案最大的问题在于：</p><ol><li>必须是基于外置 Tomcat，不支持 Spring Boot Jar 形式运行。</li><li>转换需要时间，这是时间基本上都是 1~10 分钟之间，对应用重启、快速扩缩容都有很大的副作用。</li></ol><h3 id=maven-shade-plugin>maven-shade-plugin</h3><p><strong>用途：</strong></p><ul><li>字节码转换</li><li>需要配置详细的转换规则</li></ul><p><strong>缺陷：</strong></p><ul><li>解决不了本地开发 Debug 期间编译、运行的问题，本地启动、Test 失败</li></ul><h3 id=maven-assembly-plugin>maven-assembly-plugin</h3><p>上面我们都是假设只有 javax 和 jakarta namespace 差异，只需要转换字节码。但是，</p><ul><li>如果有某个 Java 方法不兼容需要重写一个版本怎么办</li><li>配置文件比如 xml 有差异怎么办</li></ul><p>assembly-plugin 就可以帮助我们通过 include、exclude 不同的源码、resource、依赖项，重组编译发布不同的包。</p><p>这是适合复杂不兼容的代码，但是对于多模块项目，需要某个模块开发指定 assembly xml，会非常痛苦。</p><p>目前其他几种工具只处理 javax 和 jakarta package 差异，后续肯定会遇到除了 package 不同，接口或使用方式也不兼容的情况，等遇到了再单独处理。</p><h3 id=openrewrite>OpenRewrite</h3><p>OpenRewrite 迁移菜谱 <a href=https://docs.openrewrite.org/recipes/java/migrate/jakarta/javaxmigrationtojakarta target=_blank rel=noopener>Migrate to Jakarta EE 9</a>
。</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 命令行运行</span>
</span></span><span class=line><span class=cl>mvn -U org.openrewrite.maven:rewrite-maven-plugin:run <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -Drewrite.recipeArtifactCoordinates<span class=o>=</span>org.openrewrite.recipe:rewrite-migrate-java:RELEASE <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -Drewrite.activeRecipes<span class=o>=</span>org.openrewrite.java.migrate.jakarta.JavaxMigrationToJakarta <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -Drewrite.exportDatatables<span class=o>=</span>false</span></span></code></pre></div></figure></div><p><strong>用途：</strong></p><ul><li>源码级别转换，直接自动改代码</li><li>除了代码，还能自动改写 pom 依赖</li></ul><p><strong>缺陷：</strong></p><ul><li>多模块目前适配还不完善，对于多模块，需要每个模块处理一次</li><li>复杂代码可能转换失败，失败后可能导致编译失败，无法一键编译，需要人工介入</li><li>改 pom 时，他会自己强制指定版本号，实际上我们希望用父 pom 管理版本号</li><li>速度稍慢，遍历并修改文件源码，然后编译</li></ul><h3 id=transformer-maven-plugin>transformer-maven-plugin</h3><p><a href=https://github.com/eclipse-transformer/transformer target=_blank rel=noopener>transformer-maven-plugin</a>
是 eclipse 出的字节码和配置文件转换工具，默认内置了一些 jakarta 的替换规则。</p><p>它能帮我们实现：</p><ul><li>同时打包（或发布）出 javax 和 jakarta 两个包，通过 classifier 区分，比如设置 javax 默认 classifier 为 null，转换后的版本设置 classifier 为 jakarta。</li><li>只打包（或发布）javax 和 jakarta 任意一个版本。</li><li>web.xml 或 web-fragment.xml 等相关 xml 定义转换。</li></ul><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 这个插件自动把 javax 转为 jakarta，打包出 javax 和 jakarta 两个包，通过 classifier 区分 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.eclipse.transformer<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>transformer-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;extensions&gt;</span>true<span class=nt>&lt;/extensions&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=c>&lt;!-- javax 替换成 jakarta --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;id&gt;</span>jakarta-jar<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;phase&gt;</span>package<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goal&gt;</span>jar<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;rules&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;jakartaDefaults&gt;</span>true<span class=nt>&lt;/jakartaDefaults&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/rules&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;artifact&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;groupId&gt;</span>${project.groupId}<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;artifactId&gt;</span>${project.artifactId}<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/artifact&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span></span></span></code></pre></div></figure></div><p><strong>用途：</strong></p><ul><li>字节码转换</li><li>支持 web 相关 xml 定义自动替换，比如 web-fragment.xml <code>xmlns="http://xmlns.jcp.org/xml/ns/javaee"</code></li><li>转换和 deploy 可以一步到位，速度快很方便</li><li>如果是多模块，可以在根父模块声明一次，一键全部编译</li></ul><p><strong>缺陷：</strong></p><ul><li>不处理 pom 依赖关系，发布出的 Jakarta 版本依赖项都遵循原 pom 声明</li></ul><p>此插件运行需要 Java 21 版本，发布业务包的时候，必须使用 Java 21 编译，编译目标 release 版本可以是 Java 8，在 pom 中增加以下设置：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;java.version&gt;</span>21<span class=nt>&lt;/java.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;maven.compiler.release&gt;</span>8<span class=nt>&lt;/maven.compiler.release&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/properties&gt;</span></span></span></code></pre></div></figure></div><h4 id=web-fragmentxml-适配>web-fragment.xml 适配</h4><p>一般咱们典型的 web-fragment 定义有如下两个版本，3.0 和 3.1：</p><p><strong>3.0 版本：</strong></p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;web-fragment</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns=</span><span class=s>&#34;http://java.sun.com/xml/ns/javaee&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://java.sun.com/xml/ns/javaee
</span></span></span><span class=line><span class=cl><span class=s>        http://java.sun.com/xml/ns/javaee/web-fragment_3_0.xsd&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>version=</span><span class=s>&#34;3.0&#34;</span> <span class=na>metadata-complete=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/web-fragment&gt;</span></span></span></code></pre></div></figure></div><p><strong>3.1 版本：</strong></p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;web-fragment</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee
</span></span></span><span class=line><span class=cl><span class=s>        http://xmlns.jcp.org/xml/ns/javaee/web-fragment_3_1.xsd&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>version=</span><span class=s>&#34;3.1&#34;</span> <span class=na>metadata-complete=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/web-fragment&gt;</span></span></span></code></pre></div></figure></div><p>其中涉及 jakarta 修改的替换的是其中的 xmlns、xsi、version 字段。</p><p>Tomcat 8 以后支持 3.1 版本并兼容 3.0 版本，Tomcat 7 对应 3.0 版本。</p><p>transformer-maven-plugin 已经不支持 3.0 版本的替换，所以如果还在用 3.0 的需要咱们手动改成以上 3.1 版本的定义，transformer-maven-plugin 在转换的过程中才能自动升级到 jakarta，自动升级后，升级到 5.0 后的结果如下：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;web-fragment</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns=</span><span class=s>&#34;https://jakarta.ee/xml/ns/jakartaee&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xsi:schemaLocation=</span><span class=s>&#34;https://jakarta.ee/xml/ns/jakartaee
</span></span></span><span class=line><span class=cl><span class=s>        https://jakarta.ee/xml/ns/jakartaee/web-fragment_5_0.xsd&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>version=</span><span class=s>&#34;5.0&#34;</span> <span class=na>metadata-complete=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/web-fragment&gt;</span></span></span></code></pre></div></figure></div><h4 id=跳过转换>跳过转换</h4><p>我们的 maven 项目大部分都是多模块，对于打包成 war 自运行不需要发布给别人用的项目，一般都不需要转换，可以设置 properties <code>transform.skip=true</code> 跳过。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 不发布 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;maven.deploy.skip&gt;</span>true<span class=nt>&lt;/maven.deploy.skip&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 不转换 --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;transform.skip&gt;</span>true<span class=nt>&lt;/transform.skip&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/properties&gt;</span></span></span></code></pre></div></figure></div><h2 id=实施方案>实施方案</h2><h3 id=classifier-vs-version>Classifier vs Version</h3><p>业界主流方案就是用版本号区分或者用 classifier 区分这两种方案。</p><p>classifier 最主要的问题是无法通过父 pom 继承，这样将导致各个业务方需要大量改 pom.xml 文件。</p><p>假设一个项目依赖了 app-a，而 app-a 又依赖 b、c、d.</p><p>首先因为父 pom 定义 classifier 并不会继承。那么，我是不是指定 app-a 的 classifier 就行了。</p><p>不是，除非 app-a 的特定 classifier 自身 pom 里已经为给个模块指定了 classifier，否则 app-a 依赖的各个都要重新指定一遍，这就使用 pom 文件长得又长又臭。如果哪天 app-a 又新增依赖 e, 但是使用者漏掉了 e classifier 声明的，就可能带来问题，这是很危险的动作。</p><p>所以我们最终选择用版本号来区分。</p><h3 id=使用特定版本>使用特定版本</h3><p>版本号规则，在原版本基础上增加固定前缀：<code>9999.${project.version}</code>，如原 <code>9.6.0</code> 对应的 jakarta 版本号是 <code>9999.9.6.0</code>。</p><p>父 pom 区分版本号，Spring Boot 3.x 版本依赖，重申版本号。</p><p>这样各个使用者，只需要选择不同的父 pom，遵循父 pom 版本定义，dependency 可以原样不变。</p><h4 id=如何打包发布>如何打包发布</h4><p>目前暂定选择 transformer-maven-plugin，他不完美，但是足够快，相对稳定。</p><p>发布目标：两次发布，第一次发布常规版本，第二次发布自动转换后的版本，版本号增加前缀。</p><p><strong>发布步骤：</strong></p><p>在公司级父 pom 增加如下 profile：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;profiles&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id&gt;</span>jakarta-transformer<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;groupId&gt;</span>org.eclipse.transformer<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;artifactId&gt;</span>transformer-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;version&gt;</span>1.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;extensions&gt;</span>true<span class=nt>&lt;/extensions&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=c>&lt;!-- 此处配置 javax 替换成 jakarta，artifactId 不变，无 classifier --&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=nt>&lt;id&gt;</span>jakarta-jar<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=nt>&lt;phase&gt;</span>package<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                                <span class=nt>&lt;goal&gt;</span>jar<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>                                <span class=nt>&lt;rules&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=nt>&lt;jakartaDefaults&gt;</span>true<span class=nt>&lt;/jakartaDefaults&gt;</span>
</span></span><span class=line><span class=cl>                                <span class=nt>&lt;/rules&gt;</span>
</span></span><span class=line><span class=cl>                                <span class=nt>&lt;artifact&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=nt>&lt;groupId&gt;</span>${project.groupId}<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=nt>&lt;artifactId&gt;</span>${project.artifactId}<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>                                <span class=nt>&lt;/artifact&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/profiles&gt;</span></span></span></code></pre></div></figure></div><p>发布 jakarta 版本时，先改版本号增加前缀，再指定 profile 发布：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 获取当前版本号</span>
</span></span><span class=line><span class=cl>mvn help:evaluate -Dexpression<span class=o>=</span>project.version -q -DforceStdout
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果项目都是自己写版本号的，使用 version 插件设置新版本号，增加前缀</span>
</span></span><span class=line><span class=cl>mvn versions:set -DnewVersion<span class=o>=</span>9999.9.6.0 -DgenerateBackupPoms<span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重新发布，指定 -Pjakarta profile，父 pom 里的插件自动转换 javax</span>
</span></span><span class=line><span class=cl>mvn deploy -Pjakarta-transformer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 如果使用 flatten-maven-plugin 插件管理版本号的，设置 revision</span>
</span></span><span class=line><span class=cl>mvn deploy -Drevision<span class=o>=</span>9999.9.6.0 -Pjakarta-transformer</span></span></code></pre></div></figure></div><div class=tag-list-single><a class="btn btn-light" href=/tags/java/ role=button>Java</a>
<a class="btn btn-light" href=/tags/spring-boot/ role=button>Spring Boot</a></div></div></div></article></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/>Powered by Hugo, and based on Doks</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Give Me a <a class=text-muted href=https://github.com/xlabs-club/>Star</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.8b717d53dae071196d91d0d0c63650fe240e84ffe50a76fdb433a914d6b216ec.js integrity="sha256-i3F9U9rgcRltkdDQxjZQ/iQOhP/lCnb9tDOpFNayFuw="></script><script async src=/js/app.592ddd2791734c581ee9465f923ca99817c6bcb2a5c2725df8c34f9def04b128.js integrity="sha256-WS3dJ5FzTFge6UZfkjypmBfGvLKlwnJd+MNPne8EsSg="></script><script async src=/js/docsearch.4c43898496d40210bc7d52e319d675a83a35016293221b53c5c2e544c50ab234.js integrity="sha256-TEOJhJbUAhC8fVLjGdZ1qDo1AWKTIhtTxcLlRMUKsjQ="></script></body></html>